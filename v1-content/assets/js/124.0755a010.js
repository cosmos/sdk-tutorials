(window.webpackJsonp=window.webpackJsonp||[]).push([[124],{743:function(e,t,a){"use strict";a.r(t);var o=a(1),s=Object(o.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"message-and-handler-make-sure-a-player-can-reject-a-game"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#message-and-handler-make-sure-a-player-can-reject-a-game"}},[e._v("#")]),e._v(" Message and Handler - Make Sure a Player Can Reject a Game")]),e._v(" "),a("HighlightBox",{attrs:{type:"prerequisite"}},[a("p",[e._v("Before proceeding, make sure you have all you need:")]),e._v(" "),a("ul",[a("li",[e._v("You understand the concepts of "),a("RouterLink",{attrs:{to:"/academy/2-main-concepts/transactions.html"}},[e._v("transactions")]),e._v(", "),a("RouterLink",{attrs:{to:"/academy/2-main-concepts/messages.html"}},[e._v("messages")]),e._v("), and "),a("RouterLink",{attrs:{to:"/academy/2-main-concepts/protobuf.html"}},[e._v("Protobuf")]),e._v(".")],1),e._v(" "),a("li",[e._v("You know how to "),a("RouterLink",{attrs:{to:"/academy/3-my-own-chain/create-message.html"}},[e._v("create a message")]),e._v(" with Ignite CLI, and code "),a("RouterLink",{attrs:{to:"/academy/3-my-own-chain/create-handling.html"}},[e._v("its handling")]),e._v(". This section does not aim to repeat what can be learned in earlier sections.")],1),e._v(" "),a("li",[e._v("Go is installed.")]),e._v(" "),a("li",[e._v("You have the checkers blockchain codebase with the previous messages and their events. If not, follow the "),a("RouterLink",{attrs:{to:"/academy/3-my-own-chain/events.html"}},[e._v("previous steps")]),e._v(" or check out the "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/tree/v1-two-events",target:"_blank",rel:"noopener noreferrer"}},[e._v("relevant version"),a("OutboundLink")],1),e._v(".")],1)])]),e._v(" "),a("HighlightBox",{attrs:{type:"learning"}},[a("p",[e._v("In this section, you will:")]),e._v(" "),a("ul",[a("li",[e._v("Add a new protocol rule.")]),e._v(" "),a("li",[e._v("Define custom errors.")]),e._v(" "),a("li",[e._v("Add a message handler.")]),e._v(" "),a("li",[e._v("Extend unit tests.")])])]),e._v(" "),a("p",[e._v("Your blockchain can now create and play games, and inform the outside world about the process. It would be good to add a way for players to back out of games they do not want to play. What do you need to make this possible?")]),e._v(" "),a("h2",{attrs:{id:"some-initial-thoughts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#some-initial-thoughts"}},[e._v("#")]),e._v(" Some initial thoughts")]),e._v(" "),a("p",[e._v("Ask yourself:")]),e._v(" "),a("ul",[a("li",[e._v("What goes into the message?")]),e._v(" "),a("li",[e._v("How do you sanitize the inputs?")]),e._v(" "),a("li",[e._v("How do you unequivocally identify games?")]),e._v(" "),a("li",[e._v("What conditions have to be satisfied to reject a game?")]),e._v(" "),a("li",[e._v("How do you report back errors?")]),e._v(" "),a("li",[e._v("What event should you emit?")]),e._v(" "),a("li",[e._v("How do you use your files that implement the Checkers rules?")]),e._v(" "),a("li",[e._v("What do you do with a rejected game?")])]),e._v(" "),a("h2",{attrs:{id:"code-needs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#code-needs"}},[e._v("#")]),e._v(" Code needs")]),e._v(" "),a("p",[e._v("When you think about the code you might need, try to first answer the following questions:")]),e._v(" "),a("ul",[a("li",[e._v("What Ignite CLI commands will create your message?")]),e._v(" "),a("li",[e._v("How do you adjust what Ignite CLI created for you?")]),e._v(" "),a("li",[e._v("How would you unit-test these new elements?")]),e._v(" "),a("li",[e._v("How would you use Ignite CLI to locally run a one-node blockchain and interact with it via the CLI to see what you get?")])]),e._v(" "),a("p",[e._v("As before, do not bother yet with niceties like gas metering.")]),e._v(" "),a("p",[e._v("If anyone can create a game for any two other players, it is important to allow a player to reject a game. But a player should not be allowed to reject a game once they have made their first move.")]),e._v(" "),a("p",[e._v("To reject a game, a player needs to provide the ID of the game that the player wants to reject. Call the field "),a("code",[e._v("idValue")]),e._v(". This should be sufficient, as the signer of the message is implicitly the player.")]),e._v(" "),a("h2",{attrs:{id:"working-with-ignite-cli"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#working-with-ignite-cli"}},[e._v("#")]),e._v(" Working with Ignite CLI")]),e._v(" "),a("p",[e._v("Name the message object "),a("code",[e._v("RejectGame")]),e._v(". Invoke Ignite CLI:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBpZ25pdGUgc2NhZmZvbGQgbWVzc2FnZSByZWplY3RHYW1lIGlkVmFsdWUgLS1tb2R1bGUgY2hlY2tlcnMK"}}),e._v(" "),a("p",[e._v("This creates all the boilerplate for you and leaves a single place for the code you want to include:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAoayBtc2dTZXJ2ZXIpIFJlamVjdEdhbWUoZ29DdHggY29udGV4dC5Db250ZXh0LCBtc2cgKnR5cGVzLk1zZ1JlamVjdEdhbWUpICgqdHlwZXMuTXNnUmVqZWN0R2FtZVJlc3BvbnNlLCBlcnJvcikgewogICAgY3R4IDo9IHNkay5VbndyYXBTREtDb250ZXh0KGdvQ3R4KQoKICAgIC8vIFRPRE86IEhhbmRsaW5nIHRoZSBtZXNzYWdlCiAgICBfID0gY3R4CgogICAgcmV0dXJuICZhbXA7dHlwZXMuTXNnUmVqZWN0R2FtZVJlc3BvbnNle30sIG5pbAp9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/93d048c/x/checkers/keeper/msg_server_reject_game.go#L10-L17"}}),e._v(" "),a("h2",{attrs:{id:"additional-information"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#additional-information"}},[e._v("#")]),e._v(" Additional information")]),e._v(" "),a("p",[e._v("A new rule of the game should be that a player cannot reject a game once they begin to play. When loading a "),a("code",[e._v("StoredGame")]),e._v(" from storage you have no way of knowing whether a player already played or not. To access this information add a new field to the "),a("code",[e._v("StoredGame")]),e._v(" called "),a("code",[e._v("MoveCount")]),e._v(". In "),a("code",[e._v("proto/checkers/stored_game.proto")]),e._v(":")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"protobuf",base64:"bWVzc2FnZSBTdG9yZWRHYW1lIHsKICAgIC4uLgogICAgdWludDY0IG1vdmVDb3VudCA9IDc7Cn0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/59db7fb5/proto/checkers/stored_game.proto#L13"}}),e._v(" "),a("p",[e._v("Run Protobuf to recompile the relevant Go files:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBpZ25pdGUgZ2VuZXJhdGUgcHJvdG8tZ28K"}}),e._v(" "),a("p",[a("code",[e._v("MoveCount")]),e._v(" should start at "),a("code",[e._v("0")]),e._v(" and increment by "),a("code",[e._v("1")]),e._v(" on each move. Adjust it first in the handler when creating the game:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"c3RvcmVkR2FtZSA6PSB0eXBlcy5TdG9yZWRHYW1lewogICAgLi4uCiAgICBNb3ZlQ291bnQ6IDAsCn0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/59db7fb5/x/checkers/keeper/msg_server_create_game.go#L28"}}),e._v(" "),a("p",[e._v("Before saving to the storage, in the handler when playing a move:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Li4uCnN0b3JlZEdhbWUuTW92ZUNvdW50KysKc3RvcmVkR2FtZS5HYW1lID0gZ2FtZS5TdHJpbmcoKQouLi4K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/59db7fb5/x/checkers/keeper/msg_server_play_move.go#L59"}}),e._v(" "),a("p",[e._v("With "),a("code",[e._v("MoveCount")]),e._v(" counting properly, you are now ready to handle a rejection request.")]),e._v(" "),a("h2",{attrs:{id:"the-reject-handling"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#the-reject-handling"}},[e._v("#")]),e._v(" The reject handling")]),e._v(" "),a("p",[e._v("To follow the Cosmos SDK conventions, declare the following new errors:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"RXJyUmVkQWxyZWFkeVBsYXllZCAgID0gc2RrZXJyb3JzLlJlZ2lzdGVyKE1vZHVsZU5hbWUsIDExMDgsICZxdW90O3JlZCBwbGF5ZXIgaGFzIGFscmVhZHkgcGxheWVkJnF1b3Q7KQpFcnJCbGFja0FscmVhZHlQbGF5ZWQgPSBzZGtlcnJvcnMuUmVnaXN0ZXIoTW9kdWxlTmFtZSwgMTEwOSwgJnF1b3Q7YmxhY2sgcGxheWVyIGhhcyBhbHJlYWR5IHBsYXllZCZxdW90OykK",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/59db7fb5/x/checkers/types/errors.go#L19-L20"}}),e._v(" "),a("p",[e._v("Now you will add an event for rejection. Begin by preparing the new keys:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Y29uc3QgKAogICAgUmVqZWN0R2FtZUV2ZW50S2V5ICAgICA9ICZxdW90O0dhbWVSZWplY3RlZCZxdW90OwogICAgUmVqZWN0R2FtZUV2ZW50Q3JlYXRvciA9ICZxdW90O0NyZWF0b3ImcXVvdDsKICAgIFJlamVjdEdhbWVFdmVudElkVmFsdWUgPSAmcXVvdDtJZFZhbHVlJnF1b3Q7CikK",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/59db7fb5/x/checkers/types/keys.go#L41-L45"}}),e._v(" "),a("p",[e._v("In the message handler, the reject steps are:")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("Fetch the relevant information:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"c3RvcmVkR2FtZSwgZm91bmQgOj0gay5LZWVwZXIuR2V0U3RvcmVkR2FtZShjdHgsIG1zZy5JZFZhbHVlKQppZiAhZm91bmQgewogICAgcmV0dXJuIG5pbCwgc2RrZXJyb3JzLldyYXBmKHR5cGVzLkVyckdhbWVOb3RGb3VuZCwgJnF1b3Q7Z2FtZSBub3QgZm91bmQgJXMmcXVvdDssIG1zZy5JZFZhbHVlKQp9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/59db7fb5/x/checkers/keeper/msg_server_reject_game.go#L15-L18"}})],1),e._v(" "),a("li",[a("p",[e._v("Is the player expected? Did the player already play? Check with:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"aWYgc3RyaW5ncy5Db21wYXJlKHN0b3JlZEdhbWUuUmVkLCBtc2cuQ3JlYXRvcikgPT0gMCB7CiAgICBpZiAxICZsdDsgc3RvcmVkR2FtZS5Nb3ZlQ291bnQgeyAvLyBOb3RpY2UgdGhlIHVzZSBvZiB0aGUgbmV3IGZpZWxkCiAgICAgICAgcmV0dXJuIG5pbCwgdHlwZXMuRXJyUmVkQWxyZWFkeVBsYXllZAogICAgfQp9IGVsc2UgaWYgc3RyaW5ncy5Db21wYXJlKHN0b3JlZEdhbWUuQmxhY2ssIG1zZy5DcmVhdG9yKSA9PSAwIHsKICAgIGlmIDAgJmx0OyBzdG9yZWRHYW1lLk1vdmVDb3VudCB7IC8vIE5vdGljZSB0aGUgdXNlIG9mIHRoZSBuZXcgZmllbGQKICAgICAgICByZXR1cm4gbmlsLCB0eXBlcy5FcnJCbGFja0FscmVhZHlQbGF5ZWQKICAgIH0KfSBlbHNlIHsKICAgIHJldHVybiBuaWwsIHR5cGVzLkVyckNyZWF0b3JOb3RQbGF5ZXIKfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/59db7fb5/x/checkers/keeper/msg_server_reject_game.go#L21-L31"}}),e._v(" "),a("p",[e._v("Remember that the player with the color black plays first.")])],1),e._v(" "),a("li",[a("p",[e._v("Remove the game using the "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/create-game-msg/x/checkers/keeper/stored_game.go#L30",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("Keeper.RemoveStoredGame")]),a("OutboundLink")],1),e._v(" function created long ago by the "),a("code",[e._v("ignite scaffold map storedGame...")]),e._v(" command:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ay5LZWVwZXIuUmVtb3ZlU3RvcmVkR2FtZShjdHgsIG1zZy5JZFZhbHVlKQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/59db7fb5/x/checkers/keeper/msg_server_reject_game.go#L34"}})],1),e._v(" "),a("li",[a("p",[e._v("Emit the relevant event:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Y3R4LkV2ZW50TWFuYWdlcigpLkVtaXRFdmVudCgKICAgIHNkay5OZXdFdmVudChzZGsuRXZlbnRUeXBlTWVzc2FnZSwKICAgICAgICBzZGsuTmV3QXR0cmlidXRlKHNkay5BdHRyaWJ1dGVLZXlNb2R1bGUsICZxdW90O2NoZWNrZXJzJnF1b3Q7KSwKICAgICAgICBzZGsuTmV3QXR0cmlidXRlKHNkay5BdHRyaWJ1dGVLZXlBY3Rpb24sIHR5cGVzLlJlamVjdEdhbWVFdmVudEtleSksCiAgICAgICAgc2RrLk5ld0F0dHJpYnV0ZSh0eXBlcy5SZWplY3RHYW1lRXZlbnRDcmVhdG9yLCBtc2cuQ3JlYXRvciksCiAgICAgICAgc2RrLk5ld0F0dHJpYnV0ZSh0eXBlcy5SZWplY3RHYW1lRXZlbnRJZFZhbHVlLCBtc2cuSWRWYWx1ZSksCiAgICApLAopCg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/59db7fb5/x/checkers/keeper/msg_server_reject_game.go#L37-L44"}})],1),e._v(" "),a("li",[a("p",[e._v("Leave the returned object as it is, as you have nothing new to tell the caller.")])])]),e._v(" "),a("p",[e._v("Finally, confirm that your project at least compiles "),a("a",{attrs:{href:"https://docs.ignite.com/cli/#ignite-chain-build",target:"_blank",rel:"noopener noreferrer"}},[e._v("with"),a("OutboundLink")],1),e._v(":")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBpZ25pdGUgY2hhaW4gYnVpbGQK"}}),e._v(" "),a("h2",{attrs:{id:"unit-tests"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#unit-tests"}},[e._v("#")]),e._v(" Unit tests")]),e._v(" "),a("p",[e._v("The tests here are similar to those you created for "),a("em",[e._v("create")]),e._v(" and "),a("em",[e._v("play")]),e._v(", except that now you test a game rejection "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/59db7fb5/x/checkers/keeper/msg_server_reject_game_test.go#L27-L35",target:"_blank",rel:"noopener noreferrer"}},[e._v("by the game creator"),a("OutboundLink")],1),e._v(", the "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/59db7fb5/x/checkers/keeper/msg_server_reject_game_test.go#L199-L215",target:"_blank",rel:"noopener noreferrer"}},[e._v("black player"),a("OutboundLink")],1),e._v(", or the "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/59db7fb5/x/checkers/keeper/msg_server_reject_game_test.go#L83-L91",target:"_blank",rel:"noopener noreferrer"}},[e._v("red player"),a("OutboundLink")],1),e._v(" which is made "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/59db7fb5/x/checkers/keeper/msg_server_reject_game_test.go#L37-L45",target:"_blank",rel:"noopener noreferrer"}},[e._v("before anyone has played"),a("OutboundLink")],1),e._v(", or after "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/59db7fb5/x/checkers/keeper/msg_server_reject_game_test.go#L129-L145",target:"_blank",rel:"noopener noreferrer"}},[e._v("one"),a("OutboundLink")],1),e._v(" or "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/59db7fb5/x/checkers/keeper/msg_server_reject_game_test.go#L217-L241",target:"_blank",rel:"noopener noreferrer"}},[e._v("two moves"),a("OutboundLink")],1),e._v(" have been made. Check also that the "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/59db7fb5/x/checkers/keeper/msg_server_reject_game_test.go#L47-L61",target:"_blank",rel:"noopener noreferrer"}},[e._v("game is removed"),a("OutboundLink")],1),e._v(", and that "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/59db7fb5/x/checkers/keeper/msg_server_reject_game_test.go#L63-L81",target:"_blank",rel:"noopener noreferrer"}},[e._v("events are emitted"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("p",[e._v("For instance:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBUZXN0UmVqZWN0R2FtZUJ5UmVkT25lTW92ZVJlbW92ZWRHYW1lKHQgKnRlc3RpbmcuVCkgewogICAgbXNnU2VydmVyLCBrZWVwZXIsIGNvbnRleHQgOj0gc2V0dXBNc2dTZXJ2ZXJXaXRoT25lR2FtZUZvclJlamVjdEdhbWUodCkKICAgIG1zZ1NlcnZlci5QbGF5TW92ZShjb250ZXh0LCAmYW1wO3R5cGVzLk1zZ1BsYXlNb3ZlewogICAgICAgIENyZWF0b3I6IGNhcm9sLAogICAgICAgIElkVmFsdWU6ICZxdW90OzEmcXVvdDssCiAgICAgICAgRnJvbVg6ICAgMSwKICAgICAgICBGcm9tWTogICAyLAogICAgICAgIFRvWDogICAgIDIsCiAgICAgICAgVG9ZOiAgICAgMywKICAgIH0pCiAgICBtc2dTZXJ2ZXIuUmVqZWN0R2FtZShjb250ZXh0LCAmYW1wO3R5cGVzLk1zZ1JlamVjdEdhbWV7CiAgICAgICAgQ3JlYXRvcjogYm9iLAogICAgICAgIElkVmFsdWU6ICZxdW90OzEmcXVvdDssCiAgICB9KQogICAgbmV4dEdhbWUsIGZvdW5kIDo9IGtlZXBlci5HZXROZXh0R2FtZShzZGsuVW53cmFwU0RLQ29udGV4dChjb250ZXh0KSkKICAgIHJlcXVpcmUuVHJ1ZSh0LCBmb3VuZCkKICAgIHJlcXVpcmUuRXF1YWxWYWx1ZXModCwgdHlwZXMuTmV4dEdhbWV7CiAgICAgICAgQ3JlYXRvcjogJnF1b3Q7JnF1b3Q7LAogICAgICAgIElkVmFsdWU6IDIsCiAgICB9LCBuZXh0R2FtZSkKICAgIF8sIGZvdW5kID0ga2VlcGVyLkdldFN0b3JlZEdhbWUoc2RrLlVud3JhcFNES0NvbnRleHQoY29udGV4dCksICZxdW90OzEmcXVvdDspCiAgICByZXF1aXJlLkZhbHNlKHQsIGZvdW5kKQp9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/59db7fb5/x/checkers/keeper/msg_server_reject_game_test.go#L147-L169"}}),e._v(" "),a("h2",{attrs:{id:"interact-with-the-cli"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#interact-with-the-cli"}},[e._v("#")]),e._v(" Interact with the CLI")]),e._v(" "),a("p",[e._v("Time to see if it is possible to reject a game.")]),e._v(" "),a("p",[e._v("First, is it possible to reject the current game from the command line?")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBjaGVja2Vyc2QgdHggY2hlY2tlcnMgLS1oZWxwCg=="}}),e._v(" "),a("p",[e._v("This prints:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"undefined",base64:"Li4uCkF2YWlsYWJsZSBDb21tYW5kczoKLi4uCiAgcmVqZWN0LWdhbWUgQnJvYWRjYXN0IG1lc3NhZ2UgcmVqZWN0R2FtZQo="}}),e._v(" "),a("p",[a("code",[e._v("reject-game")]),e._v(" is the command. What is its syntax?")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBjaGVja2Vyc2QgdHggY2hlY2tlcnMgcmVqZWN0LWdhbWUgLS1oZWxwCg=="}}),e._v(" "),a("p",[e._v("This prints:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"undefined",base64:"Li4uClVzYWdlOgogIGNoZWNrZXJzZCB0eCBjaGVja2VycyByZWplY3QtZ2FtZSBbaWRWYWx1ZV0gW2ZsYWdzXQo="}}),e._v(" "),a("p",[e._v("Have Alice, who played poorly in game "),a("code",[e._v("1")]),e._v(", try to reject it:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBjaGVja2Vyc2QgdHggY2hlY2tlcnMgcmVqZWN0LWdhbWUgMSAtLWZyb20gJGFsaWNlCg=="}}),e._v(" "),a("p",[e._v("This returns:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"undefined",base64:"Li4uCnJhd19sb2c6ICdbeyZxdW90O2V2ZW50cyZxdW90OzpbeyZxdW90O3R5cGUmcXVvdDs6JnF1b3Q7bWVzc2FnZSZxdW90OywmcXVvdDthdHRyaWJ1dGVzJnF1b3Q7Olt7JnF1b3Q7a2V5JnF1b3Q7OiZxdW90O2FjdGlvbiZxdW90OywmcXVvdDt2YWx1ZSZxdW90OzomcXVvdDtSZWplY3RHYW1lJnF1b3Q7fSx7JnF1b3Q7a2V5JnF1b3Q7OiZxdW90O21vZHVsZSZxdW90OywmcXVvdDt2YWx1ZSZxdW90OzomcXVvdDtjaGVja2VycyZxdW90O30seyZxdW90O2tleSZxdW90OzomcXVvdDthY3Rpb24mcXVvdDssJnF1b3Q7dmFsdWUmcXVvdDs6JnF1b3Q7R2FtZVJlamVjdGVkJnF1b3Q7fSx7JnF1b3Q7a2V5JnF1b3Q7OiZxdW90O0NyZWF0b3ImcXVvdDssJnF1b3Q7dmFsdWUmcXVvdDs6JnF1b3Q7Y29zbW9zMWdtbDA1bnZsaHIwazI3dW5hczhtajgyN3o2bTc3bGhmcHp6cjNsJnF1b3Q7fSx7JnF1b3Q7a2V5JnF1b3Q7OiZxdW90O0lkVmFsdWUmcXVvdDssJnF1b3Q7dmFsdWUmcXVvdDs6JnF1b3Q7MSZxdW90O31dfV19XScK"}}),e._v(" "),a("p",[e._v("Against expectations, the system carried out Alice's request to reject the game.")]),e._v(" "),a("HighlightBox",{attrs:{type:"warn"}},[a("p",[e._v("How is it possible that Alice could reject a game she had already played in, despite the code preventing that? Because game "),a("code",[e._v("0")]),e._v(" was created in an earlier version of your code. This earlier version created "),a("strong",[e._v("a game without any "),a("code",[e._v(".MoveCount")])]),e._v(". When you later added the code for rejection, Ignite CLI kept the current state of your blockchain. In effect, your blockchain was in a "),a("strong",[e._v("broken")]),e._v(" state, where "),a("strong",[e._v("the code and the state were out of sync")]),e._v(".\n"),a("br"),a("br"),e._v("\nTo see how to properly handle code changes that would otherwise result in a broken state, see the section on "),a("RouterLink",{attrs:{to:"/academy/3-my-own-chain/migration.html"}},[e._v("migrations")]),e._v(".")],1)]),e._v(" "),a("p",[e._v("You need to create other games and test the rejection on them. Notice the incrementing game ID.")]),e._v(" "),a("PanelList",[a("PanelListItem",{attrs:{number:"1"}},[a("p",[e._v("Bob rejects:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBjaGVja2Vyc2QgdHggY2hlY2tlcnMgY3JlYXRlLWdhbWUgJGFsaWNlICRib2IgLS1mcm9tICRib2IKJCBjaGVja2Vyc2QgdHggY2hlY2tlcnMgcmVqZWN0LWdhbWUgMiAtLWZyb20gJGJvYgo="}}),e._v(" "),a("p",[e._v("Above, Bob creates a game and rejects it immediately. This returns:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"undefined",base64:"Li4uCnJhd19sb2c6ICdbeyZxdW90O2V2ZW50cyZxdW90OzpbeyZxdW90O3R5cGUmcXVvdDs6JnF1b3Q7bWVzc2FnZSZxdW90OywmcXVvdDthdHRyaWJ1dGVzJnF1b3Q7Olt7JnF1b3Q7a2V5JnF1b3Q7OiZxdW90O2FjdGlvbiZxdW90OywmcXVvdDt2YWx1ZSZxdW90OzomcXVvdDtSZWplY3RHYW1lJnF1b3Q7fSx7JnF1b3Q7a2V5JnF1b3Q7OiZxdW90O21vZHVsZSZxdW90OywmcXVvdDt2YWx1ZSZxdW90OzomcXVvdDtjaGVja2VycyZxdW90O30seyZxdW90O2tleSZxdW90OzomcXVvdDthY3Rpb24mcXVvdDssJnF1b3Q7dmFsdWUmcXVvdDs6JnF1b3Q7R2FtZVJlamVjdGVkJnF1b3Q7fSx7JnF1b3Q7a2V5JnF1b3Q7OiZxdW90O0NyZWF0b3ImcXVvdDssJnF1b3Q7dmFsdWUmcXVvdDs6JnF1b3Q7Y29zbW9zMXcwdXVtbGowNGV5dmV2aGZhd2FzbTJkdGpjMjRuZXh4eWdyOHF4JnF1b3Q7fSx7JnF1b3Q7a2V5JnF1b3Q7OiZxdW90O0lkVmFsdWUmcXVvdDssJnF1b3Q7dmFsdWUmcXVvdDs6JnF1b3Q7MiZxdW90O31dfV19XScK"}}),e._v(" "),a("p",[e._v("Correct result, because nobody played a move.")])],1),e._v(" "),a("PanelListItem",{attrs:{number:"2"}},[a("p",[e._v("Alice rejects:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBjaGVja2Vyc2QgdHggY2hlY2tlcnMgY3JlYXRlLWdhbWUgJGFsaWNlICRib2IgLS1mcm9tICRib2IKJCBjaGVja2Vyc2QgdHggY2hlY2tlcnMgcmVqZWN0LWdhbWUgMyAtLWZyb20gJGFsaWNlCg=="}}),e._v(" "),a("p",[e._v("Above, Bob creates a game and Alice rejects it immediately. This returns:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"undefined",base64:"Li4uCnJhd19sb2c6ICdbeyZxdW90O2V2ZW50cyZxdW90OzpbeyZxdW90O3R5cGUmcXVvdDs6JnF1b3Q7bWVzc2FnZSZxdW90OywmcXVvdDthdHRyaWJ1dGVzJnF1b3Q7Olt7JnF1b3Q7a2V5JnF1b3Q7OiZxdW90O2FjdGlvbiZxdW90OywmcXVvdDt2YWx1ZSZxdW90OzomcXVvdDtSZWplY3RHYW1lJnF1b3Q7fSx7JnF1b3Q7a2V5JnF1b3Q7OiZxdW90O21vZHVsZSZxdW90OywmcXVvdDt2YWx1ZSZxdW90OzomcXVvdDtjaGVja2VycyZxdW90O30seyZxdW90O2tleSZxdW90OzomcXVvdDthY3Rpb24mcXVvdDssJnF1b3Q7dmFsdWUmcXVvdDs6JnF1b3Q7R2FtZVJlamVjdGVkJnF1b3Q7fSx7JnF1b3Q7a2V5JnF1b3Q7OiZxdW90O0NyZWF0b3ImcXVvdDssJnF1b3Q7dmFsdWUmcXVvdDs6JnF1b3Q7Y29zbW9zMWdtbDA1bnZsaHIwazI3dW5hczhtajgyN3o2bTc3bGhmcHp6cjNsJnF1b3Q7fSx7JnF1b3Q7a2V5JnF1b3Q7OiZxdW90O0lkVmFsdWUmcXVvdDssJnF1b3Q7dmFsdWUmcXVvdDs6JnF1b3Q7MyZxdW90O31dfV19XScK"}}),e._v(" "),a("p",[e._v("Correct again, because nobody played a move.")])],1),e._v(" "),a("PanelListItem",{attrs:{number:"3"}},[a("p",[e._v("Bob plays and rejects:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBjaGVja2Vyc2QgdHggY2hlY2tlcnMgY3JlYXRlLWdhbWUgJGFsaWNlICRib2IgLS1mcm9tICRib2IKJCBjaGVja2Vyc2QgdHggY2hlY2tlcnMgcGxheS1tb3ZlIDQgMSAyIDIgMyAtLWZyb20gJGJvYgokIGNoZWNrZXJzZCB0eCBjaGVja2VycyByZWplY3QtZ2FtZSA0IC0tZnJvbSAkYm9iCg=="}}),e._v(" "),a("p",[e._v("Above, Bob creates a game, makes a move, and then rejects the game. This returns:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"undefined",base64:"Li4uCnJhd19sb2c6ICdmYWlsZWQgdG8gZXhlY3V0ZSBtZXNzYWdlOyBtZXNzYWdlIGluZGV4OiAwOiBibGFjayBwbGF5ZXIgaGFzIGFscmVhZHkgcGxheWVkJwo="}}),e._v(" "),a("p",[e._v("Correct: the request fails, because Bob has already played a move.")])],1),e._v(" "),a("PanelListItem",{attrs:{number:"4"}},[a("p",[e._v("Bob plays and Alice rejects:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBjaGVja2Vyc2QgdHggY2hlY2tlcnMgY3JlYXRlLWdhbWUgJGFsaWNlICRib2IgLS1mcm9tICRib2IKJCBjaGVja2Vyc2QgdHggY2hlY2tlcnMgcGxheS1tb3ZlIDUgMSAyIDIgMyAtLWZyb20gJGJvYgokIGNoZWNrZXJzZCB0eCBjaGVja2VycyByZWplY3QtZ2FtZSA1IC0tZnJvbSAkYWxpY2UK"}}),e._v(" "),a("p",[e._v("Above, Bob creates a game, makes a move, and Alice rejects the game. This returns:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"undefined",base64:"Li4uCnJhd19sb2c6ICdbeyZxdW90O2V2ZW50cyZxdW90OzpbeyZxdW90O3R5cGUmcXVvdDs6JnF1b3Q7bWVzc2FnZSZxdW90OywmcXVvdDthdHRyaWJ1dGVzJnF1b3Q7Olt7JnF1b3Q7a2V5JnF1b3Q7OiZxdW90O2FjdGlvbiZxdW90OywmcXVvdDt2YWx1ZSZxdW90OzomcXVvdDtSZWplY3RHYW1lJnF1b3Q7fSx7JnF1b3Q7a2V5JnF1b3Q7OiZxdW90O21vZHVsZSZxdW90OywmcXVvdDt2YWx1ZSZxdW90OzomcXVvdDtjaGVja2VycyZxdW90O30seyZxdW90O2tleSZxdW90OzomcXVvdDthY3Rpb24mcXVvdDssJnF1b3Q7dmFsdWUmcXVvdDs6JnF1b3Q7R2FtZVJlamVjdGVkJnF1b3Q7fSx7JnF1b3Q7a2V5JnF1b3Q7OiZxdW90O0NyZWF0b3ImcXVvdDssJnF1b3Q7dmFsdWUmcXVvdDs6JnF1b3Q7Y29zbW9zMWdtbDA1bnZsaHIwazI3dW5hczhtajgyN3o2bTc3bGhmcHp6cjNsJnF1b3Q7fSx7JnF1b3Q7a2V5JnF1b3Q7OiZxdW90O0lkVmFsdWUmcXVvdDssJnF1b3Q7dmFsdWUmcXVvdDs6JnF1b3Q7NSZxdW90O31dfV19XScK"}}),e._v(" "),a("p",[e._v("Correct: Alice has not played a move yet, so she can still reject the game.")])],1),e._v(" "),a("PanelListItem",{attrs:{number:"5",last:!0}},[a("p",[e._v("Bob & Alice play, Alice rejects:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBjaGVja2Vyc2QgdHggY2hlY2tlcnMgY3JlYXRlLWdhbWUgJGFsaWNlICRib2IgLS1mcm9tICRib2IKJCBjaGVja2Vyc2QgdHggY2hlY2tlcnMgcGxheS1tb3ZlIDYgMSAyIDIgMyAtLWZyb20gJGJvYgokIGNoZWNrZXJzZCB0eCBjaGVja2VycyBwbGF5LW1vdmUgNiAwIDUgMSA0IC0tZnJvbSAkYWxpY2UKJCBjaGVja2Vyc2QgdHggY2hlY2tlcnMgcmVqZWN0LWdhbWUgNiAtLWZyb20gJGFsaWNlCg=="}}),e._v(" "),a("p",[e._v("Above, Bob creates a game and makes a move, then Alice makes a poor move and rejects the game. This returns:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"undefined",base64:"Li4uCnJhd19sb2c6ICdmYWlsZWQgdG8gZXhlY3V0ZSBtZXNzYWdlOyBtZXNzYWdlIGluZGV4OiAwOiByZWQgcGxheWVyIGhhcyBhbHJlYWR5IHBsYXllZCcK"}}),e._v(" "),a("p",[e._v("Correct: this time Alice could not reject the game because the state recorded her move in "),a("code",[e._v(".MoveCount")]),e._v(".")])],1)],1),e._v(" "),a("hr"),e._v(" "),a("HighlightBox",{attrs:{type:"warning"}},[a("p",[e._v("To belabor the point made in the earlier warning box: if you change your code, think about what it means for the current state of the chain and whether you end up in a broken state.")])]),e._v(" "),a("h2",{attrs:{id:"next-up"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#next-up"}},[e._v("#")]),e._v(" Next up")]),e._v(" "),a("p",[e._v("The "),a("RouterLink",{attrs:{to:"/academy/3-my-own-chain/game-fifo.html"}},[e._v("next section")]),e._v(" covers modularity and data organization styles. You create a "),a("RouterLink",{attrs:{to:"/academy/3-my-own-chain/game-fifo.html"}},[e._v("doubly-linked FIFO")]),e._v(".")],1),e._v(" "),a("p",[e._v("Later you add "),a("RouterLink",{attrs:{to:"/academy/3-my-own-chain/game-deadline.html"}},[e._v("deadline")]),e._v(" and "),a("RouterLink",{attrs:{to:"/academy/3-my-own-chain/game-winner.html"}},[e._v("game winner")]),e._v(" fields, before being able to finally "),a("RouterLink",{attrs:{to:"/academy/3-my-own-chain/game-forfeit.html"}},[e._v("enforce the forfeit")]),e._v(".")],1),e._v(" "),a("HighlightBox",{attrs:{type:"tip"}},[a("p",[e._v("If you want to enable token wagers in your games instead, skip ahead to "),a("RouterLink",{attrs:{to:"/academy/3-my-own-chain/game-wager.html"}},[e._v("wagers")]),e._v(".")],1)])],1)}),[],!1,null,null,null);t.default=s.exports}}]);