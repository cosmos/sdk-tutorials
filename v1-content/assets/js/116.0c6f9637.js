(window.webpackJsonp=window.webpackJsonp||[]).push([[116],{733:function(e,t,a){"use strict";a.r(t);var o=a(1),s=Object(o.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"token-let-players-set-a-wager"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#token-let-players-set-a-wager"}},[e._v("#")]),e._v(" Token - Let Players Set a Wager")]),e._v(" "),a("HighlightBox",{attrs:{type:"prerequisite"}},[a("p",[e._v("Make sure you have everything you need before proceeding:")]),e._v(" "),a("ul",[a("li",[e._v("You understand the concepts of "),a("RouterLink",{attrs:{to:"/academy/2-main-concepts/modules.html"}},[e._v("modules")]),e._v(", "),a("RouterLink",{attrs:{to:"/academy/2-main-concepts/multistore-keepers.html"}},[e._v("keepers")]),e._v(", and "),a("RouterLink",{attrs:{to:"/academy/2-main-concepts/protobuf.html"}},[e._v("Protobuf")]),e._v(".")],1),e._v(" "),a("li",[e._v("Go is installed.")]),e._v(" "),a("li",[e._v("You have the checkers blockchain codebase up to game expiry handling. If not, follow the "),a("RouterLink",{attrs:{to:"/academy/3-my-own-chain/game-forfeit.html"}},[e._v("previous steps")]),e._v(" or check out "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/tree/v1-forfeit-game",target:"_blank",rel:"noopener noreferrer"}},[e._v("the relevant version"),a("OutboundLink")],1),e._v(".")],1)])]),e._v(" "),a("HighlightBox",{attrs:{type:"learning"}},[a("p",[e._v("In this section, you will:")]),e._v(" "),a("ul",[a("li",[e._v("Add wagers.")]),e._v(" "),a("li",[e._v("Work with the Bank module.")]),e._v(" "),a("li",[e._v("Handle money.")]),e._v(" "),a("li",[e._v("Do integration tests.")])])]),e._v(" "),a("p",[e._v("With the introduction of game expiry in the "),a("RouterLink",{attrs:{to:"/academy/3-my-own-chain/game-forfeit.html"}},[e._v("previous section")]),e._v(" and other features, you have now addressed the cases when two players start a game and finish it, or let it expire.")],1),e._v(" "),a("p",[e._v("In this section, you will add an extra layer to a game, with wagers or stakes. Your application already includes all the necessary modules. This section relies on the "),a("code",[e._v("bank")]),e._v(" module in particular.")]),e._v(" "),a("p",[e._v("Players choose to wager "),a("em",[e._v("money")]),e._v(" or not, and the winner gets both wagers. The forfeiter loses their wager. To reduce complexity, start by letting players wager in the staking token of your application.")]),e._v(" "),a("p",[e._v("Now that no games can be left stranded, it is possible for players to safely wager on their games. How could this be implemented?")]),e._v(" "),a("h2",{attrs:{id:"some-initial-thoughts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#some-initial-thoughts"}},[e._v("#")]),e._v(" Some initial thoughts")]),e._v(" "),a("p",[e._v("When thinking about implementing a wager on games, ask:")]),e._v(" "),a("ul",[a("li",[e._v("What form will a wager take?")]),e._v(" "),a("li",[e._v("Who decides on the amount of wagers?")]),e._v(" "),a("li",[e._v("Where is a wager recorded?")]),e._v(" "),a("li",[e._v("Is there any desirable atomicity of actions?")]),e._v(" "),a("li",[e._v("At what junctures do you need to handle payments, refunds, and wins?")]),e._v(" "),a("li",[e._v("Are there errors to report back?")]),e._v(" "),a("li",[e._v("What event should you emit?")])]),e._v(" "),a("h2",{attrs:{id:"code-needs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#code-needs"}},[e._v("#")]),e._v(" Code needs")]),e._v(" "),a("p",[e._v("When it comes to your code:")]),e._v(" "),a("ul",[a("li",[e._v("What Ignite CLI commands, if any, will assist you?")]),e._v(" "),a("li",[e._v("How do you adjust what Ignite CLI created for you?")]),e._v(" "),a("li",[e._v("Where do you make your changes?")]),e._v(" "),a("li",[e._v("How would you unit-test these new elements?")]),e._v(" "),a("li",[e._v("How would you use Ignite CLI to locally run a one-node blockchain and interact with it via the CLI to see what you get?")])]),e._v(" "),a("h2",{attrs:{id:"new-information"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#new-information"}},[e._v("#")]),e._v(" New information")]),e._v(" "),a("p",[e._v("Add this wager value to the "),a("code",[e._v("StoredGame")]),e._v("'s Protobuf definition:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"protobuf",base64:"bWVzc2FnZSBTdG9yZWRHYW1lIHsKICAgIC4uLgogICAgdWludDY0IHdhZ2VyID0gMTI7Cn0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/proto/checkers/stored_game.proto#L18"}}),e._v(" "),a("p",[e._v("You can let players choose the wager they want by adding a dedicated field in the message to create a game, in "),a("code",[e._v("proto/checkers/tx.proto")]),e._v(":")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"protobuf",base64:"bWVzc2FnZSBNc2dDcmVhdGVHYW1lIHsKICAgIC4uLgogICAgdWludDY0IHdhZ2VyID0gNDsKfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/proto/checkers/tx.proto#L45"}}),e._v(" "),a("p",[e._v("Have Ignite CLI and Protobuf recompile these two files:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBpZ25pdGUgZ2VuZXJhdGUgcHJvdG8tZ28K"}}),e._v(" "),a("p",[e._v("Now add a helper function to "),a("code",[e._v("StoredGame")]),e._v(" using the Cosmos SDK "),a("code",[e._v("Coin")]),e._v(" in "),a("code",[e._v("full_game.go")]),e._v(":")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAoc3RvcmVkR2FtZSAqU3RvcmVkR2FtZSkgR2V0V2FnZXJDb2luKCkgKHdhZ2VyIHNkay5Db2luKSB7CiAgICByZXR1cm4gc2RrLk5ld0NvaW4oc2RrLkRlZmF1bHRCb25kRGVub20sIHNkay5OZXdJbnQoaW50NjQoc3RvcmVkR2FtZS5XYWdlcikpKQp9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/types/full_game.go#L74-L76"}}),e._v(" "),a("p",[e._v("This encapsulates information about the wager (where "),a("code",[e._v("sdk.DefaultBondDenom")]),e._v(" is most likely "),a("code",[e._v('"stake"')]),e._v(").")]),e._v(" "),a("h2",{attrs:{id:"saving-the-wager"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#saving-the-wager"}},[e._v("#")]),e._v(" Saving the wager")]),e._v(" "),a("p",[e._v("Time to make sure that the new field is saved in the storage and it is part of the creation event.")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("Define a new event key as a constant:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Y29uc3QgKAogICAgU3RvcmVkR2FtZUV2ZW50V2FnZXIgPSAmcXVvdDtXYWdlciZxdW90OwopCg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/types/keys.go#L49"}})],1),e._v(" "),a("li",[a("p",[e._v("Set the actual value in the new "),a("code",[e._v("StoredGame")]),e._v(" as it is instantiated in the create game handler:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"c3RvcmVkR2FtZSA6PSB0eXBlcy5TdG9yZWRHYW1lewogICAgLi4uCiAgICBXYWdlcjogbXNnLldhZ2VyLAp9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/msg_server_create_game.go#L33"}})],1),e._v(" "),a("li",[a("p",[e._v("And in the event:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Y3R4LkV2ZW50TWFuYWdlcigpLkVtaXRFdmVudCgKICAgIHNkay5OZXdFdmVudChzZGsuRXZlbnRUeXBlTWVzc2FnZSwKICAgICAgICAuLi4KICAgICAgICBzZGsuTmV3QXR0cmlidXRlKHR5cGVzLlN0b3JlZEdhbWVFdmVudFdhZ2VyLCBzdHJjb252LkZvcm1hdFVpbnQobXNnLldhZ2VyLCAxMCkpLAogICAgKQopCg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/msg_server_create_game.go#L54"}})],1),e._v(" "),a("li",[a("p",[e._v("Modify the constructor among the interface definition of "),a("code",[e._v("MsgCreateGame")]),e._v(" in "),a("code",[e._v("x/checkers/types/message_create_game.go")]),e._v(" to avoid surprises:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBOZXdNc2dDcmVhdGVHYW1lKGNyZWF0b3Igc3RyaW5nLCByZWQgc3RyaW5nLCBibGFjayBzdHJpbmcsIHdhZ2VyIHVpbnQ2NCkgKk1zZ0NyZWF0ZUdhbWUgewogICAgcmV0dXJuICZhbXA7TXNnQ3JlYXRlR2FtZXsKICAgICAgICAuLi4KICAgICAgICBXYWdlcjogd2FnZXIsCiAgICB9Cn0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/types/message_create_game.go#L15"}})],1)]),e._v(" "),a("h2",{attrs:{id:"declaring-expectations"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#declaring-expectations"}},[e._v("#")]),e._v(" Declaring expectations")]),e._v(" "),a("p",[e._v("On its own the "),a("code",[e._v("Wager")]),e._v(" field does not make players pay the wager or receive rewards. You need to add handling actions which ask the "),a("code",[e._v("bank")]),e._v(" module to perform the required token transfers. For that, your keeper needs to ask for a "),a("code",[e._v("bank")]),e._v(" instance during setup.")]),e._v(" "),a("HighlightBox",{attrs:{type:"info"}},[a("p",[e._v("The only way to have access to a capability with the object-capability model of the Cosmos SDK is to be given the reference to an instance which already has this capability.")])]),e._v(" "),a("p",[e._v("Payment handling is implemented by having your keeper hold wagers "),a("strong",[e._v("in escrow")]),e._v(" while the game is being played. The "),a("code",[e._v("bank")]),e._v(" module has functions to transfer tokens from any account to your module and vice-versa.")]),e._v(" "),a("p",[e._v("Alternatively, your keeper could burn tokens when playing and mint them again when paying out. However, this makes your blockchain's total supply "),a("em",[e._v("falsely")]),e._v(" fluctuate. Additionally, this burning and minting may prove questionable when you later introduce IBC tokens.")]),e._v(" "),a("HighlightBox",{attrs:{type:"best-practice"}},[a("p",[e._v("Declare an interface that narrowly declares the functions from other modules that you expect for your module. The conventional file for these declarations is "),a("code",[e._v("x/checkers/types/expected_keepers.go")]),e._v(".")])]),e._v(" "),a("p",[e._v("The "),a("code",[e._v("bank")]),e._v(" module has many capabilities, but all you need here are two functions. Therefore, you "),a("em",[e._v("redeclare")]),e._v(" the functions like so:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"dHlwZSBCYW5rS2VlcGVyIGludGVyZmFjZSB7CiAgICBTZW5kQ29pbnNGcm9tTW9kdWxlVG9BY2NvdW50KGN0eCBzZGsuQ29udGV4dCwgc2VuZGVyTW9kdWxlIHN0cmluZywgcmVjaXBpZW50QWRkciBzZGsuQWNjQWRkcmVzcywgYW10IHNkay5Db2lucykgZXJyb3IKICAgIFNlbmRDb2luc0Zyb21BY2NvdW50VG9Nb2R1bGUoY3R4IHNkay5Db250ZXh0LCBzZW5kZXJBZGRyIHNkay5BY2NBZGRyZXNzLCByZWNpcGllbnRNb2R1bGUgc3RyaW5nLCBhbXQgc2RrLkNvaW5zKSBlcnJvcgp9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/types/expected_keepers.go#L7-L10"}}),e._v(" "),a("p",[e._v("These two functions must exactly match the functions declared in the "),a("a",{attrs:{href:"https://github.com/cosmos/cosmos-sdk/blob/8b78406/x/bank/keeper/keeper.go#L37-L39",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("bank")]),e._v("'s keeper.go file"),a("OutboundLink")],1),e._v(". Copy the declarations directly from the "),a("code",[e._v("bank")]),e._v("'s file. In Go, any object with these two functions is a "),a("code",[e._v("BankKeeper")]),e._v(".")]),e._v(" "),a("h2",{attrs:{id:"obtaining-the-capability"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#obtaining-the-capability"}},[e._v("#")]),e._v(" Obtaining the capability")]),e._v(" "),a("p",[e._v("With your requirements declared, it is time to make sure your keeper receives a reference to a bank keeper. First add a "),a("code",[e._v("BankKeeper")]),e._v(" to your keeper in "),a("code",[e._v("x/checkers/keeper/keeper.go")]),e._v(":")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"dHlwZSAoCiAgICBLZWVwZXIgc3RydWN0IHsKICAgICAgICBiYW5rIHR5cGVzLkJhbmtLZWVwZXIKICAgICAgICAuLi4KICAgIH0KKQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/keeper.go#L16"}}),e._v(" "),a("p",[e._v("This "),a("code",[e._v("BankKeeper")]),e._v(" is your newly declared narrow interface. Do not forget to adjust the constructor accordingly:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBOZXdLZWVwZXIoCiAgICBiYW5rIHR5cGVzLkJhbmtLZWVwZXIsCiAgICAuLi4KKSAqS2VlcGVyIHsKICAgIHJldHVybiAmYW1wO0tlZXBlcnsKICAgICAgICBiYW5rOiBiYW5rLAogICAgICAgIC4uLgogICAgfQp9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/keeper.go#L25-L41"}}),e._v(" "),a("p",[e._v("Next, update where the constructor is called and pass a proper instance of "),a("code",[e._v("BankKeeper")]),e._v(". This happens in "),a("code",[e._v("app/app.go")]),e._v(":")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"YXBwLkNoZWNrZXJzS2VlcGVyID0gKmNoZWNrZXJzbW9kdWxla2VlcGVyLk5ld0tlZXBlcigKICAgIGFwcC5CYW5rS2VlcGVyLAogICAgLi4uCikK",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/app/app.go#L368-L369"}}),e._v(" "),a("p",[e._v("This "),a("code",[e._v("app.BankKeeper")]),e._v(" is a full "),a("code",[e._v("bank")]),e._v(" keeper that also conforms to your "),a("code",[e._v("BankKeeper")]),e._v(" interface.")]),e._v(" "),a("p",[e._v("Finally, inform the app that your checkers module is going to hold balances in escrow by adding it to the list of permitted modules:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"bWFjY1Blcm1zID0gbWFwW3N0cmluZ11bXXN0cmluZ3sKICAgIC4uLgogICAgY2hlY2tlcnNtb2R1bGV0eXBlcy5Nb2R1bGVOYW1lOiBuaWwsCn0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/6213d10/app/app.go#L153"}}),e._v(" "),a("p",[e._v("It is only keeping funds in escrow and not minting or burning, hence the "),a("code",[e._v("nil")]),e._v(".")]),e._v(" "),a("p",[e._v("One last step. Before your module can keep money in escrow, it needs to be "),a("strong",[e._v("whitelisted")]),e._v(" by the bank module. You do this in the "),a("code",[e._v("maccperms")]),e._v(":")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"bWFjY1Blcm1zID0gbWFwW3N0cmluZ11bXXN0cmluZ3sKICAgIC4uLgogICAgY2hlY2tlcnNtb2R1bGV0eXBlcy5Nb2R1bGVOYW1lOiBuaWwsCn0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/app/app.go#L154"}}),e._v(" "),a("p",[e._v("If you compare it to the other "),a("code",[e._v("maccperms")]),e._v(" lines, the new line does not mention any "),a("code",[e._v("authtypes.Minter")]),e._v(" or "),a("code",[e._v("authtypes.Burner")]),e._v(". Indeed "),a("code",[e._v("nil")]),e._v(" is what you need to keep in escrow. For your information, the bank creates an "),a("em",[e._v("address")]),e._v(" for your module's escrow account. When you have the full "),a("code",[e._v("app")]),e._v(", you can access it with:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"aW1wb3J0KAogICAgJnF1b3Q7Z2l0aHViLmNvbS9hbGljZS9jaGVja2Vycy94L2NoZWNrZXJzL3R5cGVzJnF1b3Q7CikKY2hlY2tlcnNNb2R1bGVBZGRyZXNzIDo9IGFwcC5BY2NvdW50S2VlcGVyLkdldE1vZHVsZUFkZHJlc3ModHlwZXMuTW9kdWxlTmFtZSkK"}}),e._v(" "),a("h2",{attrs:{id:"preparing-expected-errors"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#preparing-expected-errors"}},[e._v("#")]),e._v(" Preparing expected errors")]),e._v(" "),a("p",[e._v("There are several new error situations that you can enumerate with new variables:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"RXJyUmVkQ2Fubm90UGF5ICAgICAgPSBzZGtlcnJvcnMuUmVnaXN0ZXIoTW9kdWxlTmFtZSwgMTExMiwgJnF1b3Q7cmVkIGNhbm5vdCBwYXkgdGhlIHdhZ2VyJnF1b3Q7KQpFcnJCbGFja0Nhbm5vdFBheSAgICA9IHNka2Vycm9ycy5SZWdpc3RlcihNb2R1bGVOYW1lLCAxMTEzLCAmcXVvdDtibGFjayBjYW5ub3QgcGF5IHRoZSB3YWdlciZxdW90OykKRXJyTm90aGluZ1RvUGF5ICAgICAgPSBzZGtlcnJvcnMuUmVnaXN0ZXIoTW9kdWxlTmFtZSwgMTExNSwgJnF1b3Q7dGhlcmUgaXMgbm90aGluZyB0byBwYXksIHNob3VsZCBub3QgaGF2ZSBiZWVuIGNhbGxlZCZxdW90OykKRXJyQ2Fubm90UmVmdW5kV2FnZXIgPSBzZGtlcnJvcnMuUmVnaXN0ZXIoTW9kdWxlTmFtZSwgMTExNiwgJnF1b3Q7Y2Fubm90IHJlZnVuZCB3YWdlciB0bzogJXMmcXVvdDspCkVyckNhbm5vdFBheVdpbm5pbmdzID0gc2RrZXJyb3JzLlJlZ2lzdGVyKE1vZHVsZU5hbWUsIDExMTcsICZxdW90O2Nhbm5vdCBwYXkgd2lubmluZ3MgdG8gd2lubmVyJnF1b3Q7KQpFcnJOb3RJblJlZnVuZFN0YXRlICA9IHNka2Vycm9ycy5SZWdpc3RlcihNb2R1bGVOYW1lLCAxMTE4LCAmcXVvdDtnYW1lIGlzIG5vdCBpbiBhIHN0YXRlIHRvIHJlZnVuZCwgbW92ZSBjb3VudDogJWQmcXVvdDspCg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/types/errors.go#L23-L29"}}),e._v(" "),a("h2",{attrs:{id:"money-handling-steps"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#money-handling-steps"}},[e._v("#")]),e._v(" Money handling steps")]),e._v(" "),a("p",[e._v("With the "),a("code",[e._v("bank")]),e._v(" now in your keeper, it is time to have your keeper handle the money. Keep this concern in its file, as the functions are reused on a play, reject, and forfeit.")]),e._v(" "),a("p",[e._v("Create the new file "),a("code",[e._v("x/checkers/keeper/wager_handler.go")]),e._v(" and add three functions to collect a wager, refund a wager, and pay winnings:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAoayAqS2VlcGVyKSBDb2xsZWN0V2FnZXIoY3R4IHNkay5Db250ZXh0LCBzdG9yZWRHYW1lICp0eXBlcy5TdG9yZWRHYW1lKSBlcnJvcgpmdW5jIChrICpLZWVwZXIpIE11c3RQYXlXaW5uaW5ncyhjdHggc2RrLkNvbnRleHQsIHN0b3JlZEdhbWUgKnR5cGVzLlN0b3JlZEdhbWUpCmZ1bmMgKGsgKktlZXBlcikgTXVzdFJlZnVuZFdhZ2VyKGN0eCBzZGsuQ29udGV4dCwgc3RvcmVkR2FtZSAqdHlwZXMuU3RvcmVkR2FtZSkK",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/wager_handler.go"}}),e._v(" "),a("p",[e._v("The "),a("code",[e._v("Must")]),e._v(" prefix in the function means that the transaction either takes place or a panic is issued. If a player cannot pay the wager, it is a user-side error and the user must be informed of a failed transaction. If the module cannot pay, it means the escrow account has failed. This error is much more serious: an invariant has been violated and the whole application must be terminated.")]),e._v(" "),a("p",[e._v("Now set up collecting a wager, paying winnings, and refunding a wager:")]),e._v(" "),a("ol",[a("li",[a("p",[a("strong",[e._v("Collecting wagers")]),e._v(" happens on a player's first move. Therefore, differentiate between players:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"aWYgc3RvcmVkR2FtZS5Nb3ZlQ291bnQgPT0gMCB7CiAgICAvLyBCbGFjayBwbGF5cyBmaXJzdAp9IGVsc2UgaWYgc3RvcmVkR2FtZS5Nb3ZlQ291bnQgPT0gMSB7CiAgICAvLyBSZWQgcGxheXMgc2Vjb25kCn0KcmV0dXJuIG5pbAo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/wager_handler.go#L15-L36"}}),e._v(" "),a("p",[e._v("Get the address for the black player:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"YmxhY2ssIGVyciA6PSBzdG9yZWRHYW1lLkdldEJsYWNrQWRkcmVzcygpCmlmIGVyciAhPSBuaWwgewogICAgcGFuaWMoZXJyLkVycm9yKCkpCn0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/wager_handler.go#L17-L20"}}),e._v(" "),a("p",[e._v("Try to transfer into the escrow:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZXJyID0gay5iYW5rLlNlbmRDb2luc0Zyb21BY2NvdW50VG9Nb2R1bGUoY3R4LCBibGFjaywgdHlwZXMuTW9kdWxlTmFtZSwgc2RrLk5ld0NvaW5zKHN0b3JlZEdhbWUuR2V0V2FnZXJDb2luKCkpKQppZiBlcnIgIT0gbmlsIHsKICAgIHJldHVybiBzZGtlcnJvcnMuV3JhcGYoZXJyLCB0eXBlcy5FcnJCbGFja0Nhbm5vdFBheS5FcnJvcigpKQp9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/wager_handler.go#L21-L24"}}),e._v(" "),a("p",[e._v("Then do the same for the red player.")])],1),e._v(" "),a("li",[a("p",[a("strong",[e._v("Paying winnings")]),e._v(' takes place when the game has a declared winner. First get the winner. "No winner" is '),a("strong",[e._v("not")]),e._v(" an acceptable situation in this "),a("code",[e._v("MustPayWinnings")]),e._v(". The caller of the function must ensure there is a winner:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"d2lubmVyQWRkcmVzcywgZm91bmQsIGVyciA6PSBzdG9yZWRHYW1lLkdldFdpbm5lckFkZHJlc3MoKQppZiBlcnIgIT0gbmlsIHsKICAgIHBhbmljKGVyci5FcnJvcigpKQp9CmlmICFmb3VuZCB7CiAgICBwYW5pYyhmbXQuU3ByaW50Zih0eXBlcy5FcnJDYW5ub3RGaW5kV2lubmVyQnlDb2xvci5FcnJvcigpLCBzdG9yZWRHYW1lLldpbm5lcikpCn0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/wager_handler.go#L42-L48"}}),e._v(" "),a("p",[e._v("Then get the winnings to pay:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"d2lubmluZ3MgOj0gc3RvcmVkR2FtZS5HZXRXYWdlckNvaW4oKQppZiBzdG9yZWRHYW1lLk1vdmVDb3VudCA9PSAwIHsKICAgIHBhbmljKHR5cGVzLkVyck5vdGhpbmdUb1BheS5FcnJvcigpKQp9IGVsc2UgaWYgMSAmbHQ7IHN0b3JlZEdhbWUuTW92ZUNvdW50IHsKICAgIHdpbm5pbmdzID0gd2lubmluZ3MuQWRkKHdpbm5pbmdzKQp9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/wager_handler.go#L49-L54"}}),e._v(" "),a("p",[e._v("You double the wager only if the red player has also played and therefore both players have paid their wagers. Then pay the winner:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZXJyID0gay5iYW5rLlNlbmRDb2luc0Zyb21Nb2R1bGVUb0FjY291bnQoY3R4LCB0eXBlcy5Nb2R1bGVOYW1lLCB3aW5uZXJBZGRyZXNzLCBzZGsuTmV3Q29pbnMod2lubmluZ3MpKQppZiBlcnIgIT0gbmlsIHsKICAgIHBhbmljKHR5cGVzLkVyckNhbm5vdFBheVdpbm5pbmdzLkVycm9yKCkpCn0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/wager_handler.go#L55-L58"}})],1),e._v(" "),a("li",[a("p",[e._v("Finally, "),a("strong",[e._v("refunding wagers")]),e._v(" takes place when the game has partially started, i.e. only one party has paid, or when the game ends in a draw. In this narrow case of "),a("code",[e._v("MustRefundWager")]),e._v(":")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"aWYgc3RvcmVkR2FtZS5Nb3ZlQ291bnQgPT0gMSB7CiAgICAvLyBSZWZ1bmQKfSBlbHNlIGlmIHN0b3JlZEdhbWUuTW92ZUNvdW50ID09IDAgewogICAgLy8gRG8gbm90aGluZwp9IGVsc2UgewogICAgLy8gVE9ETyBJbXBsZW1lbnQgYSBkcmF3IG1lY2hhbmlzbS4KICAgIHBhbmljKGZtdC5TcHJpbnRmKHR5cGVzLkVyck5vdEluUmVmdW5kU3RhdGUuRXJyb3IoKSwgc3RvcmVkR2FtZS5Nb3ZlQ291bnQpKQp9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/wager_handler.go#L64-L78"}}),e._v(" "),a("p",[e._v("Refund the black player when there has been a single move:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"YmxhY2ssIGVyciA6PSBzdG9yZWRHYW1lLkdldEJsYWNrQWRkcmVzcygpCmlmIGVyciAhPSBuaWwgewogICAgcGFuaWMoZXJyLkVycm9yKCkpCn0KZXJyID0gay5iYW5rLlNlbmRDb2luc0Zyb21Nb2R1bGVUb0FjY291bnQoY3R4LCB0eXBlcy5Nb2R1bGVOYW1lLCBibGFjaywgc2RrLk5ld0NvaW5zKHN0b3JlZEdhbWUuR2V0V2FnZXJDb2luKCkpKQppZiBlcnIgIT0gbmlsIHsKICAgIHBhbmljKGZtdC5TcHJpbnRmKHR5cGVzLkVyckNhbm5vdFJlZnVuZFdhZ2VyLkVycm9yKCksIHJ1bGVzLkJMQUNLX1BMQVlFUi5Db2xvcikpCn0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/wager_handler.go#L65-L72"}}),e._v(" "),a("p",[e._v("If the module cannot pay, then there is a panic as the escrow has failed.")])],1)]),e._v(" "),a("p",[e._v("You will notice that no special case is made when the wager is zero. This is a design choice here, and which way you choose to go is up to you. Not contacting the bank unnecessarily is cheaper in gas. On the other hand, why not outsource the zero check to the bank?")]),e._v(" "),a("h2",{attrs:{id:"insert-wager-handling"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#insert-wager-handling"}},[e._v("#")]),e._v(" Insert wager handling")]),e._v(" "),a("p",[e._v("With the desired steps defined in the wager handling functions, it is time to invoke them at the right places in the message handlers.")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("When a player plays for the first time:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZXJyID0gay5LZWVwZXIuQ29sbGVjdFdhZ2VyKGN0eCwgJmFtcDtzdG9yZWRHYW1lKQppZiBlcnIgIT0gbmlsIHsKICAgIHJldHVybiBuaWwsIGVycgp9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/msg_server_play_move.go#L51-L54"}})],1),e._v(" "),a("li",[a("p",[e._v("When a player wins as a result of a move:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"aWYgc3RvcmVkR2FtZS5XaW5uZXIgPT0gcnVsZXMuUGllY2VTdHJpbmdzW3J1bGVzLk5PX1BMQVlFUl0gewogICAgLi4uCn0gZWxzZSB7CiAgICAuLi4KICAgIGsuS2VlcGVyLk11c3RQYXlXaW5uaW5ncyhjdHgsICZhbXA7c3RvcmVkR2FtZSkKfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/msg_server_play_move.go#L79-L86"}})],1),e._v(" "),a("li",[a("p",[e._v("When a player rejects a game:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ay5LZWVwZXIuTXVzdFJlZnVuZFdhZ2VyKGN0eCwgJmFtcDtzdG9yZWRHYW1lKQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/msg_server_reject_game.go#L39"}})],1),e._v(" "),a("li",[a("p",[e._v("When a game expires and there is a forfeit, make sure to only refund or pay full winnings when applicable. The logic needs to be adjusted:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"aWYgZGVhZGxpbmUuQmVmb3JlKGN0eC5CbG9ja1RpbWUoKSkgewogICAgLi4uCiAgICBpZiBzdG9yZWRHYW1lLk1vdmVDb3VudCAmbHQ7PSAxIHsKICAgICAgICAuLi4KICAgICAgICBpZiBzdG9yZWRHYW1lLk1vdmVDb3VudCA9PSAxIHsKICAgICAgICAgICAgay5NdXN0UmVmdW5kV2FnZXIoY3R4LCAmYW1wO3N0b3JlZEdhbWUpCiAgICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgICAuLi4KICAgICAgICBrLk11c3RQYXlXaW5uaW5ncyhjdHgsICZhbXA7c3RvcmVkR2FtZSkKICAgICAgICAuLi4KICAgIH0KfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/end_block_server_game.go#L45-L56"}})],1)]),e._v(" "),a("h2",{attrs:{id:"integration-tests"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#integration-tests"}},[e._v("#")]),e._v(" Integration tests")]),e._v(" "),a("p",[e._v("If you try running your existing tests you will see a lot of "),a("strong",[e._v("null pointer exceptions")]),e._v(". That's because currently the tests set up your checkers keeper "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/ba95217/x/checkers/keeper/keeper_test.go#L30-L34",target:"_blank",rel:"noopener noreferrer"}},[e._v("without a bank keeper"),a("OutboundLink")],1),e._v(". Cosmos SDK does not have "),a("a",{attrs:{href:"https://en.wikipedia.org/wiki/Mock_object",target:"_blank",rel:"noopener noreferrer"}},[e._v("mocks"),a("OutboundLink")],1),e._v(", so instead of passing a mocked bank when setting up your test keeper you need to build a proper bank keeper too. Fortunately, you do not have to do this from scratch: taking inspiration from "),a("a",{attrs:{href:"https://github.com/cosmos/cosmos-sdk/blob/9e1ec7b/x/bank/keeper/keeper_test.go#L66-L110",target:"_blank",rel:"noopener noreferrer"}},[e._v("tests on the bank module"),a("OutboundLink")],1),e._v(", prepare your code and tests in order to accommodate and create a full app which will contain a bank keeper.")]),e._v(" "),a("HighlightBox",{attrs:{type:"note"}},[a("p",[e._v("Your existing tests, although never pure "),a("strong",[e._v("unit")]),e._v(" tests, will become true "),a("strong",[e._v("integration")]),e._v(" tests.")])]),e._v(" "),a("p",[e._v("Previously, each test function took a "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/ba95217/x/checkers/keeper/end_block_server_game_test.go#L12",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("t *testing.T")]),a("OutboundLink")],1),e._v(" object. Now, each test function will be a method on a test suite that inherits from "),a("a",{attrs:{href:"https://pkg.go.dev/github.com/stretchr/testify/suite",target:"_blank",rel:"noopener noreferrer"}},[e._v("testify's suite"),a("OutboundLink")],1),e._v(". This has the advantage that your test suite can have as many fields as is necessary or useful. The objects that you have used and would welcome in the suite are:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"a2VlcGVyICAgIGtlZXBlci5LZWVwZXIKbXNnU2VydmVyIHR5cGVzLk1zZ1NlcnZlcgpjdHggICAgICAgc2RrLkNvbnRleHQK"}}),e._v(" "),a("p",[e._v("You can spread the suite's methods to different files, so as to keep consistent naming for your test files.")]),e._v(" "),a("p",[e._v("When testing, "),a("code",[e._v("go test")]),e._v(" will find the suite because you add a "),a("a",{attrs:{href:"https://github.com/cosmos/cosmos-sdk/blob/9e1ec7b/x/bank/keeper/keeper_test.go#L1241-L1243",target:"_blank",rel:"noopener noreferrer"}},[a("em",[e._v("regular")]),e._v(" test"),a("OutboundLink")],1),e._v(" that initializes the suite and runs it. The test suite is then automatically initialized with its "),a("a",{attrs:{href:"https://github.com/cosmos/cosmos-sdk/blob/9e1ec7b/x/bank/keeper/keeper_test.go#L96",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("SetupTest")]),a("OutboundLink")],1),e._v(" function via its parent "),a("code",[e._v("suite")]),e._v(" class. After that, all the methods of the test suite are run.")]),e._v(" "),a("h3",{attrs:{id:"accommodate-your-code"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#accommodate-your-code"}},[e._v("#")]),e._v(" Accommodate your code")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("To get the compilation error out of the way, for basic tests that do not require integration you can add an empty bank keeper on "),a("code",[e._v("func setupKeeper(t testing.TB)")]),e._v(":")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"a2VlcGVyIDo9IGtlZXBlci5OZXdLZWVwZXIoCiAgICAqbmV3KGJhbmtrZWVwZXIuS2VlcGVyKSwKICAgIC4uLgp9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/keeper_test.go#L35"}}),e._v(" "),a("p",[e._v("Keep this "),a("code",[e._v("setupKeeper")]),e._v(" function because tests created by Ignite CLI expect it.")])],1),e._v(" "),a("li",[a("p",[e._v("Ignite CLI created a default constructor for your App with a "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/app/app.go#L219-L230",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("cosmoscmd.App")]),a("OutboundLink")],1),e._v(" return type, but this is not convenient as you need access to the "),a("code",[e._v("app.App")]),e._v(" type for initialization in the upcoming tests. Instead of risking breaking other dependencies, add a new constructor with "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/app/app.go#L231-L255",target:"_blank",rel:"noopener noreferrer"}},[e._v("your "),a("code",[e._v("App")]),a("OutboundLink")],1),e._v(" as the return type.")])]),e._v(" "),a("li",[a("p",[e._v("Add other elements taken from Cosmos SDK tests, like "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/app/encoding.go",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("encoding.go")]),a("OutboundLink")],1),e._v(", "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/app/params/proto.go",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("proto.go")]),a("OutboundLink")],1),e._v(", and "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/app/test_helpers.go",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("test_helpers.go")]),a("OutboundLink")],1),e._v(", in which you must also initialize your checkers genesis:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Y2hlY2tlcnNHZW5lc2lzIDo9IHR5cGVzLkRlZmF1bHRHZW5lc2lzKCkKZ2VuZXNpc1N0YXRlW3R5cGVzLk1vZHVsZU5hbWVdID0gYXBwLkFwcENvZGVjKCkuTXVzdE1hcnNoYWxKU09OKGNoZWNrZXJzR2VuZXNpcykK",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/app/test_helpers.go#L127-L128"}})],1),e._v(" "),a("li",[a("p",[e._v("Define your test suite in a new "),a("code",[e._v("keeper_integration_test.go")]),e._v(" file:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"dHlwZSBJbnRlZ3JhdGlvblRlc3RTdWl0ZSBzdHJ1Y3QgewogICAgc3VpdGUuU3VpdGUKCiAgICBhcHAgICAgICAgICAqY2hlY2tlcnNhcHAuQXBwCiAgICBtc2dTZXJ2ZXIgICB0eXBlcy5Nc2dTZXJ2ZXIKICAgIGN0eCAgICAgICAgIHNkay5Db250ZXh0CiAgICBxdWVyeUNsaWVudCB0eXBlcy5RdWVyeUNsaWVudAp9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/keeper_integration_test.go#L38-L45"}})],1),e._v(" "),a("li",[a("p",[e._v("Direct "),a("code",[e._v("go test")]),e._v(" to it:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBUZXN0Q2hlY2tlcnNLZWVwZXJUZXN0U3VpdGUodCAqdGVzdGluZy5UKSB7CiAgICBzdWl0ZS5SdW4odCwgbmV3KEludGVncmF0aW9uVGVzdFN1aXRlKSkKfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/keeper_integration_test.go#L47-L49"}})],1),e._v(" "),a("li",[a("p",[e._v("Create the "),a("code",[e._v("suite.SetupTest")]),e._v(" function, taking inspiration from the "),a("a",{attrs:{href:"https://github.com/cosmos/cosmos-sdk/blob/9e1ec7b/x/bank/keeper/keeper_test.go#L96-L110",target:"_blank",rel:"noopener noreferrer"}},[e._v("bank tests"),a("OutboundLink")],1),e._v(":")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAoc3VpdGUgKkludGVncmF0aW9uVGVzdFN1aXRlKSBTZXR1cFRlc3QoKSB7CiAgICBhcHAgOj0gY2hlY2tlcnNhcHAuU2V0dXAoZmFsc2UpCiAgICBjdHggOj0gYXBwLkJhc2VBcHAuTmV3Q29udGV4dChmYWxzZSwgdG1wcm90by5IZWFkZXJ7fSkKCiAgICBhcHAuQWNjb3VudEtlZXBlci5TZXRQYXJhbXMoY3R4LCBhdXRodHlwZXMuRGVmYXVsdFBhcmFtcygpKQogICAgYXBwLkJhbmtLZWVwZXIuU2V0UGFyYW1zKGN0eCwgYmFua3R5cGVzLkRlZmF1bHRQYXJhbXMoKSkKICAgIGNoZWNrZXJzTW9kdWxlQWRkcmVzcyA9IGFwcC5BY2NvdW50S2VlcGVyLkdldE1vZHVsZUFkZHJlc3ModHlwZXMuTW9kdWxlTmFtZSkuU3RyaW5nKCkKCiAgICBxdWVyeUhlbHBlciA6PSBiYXNlYXBwLk5ld1F1ZXJ5U2VydmVyVGVzdEhlbHBlcihjdHgsIGFwcC5JbnRlcmZhY2VSZWdpc3RyeSgpKQogICAgdHlwZXMuUmVnaXN0ZXJRdWVyeVNlcnZlcihxdWVyeUhlbHBlciwgYXBwLkNoZWNrZXJzS2VlcGVyKQogICAgcXVlcnlDbGllbnQgOj0gdHlwZXMuTmV3UXVlcnlDbGllbnQocXVlcnlIZWxwZXIpCgogICAgc3VpdGUuYXBwID0gYXBwCiAgICBzdWl0ZS5tc2dTZXJ2ZXIgPSBrZWVwZXIuTmV3TXNnU2VydmVySW1wbChhcHAuQ2hlY2tlcnNLZWVwZXIpCiAgICBzdWl0ZS5jdHggPSBjdHgKICAgIHN1aXRlLnF1ZXJ5Q2xpZW50ID0gcXVlcnlDbGllbnQKfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/keeper_integration_test.go#L51-L67"}}),e._v(" "),a("p",[e._v("This "),a("a",{attrs:{href:"https://github.com/stretchr/testify/blob/v1.7.0/suite/interfaces.go#L18-L22",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("SetupTest")]),e._v(" function"),a("OutboundLink")],1),e._v(" is like a "),a("code",[e._v("beforeEach")]),e._v(" as it is named in other test libraries. With it, you always get a new "),a("code",[e._v("app")]),e._v(" with each test, without interference between them. Do not "),a("a",{attrs:{href:"https://github.com/stretchr/testify/blob/v1.7.0/suite/suite.go#L147",target:"_blank",rel:"noopener noreferrer"}},[e._v("omit it"),a("OutboundLink")],1),e._v(" unless you have specific reasons to do so.")]),e._v(" "),a("p",[e._v("Also note that it collects your "),a("code",[e._v("checkersModuleAddress")]),e._v(" for later use in tests that check events and balances:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"dmFyICgKICAgIGNoZWNrZXJzTW9kdWxlQWRkcmVzcyBzdHJpbmcKKQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/keeper_integration_test.go#L34-L36"}})],1)]),e._v(" "),a("h3",{attrs:{id:"helpers-for-money-checking"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#helpers-for-money-checking"}},[e._v("#")]),e._v(" Helpers for money checking")]),e._v(" "),a("p",[e._v("Your new tests will include checks on wagers being paid, lost, and won, so your tests need to initialize some bank balances for your players. This is made easier with a few helpers, including a helper to confirm a bank balance.")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("Make a bank genesis "),a("a",{attrs:{href:"https://github.com/cosmos/cosmos-sdk/blob/9e1ec7b6/x/bank/types/genesis.pb.go#L105-L110",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("Balance")]),a("OutboundLink")],1),e._v(" type from primitives:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBtYWtlQmFsYW5jZShhZGRyZXNzIHN0cmluZywgYmFsYW5jZSBpbnQ2NCkgYmFua3R5cGVzLkJhbGFuY2UgewogICAgcmV0dXJuIGJhbmt0eXBlcy5CYWxhbmNlewogICAgICAgIEFkZHJlc3M6IGFkZHJlc3MsCiAgICAgICAgQ29pbnM6IHNkay5Db2luc3sKICAgICAgICAgICAgc2RrLkNvaW57CiAgICAgICAgICAgICAgICBEZW5vbTogIHNkay5EZWZhdWx0Qm9uZERlbm9tLAogICAgICAgICAgICAgICAgQW1vdW50OiBzZGsuTmV3SW50KGJhbGFuY2UpLAogICAgICAgICAgICB9LAogICAgICAgIH0sCiAgICB9Cn0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/keeper_integration_test.go#L69-L79"}})],1),e._v(" "),a("li",[a("p",[e._v("Declare default balances that will be useful for you:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Y29uc3QgKAogICAgYWxpY2UgICAgPSAmcXVvdDtjb3Ntb3Mxam1qZnEwdHBscDl0bXg0djl1ZW13NzJ5NGQyd2E1bnIzeG45ZDMmcXVvdDsKICAgIGJvYiAgICAgID0gJnF1b3Q7Y29zbW9zMXh5eHMzc2tmM2Y0amZxZXV2ODl5eWFxdmpjNmxmZmF2eHFoYzhnJnF1b3Q7CiAgICBjYXJvbCAgICA9ICZxdW90O2Nvc21vczFlMHc1dDUzbnJxN3A2NmZ5ZTZjOHAweW55aGY2eTI0bDR5dXhkNyZxdW90OwogICAgYmFsQWxpY2UgPSA1MDAwMDAwMAogICAgYmFsQm9iICAgPSAyMDAwMDAwMAogICAgYmFsQ2Fyb2wgPSAxMDAwMDAwMAopCg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/keeper_integration_test.go#L26-L31"}})],1),e._v(" "),a("li",[a("p",[e._v("Make your preferred bank genesis state:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBnZXRCYW5rR2VuZXNpcygpICpiYW5rdHlwZXMuR2VuZXNpc1N0YXRlIHsKICAgIGNvaW5zIDo9IFtdYmFua3R5cGVzLkJhbGFuY2V7CiAgICAgICAgbWFrZUJhbGFuY2UoYWxpY2UsIGJhbEFsaWNlKSwKICAgICAgICBtYWtlQmFsYW5jZShib2IsIGJhbEJvYiksCiAgICAgICAgbWFrZUJhbGFuY2UoY2Fyb2wsIGJhbENhcm9sKSwKICAgIH0KICAgIHN1cHBseSA6PSBiYW5rdHlwZXMuTmV3U3VwcGx5KGNvaW5zWzBdLkNvaW5zLkFkZChjb2luc1sxXS5Db2lucy4uLikuQWRkKGNvaW5zWzJdLkNvaW5zLi4uKSkKCiAgICBzdGF0ZSA6PSBiYW5rdHlwZXMuTmV3R2VuZXNpc1N0YXRlKAogICAgICAgIGJhbmt0eXBlcy5EZWZhdWx0UGFyYW1zKCksCiAgICAgICAgY29pbnMsCiAgICAgICAgc3VwcGx5LkdldFRvdGFsKCksCiAgICAgICAgW11iYW5rdHlwZXMuTWV0YWRhdGF7fSkKCiAgICByZXR1cm4gc3RhdGUKfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/keeper_integration_test.go#L81-L96"}})],1),e._v(" "),a("li",[a("p",[e._v("Add a simple function to prepare your suite with your desired balances:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAoc3VpdGUgKkludGVncmF0aW9uVGVzdFN1aXRlKSBzZXR1cFN1aXRlV2l0aEJhbGFuY2VzKCkgewogICAgc3VpdGUuYXBwLkJhbmtLZWVwZXIuSW5pdEdlbmVzaXMoc3VpdGUuY3R4LCBnZXRCYW5rR2VuZXNpcygpKQp9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/keeper_integration_test.go#L98-L100"}})],1),e._v(" "),a("li",[a("p",[e._v("Add a function to check balances from primitives:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAoc3VpdGUgKkludGVncmF0aW9uVGVzdFN1aXRlKSBSZXF1aXJlQmFua0JhbGFuY2UoZXhwZWN0ZWQgaW50LCBhdEFkZHJlc3Mgc3RyaW5nKSB7CiAgICBzZGtBZGQsIGVyciA6PSBzZGsuQWNjQWRkcmVzc0Zyb21CZWNoMzIoYXRBZGRyZXNzKQogICAgc3VpdGUuUmVxdWlyZSgpLk5pbChlcnIsICZxdW90O0FkZHJlc3MgJXMgZmFpbGVkIHRvIHBhcnNlJnF1b3Q7KQogICAgc3VpdGUuUmVxdWlyZSgpLkVxdWFsKAogICAgICAgIGludDY0KGV4cGVjdGVkKSwKICAgICAgICBzdWl0ZS5hcHAuQmFua0tlZXBlci5HZXRCYWxhbmNlKHN1aXRlLmN0eCwgc2RrQWRkLCBzZGsuRGVmYXVsdEJvbmREZW5vbSkuQW1vdW50LkludDY0KCkpCn0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/keeper_integration_test.go#L102-L108"}})],1),e._v(" "),a("li",[a("p",[e._v("Update any functions you used to set up your keeper with one game, for instance:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAoc3VpdGUgKkludGVncmF0aW9uVGVzdFN1aXRlKSBzZXR1cFN1aXRlV2l0aE9uZUdhbWVGb3JQbGF5TW92ZSgpIHsKICAgIHN1aXRlLnNldHVwU3VpdGVXaXRoQmFsYW5jZXMoKQogICAgZ29DdHggOj0gc2RrLldyYXBTREtDb250ZXh0KHN1aXRlLmN0eCkKICAgIHN1aXRlLm1zZ1NlcnZlci5DcmVhdGVHYW1lKGdvQ3R4LCAmYW1wO3R5cGVzLk1zZ0NyZWF0ZUdhbWV7CiAgICAgICAgQ3JlYXRvcjogYWxpY2UsCiAgICAgICAgUmVkOiAgICAgYm9iLAogICAgICAgIEJsYWNrOiAgIGNhcm9sLAogICAgICAgIFdhZ2VyOiAgIDExLAogICAgfSkKfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/msg_server_play_move_test.go#L8-L17"}})],1)]),e._v(" "),a("p",[e._v("With the preparation done, what does a test method look like?")]),e._v(" "),a("h3",{attrs:{id:"anatomy-of-an-integration-suite-test"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#anatomy-of-an-integration-suite-test"}},[e._v("#")]),e._v(" Anatomy of an integration suite test")]),e._v(" "),a("p",[e._v("Now you must refactor the existing tests that test your keeper. What does a refactored test look like?")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("The method declaration:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAoc3VpdGUgKkludGVncmF0aW9uVGVzdFN1aXRlKSBUZXN0Q3JlYXRlR2FtZSgpCg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/msg_server_create_game_test.go#L8"}}),e._v(" "),a("p",[e._v("It is declared as a member of your test suite, and is prefixed with "),a("a",{attrs:{href:"https://github.com/stretchr/testify/blob/v1.7.0/suite/suite.go#L181-L182",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("Test")]),a("OutboundLink")],1),e._v(".")])],1),e._v(" "),a("li",[a("p",[e._v("The "),a("strong",[e._v("setup")]),e._v(" can be done as you like, but since you created a helper you can use it:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"c3VpdGUuc2V0dXBTdWl0ZVdpdGhCYWxhbmNlcygpCmdvQ3R4IDo9IHNkay5XcmFwU0RLQ29udGV4dChzdWl0ZS5jdHgpCg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/msg_server_create_game_test.go#L9-L10"}})],1),e._v(" "),a("li",[a("p",[e._v("The "),a("strong",[e._v("action")]),e._v(" does not change from before, other than that you get the "),a("code",[e._v("keeper")]),e._v(" or "),a("code",[e._v("msgServer")]),e._v(" from the suite's fields:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Y3JlYXRlUmVzcG9uc2UsIGVyciA6PSBzdWl0ZS5tc2dTZXJ2ZXIuQ3JlYXRlR2FtZShnb0N0eCwgJmFtcDt0eXBlcy5Nc2dDcmVhdGVHYW1lewogICAgQ3JlYXRvcjogYWxpY2UsCiAgICBSZWQ6ICAgICBib2IsCiAgICBCbGFjazogICBjYXJvbCwKICAgIFdhZ2VyOiAgIDEyLAp9KQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/msg_server_create_game_test.go#L11-L16"}})],1),e._v(" "),a("li",[a("p",[e._v("The "),a("strong",[e._v("verification")]),e._v(" is done with "),a("code",[e._v("suite.Require().X")]),e._v(", but otherwise looks similar to the shorter "),a("code",[e._v("require.X")]),e._v(":")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"c3VpdGUuUmVxdWlyZSgpLk5pbChlcnIpCnN1aXRlLlJlcXVpcmUoKS5FcXVhbFZhbHVlcyh0eXBlcy5Nc2dDcmVhdGVHYW1lUmVzcG9uc2V7CiAgICBJZFZhbHVlOiAmcXVvdDsxJnF1b3Q7LAp9LCAqY3JlYXRlUmVzcG9uc2UpCg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/msg_server_create_game_test.go#L17-L20"}}),e._v(" "),a("p",[e._v("In fact, it is exactly the "),a("a",{attrs:{href:"https://github.com/stretchr/testify/blob/v1.7.0/suite/suite.go#L24",target:"_blank",rel:"noopener noreferrer"}},[e._v("same "),a("code",[e._v("require")]),a("OutboundLink")],1),e._v(" object. A basic search and replace should work.")])],1),e._v(" "),a("li",[a("p",[e._v("If you need access to the checkers keeper, it can also be found in the suite:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"a2VlcGVyIDo9IHN1aXRlLmFwcC5DaGVja2Vyc0tlZXBlcgpuZXh0R2FtZSwgZm91bmQgOj0ga2VlcGVyLkdldE5leHRHYW1lKHN1aXRlLmN0eCkK",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/msg_server_create_game_test.go#L51-L52"}})],1)]),e._v(" "),a("h3",{attrs:{id:"what-happened-to-the-events"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#what-happened-to-the-events"}},[e._v("#")]),e._v(" What happened to the events?")]),e._v(" "),a("p",[e._v("As you refactor your existing tests, you may notice that the events become messed up. That is because the bank emits events too, and in particular it emits:")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("An event with the "),a("code",[e._v("message")]),e._v(" type, like yours, with only the sender:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"c2RrLk5ld0V2ZW50KAogICAgc2RrLkV2ZW50VHlwZU1lc3NhZ2UsCiAgICBzZGsuTmV3QXR0cmlidXRlKHR5cGVzLkF0dHJpYnV0ZUtleVNlbmRlciwgZnJvbUFkZHIuU3RyaW5nKCkpLAopLAo=",url:"https://github.com/cosmos/cosmos-sdk/blob/9e1ec7b6/x/bank/keeper/send.go#L166-L169"}})],1),e._v(" "),a("li",[a("p",[e._v("An event with the "),a("code",[e._v("transfer")]),e._v(" type:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"c2RrLk5ld0V2ZW50KAogICAgdHlwZXMuRXZlbnRUeXBlVHJhbnNmZXIsCiAgICBzZGsuTmV3QXR0cmlidXRlKHR5cGVzLkF0dHJpYnV0ZUtleVJlY2lwaWVudCwgdG9BZGRyLlN0cmluZygpKSwKICAgIHNkay5OZXdBdHRyaWJ1dGUodHlwZXMuQXR0cmlidXRlS2V5U2VuZGVyLCBmcm9tQWRkci5TdHJpbmcoKSksCiAgICBzZGsuTmV3QXR0cmlidXRlKHNkay5BdHRyaWJ1dGVLZXlBbW91bnQsIGFtdC5TdHJpbmcoKSksCikK",url:"https://github.com/cosmos/cosmos-sdk/blob/9e1ec7b6/x/bank/keeper/send.go#L160-L165"}})],1)]),e._v(" "),a("p",[e._v("This means that in your "),a("code",[e._v("suite.ctx.EventManager().ABCIEvents()")]),e._v(" there are "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/msg_server_play_move_test.go#L242",target:"_blank",rel:"noopener noreferrer"}},[e._v("extra events"),a("OutboundLink")],1),e._v(" to account for, and in each case there are extra attributes to discard. Recommended steps:")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("Make explicit the count of expected attributes for each event type:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Y29uc3QgKAogICAgdHJhbnNmZXJFdmVudENvdW50ICAgICAgICAgICAgPSAzIC8vIEFzIGVtaXR0ZWQgYnkgdGhlIGJhbmsKICAgIGNyZWF0ZUV2ZW50Q291bnQgICAgICAgICAgICAgID0gNwogICAgcGxheUV2ZW50Q291bnRGaXJzdCAgICAgICAgICAgPSA4IC8vIEV4dHJhICZxdW90O3NlbmRlciZxdW90OyBhdHRyaWJ1dGUgZW1pdHRlZCBieSB0aGUgYmFuawogICAgcGxheUV2ZW50Q291bnROZXh0ICAgICAgICAgICAgPSA3CiAgICByZWplY3RFdmVudENvdW50ICAgICAgICAgICAgICA9IDQKICAgIHJlamVjdEV2ZW50Q291bnRXaXRoVHJhbnNmZXIgID0gNSAgLy8gRXh0cmEgJnF1b3Q7c2VuZGVyJnF1b3Q7IGF0dHJpYnV0ZSBlbWl0dGVkIGJ5IHRoZSBiYW5rCiAgICBmb3JmZWl0RXZlbnRDb3VudCAgICAgICAgICAgICA9IDQKICAgIGZvcmZlaXRFdmVudENvdW50V2l0aFRyYW5zZmVyID0gNSAgLy8gRXh0cmEgJnF1b3Q7c2VuZGVyJnF1b3Q7IGF0dHJpYnV0ZSBlbWl0dGVkIGJ5IHRoZSBiYW5rCikK",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/keeper_integration_test.go#L18-L25"}})],1),e._v(" "),a("li",[a("p",[e._v("Make calculations on the expected count of attributes to discard, depending on the actions previously taken:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"cmVqZWN0QXR0cmlidXRlc0Rpc2NhcmRDb3VudCA6PSBjcmVhdGVFdmVudENvdW50ICsgcGxheUV2ZW50Q291bnRGaXJzdApzdWl0ZS5SZXF1aXJlKCkuRXF1YWxWYWx1ZXMoW11zZGsuQXR0cmlidXRlewogICAgLi4uCiAgICB7S2V5OiAmcXVvdDtJZFZhbHVlJnF1b3Q7LCBWYWx1ZTogJnF1b3Q7MSZxdW90O30sCn0sIHJlamVjdEV2ZW50LkF0dHJpYnV0ZXNbcmVqZWN0QXR0cmlidXRlc0Rpc2NhcmRDb3VudDpdKQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/msg_server_reject_game_test.go#L248-L255"}})],1)]),e._v(" "),a("p",[e._v("You can now refactor your tests, which is a substantial task.")]),e._v(" "),a("h3",{attrs:{id:"extra-tests"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#extra-tests"}},[e._v("#")]),e._v(" Extra tests")]),e._v(" "),a("p",[e._v("After refactoring, and finding no failing tests, it is time to add extra checks of money handling. For instance, before an action that you expect to transfer money (or not), you can verify the initial position:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"c3VpdGUuUmVxdWlyZUJhbmtCYWxhbmNlKGJhbEFsaWNlLCBhbGljZSkKc3VpdGUuUmVxdWlyZUJhbmtCYWxhbmNlKGJhbEJvYiwgYm9iKQpzdWl0ZS5SZXF1aXJlQmFua0JhbGFuY2UoYmFsQ2Fyb2wsIGNhcm9sKQpzdWl0ZS5SZXF1aXJlQmFua0JhbGFuY2UoMCwgY2hlY2tlcnNNb2R1bGVBZGRyZXNzKQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/msg_server_play_move_test.go#L68-L71"}}),e._v(" "),a("p",[e._v("After the action you can test the new balances, for instance:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"c3VpdGUuUmVxdWlyZUJhbmtCYWxhbmNlKGJhbEFsaWNlLCBhbGljZSkKc3VpdGUuUmVxdWlyZUJhbmtCYWxhbmNlKGJhbEJvYiwgYm9iKQpzdWl0ZS5SZXF1aXJlQmFua0JhbGFuY2UoYmFsQ2Fyb2wtMTEsIGNhcm9sKQpzdWl0ZS5SZXF1aXJlQmFua0JhbGFuY2UoMTEsIGNoZWNrZXJzTW9kdWxlQWRkcmVzcykK",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/msg_server_play_move_test.go#L80-L83"}}),e._v(" "),a("p",[e._v("How you subdivide your tests and where you insert these balance checks is up to you. You can find examples here for:")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/msg_server_create_game_test.go#L23-L40",target:"_blank",rel:"noopener noreferrer"}},[e._v("Creating a game"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/msg_server_play_move_test.go#L65-L84",target:"_blank",rel:"noopener noreferrer"}},[e._v("Playing a game"),a("OutboundLink")],1),e._v(", including "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/msg_server_play_move_winner_test.go#L142-L145",target:"_blank",rel:"noopener noreferrer"}},[e._v("up to a resolution"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("li",[e._v("Failing to play a game because of a "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/msg_server_play_move_test.go#L323-L354",target:"_blank",rel:"noopener noreferrer"}},[e._v("failure to pay the wager"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/msg_server_reject_game_test.go#L41-L52",target:"_blank",rel:"noopener noreferrer"}},[e._v("Rejecting a game"),a("OutboundLink")],1),e._v(", including when "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/msg_server_reject_game_test.go#L175-L198",target:"_blank",rel:"noopener noreferrer"}},[e._v("there have been moves played"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/end_block_server_game_test.go#L44-L47",target:"_blank",rel:"noopener noreferrer"}},[e._v("Forfeiting a game"),a("OutboundLink")],1),e._v(", including when "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/872366cd/x/checkers/keeper/end_block_server_game_test.go#L776-L779",target:"_blank",rel:"noopener noreferrer"}},[e._v("there have been moves played"),a("OutboundLink")],1),e._v(".")])]),e._v(" "),a("h3",{attrs:{id:"debug-your-suite"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#debug-your-suite"}},[e._v("#")]),e._v(" Debug your suite")]),e._v(" "),a("p",[e._v("You learned in a "),a("RouterLink",{attrs:{to:"/academy/3-my-own-chain/stored-game.html"}},[e._v("previous section")]),e._v(" how to launch your test in debug mode. It is still possible to do so when using a suite. The difference is that you launch it by right-clicking on the arrow left of the suite's runner "),a("code",[e._v("func TestCheckersKeeperTestSuite")]),e._v(":")],1),e._v(" "),a("p",[a("tm-image",{attrs:{src:"/academy/3-my-own-chain/images/go_test_debug_suite.png"}})],1),e._v(" "),a("p",[e._v("Note that you can only launch debug for all of the suite's test methods and not just a single one (as is possible with a simple test). A solution to this is to create more granular suites, for example using one or more test suites per file.")]),e._v(" "),a("h2",{attrs:{id:"interact-via-the-cli"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#interact-via-the-cli"}},[e._v("#")]),e._v(" Interact via the CLI")]),e._v(" "),a("p",[e._v("Keep the game expiry at 5 minutes to be able to test a forfeit, as done in the "),a("RouterLink",{attrs:{to:"/academy/3-my-own-chain/game-forfeit.html"}},[e._v("previous section")]),e._v(". Now, you need to check balances after relevant steps to test that wagers are being withheld and paid.")],1),e._v(" "),a("p",[e._v("How much do Alice and Bob have to start with?")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"Alice",active:""}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBjaGVja2Vyc2QgcXVlcnkgYmFuayBiYWxhbmNlcyAkYWxpY2UK"}}),e._v(" "),a("p",[e._v("This prints:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"undefined",base64:"YmFsYW5jZXM6Ci0gYW1vdW50OiAmcXVvdDsxMDAwMDAwMDAmcXVvdDsKICBkZW5vbTogc3Rha2UKLSBhbW91bnQ6ICZxdW90OzIwMDAwJnF1b3Q7CiAgZGVub206IHRva2VuCiAgcGFnaW5hdGlvbjoKICBuZXh0X2tleTogbnVsbAogIHRvdGFsOiAmcXVvdDswJnF1b3Q7Cg=="}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"Bob"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBjaGVja2Vyc2QgcXVlcnkgYmFuayBiYWxhbmNlcyAkYm9iCg=="}}),e._v(" "),a("p",[e._v("This prints:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"undefined",base64:"YmFsYW5jZXM6Ci0gYW1vdW50OiAmcXVvdDsxMDAwMDAwMDAmcXVvdDsKICBkZW5vbTogc3Rha2UKLSBhbW91bnQ6ICZxdW90OzEwMDAwJnF1b3Q7CiAgZGVub206IHRva2VuCiAgcGFnaW5hdGlvbjoKICBuZXh0X2tleTogbnVsbAogIHRvdGFsOiAmcXVvdDswJnF1b3Q7Cg=="}})],1)],1),e._v(" "),a("hr"),e._v(" "),a("p",[e._v("Create a game on which the wager will be refunded because the player playing "),a("code",[e._v("red")]),e._v(" did not join:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBjaGVja2Vyc2QgdHggY2hlY2tlcnMgY3JlYXRlLWdhbWUgJGFsaWNlICRib2IgMTAwMDAwMCAtLWZyb20gJGFsaWNlCg=="}}),e._v(" "),a("p",[e._v("Which mentions the wager:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"undefined",base64:"Li4uCnJhd19sb2c6ICdbeyZxdW90O2V2ZW50cyZxdW90OzpbeyZxdW90O3R5cGUmcXVvdDs6JnF1b3Q7bWVzc2FnZSZxdW90OywmcXVvdDthdHRyaWJ1dGVzJnF1b3Q7Olt7JnF1b3Q7a2V5JnF1b3Q7OiZxdW90O2FjdGlvbiZxdW90OywmcXVvdDt2YWx1ZSZxdW90OzomcXVvdDtDcmVhdGVHYW1lJnF1b3Q7fSx7JnF1b3Q7a2V5JnF1b3Q7OiZxdW90O21vZHVsZSZxdW90OywmcXVvdDt2YWx1ZSZxdW90OzomcXVvdDtjaGVja2VycyZxdW90O30seyZxdW90O2tleSZxdW90OzomcXVvdDthY3Rpb24mcXVvdDssJnF1b3Q7dmFsdWUmcXVvdDs6JnF1b3Q7TmV3R2FtZUNyZWF0ZWQmcXVvdDt9LHsmcXVvdDtrZXkmcXVvdDs6JnF1b3Q7Q3JlYXRvciZxdW90OywmcXVvdDt2YWx1ZSZxdW90OzomcXVvdDtjb3Ntb3MxejYzcTJtbjJmNmxqbTh2ZnhqenB1ejB4dGhteXg5cWQweXk1eHImcXVvdDt9LHsmcXVvdDtrZXkmcXVvdDs6JnF1b3Q7SW5kZXgmcXVvdDssJnF1b3Q7dmFsdWUmcXVvdDs6JnF1b3Q7MSZxdW90O30seyZxdW90O2tleSZxdW90OzomcXVvdDtSZWQmcXVvdDssJnF1b3Q7dmFsdWUmcXVvdDs6JnF1b3Q7Y29zbW9zMXo2M3EybW4yZjZsam04dmZ4anpwdXoweHRobXl4OXFkMHl5NXhyJnF1b3Q7fSx7JnF1b3Q7a2V5JnF1b3Q7OiZxdW90O0JsYWNrJnF1b3Q7LCZxdW90O3ZhbHVlJnF1b3Q7OiZxdW90O2Nvc21vczE5NWUwaDVxdzQ0c2F6ZDQ1MHl0NXF2bGx1a2NmcDdseWMzZjlrciZxdW90O30seyZxdW90O2tleSZxdW90OzomcXVvdDtXYWdlciZxdW90OywmcXVvdDt2YWx1ZSZxdW90OzomcXVvdDsxMDAwMDAwJnF1b3Q7fV19XX1dJwo="}}),e._v(" "),a("p",[e._v("Confirm that the balances of both Alice and Bob are unchanged - as they have not played yet.")]),e._v(" "),a("HighlightBox",{attrs:{type:"info"}},[a("p",[a("strong",[e._v("Note:")]),e._v(" In this example Alice paid no gas fees, other than the transaction costs, to create a game. This is fixed in the "),a("RouterLink",{attrs:{to:"/academy/3-my-own-chain/gas-meter.html"}},[e._v("next section")]),e._v(".")],1)]),e._v(" "),a("p",[e._v("Have Bob play:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBjaGVja2Vyc2QgdHggY2hlY2tlcnMgcGxheS1tb3ZlIDEgMSAyIDIgMyAtLWZyb20gJGJvYgo="}}),e._v(" "),a("p",[e._v("Confirm that Bob has paid his wager:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBjaGVja2Vyc2QgcXVlcnkgYmFuayBiYWxhbmNlcyAkYm9iCg=="}}),e._v(" "),a("p",[e._v("This prints:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"undefined",base64:"YmFsYW5jZXM6Ci0gYW1vdW50OiAmcXVvdDs5OTAwMDAwMCZxdW90OyAjICZsdDstIDEsMDAwLDAwMCBmZXdlcgogIGRlbm9tOiBzdGFrZQotIGFtb3VudDogJnF1b3Q7MTAwMDAmcXVvdDsKICBkZW5vbTogdG9rZW4KcGFnaW5hdGlvbjoKICBuZXh0X2tleTogbnVsbAogIHRvdGFsOiAmcXVvdDswJnF1b3Q7Cg=="}}),e._v(" "),a("p",[e._v("Wait 5 minutes for the game to expire and check again:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBjaGVja2Vyc2QgcXVlcnkgYmFuayBiYWxhbmNlcyAkYm9iCg=="}}),e._v(" "),a("p",[e._v("This prints:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"undefined",base64:"YmFsYW5jZXM6Ci0gYW1vdW50OiAmcXVvdDsxMDAwMDAwMDAmcXVvdDsgIyAmbHQ7LSAxLDAwMCwwMDAgYXJlIGJhY2sKICBkZW5vbTogc3Rha2UKLSBhbW91bnQ6ICZxdW90OzEwMDAwJnF1b3Q7CiAgZGVub206IHRva2VuCnBhZ2luYXRpb246CiAgbmV4dF9rZXk6IG51bGwKICB0b3RhbDogJnF1b3Q7MCZxdW90Owo="}}),e._v(" "),a("p",[e._v("Now create a game in which both players only play once each, i.e. where the player playing "),a("code",[e._v("black")]),e._v(" forfeits:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBjaGVja2Vyc2QgdHggY2hlY2tlcnMgY3JlYXRlLWdhbWUgJGFsaWNlICRib2IgMTAwMDAwMCAtLWZyb20gJGFsaWNlCiQgY2hlY2tlcnNkIHR4IGNoZWNrZXJzIHBsYXktbW92ZSAyIDEgMiAyIDMgLS1mcm9tICRib2IKJCBjaGVja2Vyc2QgdHggY2hlY2tlcnMgcGxheS1tb3ZlIDIgMCA1IDEgNCAtLWZyb20gJGFsaWNlCg=="}}),e._v(" "),a("p",[e._v("Confirm that both Alice and Bob paid their wagers. Wait 5 minutes for the game to expire and check again:")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"Alice",active:""}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBjaGVja2Vyc2QgcXVlcnkgYmFuayBiYWxhbmNlcyAkYWxpY2UK"}}),e._v(" "),a("p",[e._v("This shows:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"undefined",base64:"YmFsYW5jZXM6Ci0gYW1vdW50OiAmcXVvdDsxMDEwMDAwMDAmcXVvdDsgIyAmbHQ7LSAxLDAwMCwwMDAgbW9yZSB0aGFuIGF0IHRoZSBiZWdpbm5pbmcKICBkZW5vbTogc3Rha2UKLi4uCg=="}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"Bob"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBjaGVja2Vyc2QgcXVlcnkgYmFuayBiYWxhbmNlcyAkYm9iCg=="}}),e._v(" "),a("p",[e._v("This shows:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"undefined",base64:"YmFsYW5jZXM6Ci0gYW1vdW50OiAmcXVvdDs5OTAwMDAwMCZxdW90OyAjICZsdDstIGhpcyAxLDAwMCwwMDAgYXJlIGdvbmUgZm9yIGdvb2QKICBkZW5vbTogc3Rha2UKLi4uCg=="}})],1)],1),e._v(" "),a("hr"),e._v(" "),a("p",[e._v("This is correct: Alice was the winner by forfeit.")]),e._v(" "),a("p",[e._v("Similarly, you can test that Bob gets his wager back when Alice creates a game, Bob plays, and then Alice rejects it.")]),e._v(" "),a("p",[e._v("It would be difficult to test by CLI when there is a winner after a full game. That would be better tested with a GUI.")]),e._v(" "),a("h2",{attrs:{id:"next-up"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#next-up"}},[e._v("#")]),e._v(" Next up")]),e._v(" "),a("p",[e._v("You can skip ahead and see how to integrate "),a("RouterLink",{attrs:{to:"/academy/3-my-own-chain/wager-denom.html"}},[e._v("foreign tokens")]),e._v(" via the use of IBC, or take a look at the "),a("RouterLink",{attrs:{to:"/academy/3-my-own-chain/gas-meter.html"}},[e._v("next section")]),e._v(" to prevent spam and reward validators proportional to their effort in your checkers blockchain.")],1)],1)}),[],!1,null,null,null);t.default=s.exports}}]);