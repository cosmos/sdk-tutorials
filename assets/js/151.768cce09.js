(window.webpackJsonp=window.webpackJsonp||[]).push([[151],{767:function(e,o,a){"use strict";a.r(o);var l=a(1),t=Object(l.a)({},(function(){var e=this,o=e.$createElement,a=e._self._c||o;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"create-a-leaderboard-chain"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#create-a-leaderboard-chain"}},[e._v("#")]),e._v(" Create a Leaderboard Chain")]),e._v(" "),a("HighlightBox",{attrs:{type:"learning"}},[a("p",[e._v("In this section, you will learn:")]),e._v(" "),a("ul",[a("li",[e._v("How to create an IBC-enabled chain that can receive information from other chains.")]),e._v(" "),a("li",[e._v("How to send player scores from your extended checkers chain to a global leaderboard chain via IBC.")])])]),e._v(" "),a("p",[e._v("After the extension of the checkers chain with a leaderboard module, the checkers game can keep track of player stats and it can maintain (on request) a sorted leaderboard. In addition, it can send player stats via the Inter-Blockchain Communication Protocol (IBC) to another chain.")]),e._v(" "),a("p",[e._v("You will now create a leaderboard chain that can receive the "),a("code",[e._v("Candidate")]),e._v(" packets to store in a "),a("strong",[e._v("global leaderboard")]),e._v(".")]),e._v(" "),a("p",[e._v("Create another folder for your leaderboard chain, and scaffold a chain via Ignite CLI:")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"Local"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBpZ25pdGUgaWduaXRlIHNjYWZmb2xkIGNoYWluIGxlYWRlcmJvYXJkIC0tbm8tbW9kdWxlCg=="}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"Docker"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IFwKICAgIC12ICQocHdkKTovcGFyZW50IFwKICAgIC13IC9wYXJlbnQgXAogICAgaWduaXRlaHEvY2xpOjAuMjIuMSBcCiAgICBzY2FmZm9sZCBjaGFpbiBsZWFkZXJib2FyZCAtLW5vLW1vZHVsZQo="}})],1)],1),e._v(" "),a("p",[e._v("Go into it:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBjZCBsZWFkZXJib2FyZAo="}}),e._v(" "),a("p",[e._v("Again, you can include an IBC-enabled leaderboard module in it:")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"Local"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBpZ25pdGUgc2NhZmZvbGQgbW9kdWxlIGxlYWRlcmJvYXJkIC0taWJjCg=="}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"Docker"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IFwKICAgIC12ICQocHdkKTovbGVhZGVyYm9hcmQgXAogICAgLXcgL2xlYWRlcmJvYXJkIFwKICAgIGlnbml0ZWhxL2NsaTowLjIyLjEgXAogICAgc2NhZmZvbGQgbW9kdWxlIGxlYWRlcmJvYXJkIC0taWJjCg=="}})],1)],1),e._v(" "),a("p",[e._v("You need a structure to keep track of player information too:")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"Local"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBpZ25pdGUgc2NhZmZvbGQgbWFwIHBsYXllckluZm8gXAogICAgd29uQ291bnQ6dWludCBsb3N0Q291bnQ6dWludCBmb3JmZWl0ZWRDb3VudDp1aW50IFwKICAgIGRhdGVVcGRhdGVkOnN0cmluZyBcCiAgICAtLW1vZHVsZSBsZWFkZXJib2FyZCBcCiAgICAtLW5vLW1lc3NhZ2UK"}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"Docker"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IFwKICAgIC12ICQocHdkKTovbGVhZGVyYm9hcmQgXAogICAgLXcgL2xlYWRlcmJvYXJkIFwKICAgIGlnbml0ZWhxL2NsaTowLjIyLjEgXAogICAgc2NhZmZvbGQgbWFwIHBsYXllckluZm8gXAogICAgd29uQ291bnQ6dWludCBsb3N0Q291bnQ6dWludCBmb3JmZWl0ZWRDb3VudDp1aW50IFwKICAgIGRhdGVVcGRhdGVkOnN0cmluZyBcCiAgICAtLW1vZHVsZSBsZWFkZXJib2FyZCBcCiAgICAtLW5vLW1lc3NhZ2UK"}})],1)],1),e._v(" "),a("p",[e._v("And of course a board structure:")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"Local"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBpZ25pdGUgc2NhZmZvbGQgc2luZ2xlIGJvYXJkIFwKICAgIFBsYXllckluZm86UGxheWVySW5mbyBcCiAgICAtLW1vZHVsZSBsZWFkZXJib2FyZCBcCiAgICAtLW5vLW1lc3NhZ2UK"}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"Docker"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IFwKICAgIC12ICQocHdkKTovbGVhZGVyYm9hcmQgXAogICAgLXcgL2xlYWRlcmJvYXJkIFwKICAgIGlnbml0ZWhxL2NsaTowLjIyLjEgXAogICAgc2NhZmZvbGQgc2luZ2xlIGJvYXJkIFwKICAgIFBsYXllckluZm86UGxheWVySW5mbyBcCiAgICAtLW1vZHVsZSBsZWFkZXJib2FyZCBcCiAgICAtLW5vLW1lc3NhZ2UK"}})],1)],1),e._v(" "),a("p",[e._v("In addition, you want to receive candidate packets:")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"Local"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBpZ25pdGUgc2NhZmZvbGQgcGFja2V0IGNhbmRpZGF0ZSBcCiAgICBQbGF5ZXJJbmZvOlBsYXllckluZm8gXAogICAgLS1tb2R1bGUgbGVhZGVyYm9hcmQgXAogICAgLS1uby1tZXNzYWdlCg=="}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"Docker"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IFwKICAgIC12ICQocHdkKTovbGVhZGVyYm9hcmQgXAogICAgLXcgL2xlYWRlcmJvYXJkIFwKICAgIGlnbml0ZWhxL2NsaTowLjIyLjEgXAogICAgc2NhZmZvbGQgcGFja2V0IGNhbmRpZGF0ZSBcCiAgICBQbGF5ZXJJbmZvOlBsYXllckluZm8gXAogICAgLS1tb2R1bGUgbGVhZGVyYm9hcmQgXAogICAgLS1uby1tZXNzYWdlCg=="}})],1)],1),e._v(" "),a("p",[e._v("This time you use the "),a("code",[e._v("--no-message")]),e._v(" flag because this chain is not going to send any player information to other chains.")]),e._v(" "),a("HighlightBox",{attrs:{type:"tip"}},[a("p",[e._v("As in the previous section, you need to make adjustments in the Protobuf files "),a("code",[e._v("proto/leaderboard/board.proto")]),e._v(" and "),a("code",[e._v("proto/leaderboard/genesis.proto")]),e._v(". Make sure to import "),a("code",[e._v("gogoproto/gogo.proto")]),e._v(" and use "),a("code",[e._v("[(gogoproto.nullable) = false];")]),e._v(" for the "),a("code",[e._v("PlayerInfo")]),e._v(" and the "),a("code",[e._v("Board")]),e._v(". You will also need to adjust the "),a("code",[e._v("x/leaderboard/genesis_test.go")]),e._v(" like you did in the previous section.")])]),e._v(" "),a("p",[e._v("Implement the logic for receiving packets in "),a("code",[e._v("x/leaderboard/keeper/candidate.go")]),e._v(":")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIC8vIE9uUmVjdkNhbmRpZGF0ZVBhY2tldCBwcm9jZXNzZXMgcGFja2V0IHJlY2VwdGlvbgogICAgZnVuYyAoayBLZWVwZXIpIE9uUmVjdkNhbmRpZGF0ZVBhY2tldChjdHggc2RrLkNvbnRleHQsIHBhY2tldCBjaGFubmVsdHlwZXMuUGFja2V0LCBkYXRhIHR5cGVzLkNhbmRpZGF0ZVBhY2tldERhdGEpIChwYWNrZXRBY2sgdHlwZXMuQ2FuZGlkYXRlUGFja2V0QWNrLCBlcnIgZXJyb3IpIHsKICAgICAgICAvLyB2YWxpZGF0ZSBwYWNrZXQgZGF0YSB1cG9uIHJlY2VpdmluZwogICAgICAgIGlmIGVyciA6PSBkYXRhLlZhbGlkYXRlQmFzaWMoKTsgZXJyICE9IG5pbCB7CiAgICAgICAgICAgIHJldHVybiBwYWNrZXRBY2ssIGVycgogICAgICAgIH0KCi0gICAgICAvLyBUT0RPOiBwYWNrZXQgcmVjZXB0aW9uIGxvZ2ljCisgICAgICAvLyBPdmVycmlkZSB0aGUgZW50cnkKKyAgICAgIGsuU2V0UGxheWVySW5mbyhjdHgsICpkYXRhLlBsYXllckluZm8pCgogICAgICAgIHJldHVybiBwYWNrZXRBY2ssIG5pbAogICAgfQo=",url:"https://github.com/b9lab/cosmos-ibc-docker/blob/main/modular/leaderboard/x/leaderboard/keeper/candidate.go#L77-L78"}}),e._v(" "),a("p",[e._v("In addition, add a basic validation into "),a("code",[e._v("x/leaderboard/types/packet_candidate.go")]),e._v(":")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"KyAgaW1wb3J0ICgKKyAgICAgICZxdW90O2Vycm9ycyZxdW90OworICApCgogICAgLy8gVmFsaWRhdGVCYXNpYyBpcyB1c2VkIGZvciB2YWxpZGF0aW5nIHRoZSBwYWNrZXQKICAgIGZ1bmMgKHAgQ2FuZGlkYXRlUGFja2V0RGF0YSkgVmFsaWRhdGVCYXNpYygpIGVycm9yIHsKCi0gICAgICAvLyBUT0RPOiBWYWxpZGF0ZSB0aGUgcGFja2V0IGRhdGEKKyAgICAgIC8vIHJldHVybiBlcnJvciBpZiBwbGF5ZXIgaW5mbyBpcyBpbmNvcnJlY3QKKyAgICAgIHBsYXllckluZm9FcnIgOj0gcC5QbGF5ZXJJbmZvLlZhbGlkYXRlQmFzaWMoKQorICAgICAgaWYgcGxheWVySW5mb0VyciAhPSBuaWwgeworICAgICAgICAgIHJldHVybiBwbGF5ZXJJbmZvRXJyCisgICAgICB9CgogICAgICAgIHJldHVybiBuaWwKICAgIH0K",url:"https://github.com/b9lab/cosmos-ibc-docker/blob/main/modular/leaderboard/x/leaderboard/types/packet_candidate.go#L10-L14"}}),e._v(" "),a("p",[e._v("This calls up a new validation on the "),a("code",[e._v("PlayerInfo")]),e._v(", which you also have to declare:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAoaW5mbyBQbGF5ZXJJbmZvKSBWYWxpZGF0ZUJhc2ljKCkgZXJyb3IgewogICAgXywgZXJyIDo9IHNkay5BY2NBZGRyZXNzRnJvbUJlY2gzMihpbmZvLkluZGV4KQogICAgaWYgZXJyICE9IG5pbCB7CiAgICAgICAgcmV0dXJuIGVycgogICAgfQogICAgcmV0dXJuIG5pbAp9Cg==",url:"https://github.com/b9lab/cosmos-ibc-docker/blob/main/modular/leaderboard/x/leaderboard/types/player_info.go"}}),e._v(" "),a("p",[e._v("Now your leaderboard chain can receive player information from chains with the leaderboard module! However, you need to do some more work in order to update the board on this information.")]),e._v(" "),a("p",[e._v("There are two places where you can call for an update on the board structure:")]),e._v(" "),a("ul",[a("li",[e._v("In "),a("code",[e._v("OnRecvCandidatePacket")]),e._v(", so each player sending information will pay the fee for sorting and clipping the leaderboard. This is the choice here, for simplicity.")]),e._v(" "),a("li",[e._v("Or you can change your data structure a little bit and handle the sorting and clipping of the leaderboard in "),a("code",[e._v("EndBlock")]),e._v(".")])]),e._v(" "),a("p",[e._v("Here you will extend the "),a("code",[e._v("x/leaderboard/keeper/candidate.go")]),e._v(" file in order to call for a leaderboard update in "),a("code",[e._v("OnRecvCandidatePacket")]),e._v(". You need to create some helper functions in a new "),a("code",[e._v("x/leaderboard/typesboard.go/board.go")]),e._v(":")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBQYXJzZURhdGVBZGRlZEFzVGltZShkYXRlQWRkZWQgc3RyaW5nKSAoZGF0ZUFkZGVkUGFyc2VkIHRpbWUuVGltZSwgZXJyIGVycm9yKSB7CiAgICBkYXRlQWRkZWRQYXJzZWQsIGVyckRhdGVBZGRlZCA6PSB0aW1lLlBhcnNlKFRpbWVMYXlvdXQsIGRhdGVBZGRlZCkKICAgIHJldHVybiBkYXRlQWRkZWRQYXJzZWQsIHNka2Vycm9ycy5XcmFwZihlcnJEYXRlQWRkZWQsIEVyckludmFsaWREYXRlQWRkZWQuRXJyb3IoKSwgZGF0ZUFkZGVkKQp9CgpmdW5jIFNvcnRQbGF5ZXJJbmZvKHBsYXllckluZm9MaXN0IFtdUGxheWVySW5mbykgewogICAgc29ydC5TbGljZVN0YWJsZShwbGF5ZXJJbmZvTGlzdFs6XSwgZnVuYyhpLCBqIGludCkgYm9vbCB7CiAgICAgICAgaWYgcGxheWVySW5mb0xpc3RbaV0uV29uQ291bnQgJmd0OyBwbGF5ZXJJbmZvTGlzdFtqXS5Xb25Db3VudCB7CiAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgfQogICAgICAgIGlmIHBsYXllckluZm9MaXN0W2ldLldvbkNvdW50ICZsdDsgcGxheWVySW5mb0xpc3Rbal0uV29uQ291bnQgewogICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICB9CiAgICAgICAgZmlyc3RQbGF5ZXJUaW1lLCBfIDo9IFBhcnNlRGF0ZUFkZGVkQXNUaW1lKHBsYXllckluZm9MaXN0W2ldLkRhdGVVcGRhdGVkKQogICAgICAgIHNlY29uZFBsYXllclRpbWUsIF8gOj0gUGFyc2VEYXRlQWRkZWRBc1RpbWUocGxheWVySW5mb0xpc3Rbal0uRGF0ZVVwZGF0ZWQpCgogICAgICAgIHJldHVybiBmaXJzdFBsYXllclRpbWUuQWZ0ZXIoc2Vjb25kUGxheWVyVGltZSkKICAgIH0pCn0K",url:"https://github.com/b9lab/cosmos-ibc-docker/blob/main/modular/leaderboard/x/leaderboard/types/board.go"}}),e._v(" "),a("p",[e._v("And in "),a("code",[e._v("x/leaderboard/keeper/board.go")]),e._v(", introduce a new "),a("code",[e._v("UpdateBoard")]),e._v(" function:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAoayBLZWVwZXIpIFVwZGF0ZUJvYXJkKGN0eCBzZGsuQ29udGV4dCwgcGxheWVySW5mb0xpc3QgW110eXBlcy5QbGF5ZXJJbmZvKSB7CiAgICBTb3J0UGxheWVySW5mbyhwbGF5ZXJJbmZvTGlzdCkKCiAgICBpZiB0eXBlcy5MZWFkZXJib2FyZFdpbm5lckxlbmd0aCAmbHQ7IHVpbnQ2NChsZW4ocGxheWVySW5mb0xpc3QpKSB7CiAgICAgICAgcGxheWVySW5mb0xpc3QgPSBwbGF5ZXJJbmZvTGlzdFs6dHlwZXMuTGVhZGVyYm9hcmRXaW5uZXJMZW5ndGhdCiAgICB9CgogICAgay5TZXRCb2FyZChjdHgsIHR5cGVzLkJvYXJkIHsKICAgICAgICBQbGF5ZXJJbmZvOiBwbGF5ZXJJbmZvTGlzdCwKICAgIH0pCn0K",url:"https://github.com/b9lab/cosmos-ibc-docker/blob/main/modular/leaderboard/x/leaderboard/keeper/board.go#L36-L46"}}),e._v(" "),a("p",[e._v("Again, do not forget to declare the new error type in "),a("code",[e._v("x/leaderboard/types/errors.go")]),e._v(":")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"RXJySW52YWxpZERhdGVBZGRlZCAgICAgPSBzZGtlcnJvcnMuUmVnaXN0ZXIoTW9kdWxlTmFtZSwgMTEyMCwgJnF1b3Q7ZGF0ZUFkZGVkIGNhbm5vdCBiZSBwYXJzZWQ6ICVzJnF1b3Q7KQo=",url:"https://github.com/b9lab/cosmos-ibc-docker/blob/main/modular/leaderboard/x/leaderboard/types/errors.go#L14"}}),e._v(" "),a("p",[e._v("You also need to define "),a("code",[e._v("TimeLayout")]),e._v(" in "),a("code",[e._v("x/leaderboard/types/keys.go")]),e._v(":")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"VGltZUxheW91dCAgICAgICAgICAgICAgPSAmcXVvdDsyMDA2LTAxLTAyIDE1OjA0OjA1Ljk5OTk5OTk5OSArMDAwMCBVVEMmcXVvdDsK",url:"https://github.com/b9lab/cosmos-ibc-docker/blob/main/modular/leaderboard/x/leaderboard/types/keys.go#L40"}}),e._v(" "),a("p",[e._v("Then you can include a call to "),a("code",[e._v("UpdateBoard")]),e._v(" call in "),a("code",[e._v("x/leaderboard/keeper/candidate.go")]),e._v(":")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIC8vIE9uUmVjdkNhbmRpZGF0ZVBhY2tldCBwcm9jZXNzZXMgcGFja2V0IHJlY2VwdGlvbgogICAgZnVuYyAoayBLZWVwZXIpIE9uUmVjdkNhbmRpZGF0ZVBhY2tldChjdHggc2RrLkNvbnRleHQsIHBhY2tldCBjaGFubmVsdHlwZXMuUGFja2V0LCBkYXRhIHR5cGVzLkNhbmRpZGF0ZVBhY2tldERhdGEpIChwYWNrZXRBY2sgdHlwZXMuQ2FuZGlkYXRlUGFja2V0QWNrLCBlcnIgZXJyb3IpIHsKICAgICAgICAuLi4KICAgICAgICBrLlNldFBsYXllckluZm8oY3R4LCAqZGF0YS5QbGF5ZXJJbmZvKQoKKyAgICAgIC8vIFVwZGF0ZSB0aGUgYm9hcmQKKyAgICAgIGJvYXJkLCBmb3VuZCA6PSBrLkdldEJvYXJkKGN0eCkKKyAgICAgIGlmICFmb3VuZCB7CisgICAgICAgICAgcGFuaWMoJnF1b3Q7TGVhZGVyYm9hcmQgbm90IGZvdW5kJnF1b3Q7KQorICAgICAgfQorICAgICAgbGlzdGVkIDo9IGJvYXJkLlBsYXllckluZm8KKyAgICAgIHJlcGxhY2VkIDo9IGZhbHNlCisgICAgICBmb3IgaSA6PSByYW5nZSBsaXN0ZWQgeworICAgICAgICAgIGlmIGxpc3RlZFtpXS5JbmRleCA9PSBkYXRhLlBsYXllckluZm8uSW5kZXggeworICAgICAgICAgICAgICBsaXN0ZWRbaV0gPSAqZGF0YS5QbGF5ZXJJbmZvCisgICAgICAgICAgICAgIHJlcGxhY2VkID0gdHJ1ZQorICAgICAgICAgICAgICBicmVhaworICAgICAgICAgIH0KKyAgICAgIH0KKyAgICAgIGlmICFyZXBsYWNlZCB7CisgICAgICAgICAgbGlzdGVkID0gYXBwZW5kKGxpc3RlZCwgKmRhdGEuUGxheWVySW5mbykKKyAgICAgIH0KKyAgICAgIGsuVXBkYXRlQm9hcmQoY3R4LCBsaXN0ZWQpCgogICAgICAgIHJldHVybiBwYWNrZXRBY2ssIG5pbAogICAgfQo=",url:"https://github.com/b9lab/cosmos-ibc-docker/blob/main/modular/leaderboard/x/leaderboard/keeper/candidate.go#L80-L97"}}),e._v(" "),a("p",[e._v("With this, your leaderboard chain is ready to update its leaderboard when receiving a candidate packet.")]),e._v(" "),a("h2",{attrs:{id:"test-it"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#test-it"}},[e._v("#")]),e._v(" Test it")]),e._v(" "),a("p",[e._v("You can find the sample implementation of the checkers chain extension and the leaderboard chain in "),a("a",{attrs:{href:"https://github.com/b9lab/cosmos-ibc-docker/tree/main/modular",target:"_blank",rel:"noopener noreferrer"}},[e._v("this repository"),a("OutboundLink")],1),e._v(". There you will also find a Docker network and the relayer settings for an easy test. It also includes a script to create and run games.")]),e._v(" "),a("p",[e._v("Follow the steps described in the repository to run a few tests and to see it in action. If you want to do the tests with your chains, replace "),a("code",[e._v("modular/b9-checkers-academy-draft")]),e._v(" with your checkers chain and "),a("code",[e._v("modular/leaderboard")]),e._v(" with your leaderboard chain, and build the docker images.")])],1)}),[],!1,null,null,null);o.default=t.exports}}]);