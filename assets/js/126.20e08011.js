(window.webpackJsonp=window.webpackJsonp||[]).push([[126],{744:function(e,t,o){"use strict";o.r(t);var a=o(1),i=Object(a.a)({},(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[o("h1",{attrs:{id:"record-the-game-winner"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#record-the-game-winner"}},[e._v("#")]),e._v(" Record the Game Winner")]),e._v(" "),o("HighlightBox",{attrs:{type:"prerequisite"}},[o("p",[e._v("Make sure you have everything you need before proceeding:")]),e._v(" "),o("ul",[o("li",[e._v("You understand the concepts of "),o("RouterLink",{attrs:{to:"/academy/2-cosmos-concepts/6-protobuf.html"}},[e._v("Protobuf")]),e._v(".")],1),e._v(" "),o("li",[e._v("Go is installed.")]),e._v(" "),o("li",[e._v("You have the checkers blockchain codebase with the new events. If not, follow the "),o("RouterLink",{attrs:{to:"/hands-on-exercise/1-ignite-cli/7-events.html"}},[e._v("previous steps")]),e._v(" or check out the "),o("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/tree/two-events",target:"_blank",rel:"noopener noreferrer"}},[e._v("relevant version"),o("OutboundLink")],1),e._v(".")],1)])]),e._v(" "),o("HighlightBox",{attrs:{type:"learning"}},[o("p",[e._v("In this section, you will:")]),e._v(" "),o("ul",[o("li",[e._v("Check for a game winner.")]),e._v(" "),o("li",[e._v("Extend unit tests.")])])]),e._v(" "),o("p",[e._v("In a "),o("RouterLink",{attrs:{to:"/hands-on-exercise/1-ignite-cli/6-play-game.html"}},[e._v("previous section")]),e._v(" you made it possible to determine the outcome of a game by declaring a winner. You also "),o("RouterLink",{attrs:{to:"/hands-on-exercise/1-ignite-cli/7-events.html"}},[e._v("emitted it")]),e._v(".")],1),e._v(" "),o("p",[e._v("The next logical step is to also record this information in storage. That will assist you in discerning between games that are current and those that have reached an end by winning. As you will see in subsequent sections about forfeit, there are other ways for a game to finish.")]),e._v(" "),o("p",[e._v("Therefore, a reasonable field to add is for the "),o("strong",[e._v("winner")]),e._v(". It needs to contain:")]),e._v(" "),o("ul",[o("li",[e._v("The winner of a game that reaches completion.")]),e._v(" "),o("li",[e._v("Or the winner "),o("em",[e._v("by forfeit")]),e._v(" when a game is expired.")]),e._v(" "),o("li",[e._v("Or a neutral value when the game is active.")])]),e._v(" "),o("HighlightBox",{attrs:{type:"note"}},[o("p",[e._v("In this section a draw is not handled and it would perhaps require yet another value to be saved in "),o("em",[e._v("winner")]),e._v(".")])]),e._v(" "),o("p",[e._v("It is time to introduce another consideration. When a game has been won, no one else is going to play it. Its board will no longer be updated and is no longer used for any further on-chain decisions. In effect, the board becomes redundant. With a view to keeping a node's storage requirement low, you should delete the board's content but keep the rest of the game's information.")]),e._v(" "),o("p",[e._v("To keep a trace of the last state of the board, you emit it with an event.")]),e._v(" "),o("h2",{attrs:{id:"new-information"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#new-information"}},[e._v("#")]),e._v(" New information")]),e._v(" "),o("p",[e._v("In the "),o("code",[e._v("StoredGame")]),e._v(" Protobuf definition file:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-protobuf",base64:"ICAgIG1lc3NhZ2UgU3RvcmVkR2FtZSB7CiAgICAgICAgLi4uCisgICAgICBzdHJpbmcgd2lubmVyID0gNjsKICAgIH0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/game-winner/proto/checkers/stored_game.proto#L12"}}),e._v(" "),o("p",[e._v("Have Ignite CLI and Protobuf recompile this file:")]),e._v(" "),o("CodeGroup",[o("CodeGroupItem",{attrs:{title:"Local",active:""}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBpZ25pdGUgZ2VuZXJhdGUgcHJvdG8tZ28K"}})],1),e._v(" "),o("CodeGroupItem",{attrs:{title:"Docker"}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IFwKICAgIC12ICQocHdkKTovY2hlY2tlcnMgXAogICAgLXcgL2NoZWNrZXJzIFwKICAgIGNoZWNrZXJzX2kgXAogICAgaWduaXRlIGdlbmVyYXRlIHByb3RvLWdvCg=="}})],1)],1),e._v(" "),o("p",[e._v("Add a helper function to get the winner's address, if it exists. A good location is in "),o("code",[e._v("full_game.go")]),e._v(":")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAoc3RvcmVkR2FtZSBTdG9yZWRHYW1lKSBHZXRQbGF5ZXJBZGRyZXNzKGNvbG9yIHN0cmluZykgKGFkZHJlc3Mgc2RrLkFjY0FkZHJlc3MsIGZvdW5kIGJvb2wsIGVyciBlcnJvcikgewogICAgYmxhY2ssIGVyciA6PSBzdG9yZWRHYW1lLkdldEJsYWNrQWRkcmVzcygpCiAgICBpZiBlcnIgIT0gbmlsIHsKICAgICAgICByZXR1cm4gbmlsLCBmYWxzZSwgZXJyCiAgICB9CiAgICByZWQsIGVyciA6PSBzdG9yZWRHYW1lLkdldFJlZEFkZHJlc3MoKQogICAgaWYgZXJyICE9IG5pbCB7CiAgICAgICAgcmV0dXJuIG5pbCwgZmFsc2UsIGVycgogICAgfQogICAgYWRkcmVzcywgZm91bmQgPSBtYXBbc3RyaW5nXXNkay5BY2NBZGRyZXNzewogICAgICAgIHJ1bGVzLlBpZWNlU3RyaW5nc1tydWxlcy5CTEFDS19QTEFZRVJdOiBibGFjaywKICAgICAgICBydWxlcy5QaWVjZVN0cmluZ3NbcnVsZXMuUkVEX1BMQVlFUl06ICAgcmVkLAogICAgfVtjb2xvcl0KICAgIHJldHVybiBhZGRyZXNzLCBmb3VuZCwgbmlsCn0KCmZ1bmMgKHN0b3JlZEdhbWUgU3RvcmVkR2FtZSkgR2V0V2lubmVyQWRkcmVzcygpIChhZGRyZXNzIHNkay5BY2NBZGRyZXNzLCBmb3VuZCBib29sLCBlcnIgZXJyb3IpIHsKICAgIHJldHVybiBzdG9yZWRHYW1lLkdldFBsYXllckFkZHJlc3Moc3RvcmVkR2FtZS5XaW5uZXIpCn0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/game-winner/x/checkers/types/full_game.go#L34-L52"}}),e._v(" "),o("h2",{attrs:{id:"update-and-check-for-the-winner"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#update-and-check-for-the-winner"}},[e._v("#")]),e._v(" Update and check for the winner")]),e._v(" "),o("p",[e._v("This is a two-part update. You set the winner where relevant, but you also introduce new checks so that a game with a winner cannot be acted upon.")]),e._v(" "),o("p",[e._v("Start with a new error that you define as a constant:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIHZhciAoCiAgICAgICAgLi4uCisgICAgICBFcnJHYW1lRmluaXNoZWQgPSBzZGtlcnJvcnMuUmVnaXN0ZXIoTW9kdWxlTmFtZSwgMTExMCwgJnF1b3Q7Z2FtZSBpcyBhbHJlYWR5IGZpbmlzaGVkJnF1b3Q7KQogICAgKQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/game-winner/x/checkers/types/errors.go#L21"}}),e._v(" "),o("p",[e._v("And a new event attribute:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIGNvbnN0ICgKICAgICAgICBNb3ZlUGxheWVkRXZlbnRUeXBlICAgICAgPSAmcXVvdDttb3ZlLXBsYXllZCZxdW90OwogICAgICAgIC4uLgogICAgICAgIE1vdmVQbGF5ZWRFdmVudFdpbm5lciAgICA9ICZxdW90O3dpbm5lciZxdW90OworICAgICAgTW92ZVBsYXllZEV2ZW50Qm9hcmQgICAgID0gJnF1b3Q7Ym9hcmQmcXVvdDsKICAgICkK",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/game-winner/x/checkers/types/keys.go#L43"}}),e._v(" "),o("p",[e._v("At creation, in the "),o("em",[e._v("create game")]),e._v(" message handler, start with a neutral value:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIC4uLgogICAgc3RvcmVkR2FtZSA6PSB0eXBlcy5TdG9yZWRHYW1lewogICAgICAgIC4uLgorICAgICAgV2lubmVyOiAgICBydWxlcy5QaWVjZVN0cmluZ3NbcnVsZXMuTk9fUExBWUVSXSwKICAgIH0KICAgIC4uLgo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/game-winner/x/checkers/keeper/msg_server_create_game.go#L28"}}),e._v(" "),o("p",[e._v("With further checks when handling a play in the handler:")]),e._v(" "),o("ol",[o("li",[o("p",[e._v("Check that the game has not finished yet:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIC4uLgorICBpZiBzdG9yZWRHYW1lLldpbm5lciAhPSBydWxlcy5QaWVjZVN0cmluZ3NbcnVsZXMuTk9fUExBWUVSXSB7CisgICAgICByZXR1cm4gbmlsLCB0eXBlcy5FcnJHYW1lRmluaXNoZWQKKyAgfQogICAgaXNCbGFjayA6PSBzdG9yZWRHYW1lLkJsYWNrID09IG1zZy5DcmVhdG9yCiAgICAuLi4K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/game-winner/x/checkers/keeper/msg_server_play_move.go#L21-L23"}})],1),e._v(" "),o("li",[o("p",[e._v("Update the winner field, which "),o("a",{attrs:{href:"https://github.com/batkinson/checkers-go/blob/master/checkers/checkers.go#L165",target:"_blank",rel:"noopener noreferrer"}},[e._v("remains neutral"),o("OutboundLink")],1),e._v(" if there is no winner yet, and adjust the board depending on whether the game is finished or not:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIC4uLgotICBzdG9yZWRHYW1lLkJvYXJkID0gZ2FtZS5TdHJpbmcoKQorICBzdG9yZWRHYW1lLldpbm5lciA9IHJ1bGVzLlBpZWNlU3RyaW5nc1tnYW1lLldpbm5lcigpXQorCisgIGxhc3RCb2FyZCA6PSBnYW1lLlN0cmluZygpCisgIGlmIHN0b3JlZEdhbWUuV2lubmVyID09IHJ1bGVzLlBpZWNlU3RyaW5nc1tydWxlcy5OT19QTEFZRVJdIHsKKyAgICAgIHN0b3JlZEdhbWUuQm9hcmQgPSBsYXN0Qm9hcmQKKyAgfSBlbHNlIHsKKyAgICAgIHN0b3JlZEdhbWUuQm9hcmQgPSAmcXVvdDsmcXVvdDsKKyAgfQogICAgLi4uCg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/game-winner/x/checkers/keeper/msg_server_play_move.go#L61-L68"}})],1),e._v(" "),o("li",[o("p",[e._v("Add the new attribute in the event:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIC4uLgogICAgY3R4LkV2ZW50TWFuYWdlcigpLkVtaXRFdmVudCgKICAgICAgICBzZGsuTmV3RXZlbnQodHlwZXMuTW92ZVBsYXllZEV2ZW50VHlwZSwKICAgICAgICAgICAgLi4uCiAgICAgICAgICAgIHNkay5OZXdBdHRyaWJ1dGUodHlwZXMuTW92ZVBsYXllZEV2ZW50V2lubmVyLCBydWxlcy5QaWVjZVN0cmluZ3NbZ2FtZS5XaW5uZXIoKV0pLAorICAgICAgICAgIHNkay5OZXdBdHRyaWJ1dGUodHlwZXMuTW92ZVBsYXllZEV2ZW50Qm9hcmQsIGxhc3RCb2FyZCksCiAgICAgICAgKSwKICAgICkKICAgIC4uLgo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/game-winner/x/checkers/keeper/msg_server_play_move.go#L80"}})],1)]),e._v(" "),o("p",[e._v("Confirm the code compiles, add unit tests, and you are ready to handle the expiration of games.")]),e._v(" "),o("h2",{attrs:{id:"unit-tests"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#unit-tests"}},[e._v("#")]),e._v(" Unit tests")]),e._v(" "),o("p",[e._v("Add "),o("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/game-winner/x/checkers/types/full_game_test.go#L100-L174",target:"_blank",rel:"noopener noreferrer"}},[e._v("tests"),o("OutboundLink")],1),e._v(" for your new functions.")]),e._v(" "),o("p",[e._v("You also need to update your existing tests so that they pass with a new "),o("code",[e._v("Winner")]),e._v(" value. Most of your tests need to add this line:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIC4uLgogICAgcmVxdWlyZS5FcXVhbFZhbHVlcyh0LCB0eXBlcy5TdG9yZWRHYW1lewogICAgICAgIC4uLgorICAgICAgV2lubmVyOiAmcXVvdDsqJnF1b3Q7LAogICAgfSwgZ2FtZTEpCiAgICAuLi4K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/game-winner/x/checkers/keeper/msg_server_play_move_test.go#L107"}}),e._v(" "),o("p",[e._v("This "),o("code",[e._v('"*"')]),e._v(" means that in your tests no games have reached a conclusion with a winner. Time to fix that. In a dedicated "),o("code",[e._v("full_game_helpers.go")]),e._v(" file, prepare all the moves that will be played in the test. For convenience, a move will be written as:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"dHlwZSBHYW1lTW92ZVRlc3Qgc3RydWN0IHsKICAgIHBsYXllciBzdHJpbmcKICAgIGZyb21YICB1aW50NjQKICAgIGZyb21ZICB1aW50NjQKICAgIHRvWCAgICB1aW50NjQKICAgIHRvWSAgICB1aW50NjQKfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/game-winner/x/checkers/testutil/full_game_helpers.go#L11-L17"}}),e._v(" "),o("p",[e._v("If you do not want to create a complete game yourself, you can choose this one:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"dmFyICgKICAgIEdhbWUxTW92ZXMgPSBbXUdhbWVNb3ZlVGVzdHsKICAgICAgICB7JnF1b3Q7YiZxdW90OywgMSwgMiwgMiwgM30sIC8vICZxdW90OypiKmIqYipifGIqYipiKmIqfCoqKmIqYipifCoqYioqKioqfCoqKioqKioqfHIqcipyKnIqfCpyKnIqcipyfHIqcipyKnIqJnF1b3Q7CiAgICAgICAgeyZxdW90O3ImcXVvdDssIDAsIDUsIDEsIDR9LCAvLyAmcXVvdDsqYipiKmIqYnxiKmIqYipiKnwqKipiKmIqYnwqKmIqKioqKnwqcioqKioqKnwqKnIqcipyKnwqcipyKnIqcnxyKnIqcipyKiZxdW90OwogICAgICAgIHsmcXVvdDtiJnF1b3Q7LCAyLCAzLCAwLCA1fSwgLy8gJnF1b3Q7KmIqYipiKmJ8YipiKmIqYip8KioqYipiKmJ8KioqKioqKip8KioqKioqKip8YipyKnIqcip8KnIqcipyKnJ8cipyKnIqciomcXVvdDsKICAgICAgICAuLi4KICAgICAgICB7JnF1b3Q7ciZxdW90OywgMywgNiwgMiwgNX0sIC8vICZxdW90OypiKmIqKioqfCoqYipiKioqfCoqKioqYioqfCoqKioqKioqfCoqKioqKioqfCoqcioqKioqfCpCKioqYioqfCoqKioqKioqJnF1b3Q7CiAgICAgICAgeyZxdW90O2ImcXVvdDssIDEsIDYsIDMsIDR9LCAvLyAmcXVvdDsqYipiKioqKnwqKmIqYioqKnwqKioqKmIqKnwqKioqKioqKnwqKipCKioqKnwqKioqKioqKnwqKioqKmIqKnwqKioqKioqKiZxdW90OwogICAgfQopCg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/game-winner/x/checkers/testutil/full_game_helpers.go#L19-L63"}}),e._v(" "),o("p",[e._v("You may want to add a small function that converts "),o("code",[e._v('"b"')]),e._v(" and "),o("code",[e._v('"r"')]),e._v(" into their respective player addresses:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBHZXRQbGF5ZXIoY29sb3Igc3RyaW5nLCBibGFjayBzdHJpbmcsIHJlZCBzdHJpbmcpIHN0cmluZyB7CiAgICBpZiBjb2xvciA9PSAmcXVvdDtiJnF1b3Q7IHsKICAgICAgICByZXR1cm4gYmxhY2sKICAgIH0KICAgIHJldHVybiByZWQKfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/game-winner/x/checkers/testutil/full_game_helpers.go#L65-L70"}}),e._v(" "),o("p",[e._v("And another that applies all the moves. This could become handy if you have multiple games in the future:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBQbGF5QWxsTW92ZXMoCiAgICB0ICp0ZXN0aW5nLlQsCiAgICBtc2dTZXJ2ZXIgdHlwZXMuTXNnU2VydmVyLAogICAgY29udGV4dCBjb250ZXh0LkNvbnRleHQsCiAgICBnYW1lSW5kZXggc3RyaW5nLAogICAgYmxhY2sgc3RyaW5nLAogICAgcmVkIHN0cmluZywKICAgIG1vdmVzIFtdR2FtZU1vdmVUZXN0KSB7CiAgICBmb3IgXywgbW92ZSA6PSByYW5nZSBtb3ZlcyB7CiAgICAgICAgXywgZXJyIDo9IG1zZ1NlcnZlci5QbGF5TW92ZShjb250ZXh0LCAmYW1wO3R5cGVzLk1zZ1BsYXlNb3ZlewogICAgICAgICAgICBDcmVhdG9yOiAgIEdldFBsYXllcihtb3ZlLnBsYXllciwgYmxhY2ssIHJlZCksCiAgICAgICAgICAgIEdhbWVJbmRleDogZ2FtZUluZGV4LAogICAgICAgICAgICBGcm9tWDogICAgIG1vdmUuZnJvbVgsCiAgICAgICAgICAgIEZyb21ZOiAgICAgbW92ZS5mcm9tWSwKICAgICAgICAgICAgVG9YOiAgICAgICBtb3ZlLnRvWCwKICAgICAgICAgICAgVG9ZOiAgICAgICBtb3ZlLnRvWSwKICAgICAgICB9KQogICAgICAgIHJlcXVpcmUuTmlsKHQsIGVycikKICAgIH0KfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/game-winner/x/checkers/testutil/full_game_helpers.go#L72-L91"}}),e._v(" "),o("p",[e._v("Now, in a new file, create the test that plays all the moves, and checks at the end that the game has been saved with the right winner:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBUZXN0UGxheU1vdmVVcFRvV2lubmVyKHQgKnRlc3RpbmcuVCkgewogICAgbXNnU2VydmVyLCBrZWVwZXIsIGNvbnRleHQgOj0gc2V0dXBNc2dTZXJ2ZXJXaXRoT25lR2FtZUZvclBsYXlNb3ZlKHQpCiAgICBjdHggOj0gc2RrLlVud3JhcFNES0NvbnRleHQoY29udGV4dCkKCiAgICB0ZXN0dXRpbC5QbGF5QWxsTW92ZXModCwgbXNnU2VydmVyLCBjb250ZXh0LCAmcXVvdDsxJnF1b3Q7LCBib2IsIGNhcm9sLCB0ZXN0dXRpbC5HYW1lMU1vdmVzKQoKICAgIHN5c3RlbUluZm8sIGZvdW5kIDo9IGtlZXBlci5HZXRTeXN0ZW1JbmZvKGN0eCkKICAgIHJlcXVpcmUuVHJ1ZSh0LCBmb3VuZCkKICAgIHJlcXVpcmUuRXF1YWxWYWx1ZXModCwgdHlwZXMuU3lzdGVtSW5mb3sKICAgICAgICBOZXh0SWQ6IDIsCiAgICB9LCBzeXN0ZW1JbmZvKQoKICAgIGdhbWUsIGZvdW5kIDo9IGtlZXBlci5HZXRTdG9yZWRHYW1lKGN0eCwgJnF1b3Q7MSZxdW90OykKICAgIHJlcXVpcmUuVHJ1ZSh0LCBmb3VuZCkKICAgIHJlcXVpcmUuRXF1YWxWYWx1ZXModCwgdHlwZXMuU3RvcmVkR2FtZXsKICAgICAgICBJbmRleDogICZxdW90OzEmcXVvdDssCiAgICAgICAgQm9hcmQ6ICAmcXVvdDsmcXVvdDssCiAgICAgICAgVHVybjogICAmcXVvdDtiJnF1b3Q7LAogICAgICAgIEJsYWNrOiAgYm9iLAogICAgICAgIFJlZDogICAgY2Fyb2wsCiAgICAgICAgV2lubmVyOiAmcXVvdDtiJnF1b3Q7LAogICAgfSwgZ2FtZSkKICAgIGV2ZW50cyA6PSBzZGsuU3RyaW5naWZ5RXZlbnRzKGN0eC5FdmVudE1hbmFnZXIoKS5BQkNJRXZlbnRzKCkpCiAgICByZXF1aXJlLkxlbih0LCBldmVudHMsIDIpCiAgICBldmVudCA6PSBldmVudHNbMF0KICAgIHJlcXVpcmUuRXF1YWwodCwgZXZlbnQuVHlwZSwgJnF1b3Q7bW92ZS1wbGF5ZWQmcXVvdDspCiAgICByZXF1aXJlLkVxdWFsVmFsdWVzKHQsIFtdc2RrLkF0dHJpYnV0ZXsKICAgICAgICB7S2V5OiAmcXVvdDtjcmVhdG9yJnF1b3Q7LCBWYWx1ZTogYm9ifSwKICAgICAgICB7S2V5OiAmcXVvdDtnYW1lLWluZGV4JnF1b3Q7LCBWYWx1ZTogJnF1b3Q7MSZxdW90O30sCiAgICAgICAge0tleTogJnF1b3Q7Y2FwdHVyZWQteCZxdW90OywgVmFsdWU6ICZxdW90OzImcXVvdDt9LAogICAgICAgIHtLZXk6ICZxdW90O2NhcHR1cmVkLXkmcXVvdDssIFZhbHVlOiAmcXVvdDs1JnF1b3Q7fSwKICAgICAgICB7S2V5OiAmcXVvdDt3aW5uZXImcXVvdDssIFZhbHVlOiAmcXVvdDtiJnF1b3Q7fSwKICAgICAgICB7S2V5OiAmcXVvdDtib2FyZCZxdW90OywgVmFsdWU6ICZxdW90OypiKmIqKioqfCoqYipiKioqfCoqKioqYioqfCoqKioqKioqfCoqKkIqKioqfCoqKioqKioqfCoqKioqYioqfCoqKioqKioqJnF1b3Q7fSwKICAgIH0sIGV2ZW50LkF0dHJpYnV0ZXNbKGxlbih0ZXN0dXRpbC5HYW1lMU1vdmVzKS0xKSo2Ol0pCn0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/game-winner/x/checkers/keeper/msg_server_play_move_winner_test.go#L12-L46"}}),e._v(" "),o("HighlightBox",{attrs:{type:"note"}},[o("p",[e._v("When checking the attributes, it only cares about the last six:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZXZlbnQuQXR0cmlidXRlc1sobGVuKHRlc3R1dGlsLkdhbWUxTW92ZXMpLTEpKjY6XSkK"}})],1),e._v(" "),o("p",[e._v("Feel free to create another game won by the red player.")]),e._v(" "),o("h2",{attrs:{id:"interact-via-the-cli"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#interact-via-the-cli"}},[e._v("#")]),e._v(" Interact via the CLI")]),e._v(" "),o("p",[e._v("If you have created games in an earlier version of the code, you are now in a broken state. You cannot even play the old games because they have "),o("code",[e._v('.Winner == ""')]),e._v(" and this will be caught by the "),o("code",[e._v("if storedGame.Winner != rules.PieceStrings[rules.NO_PLAYER]")]),e._v(" test. At some point, look at "),o("RouterLink",{attrs:{to:"/hands-on-exercise/4-run-in-prod/2-migration-info.html"}},[e._v("migrations")]),e._v(" to avoid falling into such a situation with a blockchain in production.")],1),e._v(" "),o("p",[e._v("Start again:")]),e._v(" "),o("CodeGroup",[o("CodeGroupItem",{attrs:{title:"Local",active:""}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBpZ25pdGUgY2hhaW4gc2VydmUgLS1yZXNldC1vbmNlCg=="}})],1),e._v(" "),o("CodeGroupItem",{attrs:{title:"Docker"}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IFwKICAgIC0tbmFtZSBjaGVja2VycyBcCiAgICAtdiAkKHB3ZCk6L2NoZWNrZXJzIFwKICAgIC13IC9jaGVja2VycyBcCiAgICBjaGVja2Vyc19pIFwKICAgIGlnbml0ZSBjaGFpbiBzZXJ2ZSAtLXJlc2V0LW9uY2UK"}})],1)],1),e._v(" "),o("p",[e._v("Do not forget to export "),o("code",[e._v("alice")]),e._v(" and "),o("code",[e._v("bob")]),e._v(" again, as explained in an "),o("RouterLink",{attrs:{to:"/hands-on-exercise/1-ignite-cli/4-create-message.html"}},[e._v('earlier section under "Interact via the CLI"')]),e._v(".")],1),e._v(" "),o("p",[e._v("Confirm that there is no winner for a game when it is created:")]),e._v(" "),o("CodeGroup",[o("CodeGroupItem",{attrs:{title:"Local",active:""}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBjaGVja2Vyc2QgdHggY2hlY2tlcnMgY3JlYXRlLWdhbWUgJGFsaWNlICRib2IgLS1mcm9tICRhbGljZQokIGNoZWNrZXJzZCBxdWVyeSBjaGVja2VycyBzaG93LXN0b3JlZC1nYW1lIDEK"}})],1),e._v(" "),o("CodeGroupItem",{attrs:{title:"Docker"}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtaXQgY2hlY2tlcnMgXAogICAgY2hlY2tlcnNkIHR4IGNoZWNrZXJzIGNyZWF0ZS1nYW1lICRhbGljZSAkYm9iIC0tZnJvbSAkYWxpY2UKJCBkb2NrZXIgZXhlYyAtaXQgY2hlY2tlcnMgXAogICAgY2hlY2tlcnNkIHF1ZXJ5IGNoZWNrZXJzIHNob3ctc3RvcmVkLWdhbWUgMQo="}})],1)],1),e._v(" "),o("p",[e._v("This should show:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"txt",base64:"Li4uCiAgd2lubmVyOiAnKicKLi4uCg=="}}),e._v(" "),o("p",[e._v("And when a player plays:")]),e._v(" "),o("CodeGroup",[o("CodeGroupItem",{attrs:{title:"Local",active:""}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBjaGVja2Vyc2QgdHggY2hlY2tlcnMgcGxheS1tb3ZlIDEgMSAyIDIgMyAtLWZyb20gJGFsaWNlCiQgY2hlY2tlcnNkIHF1ZXJ5IGNoZWNrZXJzIHNob3ctc3RvcmVkLWdhbWUgMQo="}})],1),e._v(" "),o("CodeGroupItem",{attrs:{title:"Docker"}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtaXQgY2hlY2tlcnMgXAogICAgY2hlY2tlcnNkIHR4IGNoZWNrZXJzIHBsYXktbW92ZSAxIDEgMiAyIDMgLS1mcm9tICRhbGljZQokIGRvY2tlciBleGVjIC1pdCBjaGVja2VycyBcCiAgICBjaGVja2Vyc2QgcXVlcnkgY2hlY2tlcnMgc2hvdy1zdG9yZWQtZ2FtZSAxCg=="}})],1)],1),e._v(" "),o("p",[e._v("This should show:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"txt",base64:"Li4uCiAgd2lubmVyOiAnKicKLi4uCg=="}}),e._v(" "),o("p",[e._v("Testing with the CLI up to the point where the game is resolved with a rightful winner is better covered by unit tests (as done here) or with a nice GUI. You will be able to partially test this with the CLI in the "),o("RouterLink",{attrs:{to:"/hands-on-exercise/2-ignite-cli-adv/4-game-forfeit.html"}},[e._v("next section")]),e._v(", via a forfeit.")],1),e._v(" "),o("HighlightBox",{attrs:{type:"synopsis"}},[o("p",[e._v("To summarize, this section has explored:")]),e._v(" "),o("ul",[o("li",[e._v("How to prepare for terminating games by defining a "),o("strong",[e._v("winner")]),e._v(" field that differentiates between the outright winner of a completed game, the winner by forfeit when a game is expired, or a game which is still active.")]),e._v(" "),o("li",[e._v("What new information and functions to add and where, including the winner field, helper functions to get any winner's address, a new error for games already finished, and checks for various application actions.")]),e._v(" "),o("li",[e._v("How to update your tests to check the functionality of your code.")]),e._v(" "),o("li",[e._v("How interacting via the CLI is partially impeded by any existing test games now being in a broken state due to the absence of a value in the winner field, with recommendations for next actions to take.")])])])],1)}),[],!1,null,null,null);t.default=i.exports}}]);