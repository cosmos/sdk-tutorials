(window.webpackJsonp=window.webpackJsonp||[]).push([[111],{730:function(e,t,o){"use strict";o.r(t);var i=o(1),n=Object(i.a)({},(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[o("h1",{attrs:{id:"light-client-development"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#light-client-development"}},[e._v("#")]),e._v(" Light Client Development")]),e._v(" "),o("HighlightBox",{attrs:{type:"prerequisite"}},[o("p",[e._v("Before you dive into light clients, we recommend reviewing the following sections:")]),e._v(" "),o("ul",[o("li",[o("RouterLink",{attrs:{to:"/academy/3-ibc/1-what-is-ibc.html"}},[e._v("What is IBC?")])],1),e._v(" "),o("li",[o("RouterLink",{attrs:{to:"/academy/3-ibc/4-clients.html"}},[e._v("Transport, Authentication, and Ordering Layer - Clients")])],1)])]),e._v(" "),o("HighlightBox",{attrs:{type:"learning"}},[o("p",[e._v("In this section, you will learn:")]),e._v(" "),o("ul",[o("li",[e._v("Why we need extra light clients to be developed")]),e._v(" "),o("li",[e._v("What light client developers need to do, and where to find documentation")]),e._v(" "),o("li",[e._v("How to get a new light client on your chain")])])]),e._v(" "),o("h2",{attrs:{id:"ibc-ecosystem-expansion"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#ibc-ecosystem-expansion"}},[e._v("#")]),e._v(" IBC ecosystem expansion")]),e._v(" "),o("p",[e._v("IBC was envisioned in the original Cosmos whitepaper to be both a crucial component of the appchain thesis for the Interchain network and also a generic and universally applicable standard for blockchain interoperability.")]),e._v(" "),o("p",[e._v("Whereas the protocol always envisioned the wider adoption of IBC, the ibc-go implementation initially was focused on its usage in Cosmos SDK chains connecting to similar chains. In order to expand IBC to other chain ecosystems, the "),o("a",{attrs:{href:"https://github.com/cosmos/ibc-go/releases/tag/v7.0.0",target:"_blank",rel:"noopener noreferrer"}},[e._v("ibc-go v7 release"),o("OutboundLink")],1),e._v(" included a refactor to the "),o("code",[e._v("02-client")]),e._v(" submodule, which should streamline the development of light clients to connect ibc-go to chains with another consensus than "),o("code",[e._v("07-tendermint")]),e._v(".")]),e._v(" "),o("HighlightBox",{attrs:{type:"docs"}},[o("p",[e._v("In this section, it is assumed that the version of ibc-go is >= v7. For more information about the changes and the motivation, please refer to this "),o("a",{attrs:{href:"https://medium.com/the-interchain-foundation/client-refactor-laying-the-groundwork-for-ibc-to-expand-across-ecosystems-61ec5a1b63bc",target:"_blank",rel:"noopener noreferrer"}},[e._v("blog post"),o("OutboundLink")],1),e._v(" or "),o("a",{attrs:{href:"https://github.com/cosmos/ibc-go/blob/main/docs/architecture/adr-006-02-client-refactor.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("ADR-006"),o("OutboundLink")],1),e._v(" on the topic of the client refactor.")])]),e._v(" "),o("h2",{attrs:{id:"light-client-development-a-high-level-overview"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#light-client-development-a-high-level-overview"}},[e._v("#")]),e._v(" Light client development - a high-level overview")]),e._v(" "),o("HighlightBox",{attrs:{type:"reading"}},[o("p",[e._v("The development of a light client for heterogeneous chains is a complex topic and is outside of the scope presented here. Light client developers are urged to instead refer to "),o("a",{attrs:{href:"https://ibc.cosmos.network/main/ibc/light-clients/overview.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("the light client developer guide"),o("OutboundLink")],1),e._v(" in the ibc-go documentation.")])]),e._v(" "),o("h3",{attrs:{id:"recap-what-does-a-light-client-do"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#recap-what-does-a-light-client-do"}},[e._v("#")]),e._v(" Recap: what does a light client do?")]),e._v(" "),o("p",[e._v("A short and succinct "),o("strong",[e._v("summary of a light client's functionality")]),e._v(" is the following: a light client stores a trusted consensus state, and provides functionality to verify updates to the consensus state or verify packet commitments against the trusted root by using Merkle proofs.")]),e._v(" "),o("h3",{attrs:{id:"major-interfaces"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#major-interfaces"}},[e._v("#")]),e._v(" Major interfaces")]),e._v(" "),o("p",[e._v("Access to IBC light clients is gated by the core IBC "),o("code",[e._v("MsgServer")]),e._v(", which utilizes the abstractions set by the "),o("code",[e._v("02-client")]),e._v(" submodule to call into a light client module. A light client module developer is only required to implement a set of interfaces as defined in the "),o("code",[e._v("modules/core/exported")]),e._v(" package of ibc-go.")]),e._v(" "),o("p",[e._v("A light client module developer should be concerned with three main interfaces:")]),e._v(" "),o("ul",[o("li",[o("a",{attrs:{href:"https://github.com/cosmos/ibc-go/blob/v7.0.0/modules/core/exported/client.go#L36",target:"_blank",rel:"noopener noreferrer"}},[o("code",[e._v("ClientState")]),o("OutboundLink")],1),e._v(" contains all the information needed to verify a "),o("code",[e._v("ClientMessage")]),e._v(" and perform membership and non-membership proof verification of the counterparty state. This includes properties that refer to the remote state machine, the light client type, and the specific light client instance.")]),e._v(" "),o("li",[o("a",{attrs:{href:"https://github.com/cosmos/ibc-go/blob/v7.0.0/modules/core/exported/client.go#L133",target:"_blank",rel:"noopener noreferrer"}},[o("code",[e._v("ConsensusState")]),o("OutboundLink")],1),e._v(" tracks consensus data used for verification of client updates, misbehavior detection, and proof verification of the counterparty state.")]),e._v(" "),o("li",[o("a",{attrs:{href:"https://github.com/cosmos/ibc-go/blob/v7.0.0/modules/core/exported/client.go#L147",target:"_blank",rel:"noopener noreferrer"}},[o("code",[e._v("ClientMessage")]),o("OutboundLink")],1),e._v(" is used for submitting block headers (single or batch) for client updates, and submission of misbehavior evidence using conflicting headers.")])]),e._v(" "),o("h3",{attrs:{id:"handling-client-messages"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#handling-client-messages"}},[e._v("#")]),e._v(" Handling client messages")]),e._v(" "),o("p",[e._v("The light client can be updated by handling the aforementioned "),o("code",[e._v("ClientMessage")]),e._v(". This will either be an update to the "),o("code",[e._v("ConsensusState")]),e._v(" through verification of a single header or multiple batched headers, or it could be evidence of misbehavior which (if confirmed) will result in the client getting frozen for security reasons.")]),e._v(" "),o("p",[e._v("The "),o("code",[e._v("ClientMessage")]),e._v(" will be passed onto the client through a "),o("code",[e._v("MsgUpdateClient")]),e._v(" (generally submitted by a relayer). The "),o("code",[e._v("02-client")]),e._v("'s "),o("a",{attrs:{href:"https://github.com/cosmos/ibc-go/blob/v7.0.0/modules/core/02-client/keeper/client.go#L48",target:"_blank",rel:"noopener noreferrer"}},[o("code",[e._v("UpdateClient")]),o("OutboundLink")],1),e._v(" method will then handle the client message by using "),o("a",{attrs:{href:"https://github.com/cosmos/ibc-go/blob/v7.0.0/modules/core/exported/client.go#L98-L109",target:"_blank",rel:"noopener noreferrer"}},[e._v("these 4 methods on the "),o("code",[e._v("ClientState")]),e._v(" interface"),o("OutboundLink")],1),e._v(":")]),e._v(" "),o("ul",[o("li",[o("code",[e._v("VerifyClientMessage")])]),e._v(" "),o("li",[o("code",[e._v("CheckForMisbehaviour")])]),e._v(" "),o("li",[o("code",[e._v("UpdateStateOnMisbehaviour")])]),e._v(" "),o("li",[o("code",[e._v("UpdateState")])])]),e._v(" "),o("p",[e._v("For the full explanation, please refer to "),o("a",{attrs:{href:"https://ibc.cosmos.network/main/ibc/light-clients/updates-and-misbehaviour.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("the docs"),o("OutboundLink")],1),e._v(".")]),e._v(" "),o("HighlightBox",{attrs:{type:"note"}},[o("p",[e._v("You will note that the "),o("code",[e._v("ClientState")]),e._v(" interface also contains the following methods:")]),e._v(" "),o("ul",[o("li",[o("code",[e._v("VerifyUpgradeAndUpdateState")])]),e._v(" "),o("li",[o("code",[e._v("CheckSubstituteAndUpdateState")])])]),e._v(" "),o("p",[e._v("These similarly provide the functionality to update the client based on handling messages but they cover the less frequent cases of, respectively:")]),e._v(" "),o("ul",[o("li",[e._v("Upgrading the light client when the remote chain it is representing upgrades - read the docs "),o("a",{attrs:{href:"https://ibc.cosmos.network/main/ibc/light-clients/upgrades.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("here"),o("OutboundLink")],1),e._v(".")]),e._v(" "),o("li",[e._v("Updating the client with the state of a substitute client (following a client being expired) through a governance proposal -read the docs "),o("a",{attrs:{href:"https://ibc.cosmos.network/main/ibc/light-clients/proposals.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("here"),o("OutboundLink")],1),e._v(".")])])]),e._v(" "),o("HighlightBox",{attrs:{type:"info"}},[o("p",[e._v("Prior to the client refactor (prior to v7) the client and consensus states are set within the "),o("code",[e._v("02-client")]),e._v(" submodule. Moving these responsibilities from the "),o("code",[e._v("02-client")]),e._v(" to the individual light client implementations (including the setting of updated client state and consensus state in the client store) provides light client developers with a greater degree of flexibility with respect to storage and verification, and allows for the abstraction of different types of consensus states/consensus state verification methods away from IBC clients and the connections/channels that they support.")])]),e._v(" "),o("h3",{attrs:{id:"packet-commitment-verification"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#packet-commitment-verification"}},[e._v("#")]),e._v(" Packet commitment verification")]),e._v(" "),o("p",[e._v("In addition to updating the client and consensus state, the light client also provides functionality to perform the verification required for the packet flow (send, receive, and acknowledge or timeout). IBC currently uses Merkle proofs to verify against the trusted root if the state is either committed or absent on a predefined standardized key path, as defined in "),o("a",{attrs:{href:"https://github.com/cosmos/ibc/tree/main/spec/core/ics-024-host-requirements",target:"_blank",rel:"noopener noreferrer"}},[e._v("ICS-24 host requirements"),o("OutboundLink")],1),e._v(".")]),e._v(" "),o("p",[e._v("As you have seen in the "),o("RouterLink",{attrs:{to:"/academy/3-ibc/4-clients.html"}},[e._v("previous section on clients")]),e._v(", when the IBC handler receives a message to receive, acknowledge, or timeout a packet, it will call one of the following functions on the "),o("code",[e._v("connectionKeeper")]),e._v(" to verify if the remote chain includes (or does not include) the appropriate state:")],1),e._v(" "),o("ul",[o("li",[o("a",{attrs:{href:"https://github.com/cosmos/ibc-go/blob/v7.0.0/modules/core/03-connection/keeper/verify.go#L205",target:"_blank",rel:"noopener noreferrer"}},[o("code",[e._v("VerifyPacketCommitment")]),o("OutboundLink")],1),e._v(" checks if the proof added to a "),o("code",[e._v("MsgRecvPacket")]),e._v(" submitted to the destination points to a valid packet commitment on the source.")]),e._v(" "),o("li",[o("a",{attrs:{href:"https://github.com/cosmos/ibc-go/blob/v7.0.0/modules/core/03-connection/keeper/verify.go#L250",target:"_blank",rel:"noopener noreferrer"}},[o("code",[e._v("VerifyPacketAcknowledgement")]),o("OutboundLink")],1),e._v(" checks if the proof added to a "),o("code",[e._v("MsgAcknowledgePacket")]),e._v(" submitted to the source points to a valid packet receipt commitment on the destination.")]),e._v(" "),o("li",[o("a",{attrs:{href:"https://github.com/cosmos/ibc-go/blob/v7.0.0/modules/core/03-connection/keeper/verify.go#L296",target:"_blank",rel:"noopener noreferrer"}},[o("code",[e._v("VerifyPacketReceiptAbsence")]),o("OutboundLink")],1),e._v(" checks if the proof added to a "),o("code",[e._v("MsgTimeout")]),e._v(" submitted to the source proves that a packet receipt is absent at a height beyond the timeout height on the destination.")])]),e._v(" "),o("p",[e._v("All of the above rely on either "),o("code",[e._v("VerifyMembership")]),e._v(" or "),o("code",[e._v("VerifyNonMembership")]),e._v(" methods to prove either inclusion (also referred to as "),o("em",[e._v("existence")]),e._v(") or non-inclusion ("),o("em",[e._v("non-existence")]),e._v(") at a given commitment path.")]),e._v(" "),o("p",[e._v("It is up to the light client developer to add these methods to their light client implementation.")]),e._v(" "),o("HighlightBox",{attrs:{type:"reading"}},[o("p",[e._v("Please refer to the "),o("a",{attrs:{href:"https://github.com/cosmos/ibc-go/blob/v7.0.0/modules/core/23-commitment/types/merkle.go#L131-L205",target:"_blank",rel:"noopener noreferrer"}},[e._v("ICS-23 implementation"),o("OutboundLink")],1),e._v(" for a concrete example.")])]),e._v(" "),o("h3",{attrs:{id:"add-the-light-client-to-a-cosmos-sdk-chain"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#add-the-light-client-to-a-cosmos-sdk-chain"}},[e._v("#")]),e._v(" Add the light client to a Cosmos SDK chain")]),e._v(" "),o("p",[e._v("Suppose that you have managed to develop a light client implementation fulfilling the requirements described above. How do you now get the light client on-chain?")]),e._v(" "),o("p",[e._v("This will depend on the chain environment you are in, so from here on the assumption will be made that you want to add the light client module to a Cosmos SDK chain, in order for the Cosmos SDK chain that you are interacting with to be able to verify proofs of the consensus state coming from your non-"),o("code",[e._v("07-tendermint")]),e._v(" chain.")]),e._v(" "),o("p",[e._v("For example, if you are developing a light client which enables proof verification of ETH2 or Solana, you would need to deploy a light client that can verify proofs of ETH2 or Solana consensus state on Cosmos SDK chains which you want to interoperate with.")]),e._v(" "),o("h4",{attrs:{id:"configure-the-light-client-module"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#configure-the-light-client-module"}},[e._v("#")]),e._v(" Configure the light client module")]),e._v(" "),o("p",[e._v("You will be adding your light client as an SDK module which must implement the SDK's "),o("a",{attrs:{href:"https://github.com/cosmos/cosmos-sdk/blob/main/types/module/module.go#L50",target:"_blank",rel:"noopener noreferrer"}},[o("code",[e._v("AppModuleBasic")]),o("OutboundLink")],1),e._v(" interface.")]),e._v(" "),o("p",[e._v("You must then register your light client module with "),o("code",[e._v("module.BasicManager")]),e._v(" in the chain's "),o("code",[e._v("app.go")]),e._v(" file.")]),e._v(" "),o("p",[e._v("More information can be found "),o("a",{attrs:{href:"https://ibc.cosmos.network/main/ibc/light-clients/setup.html#configuring-a-light-client-module",target:"_blank",rel:"noopener noreferrer"}},[e._v("here"),o("OutboundLink")],1),e._v(".")]),e._v(" "),o("h4",{attrs:{id:"get-support-through-governance"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#get-support-through-governance"}},[e._v("#")]),e._v(" Get support through governance")]),e._v(" "),o("p",[e._v("In order to successfully create an IBC client using a new client type, it "),o("a",{attrs:{href:"https://github.com/cosmos/ibc-go/blob/v7.0.0/modules/core/02-client/keeper/client.go#L19-L25",target:"_blank",rel:"noopener noreferrer"}},[e._v("must be supported"),o("OutboundLink")],1),e._v(". Light client support in IBC is gated by on-chain governance. The allow list may be updated by submitting a new governance proposal to update the "),o("code",[e._v("02-client")]),e._v(" parameter "),o("code",[e._v("AllowedClients")]),e._v(".")]),e._v(" "),o("HighlightBox",{attrs:{type:"info"}},[o("p",[e._v("To add your light client "),o("code",[e._v("0x-new-client")]),e._v(" to "),o("code",[e._v("AllowedClients")]),e._v(", submit a proposal:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCAuLi4gdHggZ292IHN1Ym1pdC1sZWdhY3ktcHJvcG9zYWwgXAogIHBhcmFtLWNoYW5nZSAmbHQ7cGF0aC90by9wcm9wb3NhbC5qc29uJmd0OyBcCiAgLS1mcm9tPSZsdDtrZXlfb3JfYWRkcmVzcyZndDsK"}}),e._v(" "),o("p",[e._v("where "),o("code",[e._v("proposal.json")]),e._v(" contains:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"json",base64:"ewogICZxdW90O3RpdGxlJnF1b3Q7OiAmcXVvdDtJQkMgQ2xpZW50cyBQYXJhbSBDaGFuZ2UmcXVvdDssCiAgJnF1b3Q7ZGVzY3JpcHRpb24mcXVvdDs6ICZxdW90O1VwZGF0ZSBhbGxvd2VkIGNsaWVudHMmcXVvdDssCiAgJnF1b3Q7Y2hhbmdlcyZxdW90OzogWwogICAgewogICAgICAmcXVvdDtzdWJzcGFjZSZxdW90OzogJnF1b3Q7aWJjJnF1b3Q7LAogICAgICAmcXVvdDtrZXkmcXVvdDs6ICZxdW90O0FsbG93ZWRDbGllbnRzJnF1b3Q7LAogICAgICAmcXVvdDt2YWx1ZSZxdW90OzogWyZxdW90OzA2LXNvbG9tYWNoaW5lJnF1b3Q7LCAmcXVvdDswNy10ZW5kZXJtaW50JnF1b3Q7LCAmcXVvdDsweC1uZXctY2xpZW50JnF1b3Q7XQogICAgfQogIF0sCiAgJnF1b3Q7ZGVwb3NpdCZxdW90OzogJnF1b3Q7MTAwMHN0YWtlJnF1b3Q7Cn0K"}})],1),e._v(" "),o("h4",{attrs:{id:"create-client-instances"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#create-client-instances"}},[e._v("#")]),e._v(" Create client instances")]),e._v(" "),o("p",[e._v("When the governance proposal has passed, relayers can create client instances by submitting a "),o("code",[e._v("MsgCreateClient")]),e._v(" as described in "),o("RouterLink",{attrs:{to:"/academy/3-ibc/4-clients.html#creating-a-client"}},[e._v("the previous section on IBC light clients")]),e._v(".")],1),e._v(" "),o("p",[e._v("And there you have it: you have contributed to the expansion of IBC to other ecosystems!")]),e._v(" "),o("HighlightBox",{attrs:{type:"docs"}},[o("p",[e._v("This section is meant as a short introduction to the topic of light client development, for further information we recommend taking a look at the "),o("a",{attrs:{href:"https://ibc.cosmos.network/main/ibc/light-clients/overview.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("ibc-go docs"),o("OutboundLink")],1),e._v(".")])]),e._v(" "),o("HighlightBox",{attrs:{type:"synopsis"}},[o("p",[e._v("To summarize, this section has explored:")]),e._v(" "),o("ul",[o("li",[e._v("How the development of IBC light clients is crucial to the expansion of IBC into other ecosystems, to connect them to the Interchain.")]),e._v(" "),o("li",[e._v("Where to find the required documentation in the form of a "),o("em",[e._v("light client developer guide")]),e._v(" if you need to develop a light client.")]),e._v(" "),o("li",[e._v("What the most important interfaces are: client and consensus state and client messages.")]),e._v(" "),o("li",[e._v("How a client can get updates.")]),e._v(" "),o("li",[e._v("How a client can verify packets against its trusted root using Merkle proofs.")])])])],1)}),[],!1,null,null,null);t.default=n.exports}}]);