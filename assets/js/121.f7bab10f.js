(window.webpackJsonp=window.webpackJsonp||[]).push([[121],{725:function(e,t,a){"use strict";a.r(t);var o=a(0),c=Object(o.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"message-and-handler-add-a-way-to-make-a-move"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#message-and-handler-add-a-way-to-make-a-move"}},[e._v("#")]),e._v(" Message and Handler - Add a Way to Make a Move")]),e._v(" "),a("HighlightBox",{attrs:{type:"synopsis"}},[a("p",[e._v("Make sure you have all you need before proceeding:")]),e._v(" "),a("ul",[a("li",[e._v("You understand the concepts of "),a("RouterLink",{attrs:{to:"/academy/2-main-concepts/transactions.html"}},[e._v("transactions")]),e._v(", "),a("RouterLink",{attrs:{to:"/academy/2-main-concepts/messages.html"}},[e._v("messages")]),e._v("), and "),a("RouterLink",{attrs:{to:"/academy/2-main-concepts/protobuf.html"}},[e._v("Protobuf")]),e._v(".")],1),e._v(" "),a("li",[e._v("Have Go installed.")]),e._v(" "),a("li",[e._v("The checkers blockchain codebase with "),a("code",[e._v("MsgCreateGame")]),e._v(" and its handling. You can get there by following the "),a("RouterLink",{attrs:{to:"/academy/4-my-own-chain/create-handling.html"}},[e._v("previous steps")]),e._v(" or checking out the "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/tree/create-game-handler",target:"_blank",rel:"noopener noreferrer"}},[e._v("relevant version"),a("OutboundLink")],1),e._v(".")],1)])]),e._v(" "),a("p",[e._v("To play a game a player only needs to specify:")]),e._v(" "),a("ul",[a("li",[e._v("The ID of the game the player wants to join. Call the field "),a("code",[e._v("idValue")]),e._v(".")]),e._v(" "),a("li",[e._v("The initial positions of the pawn. Call the fields "),a("code",[e._v("fromX")]),e._v(" and "),a("code",[e._v("fromY")]),e._v(" and make them "),a("code",[e._v("uint")]),e._v(".")]),e._v(" "),a("li",[e._v("The final position of the pawn after a player's move. Call the fields "),a("code",[e._v("toX")]),e._v(" and "),a("code",[e._v("toY")]),e._v(" to be "),a("code",[e._v("uint")]),e._v(" too.")])]),e._v(" "),a("p",[e._v("The player does not need to be explicitly added as a field in the message because the player "),a("strong",[e._v("is")]),e._v(" implicitly the signer of the message. Name the object "),a("code",[e._v("PlayMove")]),e._v(".")]),e._v(" "),a("p",[e._v("Unlike when creating the game, you want to return:")]),e._v(" "),a("ul",[a("li",[e._v("The game ID again. Call this field "),a("code",[e._v("idValue")]),e._v(".")]),e._v(" "),a("li",[e._v("The captured piece, if any. Call the fields "),a("code",[e._v("capturedX")]),e._v(" and "),a("code",[e._v("capturedY")]),e._v(".")]),e._v(" "),a("li",[e._v("The winner in the field "),a("code",[e._v("winner")]),e._v(".")])]),e._v(" "),a("h2",{attrs:{id:"with-ignite-cli"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#with-ignite-cli"}},[e._v("#")]),e._v(" With Ignite CLI")]),e._v(" "),a("p",[e._v("Now Ignite CLI only creates a response object with a single field. You can update the object after Ignite CLI has run:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBpZ25pdGUgc2NhZmZvbGQgbWVzc2FnZSBwbGF5TW92ZSBpZFZhbHVlIGZyb21YOnVpbnQgZnJvbVk6dWludCB0b1g6dWludCB0b1k6dWludCAtLW1vZHVsZSBjaGVja2VycyAtLXJlc3BvbnNlIGlkVmFsdWUK"}}),e._v(" "),a("p",[e._v("Ignite CLI once more creates all the necessary Protobuf files and the boilerplate for you. All you have left to do is:")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("Add the missing fields to the response in "),a("code",[e._v("proto/checkers/tx.proto")]),e._v(":")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"protobuf",base64:"bWVzc2FnZSBNc2dQbGF5TW92ZVJlc3BvbnNlIHsKICAgIHN0cmluZyBpZFZhbHVlID0gMTsKICAgIGludDY0IGNhcHR1cmVkWCA9IDI7CiAgICBpbnQ2NCBjYXB0dXJlZFkgPSAzOwogICAgc3RyaW5nIHdpbm5lciA9IDQ7Cn0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/8d686fc4feaf38687092712849f35a5d74a11378/proto/checkers/tx.proto#L25-L30"}}),e._v(" "),a("p",[e._v("Use "),a("code",[e._v("int64")]),e._v(" here so that you can enter "),a("code",[e._v("-1")]),e._v(" when no pawns have been captured.")])],1),e._v(" "),a("li",[a("p",[e._v("Fill in the needed part in "),a("code",[e._v("x/checkers/keeper/msg_server_play_move.go")]),e._v(":")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAoayBtc2dTZXJ2ZXIpIFBsYXlNb3ZlKGdvQ3R4IGNvbnRleHQuQ29udGV4dCwgbXNnICp0eXBlcy5Nc2dQbGF5TW92ZSkgKCp0eXBlcy5Nc2dQbGF5TW92ZVJlc3BvbnNlLCBlcnJvcikgewogICAgY3R4IDo9IHNkay5VbndyYXBTREtDb250ZXh0KGdvQ3R4KQoKICAgIC8vIFRPRE86IEhhbmRsaW5nIHRoZSBtZXNzYWdlCiAgICBfID0gY3R4CgogICAgcmV0dXJuICZhbXA7dHlwZXMuTXNnUGxheU1vdmVSZXNwb25zZXt9LCBuaWwKfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/f52a673c3fbd2c31c408f0c0aecb70d8c1a880f7/x/checkers/keeper/msg_server_play_move.go#L10-L17"}}),e._v(" "),a("p",[e._v("Where the "),a("code",[e._v("TODO")]),e._v(" is replaced as per below.")])],1)]),e._v(" "),a("h2",{attrs:{id:"the-move-handling"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#the-move-handling"}},[e._v("#")]),e._v(" The move handling")]),e._v(" "),a("p",[a("code",[e._v("rules")]),e._v(" represent the ready-made file containing the rules of the game you imported earlier. Declare them in "),a("code",[e._v("x/checkers/types/errors.go")]),e._v(" given your code has to handle new error situations:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"RXJyR2FtZU5vdEZvdW5kICAgICA9IHNka2Vycm9ycy5SZWdpc3RlcihNb2R1bGVOYW1lLCAxMTA0LCAmcXVvdDtnYW1lIGJ5IGlkIG5vdCBmb3VuZDogJXMmcXVvdDspCkVyckNyZWF0b3JOb3RQbGF5ZXIgPSBzZGtlcnJvcnMuUmVnaXN0ZXIoTW9kdWxlTmFtZSwgMTEwNSwgJnF1b3Q7bWVzc2FnZSBjcmVhdG9yIGlzIG5vdCBhIHBsYXllcjogJXMmcXVvdDspCkVyck5vdFBsYXllclR1cm4gICAgPSBzZGtlcnJvcnMuUmVnaXN0ZXIoTW9kdWxlTmFtZSwgMTEwNiwgJnF1b3Q7cGxheWVyIHRyaWVkIHRvIHBsYXkgb3V0IG9mIHR1cm46ICVzJnF1b3Q7KQpFcnJXcm9uZ01vdmUgICAgICAgID0gc2RrZXJyb3JzLlJlZ2lzdGVyKE1vZHVsZU5hbWUsIDExMDcsICZxdW90O3dyb25nIG1vdmUmcXVvdDspCg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/8d686fc4feaf38687092712849f35a5d74a11378/x/checkers/types/errors.go#L14-L18"}}),e._v(" "),a("p",[e._v("Take the following steps to replace the "),a("code",[e._v("TODO")]),e._v(":")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("Fetch the stored game information:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"c3RvcmVkR2FtZSwgZm91bmQgOj0gay5LZWVwZXIuR2V0U3RvcmVkR2FtZShjdHgsIG1zZy5JZFZhbHVlKQppZiAhZm91bmQgewogICAgcmV0dXJuIG5pbCwgc2RrZXJyb3JzLldyYXBmKHR5cGVzLkVyckdhbWVOb3RGb3VuZCwgJnF1b3Q7Z2FtZSBub3QgZm91bmQgJXMmcXVvdDssIG1zZy5JZFZhbHVlKQp9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/8d686fc/x/checkers/keeper/msg_server_play_move.go#L16-L19"}}),e._v(" "),a("p",[e._v("Using the "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/8d686fc4feaf38687092712849f35a5d74a11378/x/checkers/keeper/stored_game.go#L17",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("Keeper.GetStoredGame")]),a("OutboundLink")],1),e._v(" function created by Ignite CLI.")])],1),e._v(" "),a("li",[a("p",[e._v("Is the player legitimate? Check with:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"dmFyIHBsYXllciBydWxlcy5QbGF5ZXIKaWYgc3RyaW5ncy5Db21wYXJlKHN0b3JlZEdhbWUuUmVkLCBtc2cuQ3JlYXRvcikgPT0gMCB7CiAgICBwbGF5ZXIgPSBydWxlcy5SRURfUExBWUVSCn0gZWxzZSBpZiBzdHJpbmdzLkNvbXBhcmUoc3RvcmVkR2FtZS5CbGFjaywgbXNnLkNyZWF0b3IpID09IDAgewogICAgcGxheWVyID0gcnVsZXMuQkxBQ0tfUExBWUVSCn0gZWxzZSB7CiAgICByZXR1cm4gbmlsLCB0eXBlcy5FcnJDcmVhdG9yTm90UGxheWVyCn0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/8d686fc/x/checkers/keeper/msg_server_play_move.go#L22-L29"}}),e._v(" "),a("p",[e._v("Using the certainty that the "),a("code",[e._v("MsgPlayMove.Creator")]),e._v(" has been verified "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/8d686fc4feaf38687092712849f35a5d74a11378/x/checkers/types/message_play_move.go#L29-L35",target:"_blank",rel:"noopener noreferrer"}},[e._v("by its signature"),a("OutboundLink")],1),e._v(".")])],1),e._v(" "),a("li",[a("p",[e._v("Instantiate the board to implement the rules:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Z2FtZSwgZXJyIDo9IHN0b3JlZEdhbWUuUGFyc2VHYW1lKCkKaWYgZXJyICE9IG5pbCB7CiAgICBwYW5pYyhlcnIuRXJyb3IoKSkKfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/8d686fc/x/checkers/keeper/msg_server_play_move.go#L32-L35"}}),e._v(" "),a("p",[e._v("Good thing you previously created "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/8d686fc4feaf38687092712849f35a5d74a11378/x/checkers/types/full_game.go#L24-L33",target:"_blank",rel:"noopener noreferrer"}},[e._v("this helper"),a("OutboundLink")],1),e._v(".")])],1),e._v(" "),a("li",[a("p",[e._v("Is it the player's turn? Check with:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"aWYgIWdhbWUuVHVybklzKHBsYXllcikgewogICAgcmV0dXJuIG5pbCwgdHlwZXMuRXJyTm90UGxheWVyVHVybgp9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/8d686fc/x/checkers/keeper/msg_server_play_move.go#L36-L38"}}),e._v(" "),a("p",[e._v("Using the rules file's own "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/8d686fc4feaf38687092712849f35a5d74a11378/x/checkers/rules/checkers.go#L145-L147",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("TurnIs")]),a("OutboundLink")],1),e._v(" function.")])],1),e._v(" "),a("li",[a("p",[e._v("Properly conduct the move:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Y2FwdHVyZWQsIG1vdmVFcnIgOj0gZ2FtZS5Nb3ZlKAogICAgcnVsZXMuUG9zewogICAgICAgIFg6IGludChtc2cuRnJvbVgpLAogICAgICAgIFk6IGludChtc2cuRnJvbVkpLAogICAgfSwKICAgIHJ1bGVzLlBvc3sKICAgICAgICBYOiBpbnQobXNnLlRvWCksCiAgICAgICAgWTogaW50KG1zZy5Ub1kpLAogICAgfSwKKQppZiBtb3ZlRXJyICE9IG5pbCB7CiAgICByZXR1cm4gbmlsLCBzZGtlcnJvcnMuV3JhcGYobW92ZUVyciwgdHlwZXMuRXJyV3JvbmdNb3ZlLkVycm9yKCkpCn0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/8d686fc/x/checkers/keeper/msg_server_play_move.go#L41-L53"}}),e._v(" "),a("p",[e._v("Using the rules' "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/8d686fc4feaf38687092712849f35a5d74a11378/x/checkers/rules/checkers.go#L274-L301",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("Move")]),a("OutboundLink")],1),e._v(" function.")])],1),e._v(" "),a("li",[a("p",[e._v("Prepare the updated board to be stored and store the information:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"c3RvcmVkR2FtZS5HYW1lID0gZ2FtZS5TdHJpbmcoKQpzdG9yZWRHYW1lLlR1cm4gPSBnYW1lLlR1cm4uQ29sb3IKay5LZWVwZXIuU2V0U3RvcmVkR2FtZShjdHgsIHN0b3JlZEdhbWUpCg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/8d686fc/x/checkers/keeper/msg_server_play_move.go#L56-L58"}}),e._v(" "),a("p",[e._v("Updating the fields that were modified using the "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/8d686fc4feaf38687092712849f35a5d74a11378/x/checkers/keeper/stored_game.go#L10",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("Keeper.SetStoredGame")]),a("OutboundLink")],1),e._v(" function just as when you created and saved the game.")])],1),e._v(" "),a("li",[a("p",[e._v("Return relevant information regarding the move's result:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"cmV0dXJuICZhbXA7dHlwZXMuTXNnUGxheU1vdmVSZXNwb25zZXsKICAgIElkVmFsdWU6ICAgbXNnLklkVmFsdWUsCiAgICBDYXB0dXJlZFg6IGludDY0KGNhcHR1cmVkLlgpLAogICAgQ2FwdHVyZWRZOiBpbnQ2NChjYXB0dXJlZC5ZKSwKICAgIFdpbm5lcjogICAgZ2FtZS5XaW5uZXIoKS5Db2xvciwKfSwgbmlsCg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/8d686fc/x/checkers/keeper/msg_server_play_move.go#L61-L66"}}),e._v(" "),a("p",[e._v("The "),a("code",[e._v("Captured")]),e._v(" and "),a("code",[e._v("Winner")]),e._v(" information would be lost if you do not. More accurately, one would have to replay the transaction to find out the values. Better be a good citizen and make this information easily accessible.")])],1)]),e._v(" "),a("p",[e._v("That is all there is to it: good preparation and the use of Ignite CLI.")]),e._v(" "),a("h2",{attrs:{id:"next-up"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#next-up"}},[e._v("#")]),e._v(" Next up")]),e._v(" "),a("p",[e._v("Before you add a third Message to let a player "),a("RouterLink",{attrs:{to:"/academy/4-my-own-chain/reject-game.html"}},[e._v("reject a game")]),e._v(", add events to the existing message handlers for relevant information. That is the object of the "),a("RouterLink",{attrs:{to:"/academy/4-my-own-chain/events.html"}},[e._v("next section")]),e._v(".")],1),e._v(" "),a("p",[e._v("If you want to skip ahead and see how you can assist a player in not submitting a transaction that would result in a failed move, you can "),a("RouterLink",{attrs:{to:"/academy/4-my-own-chain/can-play.html"}},[e._v("create a query to test a move")]),e._v(".")],1)],1)}),[],!1,null,null,null);t.default=c.exports}}]);