(window.webpackJsonp=window.webpackJsonp||[]).push([[85],{688:function(l,c,C){"use strict";C.r(c);var t=C(0),b=Object(t.a)({},(function(){var l=this,c=l.$createElement,C=l._self._c||c;return C("ContentSlotsDistributor",{attrs:{"slot-key":l.$parent.slotKey}},[C("h1",{attrs:{id:"create-the-buy-order-ibc-packet"}},[C("a",{staticClass:"header-anchor",attrs:{href:"#create-the-buy-order-ibc-packet"}},[l._v("#")]),l._v(" Create the Buy Order IBC packet")]),l._v(" "),C("p",[l._v("In this chapter you want to modify the IBC logic to create buy orders on the IBC exchange.\nThe logic is very similar to the previous sell order chapter.")]),l._v(" "),C("h2",{attrs:{id:"modify-the-proto-definition"}},[C("a",{staticClass:"header-anchor",attrs:{href:"#modify-the-proto-definition"}},[l._v("#")]),l._v(" Modify the Proto Definition")]),l._v(" "),C("p",[l._v("Add the buyer to the proto file definition")]),l._v(" "),C("tm-code-block",{staticClass:"codeblock",attrs:{language:"proto",base64:"Ly8gcHJvdG8vaWJjZGV4L3BhY2tldC5wcm90bwptZXNzYWdlIEJ1eU9yZGVyUGFja2V0RGF0YSB7CiAgc3RyaW5nIGFtb3VudERlbm9tID0gMTsKICBpbnQzMiBhbW91bnQgPSAyOwogIHN0cmluZyBwcmljZURlbm9tID0gMzsKICBpbnQzMiBwcmljZSA9IDQ7CiAgc3RyaW5nIGJ1eWVyID0gNTsgLy8gJmx0Oy0tCn0K"}}),l._v(" "),C("h2",{attrs:{id:"about-the-ibc-packet"}},[C("a",{staticClass:"header-anchor",attrs:{href:"#about-the-ibc-packet"}},[l._v("#")]),l._v(" About the IBC Packet")]),l._v(" "),C("p",[l._v("The IBC packet has four different stages you need to consider:")]),l._v(" "),C("ol",[C("li",[l._v("Before transmitting the packet")]),l._v(" "),C("li",[l._v("On Receipt of a packet")]),l._v(" "),C("li",[l._v("On Acknowledgment of a packet")]),l._v(" "),C("li",[l._v("On Timeout of a packet")])]),l._v(" "),C("h3",{attrs:{id:"pre-transmit"}},[C("a",{staticClass:"header-anchor",attrs:{href:"#pre-transmit"}},[l._v("#")]),l._v(" Pre-transmit")]),l._v(" "),C("p",[l._v("Before a sell order will be submitted, make sure it contains the following logic:")]),l._v(" "),C("ul",[C("li",[l._v("Check if the pair exists on the order book")]),l._v(" "),C("li",[l._v("If the token is an IBC token, burn the tokens")]),l._v(" "),C("li",[l._v("If the token is a native token, lock the tokens")]),l._v(" "),C("li",[l._v("Save the voucher received on the target chain to later resolve a denom")])]),l._v(" "),C("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8geC9pYmNkZXgva2VlcGVyL21zZ19zZXJ2ZXJfYnV5X29yZGVyLmdvCmltcG9ydCAmcXVvdDtlcnJvcnMmcXVvdDsKCmZ1bmMgKGsgbXNnU2VydmVyKSBTZW5kQnV5T3JkZXIoZ29DdHggY29udGV4dC5Db250ZXh0LCBtc2cgKnR5cGVzLk1zZ1NlbmRCdXlPcmRlcikgKCp0eXBlcy5Nc2dTZW5kQnV5T3JkZXJSZXNwb25zZSwgZXJyb3IpIHsKCWN0eCA6PSBzZGsuVW53cmFwU0RLQ29udGV4dChnb0N0eCkKCgkvLyBDYW5ub3Qgc2VuZCBhIG9yZGVyIGlmIHRoZSBwYWlyIGRvZXNuJ3QgZXhpc3QKCXBhaXJJbmRleCA6PSB0eXBlcy5PcmRlckJvb2tJbmRleChtc2cuUG9ydCwgbXNnLkNoYW5uZWxJRCwgbXNnLkFtb3VudERlbm9tLCBtc2cuUHJpY2VEZW5vbSkKCV8sIGZvdW5kIDo9IGsuR2V0QnV5T3JkZXJCb29rKGN0eCwgcGFpckluZGV4KQoJaWYgIWZvdW5kIHsKCQlyZXR1cm4gJmFtcDt0eXBlcy5Nc2dTZW5kQnV5T3JkZXJSZXNwb25zZXt9LCBlcnJvcnMuTmV3KCZxdW90O3RoZSBwYWlyIGRvZXNuJ3QgZXhpc3QmcXVvdDspCgl9CgoJLy8gTG9jayB0aGUgdG9rZW4gdG8gc2VuZAoJc2VuZGVyLCBlcnIgOj0gc2RrLkFjY0FkZHJlc3NGcm9tQmVjaDMyKG1zZy5TZW5kZXIpCglpZiBlcnIgIT0gbmlsIHsKCQlyZXR1cm4gJmFtcDt0eXBlcy5Nc2dTZW5kQnV5T3JkZXJSZXNwb25zZXt9LCBlcnIKCX0KCQogICAgLy8gVXNlIFNhZmVCdXJuIHRvIGVuc3VyZSBubyBuZXcgbmF0aXZlIHRva2VucyBhcmUgbWludGVkCglpZiBlcnIgOj0gay5TYWZlQnVybigKCQljdHgsCgkJbXNnLlBvcnQsCgkJbXNnLkNoYW5uZWxJRCwKCQlzZW5kZXIsCgkJbXNnLlByaWNlRGVub20sCgkJbXNnLkFtb3VudCptc2cuUHJpY2UsCgkpOyBlcnIgIT0gbmlsIHsKCQlyZXR1cm4gJmFtcDt0eXBlcy5Nc2dTZW5kQnV5T3JkZXJSZXNwb25zZXt9LCBlcnIKCX0KCgkvLyBTYXZlIHRoZSB2b3VjaGVyIHJlY2VpdmVkIG9uIHRoZSBvdGhlciBjaGFpbiwgdG8gaGF2ZSB0aGUgYWJpbGl0eSB0byByZXNvbHZlIGl0IGludG8gdGhlIG9yaWdpbmFsIGRlbm9tCglrLlNhdmVWb3VjaGVyRGVub20oY3R4LCBtc2cuUG9ydCwgbXNnLkNoYW5uZWxJRCwgbXNnLlByaWNlRGVub20pCgoJLy8gQ29uc3RydWN0IHRoZSBwYWNrZXQKCXZhciBwYWNrZXQgdHlwZXMuQnV5T3JkZXJQYWNrZXREYXRhCgoJcGFja2V0LkJ1eWVyID0gbXNnLlNlbmRlciAvLyAmbHQ7LSBNYW51YWxseSBzcGVjaWZ5IHRoZSBidXllciBoZXJlCglwYWNrZXQuQW1vdW50RGVub20gPSBtc2cuQW1vdW50RGVub20KCXBhY2tldC5BbW91bnQgPSBtc2cuQW1vdW50CglwYWNrZXQuUHJpY2VEZW5vbSA9IG1zZy5QcmljZURlbm9tCglwYWNrZXQuUHJpY2UgPSBtc2cuUHJpY2UKCgkvLyBUcmFuc21pdCB0aGUgcGFja2V0CgllcnIgPSBrLlRyYW5zbWl0QnV5T3JkZXJQYWNrZXQoCgkJY3R4LAoJCXBhY2tldCwKCQltc2cuUG9ydCwKCQltc2cuQ2hhbm5lbElELAoJCWNsaWVudHR5cGVzLlplcm9IZWlnaHQoKSwKCQltc2cuVGltZW91dFRpbWVzdGFtcCwKCSkKCWlmIGVyciAhPSBuaWwgewoJCXJldHVybiBuaWwsIGVycgoJfQoKCXJldHVybiAmYW1wO3R5cGVzLk1zZ1NlbmRCdXlPcmRlclJlc3BvbnNle30sIG5pbAp9Cg=="}}),l._v(" "),C("h2",{attrs:{id:"create-the-onrecv-function"}},[C("a",{staticClass:"header-anchor",attrs:{href:"#create-the-onrecv-function"}},[l._v("#")]),l._v(" Create the OnRecv Function")]),l._v(" "),C("ul",[C("li",[l._v("Update sell order book")]),l._v(" "),C("li",[l._v("Distribute gains to sellers")]),l._v(" "),C("li",[l._v("Send the buy order to chain B after the fill attempt")])]),l._v(" "),C("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8geC9pYmNkZXgva2VlcGVyL2J1eV9vcmRlci5nbwpmdW5jIChrIEtlZXBlcikgT25SZWN2QnV5T3JkZXJQYWNrZXQoY3R4IHNkay5Db250ZXh0LCBwYWNrZXQgY2hhbm5lbHR5cGVzLlBhY2tldCwgZGF0YSB0eXBlcy5CdXlPcmRlclBhY2tldERhdGEpIChwYWNrZXRBY2sgdHlwZXMuQnV5T3JkZXJQYWNrZXRBY2ssIGVyciBlcnJvcikgewoJLy8gdmFsaWRhdGUgcGFja2V0IGRhdGEgdXBvbiByZWNlaXZpbmcKCWlmIGVyciA6PSBkYXRhLlZhbGlkYXRlQmFzaWMoKTsgZXJyICE9IG5pbCB7CgkJcmV0dXJuIHBhY2tldEFjaywgZXJyCgl9CgoJLy8gQ2hlY2sgaWYgdGhlIHNlbGwgb3JkZXIgYm9vayBleGlzdHMKCXBhaXJJbmRleCA6PSB0eXBlcy5PcmRlckJvb2tJbmRleChwYWNrZXQuU291cmNlUG9ydCwgcGFja2V0LlNvdXJjZUNoYW5uZWwsIGRhdGEuQW1vdW50RGVub20sIGRhdGEuUHJpY2VEZW5vbSkKCWJvb2ssIGZvdW5kIDo9IGsuR2V0U2VsbE9yZGVyQm9vayhjdHgsIHBhaXJJbmRleCkKCWlmICFmb3VuZCB7CgkJcmV0dXJuIHBhY2tldEFjaywgZXJyb3JzLk5ldygmcXVvdDt0aGUgcGFpciBkb2Vzbid0IGV4aXN0JnF1b3Q7KQoJfQoKCS8vIEZpbGwgYnV5IG9yZGVyCglyZW1haW5pbmcsIGxpcXVpZGF0ZWQsIHB1cmNoYXNlLCBfIDo9IGJvb2suRmlsbEJ1eU9yZGVyKHR5cGVzLk9yZGVyewoJCUFtb3VudDogZGF0YS5BbW91bnQsCgkJUHJpY2U6IGRhdGEuUHJpY2UsCgl9KQoKCS8vIFJldHVybiByZW1haW5pbmcgYW1vdW50IGFuZCBnYWlucwoJcGFja2V0QWNrLlJlbWFpbmluZ0Ftb3VudCA9IHJlbWFpbmluZy5BbW91bnQKCXBhY2tldEFjay5QdXJjaGFzZSA9IHB1cmNoYXNlCgoJLy8gQmVmb3JlIGRpc3RyaWJ1dGluZyBnYWlucywgd2UgcmVzb2x2ZSB0aGUgZGVub20KCS8vIEZpcnN0IHdlIGNoZWNrIGlmIHRoZSBkZW5vbSByZWNlaXZlZCBjb21lcyBmcm9tIHRoaXMgY2hhaW4gb3JpZ2luYWxseQoJZmluYWxQcmljZURlbm9tLCBzYXZlZCA6PSBrLk9yaWdpbmFsRGVub20oY3R4LCBwYWNrZXQuRGVzdGluYXRpb25Qb3J0LCBwYWNrZXQuRGVzdGluYXRpb25DaGFubmVsLCBkYXRhLlByaWNlRGVub20pCglpZiAhc2F2ZWQgewoJCS8vIElmIGl0IHdhcyBub3QgZnJvbSB0aGlzIGNoYWluIHdlIHVzZSB2b3VjaGVyIGFzIGRlbm9tCgkJZmluYWxQcmljZURlbm9tID0gVm91Y2hlckRlbm9tKHBhY2tldC5Tb3VyY2VQb3J0LCBwYWNrZXQuU291cmNlQ2hhbm5lbCwgZGF0YS5QcmljZURlbm9tKQoJfQoKCS8vIERpc3BhdGNoIGxpcXVpZGF0ZWQgYnV5IG9yZGVyCglmb3IgXywgbGlxdWlkYXRpb24gOj0gcmFuZ2UgbGlxdWlkYXRlZCB7CgkJbGlxdWlkYXRpb24gOj0gbGlxdWlkYXRpb24KCgkJYWRkciwgZXJyIDo9IHNkay5BY2NBZGRyZXNzRnJvbUJlY2gzMihsaXF1aWRhdGlvbi5DcmVhdG9yKQoJCWlmIGVyciAhPSBuaWwgewoJCQlyZXR1cm4gcGFja2V0QWNrLCBlcnIKCQl9CgoJCWlmIGVyciA6PSBrLlNhZmVNaW50KAoJCQljdHgsCgkJCXBhY2tldC5EZXN0aW5hdGlvblBvcnQsCgkJCXBhY2tldC5EZXN0aW5hdGlvbkNoYW5uZWwsCgkJCWFkZHIsCgkJCWZpbmFsUHJpY2VEZW5vbSwKCQkJbGlxdWlkYXRpb24uQW1vdW50KmxpcXVpZGF0aW9uLlByaWNlLAoJCSk7IGVyciAhPSBuaWwgewoJCQlyZXR1cm4gcGFja2V0QWNrLCBlcnIKCQl9Cgl9CgoJLy8gU2F2ZSB0aGUgbmV3IG9yZGVyIGJvb2sKCWsuU2V0U2VsbE9yZGVyQm9vayhjdHgsIGJvb2spCgoJcmV0dXJuIHBhY2tldEFjaywgbmlsCn0K"}}),l._v(" "),C("h2",{attrs:{id:"create-the-onacknowledgement-function"}},[C("a",{staticClass:"header-anchor",attrs:{href:"#create-the-onacknowledgement-function"}},[l._v("#")]),l._v(" Create the OnAcknowledgement Function")]),l._v(" "),C("ul",[C("li",[l._v("Chain "),C("code",[l._v("Mars")]),l._v(" will store the remaining buy order in the buy order book and will distribute sold "),C("code",[l._v("MCX")]),l._v(" to the sellers and will mint the voucher token to the buyer the price of the amount bought")]),l._v(" "),C("li",[l._v("On error we mint back the burned tokens")])]),l._v(" "),C("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8geC9pYmNkZXgva2VlcGVyL2J1eV9vcmRlci5nbwpmdW5jIChrIEtlZXBlcikgT25BY2tub3dsZWRnZW1lbnRCdXlPcmRlclBhY2tldChjdHggc2RrLkNvbnRleHQsIHBhY2tldCBjaGFubmVsdHlwZXMuUGFja2V0LCBkYXRhIHR5cGVzLkJ1eU9yZGVyUGFja2V0RGF0YSwgYWNrIGNoYW5uZWx0eXBlcy5BY2tub3dsZWRnZW1lbnQpIGVycm9yIHsKCXN3aXRjaCBkaXNwYXRjaGVkQWNrIDo9IGFjay5SZXNwb25zZS4odHlwZSkgewoJY2FzZSAqY2hhbm5lbHR5cGVzLkFja25vd2xlZGdlbWVudF9FcnJvcjoKCQkvLyBJbiBjYXNlIG9mIGVycm9yIHdlIG1pbnQgYmFjayB0aGUgbmF0aXZlIHRva2VuCgkJcmVjZWl2ZXIsIGVyciA6PSBzZGsuQWNjQWRkcmVzc0Zyb21CZWNoMzIoZGF0YS5CdXllcikKCQlpZiBlcnIgIT0gbmlsIHsKCQkJcmV0dXJuIGVycgoJCX0KCgkJaWYgZXJyIDo9IGsuU2FmZU1pbnQoCgkJCWN0eCwKCQkJcGFja2V0LlNvdXJjZVBvcnQsCgkJCXBhY2tldC5Tb3VyY2VDaGFubmVsLAoJCQlyZWNlaXZlciwKCQkJZGF0YS5QcmljZURlbm9tLAoJCQlkYXRhLkFtb3VudCpkYXRhLlByaWNlLAoJCSk7IGVyciAhPSBuaWwgewoJCQlyZXR1cm4gZXJyCgkJfQoKCQlyZXR1cm4gbmlsCgljYXNlICpjaGFubmVsdHlwZXMuQWNrbm93bGVkZ2VtZW50X1Jlc3VsdDoKCQkvLyBEZWNvZGUgdGhlIHBhY2tldCBhY2tub3dsZWRnbWVudAoJCXZhciBwYWNrZXRBY2sgdHlwZXMuQnV5T3JkZXJQYWNrZXRBY2sKICAgICAgICAKCQlpZiBlcnIgOj0gdHlwZXMuTW9kdWxlQ2RjLlVubWFyc2hhbEpTT04oZGlzcGF0Y2hlZEFjay5SZXN1bHQsICZhbXA7cGFja2V0QWNrKTsgZXJyICE9IG5pbCB7CgkJCS8vIFRoZSBjb3VudGVyLXBhcnR5IG1vZHVsZSBkb2Vzbid0IGltcGxlbWVudCB0aGUgY29ycmVjdCBhY2tub3dsZWRnbWVudCBmb3JtYXQKCQkJcmV0dXJuIGVycm9ycy5OZXcoJnF1b3Q7Y2Fubm90IHVubWFyc2hhbCBhY2tub3dsZWRnbWVudCZxdW90OykKCQl9CgoJCS8vIEdldCB0aGUgc2VsbCBvcmRlciBib29rCgkJcGFpckluZGV4IDo9IHR5cGVzLk9yZGVyQm9va0luZGV4KHBhY2tldC5Tb3VyY2VQb3J0LCBwYWNrZXQuU291cmNlQ2hhbm5lbCwgZGF0YS5BbW91bnREZW5vbSwgZGF0YS5QcmljZURlbm9tKQoJCWJvb2ssIGZvdW5kIDo9IGsuR2V0QnV5T3JkZXJCb29rKGN0eCwgcGFpckluZGV4KQoJCWlmICFmb3VuZCB7CgkJCXBhbmljKCZxdW90O2J1eSBvcmRlciBib29rIG11c3QgZXhpc3QmcXVvdDspCgkJfQoKCQkvLyBBcHBlbmQgdGhlIHJlbWFpbmluZyBhbW91bnQgb2YgdGhlIG9yZGVyCgkJaWYgcGFja2V0QWNrLlJlbWFpbmluZ0Ftb3VudCAmZ3Q7IDAgewoJCQlfLCBlcnIgOj0gYm9vay5BcHBlbmRPcmRlcigKCQkJCWRhdGEuQnV5ZXIsCgkJCQlwYWNrZXRBY2suUmVtYWluaW5nQW1vdW50LAoJCQkJZGF0YS5QcmljZSwKCQkJKQoJCQlpZiBlcnIgIT0gbmlsIHsKCQkJCXJldHVybiBlcnIKCQkJfQoKCQkJLy8gU2F2ZSB0aGUgbmV3IG9yZGVyIGJvb2sKCQkJay5TZXRCdXlPcmRlckJvb2soY3R4LCBib29rKQoJCX0KCgkJLy8gTWludCB0aGUgcHVyY2hhc2UKCQlpZiBwYWNrZXRBY2suUHVyY2hhc2UgJmd0OyAwIHsKCQkJcmVjZWl2ZXIsIGVyciA6PSBzZGsuQWNjQWRkcmVzc0Zyb21CZWNoMzIoZGF0YS5CdXllcikKCQkJaWYgZXJyICE9IG5pbCB7CgkJCQlyZXR1cm4gZXJyCgkJCX0KCgkJCWZpbmFsQW1vdW50RGVub20sIHNhdmVkIDo9IGsuT3JpZ2luYWxEZW5vbShjdHgsIHBhY2tldC5Tb3VyY2VQb3J0LCBwYWNrZXQuU291cmNlQ2hhbm5lbCwgZGF0YS5BbW91bnREZW5vbSkKCQkJaWYgIXNhdmVkIHsKCQkJCS8vIElmIGl0IHdhcyBub3QgZnJvbSB0aGlzIGNoYWluIHdlIHVzZSB2b3VjaGVyIGFzIGRlbm9tCgkJCQlmaW5hbEFtb3VudERlbm9tID0gVm91Y2hlckRlbm9tKHBhY2tldC5EZXN0aW5hdGlvblBvcnQsIHBhY2tldC5EZXN0aW5hdGlvbkNoYW5uZWwsIGRhdGEuQW1vdW50RGVub20pCgkJCX0KCQkJaWYgZXJyIDo9IGsuU2FmZU1pbnQoCgkJCQljdHgsCgkJCQlwYWNrZXQuU291cmNlUG9ydCwKCQkJCXBhY2tldC5Tb3VyY2VDaGFubmVsLAoJCQkJcmVjZWl2ZXIsCgkJCQlmaW5hbEFtb3VudERlbm9tLAoJCQkJcGFja2V0QWNrLlB1cmNoYXNlLAoJCQkpOyBlcnIgIT0gbmlsIHsKCQkJCXJldHVybiBlcnIKCQkJfQoJCX0KCgkJcmV0dXJuIG5pbAoJZGVmYXVsdDoKCQkvLyBUaGUgY291bnRlci1wYXJ0eSBtb2R1bGUgZG9lc24ndCBpbXBsZW1lbnQgdGhlIGNvcnJlY3QgYWNrbm93bGVkZ21lbnQgZm9ybWF0CgkJcmV0dXJuIGVycm9ycy5OZXcoJnF1b3Q7aW52YWxpZCBhY2tub3dsZWRnbWVudCBmb3JtYXQmcXVvdDspCgl9Cn0K"}}),l._v(" "),C("h2",{attrs:{id:"create-the-ontimeout-function"}},[C("a",{staticClass:"header-anchor",attrs:{href:"#create-the-ontimeout-function"}},[l._v("#")]),l._v(" Create the OnTimeout Function")]),l._v(" "),C("p",[l._v("In case the order has a timeout is is necessary to mint back the token for the user.")]),l._v(" "),C("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8geC9pYmNkZXgva2VlcGVyL2J1eV9vcmRlci5nbwpmdW5jIChrIEtlZXBlcikgT25UaW1lb3V0QnV5T3JkZXJQYWNrZXQoY3R4IHNkay5Db250ZXh0LCBwYWNrZXQgY2hhbm5lbHR5cGVzLlBhY2tldCwgZGF0YSB0eXBlcy5CdXlPcmRlclBhY2tldERhdGEpIGVycm9yIHsKCS8vIEluIGNhc2Ugb2YgZXJyb3Igd2UgbWludCBiYWNrIHRoZSBuYXRpdmUgdG9rZW4KCXJlY2VpdmVyLCBlcnIgOj0gc2RrLkFjY0FkZHJlc3NGcm9tQmVjaDMyKGRhdGEuQnV5ZXIpCglpZiBlcnIgIT0gbmlsIHsKCQlyZXR1cm4gZXJyCgl9CgoJaWYgZXJyIDo9IGsuU2FmZU1pbnQoCgkJY3R4LAoJCXBhY2tldC5Tb3VyY2VQb3J0LAoJCXBhY2tldC5Tb3VyY2VDaGFubmVsLAoJCXJlY2VpdmVyLAoJCWRhdGEuUHJpY2VEZW5vbSwKCQlkYXRhLkFtb3VudCpkYXRhLlByaWNlLAoJKTsgZXJyICE9IG5pbCB7CgkJcmV0dXJuIGVycgoJfQoKCXJldHVybiBuaWwKfQo="}})],1)}),[],!1,null,null,null);c.default=b.exports}}]);