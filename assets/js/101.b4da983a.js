(window.webpackJsonp=window.webpackJsonp||[]).push([[101],{728:function(e,t,a){"use strict";a.r(t);var o=a(0),c=Object(o.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"query-help-find-a-correct-move"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#query-help-find-a-correct-move"}},[e._v("#")]),e._v(" Query - Help Find a Correct Move")]),e._v(" "),a("HighlightBox",{attrs:{type:"synopsis"}},[a("p",[e._v("Make sure you have all you need before proceeding:")]),e._v(" "),a("ul",[a("li",[e._v("You understand the concepts of "),a("RouterLink",{attrs:{to:"/academy/2-main-concepts/queries.html"}},[e._v("queries")]),e._v(", and "),a("RouterLink",{attrs:{to:"/academy/2-main-concepts/protobuf.html"}},[e._v("Protobuf")]),e._v(".")],1),e._v(" "),a("li",[e._v("You have Go installed.")]),e._v(" "),a("li",[e._v("The checkers blockchain codebase up to gas metering. You can get there by following the "),a("RouterLink",{attrs:{to:"/academy/4-my-own-chain/gas-meter.html"}},[e._v("previous steps")]),e._v(" or checking out "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/tree/gas-meter",target:"_blank",rel:"noopener noreferrer"}},[e._v("the relevant version"),a("OutboundLink")],1),e._v(".")],1)])]),e._v(" "),a("p",[e._v("A player sends a "),a("code",[e._v("MsgPlayMove")]),e._v(" when "),a("RouterLink",{attrs:{to:"/academy/4-my-own-chain/play-game.html"}},[e._v("making a move")]),e._v(". This message can succeed or fail for several reasons. One error situation is when the message represents an invalid move.")],1),e._v(" "),a("p",[e._v("Players should be able to make sure that a move is valid before burning gas. To add this functionality, you need to create a way for the player to call the "),a("a",{attrs:{href:"https://github.com/batkinson/checkers-go/blob/a09daeb/checkers/checkers.go#L274",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("Move")]),a("OutboundLink")],1),e._v(" function without changing the game's state. Use a query because they are evaluated in memory and do not commit anything permanently to storage.")]),e._v(" "),a("h2",{attrs:{id:"new-information"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#new-information"}},[e._v("#")]),e._v(" New information")]),e._v(" "),a("p",[e._v("To run a query to check the validity of a move you need to pass:")]),e._v(" "),a("ul",[a("li",[e._v("The game ID, call the field "),a("code",[e._v("IdValue")]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("player")]),e._v(" as queries do not have a signer.")]),e._v(" "),a("li",[e._v("The board position to start from: "),a("code",[e._v("fromX")]),e._v(" and "),a("code",[e._v("fromY")]),e._v(".")]),e._v(" "),a("li",[e._v("The board position to land on: "),a("code",[e._v("toX")]),e._v(" and "),a("code",[e._v("toY")]),e._v(".")])]),e._v(" "),a("p",[e._v("The information to be returned is:")]),e._v(" "),a("ul",[a("li",[e._v("A boolean whether the move is valid, called "),a("code",[e._v("Possible")]),e._v(".")]),e._v(" "),a("li",[e._v("A text reason as to why the move is not valid, called "),a("code",[e._v("Reason")]),e._v(".")])]),e._v(" "),a("p",[e._v("As with other data structures, you can create the query message object with Ignite CLI:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBpZ25pdGUgc2NhZmZvbGQgcXVlcnkgY2FuUGxheU1vdmUgaWRWYWx1ZSBwbGF5ZXIgZnJvbVg6dWludCBmcm9tWTp1aW50IHRvWDp1aW50IHRvWTp1aW50IC0tbW9kdWxlIGNoZWNrZXJzIC0tcmVzcG9uc2UgcG9zc2libGU6Ym9vbCxyZWFzb24K"}}),e._v(" "),a("p",[e._v("Among other files, you should now have this:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"protobuf",base64:"bWVzc2FnZSBRdWVyeUNhblBsYXlNb3ZlUmVxdWVzdCB7CiAgICBzdHJpbmcgaWRWYWx1ZSA9IDE7CiAgICBzdHJpbmcgcGxheWVyID0gMjsKICAgIHVpbnQ2NCBmcm9tWCA9IDM7CiAgICB1aW50NjQgZnJvbVkgPSA0OwogICAgdWludDY0IHRvWCA9IDU7CiAgICB1aW50NjQgdG9ZID0gNjsKIH0KCiBtZXNzYWdlIFF1ZXJ5Q2FuUGxheU1vdmVSZXNwb25zZSB7CiAgICBib29sIHBvc3NpYmxlID0gMTsKICAgIHN0cmluZyByZWFzb24gPSAyOwp9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/b53297d8e87e31b1fc7fb839fce527e66a2a0116/proto/checkers/query.proto#L39-L51"}}),e._v(" "),a("p",[e._v("Ignite CLI has created the following boilerplate for you:")]),e._v(" "),a("ul",[a("li",[e._v("The "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/b53297d8e87e31b1fc7fb839fce527e66a2a0116/proto/checkers/query.proto#L17-L19",target:"_blank",rel:"noopener noreferrer"}},[e._v("Protobuf gRPC interface function"),a("OutboundLink")],1),e._v(" to submit your new "),a("code",[e._v("QueryCanPlayMoveRequest")]),e._v(" and its default implementation.")]),e._v(" "),a("li",[e._v("The "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/b53297d8e87e31b1fc7fb839fce527e66a2a0116/x/checkers/types/query.pb.gw.go#L319-L337",target:"_blank",rel:"noopener noreferrer"}},[e._v("routing of this new query"),a("OutboundLink")],1),e._v(" in the query facilities.")]),e._v(" "),a("li",[e._v("An "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/commit/f8a6e14d753554c9122a110800455d06dbe08192#diff-0fc3b6508740faee3d86a440c1dc83e71245dc49b3f8fc688b9668dc060abb8R12-R23",target:"_blank",rel:"noopener noreferrer"}},[e._v("empty function"),a("OutboundLink")],1),e._v(" ready to implement the action.")])]),e._v(" "),a("h2",{attrs:{id:"query-handling"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#query-handling"}},[e._v("#")]),e._v(" Query handling")]),e._v(" "),a("p",[e._v("Now you need to implement the answer to the player's query in "),a("code",[e._v("grpc_query_can_play_move.go")]),e._v(". Differentiate between two types of errors:")]),e._v(" "),a("ul",[a("li",[e._v("Errors relating to the move, returning a reason.")]),e._v(" "),a("li",[e._v("Errors if a move test is impossible, returning an error.")])]),e._v(" "),a("ol",[a("li",[a("p",[e._v("The game needs to be fetched. If it does not exist at all, you can return an error message because you did not test the move:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"c3RvcmVkR2FtZSwgZm91bmQgOj0gay5HZXRTdG9yZWRHYW1lKGN0eCwgcmVxLklkVmFsdWUpCmlmICFmb3VuZCB7CiAgICByZXR1cm4gbmlsLCBzZGtlcnJvcnMuV3JhcGYodHlwZXMuRXJyR2FtZU5vdEZvdW5kLCB0eXBlcy5FcnJHYW1lTm90Rm91bmQuRXJyb3IoKSwgcmVxLklkVmFsdWUpCn0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/b53297d8e87e31b1fc7fb839fce527e66a2a0116/x/checkers/keeper/grpc_query_can_play_move.go#L23-L26"}})],1),e._v(" "),a("li",[a("p",[e._v("Has the game already been won?")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"aWYgc3RvcmVkR2FtZS5XaW5uZXIgIT0gcnVsZXMuTk9fUExBWUVSLkNvbG9yIHsKICAgIHJldHVybiAmYW1wO3R5cGVzLlF1ZXJ5Q2FuUGxheU1vdmVSZXNwb25zZXsKICAgICAgICBQb3NzaWJsZTogZmFsc2UsCiAgICAgICAgUmVhc29uOiAgIHR5cGVzLkVyckdhbWVGaW5pc2hlZC5FcnJvcigpLAogICAgfSwgbmlsCn0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/b53297d8e87e31b1fc7fb839fce527e66a2a0116/x/checkers/keeper/grpc_query_can_play_move.go#L29-L34"}})],1),e._v(" "),a("li",[a("p",[e._v("Is the "),a("code",[e._v("player")]),e._v(" given a valid player?")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"dmFyIHBsYXllciBydWxlcy5QbGF5ZXIKaWYgc3RyaW5ncy5Db21wYXJlKHJ1bGVzLlJFRF9QTEFZRVIuQ29sb3IsIHJlcS5QbGF5ZXIpID09IDAgewogICAgcGxheWVyID0gcnVsZXMuUkVEX1BMQVlFUgp9IGVsc2UgaWYgc3RyaW5ncy5Db21wYXJlKHJ1bGVzLkJMQUNLX1BMQVlFUi5Db2xvciwgcmVxLlBsYXllcikgPT0gMCB7CiAgICBwbGF5ZXIgPSBydWxlcy5CTEFDS19QTEFZRVIKfSBlbHNlIHsKICAgIHJldHVybiAmYW1wO3R5cGVzLlF1ZXJ5Q2FuUGxheU1vdmVSZXNwb25zZXsKICAgICAgICBQb3NzaWJsZTogZmFsc2UsCiAgICAgICAgUmVhc29uOiAgIHR5cGVzLkVyckNyZWF0b3JOb3RQbGF5ZXIuRXJyb3IoKSwKICAgIH0sIG5pbAp9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/b53297d8e87e31b1fc7fb839fce527e66a2a0116/x/checkers/keeper/grpc_query_can_play_move.go#L37-L47"}})],1),e._v(" "),a("li",[a("p",[e._v("Is it the player's turn?")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Z2FtZSwgZXJyIDo9IHN0b3JlZEdhbWUuUGFyc2VHYW1lKCkKaWYgZXJyICE9IG5pbCB7CiAgICByZXR1cm4gbmlsLCBlcnIKfQppZiAhZ2FtZS5UdXJuSXMocGxheWVyKSB7CiAgICByZXR1cm4gJmFtcDt0eXBlcy5RdWVyeUNhblBsYXlNb3ZlUmVzcG9uc2V7CiAgICAgICAgUG9zc2libGU6IGZhbHNlLAogICAgICAgIFJlYXNvbjogICB0eXBlcy5FcnJOb3RQbGF5ZXJUdXJuLkVycm9yKCksCiAgICB9LCBuaWwKfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/b53297d8e87e31b1fc7fb839fce527e66a2a0116/x/checkers/keeper/grpc_query_can_play_move.go#L50-L59"}})],1),e._v(" "),a("li",[a("p",[e._v("Attempt the move and report back:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"XywgbW92ZUVyciA6PSBnYW1lLk1vdmUoCiAgICBydWxlcy5Qb3N7CiAgICAgICAgWDogaW50KHJlcS5Gcm9tWCksCiAgICAgICAgWTogaW50KHJlcS5Gcm9tWSksCiAgICB9LAogICAgcnVsZXMuUG9zewogICAgICAgIFg6IGludChyZXEuVG9YKSwKICAgICAgICBZOiBpbnQocmVxLlRvWSksCiAgICB9LAopCmlmIG1vdmVFcnIgIT0gbmlsIHsKICAgIHJldHVybiAmYW1wO3R5cGVzLlF1ZXJ5Q2FuUGxheU1vdmVSZXNwb25zZXsKICAgICAgICBQb3NzaWJsZTogZmFsc2UsCiAgICAgICAgUmVhc29uOiAgIGZtdC5TcHJpbnRmKHR5cGVzLkVycldyb25nTW92ZS5FcnJvcigpLCBtb3ZlRXJyLkVycm9yKCkpLAogICAgfSwgbmlsCn0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/b53297d8e87e31b1fc7fb839fce527e66a2a0116/x/checkers/keeper/grpc_query_can_play_move.go#L62-L77"}})],1),e._v(" "),a("li",[a("p",[e._v("If all went fine:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"cmV0dXJuICZhbXA7dHlwZXMuUXVlcnlDYW5QbGF5TW92ZVJlc3BvbnNlewogICAgUG9zc2libGU6IHRydWUsCiAgICBSZWFzb246ICAgJnF1b3Q7b2smcXVvdDssCn0sIG5pbAo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/b53297d8e87e31b1fc7fb839fce527e66a2a0116/x/checkers/keeper/grpc_query_can_play_move.go#L79-L82"}})],1)]),e._v(" "),a("h2",{attrs:{id:"next-up"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#next-up"}},[e._v("#")]),e._v(" Next up")]),e._v(" "),a("p",[e._v("Do you want to give players more flexibility on which tokens they can use for games? Let players wager any fungible token in the "),a("RouterLink",{attrs:{to:"/academy/4-my-own-chain/wager-denom.html"}},[e._v("next section")]),e._v(".")],1)],1)}),[],!1,null,null,null);t.default=c.exports}}]);