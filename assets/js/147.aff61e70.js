(window.webpackJsonp=window.webpackJsonp||[]).push([[147],{764:function(e,o,t){"use strict";t.r(o);var a=t(1),g=Object(a.a)({},(function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"add-a-leaderboard-module"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#add-a-leaderboard-module"}},[e._v("#")]),e._v(" Add a Leaderboard Module")]),e._v(" "),t("HighlightBox",{attrs:{type:"prerequisite"}},[t("p",[e._v("Make sure you have all you need before proceeding:")]),e._v(" "),t("ul",[t("li",[e._v("You understand the concepts of "),t("RouterLink",{attrs:{to:"/academy/2-cosmos-concepts/6-protobuf.html"}},[e._v("Protobuf")]),e._v(", "),t("RouterLink",{attrs:{to:"/academy/2-cosmos-concepts/5-modules.html"}},[e._v("modules")]),e._v(", and "),t("RouterLink",{attrs:{to:"/academy/2-cosmos-concepts/16-migrations.html"}},[e._v("migrations")]),e._v(".")],1),e._v(" "),t("li",[e._v("Go is installed.")]),e._v(" "),t("li",[e._v("You have the checkers blockchain codebase up to the "),t("em",[e._v("Tally Player Info After Production")]),e._v(". If not, follow the "),t("RouterLink",{attrs:{to:"/hands-on-exercise/4-run-in-prod/2-migration-info.html"}},[e._v("previous steps")]),e._v(" or check out the "),t("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/tree/player-info-migration",target:"_blank",rel:"noopener noreferrer"}},[e._v("relevant version"),t("OutboundLink")],1),e._v(".")],1)])]),e._v(" "),t("HighlightBox",{attrs:{type:"learning"}},[t("p",[e._v("In this section, you will:")]),e._v(" "),t("ul",[t("li",[e._v("Add a new module.")]),e._v(" "),t("li",[e._v("Add a leaderboard storage type.")]),e._v(" "),t("li",[e._v("Add hooks for loose coupling of modules.")]),e._v(" "),t("li",[e._v("Use the transient store.")])])]),e._v(" "),t("p",[e._v("In the previous section you added a player info structure that tallies wins and losses per player. On its own, this information could be collected outside of the blockchain via a "),t("RouterLink",{attrs:{to:"/hands-on-exercise/3-cosmjs-adv/5-server-side.html"}},[e._v("dedicated server")]),e._v(".")],1),e._v(" "),t("p",[e._v("It was in fact done on-chain so as to make this new step more relevant. If you want an on-chain leaderboard that is provably correct, then you need its information to come from the chain too. As a result of this choice, you have the necessary information on-chain in the form of "),t("code",[e._v("PlayerInfo")]),e._v(". You now need to organize it into a leaderboard.")]),e._v(" "),t("h2",{attrs:{id:"high-level-considerations"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#high-level-considerations"}},[e._v("#")]),e._v(" High level considerations")]),e._v(" "),t("p",[e._v("Your blockchain is now at "),t("em",[e._v("v1.1")]),e._v(". In this section, you will introduce "),t("em",[e._v("v2")]),e._v(" of your blockchain with leaderboard support. A good leaderboard fulfills these conditions:")]),e._v(" "),t("ul",[t("li",[e._v("Any player who has "),t("strong",[e._v("ever")]),e._v(" played should have a tally of games won, lost, and forfeited. You already have that.")]),e._v(" "),t("li",[e._v("The leaderboard should list the players with the most wins up to a pre-determined number of players. For example, the leaderboard might only include the top 100 scores.")]),e._v(" "),t("li",[e._v("To avoid squatting and increase engagement, when scores are equal in value the most recent score takes precedence over an "),t("em",[e._v("older")]),e._v(" one: the player with the "),t("strong",[e._v("more recent score")]),e._v(" is listed higher on the leaderboard.")])]),e._v(" "),t("HighlightBox",{attrs:{type:"tip"}},[t("p",[e._v("When you introduce the leaderboard in production, you also have to consider migration. This concern is covered in the "),t("RouterLink",{attrs:{to:"/hands-on-exercise/4-run-in-prod/4-migration-leaderboard.html"}},[e._v("next section")]),e._v(".")],1)]),e._v(" "),t("p",[e._v("The leaderboard is not strictly the concern of the game of checkers. It is a side concern. The concept of a leaderboard is also very generic, you could easily imagine it being used for other types of game. Therefore, it makes sense to introduce it as a "),t("strong",[e._v("separate module")]),e._v(" next to the checkers module.")]),e._v(" "),t("p",[e._v("The checkers and leaderboard modules will exchange information. More specifically, the leaderboard needs to know when a player's total wins change, as this may warrant entering the leaderboard. If you have the checkers module call the leaderboard module (just as it calls the bank when handling wagers), the checkers module needs to know the details of the leaderboard module. It is best to avoid such tight coupling.")]),e._v(" "),t("p",[e._v("Fortunately, you can reuse a "),t("strong",[t("em",[e._v("hooks")]),e._v(" pattern")]),e._v(" already used in the Cosmos SDK. With this future addition, the leaderboard module adds a listener to the hook interface of the checkers module. With this the checkers module informs any listeners, whether there are none, one, or many.")]),e._v(" "),t("p",[e._v("The leaderboard module will work by listening to results from the checkers module. It will not have messages of it own.")]),e._v(" "),t("p",[e._v("Thinking about early performance optimization, you have to decide what operations the module does when it receives one candidate from the checkers module. The first idea is to:")]),e._v(" "),t("ol",[t("li",[e._v("Read the leaderboard from storage, which includes all 100 members.")]),e._v(" "),t("li",[e._v("Conditionally add the candidate to the leaderboard.")]),e._v(" "),t("li",[e._v("If added, sort and clip the list.")]),e._v(" "),t("li",[e._v("Put the leaderboard back in storage.")])]),e._v(" "),t("p",[e._v("These are a lot of expensive operations for a single candidate.")]),e._v(" "),t("p",[e._v("Fortunately, there is a better way. The leaderboard needs to be computed and saved when the block is prepared, but it does not need to be up to date after each (checkers) transaction. You can imagine keeping the leaderboard (or something approximating it) in memory for the whole length of the block.")]),e._v(" "),t("p",[e._v("In the section about "),t("RouterLink",{attrs:{to:"/hands-on-exercise/2-ignite-cli-adv/4-game-forfeit.html"}},[e._v("expiring games")]),e._v(", you learned about "),t("code",[e._v("EndBlock")]),e._v(". There is also a "),t("code",[e._v("BeginBlock")]),e._v(" callback. It is conceivable to prepare the leaderboard in "),t("code",[e._v("BeginBlock")]),e._v(" and "),t("strong",[e._v("keep it in the context or a memory or transient storage")]),e._v(". Then it would be recalled with each candidate, and finally (in "),t("code",[e._v("EndBlock")]),e._v(", and only there) it would be sorted and clipped before being saved in storage proper.")],1),e._v(" "),t("p",[e._v("Better still, though, you do not need to "),t("em",[e._v("prepare")]),e._v(" the leaderboard in "),t("code",[e._v("BeginBlock")]),e._v(". You can just keep candidates in the transient storage as they come. Then only in "),t("code",[e._v("EndBlock")]),e._v(" is the leaderboard loaded, updated, and saved.")]),e._v(" "),t("h2",{attrs:{id:"what-you-will-do"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#what-you-will-do"}},[e._v("#")]),e._v(" What you will do")]),e._v(" "),t("p",[e._v("Several things need to be addressed to build your v2 blockchain:")]),e._v(" "),t("ol",[t("li",[e._v("Add the leaderboard module.")]),e._v(" "),t("li",[e._v("Define your new data types.")]),e._v(" "),t("li",[e._v("Add helper functions to encapsulate clearly defined actions, like leaderboard sorting.")]),e._v(" "),t("li",[e._v("Prepare keys to store candidates in a transient store.")]),e._v(" "),t("li",[e._v("Adjust the existing code to make use of and update the new data types.")]),e._v(" "),t("li",[e._v("Add the hooks pattern elements.")]),e._v(" "),t("li",[e._v("Handle the leaderboard properly.")]),e._v(" "),t("li",[e._v("Configure the app for it.")])]),e._v(" "),t("h2",{attrs:{id:"new-v2-module"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#new-v2-module"}},[e._v("#")]),e._v(" New v2 module")]),e._v(" "),t("p",[e._v("As discussed, you will introduce a new leaderboard module. This is conveniently done with Ignite CLI.")]),e._v(" "),t("p",[e._v("Ignite also offers the possibilty to add new "),t("code",[e._v("Params")]),e._v(" to the module. These are module-wide parameters:")]),e._v(" "),t("ol",[t("li",[e._v("Whose original value is defined in the genesis")]),e._v(" "),t("li",[e._v("That can be modified via governance proposal")])]),e._v(" "),t("p",[e._v("It could be interesting to have the length of the leaderboard be defined like that.")]),e._v(" "),t("CodeGroup",[t("CodeGroupItem",{attrs:{title:"Local"}},[t("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBpZ25pdGUgc2NhZmZvbGQgbW9kdWxlIGxlYWRlcmJvYXJkIFwKICAgIC0tcGFyYW1zIGxlbmd0aDp1aW50Cg=="}})],1),e._v(" "),t("CodeGroupItem",{attrs:{title:"Docker"}},[t("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IFwKICAgIC12ICQocHdkKTovY2hlY2tlcnMgXAogICAgLXcgL2NoZWNrZXJzIFwKICAgIGNoZWNrZXJzX2kgXAogICAgaWduaXRlIHNjYWZmb2xkIG1vZHVsZSBsZWFkZXJib2FyZCBcCiAgICAtLXBhcmFtcyBsZW5ndGg6dWludAo="}})],1)],1),e._v(" "),t("p",[e._v("With that, Ignite has created a new "),t("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-module/x/leaderboard",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("x/leaderboard")]),t("OutboundLink")],1),e._v(" folder next to "),t("code",[e._v("x/checkers")]),e._v(". It has also put a "),t("code",[e._v("length")]),e._v(" field inside "),t("code",[e._v("Params")]),e._v(":")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"protobuf",base64:"bWVzc2FnZSBQYXJhbXMgewogICAgLi4uCiAgICB1aW50NjQgbGVuZ3RoID0gMSBbKGdvZ29wcm90by5tb3JldGFncykgPSAmcXVvdDt5YW1sOlwmcXVvdDtsZW5ndGhcJnF1b3Q7JnF1b3Q7XTsKfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-module/proto/leaderboard/params.proto#L12"}}),e._v(" "),t("p",[e._v("The genesis defines a "),t("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-module/x/leaderboard/types/genesis.go#L14",target:"_blank",rel:"noopener noreferrer"}},[e._v("starting value"),t("OutboundLink")],1),e._v(" of "),t("code",[e._v("0")]),e._v(" for this length. You ought to change it now to something adequate:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIHZhciAoCiAgICAgICAgS2V5TGVuZ3RoID0gW11ieXRlKCZxdW90O0xlbmd0aCZxdW90OykKLSAgICAgIC8vIFRPRE86IERldGVybWluZSB0aGUgZGVmYXVsdCB2YWx1ZQotICAgICAgRGVmYXVsdExlbmd0aCB1aW50NjQgPSAwCisgICkKKworICBjb25zdCAoCisgICAgICBEZWZhdWx0TGVuZ3RoIHVpbnQ2NCA9IDEwMAopCg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-objects/x/leaderboard/types/params.go#L14"}}),e._v(" "),t("p",[e._v("You also make it "),t("code",[e._v("const")]),e._v(" as this is the case and becomes helpful later on.")]),e._v(" "),t("h2",{attrs:{id:"new-v2-information"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#new-v2-information"}},[e._v("#")]),e._v(" New v2 information")]),e._v(" "),t("p",[e._v("It is time to take a closer look at the new data structures being introduced with the new module.")]),e._v(" "),t("HighlightBox",{attrs:{type:"tip"}},[t("p",[e._v("If you feel unsure about creating new data structures with Ignite CLI, look at the "),t("RouterLink",{attrs:{to:"/hands-on-exercise/1-ignite-cli/4-create-message.html"}},[e._v("previous sections")]),e._v(" of the exercise again.")],1)]),e._v(" "),t("p",[e._v("To give the new v2 information a data structure, you need the following:")]),e._v(" "),t("ol",[t("li",[t("p",[e._v("Add a structure for "),t("strong",[e._v("the leaderboard")]),e._v(": you want a single stored leaderboard for the whole module. Let Ignite CLI help you implement a structure:")]),e._v(" "),t("CodeGroup",[t("CodeGroupItem",{attrs:{title:"Local",active:""}},[t("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBpZ25pdGUgc2NhZmZvbGQgc2luZ2xlIGxlYWRlcmJvYXJkIHdpbm5lcnMgXAogICAgLS1tb2R1bGUgbGVhZGVyYm9hcmQgLS1uby1tZXNzYWdlCg=="}})],1),e._v(" "),t("CodeGroupItem",{attrs:{title:"Docker"}},[t("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IFwKICAgIC12ICQocHdkKTovY2hlY2tlcnMgXAogICAgLXcgL2NoZWNrZXJzIFwKICAgIGNoZWNrZXJzX2kgXAogICAgaWduaXRlIHNjYWZmb2xkIHNpbmdsZSBsZWFkZXJib2FyZCB3aW5uZXJzIFwKICAgIC0tbW9kdWxlIGxlYWRlcmJvYXJkIC0tbm8tbWVzc2FnZQo="}})],1)],1)],1),e._v(" "),t("li",[t("p",[e._v("This creates a Protobuf file with "),t("code",[e._v("string winners")]),e._v(". This is not very useful. So you declare by hand another Protobuf message in "),t("code",[e._v("leaderboard.proto")]),e._v(" for use as a leaderboard rung:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-protobuf",base64:"ICAgIG1lc3NhZ2UgTGVhZGVyYm9hcmQgewogICAgICAgIHN0cmluZyB3aW5uZXJzID0gMTsKICAgIH0KCisgIG1lc3NhZ2UgV2lubmVyIHsKKyAgICAgIHN0cmluZyBhZGRyZXNzID0gMTsKKyAgICAgIHVpbnQ2NCB3b25Db3VudCA9IDI7CisgICAgICB1aW50NjQgYWRkZWRBdCA9IDM7CisgIH0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-object/proto/leaderboard/leaderboard.proto#L11-L15"}}),e._v(" "),t("HighlightBox",{attrs:{type:"note"}},[t("p",[e._v("Take note of the key features:")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("address")]),e._v(" indicates the player. This will be the same address as the one that comes in "),t("code",[e._v("PlayerInfo.index")]),e._v(".")]),e._v(" "),t("li",[t("code",[e._v("wonCount")]),e._v(" determines the ranking on the leaderboard - the higher the count, the closer to the "),t("code",[e._v("0")]),e._v(" index in the array. This should exactly match the value found in the corresponding player stats. This duplication of data is a lesser evil, because if "),t("code",[e._v("wonCount")]),e._v(" was missing you would have to access the player stats to sort the leaderboard.")]),e._v(" "),t("li",[t("code",[e._v("addedAt")]),e._v(" is a timestamp that indicates when the player's "),t("code",[e._v("wonCount")]),e._v(" was last updated and determines the ranking when there is a tie in "),t("code",[e._v("wonCount")]),e._v(" - the more recent, the closer to the "),t("code",[e._v("0")]),e._v(" index in the array.")])])])],1),e._v(" "),t("li",[t("p",[e._v("You make the "),t("code",[e._v("Leaderboard")]),e._v(" message use "),t("code",[e._v("message Winner")]),e._v(" as an array. Add that each element in the map is not nullable. This will compile each "),t("code",[e._v("WinningPlayer")]),e._v(" to a Go object instead of a pointer:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-protobuf",base64:"KyAgaW1wb3J0ICZxdW90O2dvZ29wcm90by9nb2dvLnByb3RvJnF1b3Q7OwoKICAgIG1lc3NhZ2UgTGVhZGVyYm9hcmQgewotICAgICAgc3RyaW5nIHdpbm5lcnMgPSAxOworICAgICAgcmVwZWF0ZWQgV2lubmluZ1BsYXllciB3aW5uZXJzID0gMSBbKGdvZ29wcm90by5udWxsYWJsZSkgPSBmYWxzZV07CiAgICB9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-objects/proto/leaderboard/leaderboard.proto#L5-L8"}})],1),e._v(" "),t("li",[t("p",[e._v("The v2 genesis was also updated with the leaderboard. Tell it that the leaderboard should always be there (even if empty):")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-protobuf",base64:"ICAgIG1lc3NhZ2UgR2VuZXNpc1N0YXRlIHsKICAgICAgICAuLi4KLSAgICAgIExlYWRlcmJvYXJkIGxlYWRlcmJvYXJkID0gMjsKKyAgICAgIExlYWRlcmJvYXJkIGxlYWRlcmJvYXJkID0gMiBbKGdvZ29wcm90by5udWxsYWJsZSkgPSBmYWxzZV07CiAgICB9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-objects/proto/leaderboard/genesis.proto#L14"}}),e._v(" "),t("p",[e._v("At this point, you should run "),t("code",[e._v("ignite generate proto-go")]),e._v(" so that the corresponding Go objects are re-created.")])],1),e._v(" "),t("li",[t("p",[e._v("Remember to make sure the initial value stored for the leaderboard is not "),t("code",[e._v("nil")]),e._v(" but instead is an empty list. In "),t("code",[e._v("genesis.go")]),e._v(" adjust:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIGZ1bmMgRGVmYXVsdEdlbmVzaXMoKSAqR2VuZXNpc1N0YXRlIHsKICAgICAgICByZXR1cm4gJmFtcDtHZW5lc2lzU3RhdGV7Ci0gICAgICAgICAgTGVhZGVyYm9hcmQ6IG5pbCwKKyAgICAgICAgICBMZWFkZXJib2FyZDogTGVhZGVyYm9hcmR7CisgICAgICAgICAgICAgIFdpbm5lcnM6IFtdV2lubmVye30sCisgICAgICAgICAgfSwKICAgICAgICAgICAgLi4uCiAgICAgICAgfQogICAgfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-objects/x/leaderboard/types/genesis.go#L13-L15"}}),e._v(" "),t("p",[e._v('This function returns a default genesis. This step is important if you start fresh. In your case, you do not begin with an "empty" genesis but with one resulting from the upcoming genesis migration in this exercise.')]),e._v(" "),t("p",[e._v("In particular, add a test on the initial genesis:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBUZXN0RGVmYXVsdEdlbmVzaXNTdGF0ZV9FeHBlY3RlZEluaXRpYWwodCAqdGVzdGluZy5UKSB7CiAgICByZXF1aXJlLkVxdWFsVmFsdWVzKHQsCiAgICAgICAgJmFtcDt0eXBlcy5HZW5lc2lzU3RhdGV7CiAgICAgICAgICAgIExlYWRlcmJvYXJkOiB0eXBlcy5MZWFkZXJib2FyZHsKICAgICAgICAgICAgICAgIFdpbm5lcnM6ICBbXXR5cGVzLldpbm5lcnt9LAogICAgICAgICAgICB9LAogICAgICAgICAgICBQYXJhbXM6IHR5cGVzLlBhcmFtc3sKICAgICAgICAgICAgICAgIExlbmd0aDogMTAwLAogICAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgdHlwZXMuRGVmYXVsdEdlbmVzaXMoKSkKfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-objects/x/leaderboard/types/genesis_test.go#L61-L72"}}),e._v(" "),t("p",[e._v("Fix the compilation error in the same file:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"LSAgTGVhZGVyYm9hcmQ6ICZhbXA7dHlwZXMuTGVhZGVyYm9hcmR7Ci0gICAgICBXaW5uZXJzOiAmcXVvdDs0OSZxdW90OywKKyAgTGVhZGVyYm9hcmQ6IHR5cGVzLkxlYWRlcmJvYXJkeworICAgICAgV2lubmVyczogW110eXBlcy5XaW5uZXJ7fSwKICAgIH0sCg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-objects/x/leaderboard/types/genesis_test.go#L25-L27"}}),e._v(" "),t("p",[e._v("And add a test case that catches a duplicated winner address:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ewogICAgZGVzYzogJnF1b3Q7ZHVwbGljYXRlZCB3aW5uZXJQbGF5ZXImcXVvdDssCiAgICBnZW5TdGF0ZTogJmFtcDt0eXBlcy5HZW5lc2lzU3RhdGV7CiAgICAgICAgTGVhZGVyYm9hcmQ6IHR5cGVzLkxlYWRlcmJvYXJkewogICAgICAgICAgICBXaW5uZXJzOiBbXXR5cGVzLldpbm5lcnsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBBZGRyZXNzOiAmcXVvdDtjb3Ntb3MxMjMmcXVvdDssCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIEFkZHJlc3M6ICZxdW90O2Nvc21vczEyMyZxdW90OywKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgIH0sCiAgICB2YWxpZDogZmFsc2UsCn0sCg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-objects/x/leaderboard/types/genesis_test.go#L32-L47"}})],1),e._v(" "),t("li",[t("p",[e._v("Also adjust other compilation errors:")]),e._v(" "),t("p",[e._v("On "),t("code",[e._v("genesis.go")]),e._v(":")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"LSAgLy8gU2V0IGlmIGRlZmluZWQKLSAgaWYgZ2VuU3RhdGUuTGVhZGVyYm9hcmQgIT0gbmlsIHsKLSAgICAgIGsuU2V0TGVhZGVyYm9hcmQoY3R4LCAqZ2VuU3RhdGUuTGVhZGVyYm9hcmQpCi0gIH0KKyAgay5TZXRMZWFkZXJib2FyZChjdHgsIGdlblN0YXRlLkxlYWRlcmJvYXJkKQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-objects/x/leaderboard/genesis.go#L12"}}),e._v(" "),t("p",[e._v("And:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIGlmIGZvdW5kIHsKLSAgICAgIGdlbmVzaXMuTGVhZGVyYm9hcmQgPSAmYW1wO2xlYWRlcmJvYXJkCisgICAgICBnZW5lc2lzLkxlYWRlcmJvYXJkID0gbGVhZGVyYm9hcmQKICAgIH0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-objects/x/leaderboard/genesis.go#L25"}}),e._v(" "),t("p",[e._v("On "),t("code",[e._v("genesis_test.go")]),e._v(":")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIC4uLgotICBMZWFkZXJib2FyZDogJmFtcDt0eXBlcy5MZWFkZXJib2FyZHsKLSAgICAgIFdpbm5lcnM6ICZxdW90Ozk0JnF1b3Q7LAorICBMZWFkZXJib2FyZDogdHlwZXMuTGVhZGVyYm9hcmR7CisgICAgICBXaW5uZXJzOiBbXXR5cGVzLldpbm5lcnsKKyAgICAgICAgICB7CisgICAgICAgICAgICAgIEFkZHJlc3M6ICZxdW90O2Nvc21vczEyMyZxdW90OywKKyAgICAgICAgICB9LAorICAgICAgICAgIHsKKyAgICAgICAgICAgICAgQWRkcmVzczogJnF1b3Q7Y29zbW9zNDU2JnF1b3Q7LAorICAgICAgICAgIH0sCisgICAgICB9LAogICAgfSwKICAgIC4uLgo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-objects/x/leaderboard/genesis_test.go#L36-L45"}}),e._v(" "),t("p",[e._v("On "),t("code",[e._v("client/cli/query_leaderboard_test.go")]),e._v(":")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"LSAgbGVhZGVyYm9hcmQgOj0gJmFtcDt0eXBlcy5MZWFkZXJib2FyZHt9CisgIGxlYWRlcmJvYXJkIDo9IHR5cGVzLkxlYWRlcmJvYXJke30KICAgIG51bGxpZnkuRmlsbCgmYW1wO2xlYWRlcmJvYXJkKQogICAgc3RhdGUuTGVhZGVyYm9hcmQgPSBsZWFkZXJib2FyZAogICAgYnVmLCBlcnIgOj0gY2ZnLkNvZGVjLk1hcnNoYWxKU09OKCZhbXA7c3RhdGUpCiAgICByZXF1aXJlLk5vRXJyb3IodCwgZXJyKQogICAgY2ZnLkdlbmVzaXNTdGF0ZVt0eXBlcy5Nb2R1bGVOYW1lXSA9IGJ1ZgotICByZXR1cm4gbmV0d29yay5OZXcodCwgY2ZnKSwgKnN0YXRlLkxlYWRlcmJvYXJkCisgIHJldHVybiBuZXR3b3JrLk5ldyh0LCBjZmcpLCBzdGF0ZS5MZWFkZXJib2FyZAo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-objects/x/leaderboard/client/cli/query_leaderboard_test.go#L24-L30"}})],1),e._v(" "),t("li",[t("p",[e._v("Now that the leaderboard will always be in the store, you may as well change the "),t("code",[e._v("GetLeaderboard")]),e._v(" function so that it panics instead of returning an error when it cannot find it:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"LSAgZnVuYyAoayBLZWVwZXIpIEdldExlYWRlcmJvYXJkKGN0eCBzZGsuQ29udGV4dCkgKHZhbCB0eXBlcy5MZWFkZXJib2FyZCwgZm91bmQgYm9vbCkgeworICBmdW5jIChrIEtlZXBlcikgR2V0TGVhZGVyYm9hcmQoY3R4IHNkay5Db250ZXh0KSAodmFsIHR5cGVzLkxlYWRlcmJvYXJkKSB7CiAgICAgICAgLi4uCiAgICAgICAgaWYgYiA9PSBuaWwgewotICAgICAgICAgIHJldHVybiB2YWwsIGZhbHNlCisgICAgICAgICAgcGFuaWMoJnF1b3Q7TGVhZGVyYm9hcmQgbm90IGZvdW5kJnF1b3Q7KQogICAgICAgIH0KCiAgICAgICAgay5jZGMuTXVzdFVubWFyc2hhbChiLCAmYW1wO3ZhbCkKLSAgICAgIHJldHVybiB2YWwsIHRydWUKKyAgICAgIHJldHVybiB2YWwKICAgIH0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-objects/x/leaderboard/keeper/leaderboard.go#L17-L27"}}),e._v(" "),t("p",[e._v("This requires further easy fixing of new compilation errors. A more complex fix is the one that checks what happens when the leaderboard is removed:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIGZ1bmMgVGVzdExlYWRlcmJvYXJkUmVtb3ZlKHQgKnRlc3RpbmcuVCkgewogICAgICAgIGtlZXBlciwgY3R4IDo9IGtlZXBlcnRlc3QuTGVhZGVyYm9hcmRLZWVwZXIodCkKICAgICAgICBjcmVhdGVUZXN0TGVhZGVyYm9hcmQoa2VlcGVyLCBjdHgpCiAgICAgICAga2VlcGVyLlJlbW92ZUxlYWRlcmJvYXJkKGN0eCkKLSAgICAgIF8sIGZvdW5kIDo9IGtlZXBlci5HZXRMZWFkZXJib2FyZChjdHgpCi0gICAgICByZXF1aXJlLkZhbHNlKHQsIGZvdW5kKQorICAgICAgZGVmZXIgZnVuYygpIHsKKyAgICAgICAgICByIDo9IHJlY292ZXIoKQorICAgICAgICAgIHJlcXVpcmUuTm90TmlsKHQsIHIsICZxdW90O1RoZSBjb2RlIGRpZCBub3QgcGFuaWMmcXVvdDspCisgICAgICAgICAgcmVxdWlyZS5FcXVhbCh0LCByLCAmcXVvdDtMZWFkZXJib2FyZCBub3QgZm91bmQmcXVvdDspCisgICAgICB9KCkKKyAgICAgIGtlZXBlci5HZXRMZWFkZXJib2FyZChjdHgpCiAgICB9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-objects/x/leaderboard/keeper/leaderboard_test.go#L31-L41"}})],1),e._v(" "),t("li",[t("p",[e._v("The test case you added will fail unless you update the "),t("code",[e._v("Validate()")]),e._v(" method of the genesis to not allow duplicate player addresses. This is inspired by "),t("code",[e._v("types/genesis.go")]),e._v(", and is best kept in a separate and new "),t("code",[e._v("types/leaderboard.go")]),e._v(":")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAobGVhZGVyYm9hcmQgTGVhZGVyYm9hcmQpIFZhbGlkYXRlKCkgZXJyb3IgewogICAgLy8gQ2hlY2sgZm9yIGR1cGxpY2F0ZWQgcGxheWVyIGFkZHJlc3MgaW4gd2lubmVycwogICAgd2lubmVySW5mb0luZGV4TWFwIDo9IG1ha2UobWFwW3N0cmluZ11zdHJ1Y3R7fSkKCiAgICBmb3IgaW5kZXgsIGVsZW0gOj0gcmFuZ2UgbGVhZGVyYm9hcmQuV2lubmVycyB7CiAgICAgICAgaWYgXywgb2sgOj0gd2lubmVySW5mb0luZGV4TWFwW2VsZW0uQWRkcmVzc107IG9rIHsKICAgICAgICAgICAgcmV0dXJuIGZtdC5FcnJvcmYoJnF1b3Q7ZHVwbGljYXRlZCBhZGRyZXNzICVzIGF0IGluZGV4ICVkJnF1b3Q7LCBlbGVtLkFkZHJlc3MsIGluZGV4KQogICAgICAgIH0KICAgICAgICB3aW5uZXJJbmZvSW5kZXhNYXBbZWxlbS5BZGRyZXNzXSA9IHN0cnVjdHt9e30KICAgIH0KICAgIHJldHVybiBuaWwKfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-objects/x/leaderboard/types/leaderboard.go#"}}),e._v(" "),t("p",[e._v("After this, you can adjust the "),t("code",[e._v("types/genesis.go")]),e._v(" file:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIGZ1bmMgKGdzIEdlbmVzaXNTdGF0ZSkgVmFsaWRhdGUoKSBlcnJvciB7CisgICAgICAvLyBWYWxpZGF0ZSBMZWFkZXJib2FyZAorICAgICAgaWYgZXJyIDo9IGdzLkxlYWRlcmJvYXJkLlZhbGlkYXRlKCk7IGVyciAhPSBuaWwgeworICAgICAgICAgIHJldHVybiBlcnIKKyAgICAgIH0KICAgICAgICAvLyB0aGlzIGxpbmUgaXMgdXNlZCBieSBzdGFycG9ydCBzY2FmZm9sZGluZyAjIGdlbmVzaXMvdHlwZXMvdmFsaWRhdGUKICAgICAgICAuLi4KICAgIH0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-objects/x/checkers/types/genesis.go#L24-L27"}})],1)]),e._v(" "),t("p",[e._v("You can confirm that the existing unit tests pass.")]),e._v(" "),t("h2",{attrs:{id:"transient-object"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#transient-object"}},[e._v("#")]),e._v(" Transient object")]),e._v(" "),t("p",[e._v("You will use objects when storing candidates in a transient KVStore between "),t("code",[e._v("BeginBlock")]),e._v(" and "),t("code",[e._v("EndBlock")]),e._v(". You want them to be small.")]),e._v(" "),t("p",[e._v("In "),t("code",[e._v("leaderboard.proto")]),e._v(", add:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-protobuf",base64:"ICAgIG1lc3NhZ2UgV2lubmVyIHsKICAgICAgICAuLi4KICAgIH0KCisgIG1lc3NhZ2UgQ2FuZGlkYXRlIHsKKyAgICAgIGJ5dGVzIGFkZHJlc3MgPSAxOworICAgICAgdWludDY0IHdvbkNvdW50ID0gMjsKKyAgfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-object/proto/leaderboard/leaderboard.proto#L17-L20"}}),e._v(" "),t("p",[e._v("Where "),t("code",[e._v("bytes address")]),e._v(" is the player's undecoded address.")]),e._v(" "),t("p",[e._v("Remember that "),t("code",[e._v("sdk.AccAddress")]),e._v("'s underlying type is "),t("code",[e._v("byte[]")]),e._v(".")]),e._v(" "),t("p",[e._v("After another round of Go compilation, you can add a helper function to get a "),t("code",[e._v("Candidate")]),e._v("'s address as a Bech32 string:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAoY2FuZGlkYXRlIENhbmRpZGF0ZSkgR2V0QWNjQWRkcmVzcygpIHN0cmluZyB7CiAgICByZXR1cm4gc2RrLkFjY0FkZHJlc3MoY2FuZGlkYXRlLkFkZHJlc3MpLlN0cmluZygpCn0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-objects/x/leaderboard/types/leaderboard.go"}}),e._v(" "),t("p",[e._v("Where "),t("code",[e._v("sdk.AccAddress(candidate.Address)")]),e._v(" is casting the "),t("code",[e._v("byte[]")]),e._v(" into "),t("code",[e._v("sdk.AccAddress")]),e._v(".")]),e._v(" "),t("p",[e._v("Also add a function to convert it into a leaderboard rung at a given time:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAoY2FuZGlkYXRlIENhbmRpZGF0ZSkgR2V0V2lubmVyQXRUaW1lKG5vdyB0aW1lLlRpbWUpIFdpbm5lciB7CiAgICByZXR1cm4gV2lubmVyewogICAgICAgIEFkZHJlc3M6ICBjYW5kaWRhdGUuR2V0QWNjQWRkcmVzcygpLAogICAgICAgIFdvbkNvdW50OiBjYW5kaWRhdGUuV29uQ291bnQsCiAgICAgICAgQWRkZWRBdDogIHVpbnQ2NChub3cuVW5peCgpKSwKICAgIH0KfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-objects/x/leaderboard/types/leaderboard.go"}}),e._v(" "),t("p",[e._v("With the structure set up, it is time to add the code using these new elements in normal (non-migration) operations.")]),e._v(" "),t("h2",{attrs:{id:"leaderboard-helpers"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#leaderboard-helpers"}},[e._v("#")]),e._v(" Leaderboard helpers")]),e._v(" "),t("p",[e._v("Continue working on your v2 before tackling the migration. In both the migration and regular operations, the leaderboard helpers have to:")]),e._v(" "),t("ol",[t("li",[e._v("Add a number of new candidates to your array of winners.")]),e._v(" "),t("li",[e._v("Sort the array according to the rules.")]),e._v(" "),t("li",[e._v("Clip the array to the chosen length and save the result.")])]),e._v(" "),t("p",[e._v("You can reuse your "),t("code",[e._v("types/leaderboard.go")]),e._v(" to encapsulate all your leaderboard helpers:")]),e._v(" "),t("ol",[t("li",[t("p",[e._v("Add functions to sort a slice of winners in place:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBTb3J0V2lubmVycyh3aW5uZXJzIFtdV2lubmVyKSB7CiAgICBzb3J0LlNsaWNlU3RhYmxlKHdpbm5lcnNbOl0sIGZ1bmMoaSwgaiBpbnQpIGJvb2wgewogICAgICAgIGlmIHdpbm5lcnNbaV0uV29uQ291bnQgJmd0OyB3aW5uZXJzW2pdLldvbkNvdW50IHsKICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICB9CiAgICAgICAgaWYgd2lubmVyc1tpXS5Xb25Db3VudCAmbHQ7IHdpbm5lcnNbal0uV29uQ291bnQgewogICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHdpbm5lcnNbaV0uQWRkZWRBdCAmZ3Q7IHdpbm5lcnNbal0uQWRkZWRBdAogICAgfSkKfQoKZnVuYyAobGVhZGVyYm9hcmQgTGVhZGVyYm9hcmQpIFNvcnRXaW5uZXJzKCkgewogICAgU29ydFdpbm5lcnMobGVhZGVyYm9hcmQuV2lubmVycykKfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-handling/x/leaderboard/types/leaderboard.go#L36-L50"}}),e._v(" "),t("p",[e._v("It tests in descending order, first for scores and then for the timestamps.")]),e._v(" "),t("HighlightBox",{attrs:{type:"tip"}},[t("p",[e._v("It is possible to write a one-liner inside this function, but at the expense of readability.")])])],1),e._v(" "),t("li",[t("p",[e._v("When it comes to adding or updating candidates to the array of winners, your goal is to make these operations as efficient as possible. To avoid having to find duplicate player addresses in an array, it is better to use a map. Add a function to convert an array of winners into a map:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBNYXBXaW5uZXJzKHdpbm5lcnMgW11XaW5uZXIsIGxlbmd0aCBpbnQpIG1hcFtzdHJpbmddV2lubmVyIHsKICAgIG1hcHBlZCA6PSBtYWtlKG1hcFtzdHJpbmddV2lubmVyLCBsZW5ndGgpCiAgICBmb3IgXywgd2lubmVyIDo9IHJhbmdlIHdpbm5lcnMgewogICAgICAgIGFscmVhZHksIGZvdW5kIDo9IG1hcHBlZFt3aW5uZXIuQWRkcmVzc10KICAgICAgICBpZiAhZm91bmQgewogICAgICAgICAgICBtYXBwZWRbd2lubmVyLkFkZHJlc3NdID0gd2lubmVyCiAgICAgICAgfSBlbHNlIGlmIGFscmVhZHkuV29uQ291bnQgJmx0OyB3aW5uZXIuV29uQ291bnQgewogICAgICAgICAgICBtYXBwZWRbd2lubmVyLkFkZHJlc3NdID0gd2lubmVyCiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIG1hcHBlZAp9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-handling/x/leaderboard/types/leaderboard.go#L52-L63"}})],1),e._v(" "),t("li",[t("p",[e._v("The timestamp used when a winner is added to the leaderboard will be the block's time. In other words, it will be the same time for all candidates added in "),t("code",[e._v("EndBlock")]),e._v(". Prepare a function to do that:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBBZGRDYW5kaWRhdGVzQXROb3cod2lubmVycyBbXVdpbm5lciwgbm93IHRpbWUuVGltZSwgY2FuZGlkYXRlcyBbXUNhbmRpZGF0ZSkgKHVwZGF0ZWQgW11XaW5uZXIpIHsKICAgIG1hcHBlZCA6PSBNYXBXaW5uZXJzKHdpbm5lcnMsIGxlbih3aW5uZXJzKStsZW4oY2FuZGlkYXRlcykpCiAgICBmb3IgXywgY2FuZGlkYXRlIDo9IHJhbmdlIGNhbmRpZGF0ZXMgewogICAgICAgIGlmIGNhbmRpZGF0ZS5Xb25Db3VudCAmbHQ7IDEgewogICAgICAgICAgICBjb250aW51ZQogICAgICAgIH0KICAgICAgICBjYW5kaWRhdGVXaW5uZXIgOj0gY2FuZGlkYXRlLkdldFdpbm5lckF0VGltZShub3cpCiAgICAgICAgYWxyZWFkeSwgZm91bmQgOj0gbWFwcGVkW2NhbmRpZGF0ZVdpbm5lci5BZGRyZXNzXQogICAgICAgIGlmICFmb3VuZCB7CiAgICAgICAgICAgIG1hcHBlZFtjYW5kaWRhdGVXaW5uZXIuQWRkcmVzc10gPSBjYW5kaWRhdGVXaW5uZXIKICAgICAgICB9IGVsc2UgaWYgYWxyZWFkeS5Xb25Db3VudCAmbHQ7IGNhbmRpZGF0ZVdpbm5lci5Xb25Db3VudCB7CiAgICAgICAgICAgIG1hcHBlZFtjYW5kaWRhdGVXaW5uZXIuQWRkcmVzc10gPSBjYW5kaWRhdGVXaW5uZXIKICAgICAgICB9CiAgICB9CiAgICB1cGRhdGVkID0gbWFrZShbXVdpbm5lciwgMCwgbGVuKG1hcHBlZCkpCiAgICBmb3IgXywgd2lubmVyIDo9IHJhbmdlIG1hcHBlZCB7CiAgICAgICAgdXBkYXRlZCA9IGFwcGVuZCh1cGRhdGVkLCB3aW5uZXIpCiAgICB9CiAgICBTb3J0V2lubmVycyh1cGRhdGVkKQogICAgcmV0dXJuIHVwZGF0ZWQKfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-migration/x/checkers/types/leaderboard.go#L112-L155"}}),e._v(" "),t("p",[e._v("Note how, when creating the map, it initializes with a capacity equal to the sum of both winners and candidates' lengths. This is an approximative way of increasing memory performance.")])],1)]),e._v(" "),t("h2",{attrs:{id:"candidate-lifecycle"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#candidate-lifecycle"}},[e._v("#")]),e._v(" Candidate Lifecycle")]),e._v(" "),t("p",[e._v("You have prepared helper functions that will update a list of winners with a list of candidates. The candidates will come from the transient store â€“ transient in the sense that it will be discarded after "),t("code",[e._v("EndBlock")]),e._v(". That is good for this usage, as you do not want to carry candidates from one block to the next.")]),e._v(" "),t("p",[e._v("Your leaderboard module does not have access to a transient store by default, so you will have to prepare that first.")]),e._v(" "),t("p",[e._v("Additionally, you want to reduce the number of marshalling / unmarshalling taking place repeatedly. It would not make sense to unmarshall a whole array of candidates every time you want to add a single candidate to the array. Instead, it makes sense to keep each candidate as a single entry in the store, and separately keep the information on how many "),t("code",[e._v("n")]),e._v(" are being stored. Later, you can retrieve them with "),t("code",[e._v("[k]")]),e._v(" where "),t("code",[e._v("0 <= k < n")]),e._v(".")]),e._v(" "),t("p",[e._v("You will:")]),e._v(" "),t("ol",[t("li",[e._v("Prepare your leaderboard module with access to a transient store.")]),e._v(" "),t("li",[e._v("Define keys of the candidates transient store.")]),e._v(" "),t("li",[e._v("Add a function to prepare the candidates transient store in "),t("code",[e._v("BeginBlock")]),e._v(".")]),e._v(" "),t("li",[e._v("Add a function to add a single candidate to the store.")]),e._v(" "),t("li",[e._v("Add a function to retrieve all the candidates from the transient store.")])]),e._v(" "),t("h3",{attrs:{id:"prepare-transient-store"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#prepare-transient-store"}},[e._v("#")]),e._v(" Prepare transient store")]),e._v(" "),t("p",[e._v("By default, Ignite CLI does not prepare your module to have access to a transient store like it prepares it to have access to the proper store. The preparation works the same way as a normal store.")]),e._v(" "),t("p",[e._v("Add a transient store key in your keeper:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIHR5cGUgKAogICAgICAgIEtlZXBlciBzdHJ1Y3QgewogICAgICAgICAgICAuLi4KICAgICAgICAgICAgbWVtS2V5ICAgICBzZGsuU3RvcmVLZXkKKyAgICAgICAgICB0S2V5ICAgICAgIHNkay5TdG9yZUtleQogICAgICAgICAgICBwYXJhbXN0b3JlIHBhcmFtdHlwZXMuU3Vic3BhY2UKICAgICAgICB9CiAgICApCg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-handling/x/leaderboard/keeper/keeper.go#L19"}}),e._v(" "),t("p",[e._v("Update the constructor accordingly:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIGZ1bmMgTmV3S2VlcGVyKAogICAgICAgIC4uLgogICAgICAgIG1lbUtleSBzZGsuU3RvcmVLZXksCisgICAgICB0S2V5IHNkay5TdG9yZUtleSwKICAgICAgICBwcyBwYXJhbXR5cGVzLlN1YnNwYWNlLAoKICAgICkgKktlZXBlciB7CiAgICAgICAgLi4uCiAgICAgICAgcmV0dXJuICZhbXA7S2VlcGVyewogICAgICAgICAgICAuLi4KICAgICAgICAgICAgbWVtS2V5OiAgICAgbWVtS2V5LAorICAgICAgICAgIHRLZXk6ICAgICAgIHRLZXksCiAgICAgICAgICAgIHBhcmFtc3RvcmU6IHBzLAogICAgICAgIH0KICAgIH0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-handling/x/leaderboard/keeper/keeper.go#L24-L45"}}),e._v(" "),t("p",[e._v("This key will be identified by a new string in "),t("code",[e._v("app.go")]),e._v("'s list of transient store keys. Add such a distinct key:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIE1lbVN0b3JlS2V5ID0gJnF1b3Q7bWVtX2xlYWRlcmJvYXJkJnF1b3Q7CisKKyAgLy8gVFN0b3JlS2V5IGRlZmluZXMgdGhlIHRyYW5zaWVudCBzdG9yZSBrZXkKKyAgVFN0b3JlS2V5ID0gJnF1b3Q7dHJhbnNpZW50X2xlYWRlcmJvYXJkJnF1b3Q7Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-handling/x/leaderboard/types/keys.go#L19-L20"}}),e._v(" "),t("p",[e._v("Adjust "),t("code",[e._v("app.go")]),e._v(" so that it gives the keeper a valid key. Also take this opportunity to fix an Ignite bug on "),t("code",[e._v("memKeys")]),e._v(":")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIGFwcC5MZWFkZXJib2FyZEtlZXBlciA9ICpsZWFkZXJib2FyZG1vZHVsZWtlZXBlci5OZXdLZWVwZXIoCiAgICAgICAgLi4uCi0gICAgICBrZXlzW2xlYWRlcmJvYXJkbW9kdWxldHlwZXMuTWVtU3RvcmVLZXldLAorICAgICAgbWVtS2V5c1tsZWFkZXJib2FyZG1vZHVsZXR5cGVzLk1lbVN0b3JlS2V5XSwKKyAgICAgIHRrZXlzW2xlYWRlcmJvYXJkbW9kdWxldHlwZXMuVFN0b3JlS2V5XSwKICAgICAgICBhcHAuR2V0U3Vic3BhY2UobGVhZGVyYm9hcmRtb2R1bGV0eXBlcy5Nb2R1bGVOYW1lKSwKICAgICkK",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-handling/app/app.go#L419-L420"}}),e._v(" "),t("p",[e._v("Do not forget to ensure that there is indeed a store key at the string(s) you asked:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"LSAgdGtleXMgOj0gc2RrLk5ld1RyYW5zaWVudFN0b3JlS2V5cyhwYXJhbXN0eXBlcy5UU3RvcmVLZXkpCi0gIG1lbUtleXMgOj0gc2RrLk5ld01lbW9yeVN0b3JlS2V5cyhjYXBhYmlsaXR5dHlwZXMuTWVtU3RvcmVLZXkpCisgIHRrZXlzIDo9IHNkay5OZXdUcmFuc2llbnRTdG9yZUtleXMocGFyYW1zdHlwZXMuVFN0b3JlS2V5LCBsZWFkZXJib2FyZG1vZHVsZXR5cGVzLlRTdG9yZUtleSkKKyAgbWVtS2V5cyA6PSBzZGsuTmV3TWVtb3J5U3RvcmVLZXlzKGNhcGFiaWxpdHl0eXBlcy5NZW1TdG9yZUtleSwgbGVhZGVyYm9hcmRtb2R1bGV0eXBlcy5NZW1TdG9yZUtleSkK",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-handling/app/app.go#L303-L304"}}),e._v(" "),t("h3",{attrs:{id:"prepare-candidate-store-keys"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#prepare-candidate-store-keys"}},[e._v("#")]),e._v(" Prepare candidate store keys")]),e._v(" "),t("p",[e._v("Your keeper has access to a transient store. Define the keys by which elements will be accessed in it. Taking inspiration from checkers' stored games use of prefixes and their use in the "),t("code",[e._v("GetAllStoredGame")]),e._v(" function, prepare prefix keys for the values in a new "),t("code",[e._v("types/key_candidate.go")]),e._v(" file:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Y29uc3QgKAoJQ2FuZGlkYXRlS2V5UHJlZml4ID0gJnF1b3Q7Q2FuZGlkYXRlL3ZhbHVlLyZxdW90OwopCgovLyBDYW5kaWRhdGVLZXkgcmV0dXJucyB0aGUgc3RvcmUga2V5IHRvIHJldHJpZXZlIGEgQ2FuZGlkYXRlIGZyb20gdGhlIGluZGV4IGZpZWxkCi8vIEl0IGlzIG5vdCB1c2VkIGJ1dCBpcyBoZXJlIHRvIHJlbWluZCB3aGVyZSB2YWx1ZXMgYXJlIHN0b3JlZApmdW5jIENhbmRpZGF0ZUtleShhZGRyZXNzIFtdYnl0ZSkgW11ieXRlIHsKICAgIHZhciBrZXkgW11ieXRlCgogICAgcHJlZml4Qnl0ZXMgOj0gW11ieXRlKENhbmRpZGF0ZUtleVByZWZpeCkKICAgIGtleSA9IGFwcGVuZChrZXksIHByZWZpeEJ5dGVzLi4uKQogICAga2V5ID0gYXBwZW5kKGtleSwgYWRkcmVzcy4uLikKCiAgICByZXR1cm4ga2V5Cn0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-handling/x/leaderboard/types/key_candidate.go#L9-L23"}}),e._v(" "),t("h3",{attrs:{id:"use-the-candidate-store"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#use-the-candidate-store"}},[e._v("#")]),e._v(" Use the candidate store")]),e._v(" "),t("p",[e._v("Now you can add the functions that will use the transient store at each update and on "),t("code",[e._v("EndBlock")]),e._v(". Add a new "),t("code",[e._v("keeper/candidate.go")]),e._v(" file with:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAoayBLZWVwZXIpIFNldENhbmRpZGF0ZShjdHggc2RrLkNvbnRleHQsIGNhbmRpZGF0ZSB0eXBlcy5DYW5kaWRhdGUpIHsKICAgIGNhbmRpZGF0ZVN0b3JlIDo9IHByZWZpeC5OZXdTdG9yZShjdHguVHJhbnNpZW50U3RvcmUoay50S2V5KSwgW11ieXRlKHR5cGVzLkNhbmRpZGF0ZUtleVByZWZpeCkpCiAgICBjYW5kaWRhdGVCeXRlcyA6PSBrLmNkYy5NdXN0TWFyc2hhbCgmYW1wO2NhbmRpZGF0ZSkKICAgIGNhbmRpZGF0ZVN0b3JlLlNldChjYW5kaWRhdGUuQWRkcmVzcywgY2FuZGlkYXRlQnl0ZXMpCn0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-handling/x/leaderboard/keeper/candidate.go#L9-L13"}}),e._v(" "),t("p",[e._v("This function saves the candidate at its address. Already having "),t("code",[e._v("[]byte Address")]),e._v(" in the "),t("code",[e._v("Candidate")]),e._v(" object proves useful. This also means that if there are two updates in one block for a single player only the second update is recorded. In the case of a game that has only increasing scores, this is okay.")]),e._v(" "),t("p",[e._v("Next, taking inspiration from "),t("code",[e._v("StoredGame")]),e._v(" again, add a function to get all candidates with an iterator:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAoayBLZWVwZXIpIEdldEFsbENhbmRpZGF0ZXMoY3R4IHNkay5Db250ZXh0KSAoY2FuZGlkYXRlcyBbXXR5cGVzLkNhbmRpZGF0ZSkgewogICAgY2FuZGlkYXRlU3RvcmUgOj0gcHJlZml4Lk5ld1N0b3JlKGN0eC5UcmFuc2llbnRTdG9yZShrLnRLZXkpLCBbXWJ5dGUodHlwZXMuQ2FuZGlkYXRlS2V5UHJlZml4KSkKICAgIGl0ZXJhdG9yIDo9IHNkay5LVlN0b3JlUHJlZml4SXRlcmF0b3IoY2FuZGlkYXRlU3RvcmUsIFtdYnl0ZXt9KQoKICAgIGRlZmVyIGl0ZXJhdG9yLkNsb3NlKCkKCiAgICBmb3IgOyBpdGVyYXRvci5WYWxpZCgpOyBpdGVyYXRvci5OZXh0KCkgewogICAgICAgIHZhciBjYW5kaWRhdGUgdHlwZXMuQ2FuZGlkYXRlCiAgICAgICAgay5jZGMuTXVzdFVubWFyc2hhbChpdGVyYXRvci5WYWx1ZSgpLCAmYW1wO2NhbmRpZGF0ZSkKICAgICAgICBjYW5kaWRhdGVzID0gYXBwZW5kKGNhbmRpZGF0ZXMsIGNhbmRpZGF0ZSkKICAgIH0KCiAgICByZXR1cm4KfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-handling/x/leaderboard/keeper/candidate.go#L15-L28"}}),e._v(" "),t("p",[e._v("This gets all candidates. There may be many, but not so many that it grinds the application. After all, it only gets all that was put during the block itself.")]),e._v(" "),t("h2",{attrs:{id:"leaderboard-handling"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#leaderboard-handling"}},[e._v("#")]),e._v(" Leaderboard handling")]),e._v(" "),t("p",[e._v("You have created the leaderboard helper functions and the function to get all candidates. You can now update the leaderboard. This takes place in "),t("code",[e._v("EndBlock")]),e._v(".")]),e._v(" "),t("p",[e._v("First, in a separate file, add one function to the keeper:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAoayBLZWVwZXIpIENvbGxlY3RTb3J0QW5kQ2xpcExlYWRlcmJvYXJkKGN0eCBzZGsuQ29udGV4dCkgewogICAgbGVhZGVyYm9hcmQgOj0gay5HZXRMZWFkZXJib2FyZChjdHgpCiAgICB1cGRhdGVkIDo9IHR5cGVzLkFkZENhbmRpZGF0ZXNBdE5vdyhsZWFkZXJib2FyZC5XaW5uZXJzLCBjdHguQmxvY2tUaW1lKCksIGsuR2V0QWxsQ2FuZGlkYXRlcyhjdHgpKQogICAgcGFyYW1zIDo9IGsuR2V0UGFyYW1zKGN0eCkKICAgIGlmIHBhcmFtcy5MZW5ndGggJmx0OyB1aW50NjQobGVuKHVwZGF0ZWQpKSB7CiAgICAgICAgdXBkYXRlZCA9IHVwZGF0ZWRbOnBhcmFtcy5MZW5ndGhdCiAgICB9CiAgICBsZWFkZXJib2FyZC5XaW5uZXJzID0gdXBkYXRlZAogICAgay5TZXRMZWFkZXJib2FyZChjdHgsIGxlYWRlcmJvYXJkKQp9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-handling/x/leaderboard/keeper/end_block_leaderboard_handler.go#L10-L17"}}),e._v(" "),t("p",[e._v("This function gets the candidates from the transient store and the leaderboard from the regular store, adds the candidates, clips the array to the maximum length found in "),t("code",[e._v("Params")]),e._v(", and saves the updated leaderboard back in storage.")]),e._v(" "),t("p",[e._v("This means that the leaderboard will be unmarshalled and marshalled only once per block.")]),e._v(" "),t("p",[e._v("Next, make sure it is called from "),t("code",[e._v("EndBlock")]),e._v(". In "),t("code",[e._v("module.go")]),e._v(":")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"LSAgZnVuYyAoYW0gQXBwTW9kdWxlKSBFbmRCbG9jayhfIHNkay5Db250ZXh0LCBfIGFiY2kuUmVxdWVzdEVuZEJsb2NrKSBbXWFiY2kuVmFsaWRhdG9yVXBkYXRlIHsKKyAgZnVuYyAoYW0gQXBwTW9kdWxlKSBFbmRCbG9jayhjdHggc2RrLkNvbnRleHQsIF8gYWJjaS5SZXF1ZXN0RW5kQmxvY2spIFtdYWJjaS5WYWxpZGF0b3JVcGRhdGUgeworICAgICAgYW0ua2VlcGVyLkNvbGxlY3RTb3J0QW5kQ2xpcExlYWRlcmJvYXJkKGN0eCkKICAgICAgICByZXR1cm4gW11hYmNpLlZhbGlkYXRvclVwZGF0ZXt9CiAgICB9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-handling/x/leaderboard/module.go#L173-L174"}}),e._v(" "),t("p",[e._v("If Ignite did it right, "),t("code",[e._v("app.go")]),e._v(" has "),t("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-handling/app/app.go#L523",target:"_blank",rel:"noopener noreferrer"}},[e._v("already set up"),t("OutboundLink")],1),e._v(" the leaderboard module to be called on "),t("code",[e._v("EndBlock")]),e._v(".")]),e._v(" "),t("p",[e._v("Your leaderboard will now be updated and saved on an on-going basis as part of your v2 blockchain. However, so far, you have put "),t("strong",[e._v("nothing")]),e._v(" in the transient store.")]),e._v(" "),t("h2",{attrs:{id:"hook-infrastructure-for-candidates"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#hook-infrastructure-for-candidates"}},[e._v("#")]),e._v(" Hook infrastructure for candidates")]),e._v(" "),t("p",[e._v("To populate candidate winners in your transient store, you are going to "),t("em",[e._v("listen")]),e._v(" to "),t("code",[e._v("PlayerInfo")]),e._v(" updates emitted from the checkers module:")]),e._v(" "),t("ul",[t("li",[e._v("This will avoid tight coupling between the modules.")]),e._v(" "),t("li",[e._v("The checkers module will not care whether there is a listener or not.")]),e._v(" "),t("li",[e._v("It will be the duty of "),t("code",[e._v("app.go")]),e._v(" to hook the leaderboard's listener to the checkers emitter.")]),e._v(" "),t("li",[e._v("To reduce the dependency of the leaderboard module on elements of the checkers module, you are going to restrict to a single file.")])]),e._v(" "),t("p",[e._v("With the Cosmos SDK, hooks are a design pattern so you have to code them.")]),e._v(" "),t("h3",{attrs:{id:"on-the-checkers-module"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#on-the-checkers-module"}},[e._v("#")]),e._v(" On the checkers module")]),e._v(" "),t("p",[e._v("Add the hooks interface to the checkers module. First as an expected interface:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"dHlwZSBDaGVja2Vyc0hvb2tzIGludGVyZmFjZSB7CiAgICBBZnRlclBsYXllckluZm9DaGFuZ2VkKGN0eCBzZGsuQ29udGV4dCwgcGxheWVySW5mbyBQbGF5ZXJJbmZvKQp9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-handling/x/checkers/types/expected_keepers.go#L25-L27"}}),e._v(" "),t("p",[e._v("Here you can imagine you could add functions for all sorts of updates coming from checkers. But for the sake of the exercise keep it simple.")]),e._v(" "),t("p",[e._v("Then, taking inspiration from the "),t("a",{attrs:{href:"https://github.com/cosmos/cosmos-sdk/blob/v0.45.4/x/gov/types/hooks.go#L7-L20",target:"_blank",rel:"noopener noreferrer"}},[e._v("governance module's hooks"),t("OutboundLink")],1),e._v(", define a convenience multi hook that can accommodate multiple listeners:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"dmFyIF8gQ2hlY2tlcnNIb29rcyA9IE11bHRpQ2hlY2tlcnNIb29rc3t9Cgp0eXBlIE11bHRpQ2hlY2tlcnNIb29rcyBbXUNoZWNrZXJzSG9va3MKCmZ1bmMgTmV3TXVsdGlDaGVja2Vyc0hvb2tzKGhvb2tzIC4uLkNoZWNrZXJzSG9va3MpIE11bHRpQ2hlY2tlcnNIb29rcyB7CglyZXR1cm4gaG9va3MKfQoKZnVuYyAoaCBNdWx0aUNoZWNrZXJzSG9va3MpIEFmdGVyUGxheWVySW5mb0NoYW5nZWQoY3R4IHNkay5Db250ZXh0LCBwbGF5ZXJJbmZvIFBsYXllckluZm8pIHsKCWZvciBpIDo9IHJhbmdlIGggewoJCWhbaV0uQWZ0ZXJQbGF5ZXJJbmZvQ2hhbmdlZChjdHgsIHBsYXllckluZm8pCgl9Cn0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-handling/x/checkers/types/hooks.go#L7-L19"}}),e._v(" "),t("p",[e._v("Expose this hooks interface via the checkers keeper:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIHR5cGUgKAogICAgICAgIEtlZXBlciBzdHJ1Y3QgewogICAgICAgICAgICBiYW5rICAgICAgIHR5cGVzLkJhbmtFc2Nyb3dLZWVwZXIKKyAgICAgICAgICBob29rcyAgICAgIHR5cGVzLkNoZWNrZXJzSG9va3MKICAgICAgICAgICAgY2RjICAgICAgICBjb2RlYy5CaW5hcnlDb2RlYwogICAgICAgICAgICAuLi4KICAgICAgICB9CiAgICApCg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-handling/x/checkers/keeper/keeper.go#L17"}}),e._v(" "),t("p",[e._v("And a function to set it:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAoa2VlcGVyICpLZWVwZXIpIFNldEhvb2tzKGhvb2tzIHR5cGVzLkNoZWNrZXJzSG9va3MpICpLZWVwZXIgewogICAgaWYga2VlcGVyLmhvb2tzICE9IG5pbCB7CiAgICAgICAgcGFuaWMoJnF1b3Q7Y2Fubm90IHNldCBjaGVja2VycyBob29rcyB0d2ljZSZxdW90OykKICAgIH0KCiAgICBrZWVwZXIuaG9va3MgPSBob29rcwoKICAgIHJldHVybiBrZWVwZXIKfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-handling/x/checkers/keeper/keeper.go#L47-L55"}}),e._v(" "),t("p",[e._v("Having a function to set the hooks is advised, as that allows you to collect the listeners you need without worrying about the order of creation of other keepers.")]),e._v(" "),t("p",[e._v("With the hooks structure in place, you must have your checkers code call it. The best place for that is precisely where it is updated and saved:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIGZ1bmMgbXVzdEFkZERlbHRhR2FtZVJlc3VsdFRvUGxheWVyKAogICAgICAgIC4uLgogICAgKSAocGxheWVySW5mbyB0eXBlcy5QbGF5ZXJJbmZvKSB7CiAgICAgICAgLi4uCiAgICAgICAgay5TZXRQbGF5ZXJJbmZvKGN0eCwgcGxheWVySW5mbykKKyAgICAgIGlmIGsuaG9va3MgIT0gbmlsIHsKKyAgICAgICAgICBrLmhvb2tzLkFmdGVyUGxheWVySW5mb0NoYW5nZWQoY3R4LCBwbGF5ZXJJbmZvKQorICAgICAgfQogICAgICAgIHJldHVybiBwbGF5ZXJJbmZvCiAgICB9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-handling/x/checkers/keeper/player_info_handler.go#L32-L34"}}),e._v(" "),t("HighlightBox",{attrs:{type:"note"}},[t("p",[e._v("Remember that the hook is named "),t("code",[e._v("AfterPlayerInfoChanged")]),e._v(", not "),t("em",[e._v("for use by the leaderboard")]),e._v(". Therefore you should also emit when there is a change that you know is going to be discarded by the leaderboard.\n"),t("br"),t("br"),e._v("\nIt verifies "),t("code",[e._v("!= nil")]),e._v(" to make sure it does not panic if there are no listeners, which is a legitimate situation.")])]),e._v(" "),t("p",[e._v("The checkers module is now ready with regards to the hooks.")]),e._v(" "),t("h3",{attrs:{id:"on-the-leaderboard-module"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#on-the-leaderboard-module"}},[e._v("#")]),e._v(" On the leaderboard module")]),e._v(" "),t("p",[e._v("In your keeper, define a generic checkers hook listener. In a new "),t("code",[e._v("keeper/hooks.go")]),e._v(" file, put a simple:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"dHlwZSBIb29rcyBzdHJ1Y3QgewogICAgayBLZWVwZXIKfQoKZnVuYyAoayBLZWVwZXIpIEhvb2tzKCkgSG9va3MgeyByZXR1cm4gSG9va3N7a30gfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-handling/x/leaderboard/keeper/hooks.go#L3-L7"}}),e._v(" "),t("p",[e._v("Then, so as to keep the dependency on checkers' types in as few files as possible, encapsulate the conversion knowledge in a new "),t("code",[e._v("types/leaderboard_checkers.go")]),e._v(":")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBNYWtlQ2FuZGlkYXRlRnJvbVBsYXllckluZm8ocGxheWVySW5mbyBjaGVja2Vyc3R5cGVzLlBsYXllckluZm8pIChjYW5kaWRhdGUgQ2FuZGlkYXRlLCBlcnIgZXJyb3IpIHsKICAgIGFkZHJlc3MsIGVyciA6PSBzZGsuQWNjQWRkcmVzc0Zyb21CZWNoMzIocGxheWVySW5mby5JbmRleCkKICAgIGlmIGVyciAhPSBuaWwgewogICAgICAgIHJldHVybiBjYW5kaWRhdGUsIHNka2Vycm9ycy5XcmFwZihlcnIsICZxdW90O0NvdWxkIG5vdCBwYXJzZSBhZGRyZXNzIGZyb20gcGxheWVySW5mbyAlcyZxdW90OywgcGxheWVySW5mby5JbmRleCkKICAgIH0KICAgIHJldHVybiBDYW5kaWRhdGV7CiAgICAgICAgQWRkcmVzczogIGFkZHJlc3MsCiAgICAgICAgV29uQ291bnQ6IHBsYXllckluZm8uV29uQ291bnQsCiAgICB9LCBuaWwKfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-handling/x/leaderboard/types/leaderboard_checkers.go#L9-L18"}}),e._v(" "),t("p",[e._v("Now encapsulate the handling in a new "),t("code",[e._v("keeper/hooks_checkers.go")]),e._v(" file:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"dmFyIF8gY2hlY2tlcnN0eXBlcy5DaGVja2Vyc0hvb2tzID0gSG9va3N7fQoKZnVuYyAoaCBIb29rcykgQWZ0ZXJQbGF5ZXJJbmZvQ2hhbmdlZChjdHggc2RrLkNvbnRleHQsIHBsYXllckluZm8gY2hlY2tlcnN0eXBlcy5QbGF5ZXJJbmZvKSB7CiAgICBjYW5kaWRhdGUsIGVyciA6PSB0eXBlcy5NYWtlQ2FuZGlkYXRlRnJvbVBsYXllckluZm8ocGxheWVySW5mbykKICAgIGlmIGVyciAhPSBuaWwgewogICAgICAgIHBhbmljKGZtdC5TcHJpbnRmKCZxdW90OyV2JnF1b3Q7LCBlcnIpKQogICAgfQogICAgaWYgY2FuZGlkYXRlLldvbkNvdW50ICZsdDsgMSB7CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBoLmsuU2V0Q2FuZGlkYXRlKGN0eCwgY2FuZGlkYXRlKQp9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-handling/x/leaderboard/keeper/hooks_checkers.go#L11-L22"}}),e._v(" "),t("p",[e._v("As you can see, this takes the new information and puts it into the transient store "),t("em",[e._v("only if it is worth doing so")]),e._v(".")]),e._v(" "),t("HighlightBox",{attrs:{type:"best-practice"}},[t("p",[e._v("If your leaderboard hooks listener was set to listen from more than one module, you would add a new "),t("code",[e._v("hooks_othermodule.go")]),e._v(" file that only concerns itself with that other module.")])]),e._v(" "),t("p",[e._v("The leaderboard handling is now complete.")]),e._v(" "),t("h3",{attrs:{id:"on-app-go"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#on-app-go"}},[e._v("#")]),e._v(" On "),t("code",[e._v("app.go")])]),e._v(" "),t("p",[e._v("All "),t("code",[e._v("app.go")]),e._v(" has to do is call checkers' "),t("code",[e._v("SetHooks")]),e._v(" with the leaderboard's listener after all keepers have been created:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIGxlYWRlcmJvYXJkTW9kdWxlIDo9IGxlYWRlcmJvYXJkbW9kdWxlLk5ld0FwcE1vZHVsZShhcHBDb2RlYywgYXBwLkxlYWRlcmJvYXJkS2VlcGVyLCBhcHAuQWNjb3VudEtlZXBlciwgYXBwLkJhbmtLZWVwZXIpCgorICBhcHAuQ2hlY2tlcnNLZWVwZXIgPSAqYXBwLkNoZWNrZXJzS2VlcGVyLlNldEhvb2tzKAorICAgICAgY2hlY2tlcnNtb2R1bGV0eXBlcy5OZXdNdWx0aUNoZWNrZXJzSG9va3MoCisgICAgICAgICAgYXBwLkxlYWRlcmJvYXJkS2VlcGVyLkhvb2tzKCksCisgICAgICApLAorICApCgogICAgLy8gdGhpcyBsaW5lIGlzIHVzZWQgYnkgc3RhcnBvcnQgc2NhZmZvbGRpbmcgIyBzdGFyZ2F0ZS9hcHAva2VlcGVyRGVmaW5pdGlvbgo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-handling/app/app.go#L427-L431"}}),e._v(" "),t("p",[e._v("Note how "),t("code",[e._v("app.CheckersKeeper")]),e._v(" is replaced. This means that you need to move the checkers module line below:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"LSAgY2hlY2tlcnNNb2R1bGUgOj0gY2hlY2tlcnNtb2R1bGUuTmV3QXBwTW9kdWxlKGFwcENvZGVjLCBhcHAuQ2hlY2tlcnNLZWVwZXIsIGFwcC5BY2NvdW50S2VlcGVyLCBhcHAuQmFua0tlZXBlcikKCiAgICBhcHAuTGVhZGVyYm9hcmRLZWVwZXIgPSAqbGVhZGVyYm9hcmRtb2R1bGVrZWVwZXIuTmV3S2VlcGVyCiAgICAuLi4KCiAgICBhcHAuQ2hlY2tlcnNLZWVwZXIgPSAqYXBwLkNoZWNrZXJzS2VlcGVyLlNldEhvb2tzKAogICAgICAgIC4uLgogICAgKQoKKyAgY2hlY2tlcnNNb2R1bGUgOj0gY2hlY2tlcnNtb2R1bGUuTmV3QXBwTW9kdWxlKGFwcENvZGVjLCBhcHAuQ2hlY2tlcnNLZWVwZXIsIGFwcC5BY2NvdW50S2VlcGVyLCBhcHAuQmFua0tlZXBlcikKCiAgICAvLyB0aGlzIGxpbmUgaXMgdXNlZCBieSBzdGFycG9ydCBzY2FmZm9sZGluZyAjIHN0YXJnYXRlL2FwcC9rZWVwZXJEZWZpbml0aW9uCg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-handling/app/app.go#L433"}}),e._v(" "),t("p",[e._v("If you forgot to do so, the module would be created with the "),t("em",[e._v("hook-less")]),e._v(" keeper.")]),e._v(" "),t("h2",{attrs:{id:"unit-tests"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#unit-tests"}},[e._v("#")]),e._v(" Unit tests")]),e._v(" "),t("p",[e._v("After all these changes, it is worthwhile adding tests.")]),e._v(" "),t("p",[e._v("Just like you did for the checkers module, you can add valid addresses to be reused elsewhere in a new file:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Y29uc3QgKAoJQWxpY2UgPSAmcXVvdDtjb3Ntb3Mxam1qZnEwdHBscDl0bXg0djl1ZW13NzJ5NGQyd2E1bnIzeG45ZDMmcXVvdDsKCUJvYiAgID0gJnF1b3Q7Y29zbW9zMXh5eHMzc2tmM2Y0amZxZXV2ODl5eWFxdmpjNmxmZmF2eHFoYzhnJnF1b3Q7CglDYXJvbCA9ICZxdW90O2Nvc21vczFlMHc1dDUzbnJxN3A2NmZ5ZTZjOHAweW55aGY2eTI0bDR5dXhkNyZxdW90OwopCg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-objects/x/leaderboard/testutil/constants.go#L3-L7"}}),e._v(" "),t("h3",{attrs:{id:"candidate-unit-tests"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#candidate-unit-tests"}},[e._v("#")]),e._v(" Candidate unit tests")]),e._v(" "),t("p",[e._v("You added a new "),t("code",[e._v("Candidate")]),e._v(" type and helper functions on it. You can test that they work as expected. Add a new "),t("code",[e._v("leaderboard_test.go")]),e._v(" file. No need to overdo it:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Y29uc3QgKAoJYWxpY2UgPSB0ZXN0dXRpbC5BbGljZQopCgpmdW5jIFRlc3RDYW5kaWRhdGVHZXRXaW5uZXJBdFRpbWUodCAqdGVzdGluZy5UKSB7CiAgICBub3cgOj0gdGltZS5Ob3coKQogICAgdGltZXN0YW1wIDo9IG5vdy5Vbml4KCkKICAgIGFsaWNlQWRkcmVzcywgZXJyIDo9IHNkay5BY2NBZGRyZXNzRnJvbUJlY2gzMihhbGljZSkKICAgIHJlcXVpcmUuTmlsKHQsIGVycikKICAgIGNhbmRpZGF0ZSA6PSB0eXBlcy5DYW5kaWRhdGV7CiAgICAgICAgQWRkcmVzczogIGFsaWNlQWRkcmVzcywKICAgICAgICBXb25Db3VudDogMjMsCiAgICB9CiAgICB3aW5uZXIgOj0gY2FuZGlkYXRlLkdldFdpbm5lckF0VGltZShub3cpCiAgICByZXF1aXJlLkVxdWFsVmFsdWVzKHQsIHR5cGVzLldpbm5lcnsKICAgICAgICBBZGRyZXNzOiAgYWxpY2UsCiAgICAgICAgV29uQ291bnQ6IDIzLAogICAgICAgIEFkZGVkQXQ6ICB1aW50NjQodGltZXN0YW1wKSwKICAgIH0sIHdpbm5lcikKfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-objects/x/leaderboard/types/leaderboard_test.go#L13-L32"}}),e._v(" "),t("h3",{attrs:{id:"leaderboard-helper-unit-tests"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#leaderboard-helper-unit-tests"}},[e._v("#")]),e._v(" Leaderboard helper unit tests")]),e._v(" "),t("p",[e._v("Start by adding tests that confirm that the sorting of the leaderboard's winners works as expected. Here an array of test cases is a good choice:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBUZXN0U29ydFdpbm5lcnModCAqdGVzdGluZy5UKSB7CiAgICB0ZXN0cyA6PSBbXXN0cnVjdCB7CiAgICAgICAgbmFtZSAgICAgc3RyaW5nCiAgICAgICAgdW5zb3J0ZWQgW110eXBlcy5XaW5uZXIKICAgICAgICBzb3J0ZWQgICBbXXR5cGVzLldpbm5lcgogICAgfXsKICAgICAgICB7CiAgICAgICAgICAgIG5hbWU6ICAgICAmcXVvdDtzb3J0IGVtcHR5JnF1b3Q7LAogICAgICAgICAgICB1bnNvcnRlZDogW110eXBlcy5XaW5uZXJ7fSwKICAgICAgICAgICAgc29ydGVkOiAgIFtddHlwZXMuV2lubmVye30sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIG5hbWU6ICZxdW90O3NvcnQgdW5pcXVlJnF1b3Q7LAogICAgICAgICAgICB1bnNvcnRlZDogW110eXBlcy5XaW5uZXJ7CiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgQWRkcmVzczogIGFsaWNlLAogICAgICAgICAgICAgICAgICAgIFdvbkNvdW50OiAyLAogICAgICAgICAgICAgICAgICAgIEFkZGVkQXQ6ICAxMDAwLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc29ydGVkOiBbXXR5cGVzLldpbm5lcnsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBBZGRyZXNzOiAgYWxpY2UsCiAgICAgICAgICAgICAgICAgICAgV29uQ291bnQ6IDIsCiAgICAgICAgICAgICAgICAgICAgQWRkZWRBdDogIDEwMDAsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgLi4uIC8vIE1vcmUgdGVzdCBjYXNlcwogICAgfQogICAgZm9yIF8sIHR0IDo9IHJhbmdlIHRlc3RzIHsKICAgICAgICB0LlJ1bih0dC5uYW1lLCBmdW5jKHQgKnRlc3RpbmcuVCkgewogICAgICAgICAgICBsZWFkZXJib2FyZCA6PSB0eXBlcy5MZWFkZXJib2FyZHsKICAgICAgICAgICAgICAgIFdpbm5lcnM6IHR0LnVuc29ydGVkLAogICAgICAgICAgICB9CiAgICAgICAgICAgIGxlYWRlcmJvYXJkLlNvcnRXaW5uZXJzKCkKICAgICAgICAgICAgc29ydGVkIDo9IGxlYWRlcmJvYXJkLldpbm5lcnMKICAgICAgICAgICAgcmVxdWlyZS5FcXVhbCh0LCBsZW4odHQuc29ydGVkKSwgbGVuKHNvcnRlZCkpCiAgICAgICAgICAgIHJlcXVpcmUuRXF1YWxWYWx1ZXModCwgdHQuc29ydGVkLCBzb3J0ZWQpCiAgICAgICAgfSkKICAgIH0KfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-handling/x/leaderboard/types/leaderboard_test.go#L35-L156"}}),e._v(" "),t("p",[e._v("With that done, you can confirm that the updating or addition of new player info to the leaderboard works as expected, again with an array of test cases:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBUZXN0QWRkQ2FuZGlkYXRlc0F0Tm93KHQgKnRlc3RpbmcuVCkgewogICAgYWxpY2VBZGQsIGVyciA6PSBzZGsuQWNjQWRkcmVzc0Zyb21CZWNoMzIoYWxpY2UpCiAgICByZXF1aXJlLk5pbCh0LCBlcnIpCiAgICBib2JBZGQsIGVyciA6PSBzZGsuQWNjQWRkcmVzc0Zyb21CZWNoMzIoYm9iKQogICAgcmVxdWlyZS5OaWwodCwgZXJyKQogICAgdGVzdHMgOj0gW11zdHJ1Y3QgewogICAgICAgIG5hbWUgICAgICAgc3RyaW5nCiAgICAgICAgc29ydGVkICAgICBbXXR5cGVzLldpbm5lcgogICAgICAgIGNhbmRpZGF0ZXMgW110eXBlcy5DYW5kaWRhdGUKICAgICAgICBub3cgICAgICAgIGludDY0CiAgICAgICAgZXhwZWN0ZWQgICBbXXR5cGVzLldpbm5lcgogICAgfXsKICAgICAgICB7CiAgICAgICAgICAgIG5hbWU6ICAgJnF1b3Q7YWRkIHRvIGVtcHR5JnF1b3Q7LAogICAgICAgICAgICBzb3J0ZWQ6IFtddHlwZXMuV2lubmVye30sCiAgICAgICAgICAgIGNhbmRpZGF0ZXM6IFtddHlwZXMuQ2FuZGlkYXRle3sKICAgICAgICAgICAgICAgIEFkZHJlc3M6ICBhbGljZUFkZCwKICAgICAgICAgICAgICAgIFdvbkNvdW50OiAyLAogICAgICAgICAgICB9fSwKICAgICAgICAgICAgbm93OiAxMDAwLAogICAgICAgICAgICBleHBlY3RlZDogW110eXBlcy5XaW5uZXJ7CiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgQWRkcmVzczogIGFsaWNlLAogICAgICAgICAgICAgICAgICAgIFdvbkNvdW50OiAyLAogICAgICAgICAgICAgICAgICAgIEFkZGVkQXQ6ICAxMDAwLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfSwKICAgICAgICB9LAogICAgICAgIC4uLiAvLyBNb3JlIHRlc3QgY2FzZXMKICAgIH0KICAgIGZvciBfLCB0dCA6PSByYW5nZSB0ZXN0cyB7CiAgICAgICAgdC5SdW4odHQubmFtZSwgZnVuYyh0ICp0ZXN0aW5nLlQpIHsKICAgICAgICAgICAgYWN0dWFsIDo9IHR5cGVzLkFkZENhbmRpZGF0ZXNBdE5vdyh0dC5zb3J0ZWQsIHRpbWUuVW5peCh0dC5ub3csIDApLCB0dC5jYW5kaWRhdGVzKQogICAgICAgICAgICByZXF1aXJlLkVxdWFsKHQsIGxlbih0dC5leHBlY3RlZCksIGxlbihhY3R1YWwpKQogICAgICAgICAgICByZXF1aXJlLkVxdWFsVmFsdWVzKHQsIHR0LmV4cGVjdGVkLCBhY3R1YWwpCiAgICAgICAgICAgIHJlcXVpcmUuTm9FcnJvcih0LCB0eXBlcy5MZWFkZXJib2FyZHtXaW5uZXJzOiBhY3R1YWx9LlZhbGlkYXRlKCkpCiAgICAgICAgfSkKICAgIH0KfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-handling/x/leaderboard/types/leaderboard_test.go#L158-L433"}}),e._v(" "),t("h3",{attrs:{id:"candidate-lifecycle-unit-tests"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#candidate-lifecycle-unit-tests"}},[e._v("#")]),e._v(" Candidate lifecycle unit tests")]),e._v(" "),t("p",[e._v("You added functions to set and get candidates from the transient store. You ought to add unit tests to confirm this works as expected.")]),e._v(" "),t("p",[e._v("First, you need to make sure that your test keeper has a valid transient store:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIGZ1bmMgTGVhZGVyYm9hcmRLZWVwZXIodCB0ZXN0aW5nLlRCKSAoKmtlZXBlci5LZWVwZXIsIHNkay5Db250ZXh0KSB7CiAgICAgICAgc3RvcmVLZXkgOj0gc2RrLk5ld0tWU3RvcmVLZXkodHlwZXMuU3RvcmVLZXkpCiAgICAgICAgbWVtU3RvcmVLZXkgOj0gc3RvcmV0eXBlcy5OZXdNZW1vcnlTdG9yZUtleSh0eXBlcy5NZW1TdG9yZUtleSkKKyAgICAgIHRTdG9yZUtleSA6PSBzdG9yZXR5cGVzLk5ld1RyYW5zaWVudFN0b3JlS2V5KHR5cGVzLlRTdG9yZUtleSkKCiAgICAgICAgLi4uCiAgICAgICAgc3RhdGVTdG9yZS5Nb3VudFN0b3JlV2l0aERCKG1lbVN0b3JlS2V5LCBzZGsuU3RvcmVUeXBlTWVtb3J5LCBuaWwpCisgICAgICBzdGF0ZVN0b3JlLk1vdW50U3RvcmVXaXRoREIodFN0b3JlS2V5LCBzZGsuU3RvcmVUeXBlVHJhbnNpZW50LCBuaWwpCiAgICAgICAgcmVxdWlyZS5Ob0Vycm9yKHQsIHN0YXRlU3RvcmUuTG9hZExhdGVzdFZlcnNpb24oKSkKCiAgICAgICAgLi4uCiAgICAgICAgayA6PSBrZWVwZXIuTmV3S2VlcGVyKAogICAgICAgICAgICBjZGMsCiAgICAgICAgICAgIHN0b3JlS2V5LAogICAgICAgICAgICBtZW1TdG9yZUtleSwKKyAgICAgICAgICB0U3RvcmVLZXksCiAgICAgICAgICAgIHBhcmFtc1N1YnNwYWNlLAogICAgICAgICkKICAgICAgICAuLi4KICAgIH0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-handling/testutil/keeper/leaderboard.go#L23-L45"}}),e._v(" "),t("p",[e._v("With this preparation, you can add simple tests. For example, that you get back "),t("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-handling/x/leaderboard/keeper/candidate_test.go#L20-L39",target:"_blank",rel:"noopener noreferrer"}},[e._v("one candidate"),t("OutboundLink")],1),e._v(" when there is one, or three when there are three:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBUZXN0U2V0QW5kR2V0VGhyZWVDYW5kaWRhdGVzKHQgKnRlc3RpbmcuVCkgewogICAga2VlcGVyLCBjdHggOj0ga2VlcGVydGVzdC5MZWFkZXJib2FyZEtlZXBlcih0KQogICAgYWxpY2VBZGRyZXNzLCBlcnIgOj0gc2RrLkFjY0FkZHJlc3NGcm9tQmVjaDMyKGFsaWNlKQogICAgcmVxdWlyZS5OaWwodCwgZXJyKQogICAgYm9iQWRkcmVzcywgZXJyIDo9IHNkay5BY2NBZGRyZXNzRnJvbUJlY2gzMihib2IpCiAgICByZXF1aXJlLk5pbCh0LCBlcnIpCiAgICBjYXJvbEFkZHJlc3MsIGVyciA6PSBzZGsuQWNjQWRkcmVzc0Zyb21CZWNoMzIoY2Fyb2wpCiAgICByZXF1aXJlLk5pbCh0LCBlcnIpCgogICAga2VlcGVyLlNldENhbmRpZGF0ZShjdHgsIHR5cGVzLkNhbmRpZGF0ZXsKICAgICAgICBBZGRyZXNzOiAgYWxpY2VBZGRyZXNzLAogICAgICAgIFdvbkNvdW50OiAxMiwKICAgIH0pCiAgICBrZWVwZXIuU2V0Q2FuZGlkYXRlKGN0eCwgdHlwZXMuQ2FuZGlkYXRlewogICAgICAgIEFkZHJlc3M6ICBib2JBZGRyZXNzLAogICAgICAgIFdvbkNvdW50OiAzNCwKICAgIH0pCiAgICBrZWVwZXIuU2V0Q2FuZGlkYXRlKGN0eCwgdHlwZXMuQ2FuZGlkYXRlewogICAgICAgIEFkZHJlc3M6ICBjYXJvbEFkZHJlc3MsCiAgICAgICAgV29uQ291bnQ6IDU2LAogICAgfSkKCiAgICBjYW5kaWRhdGVzIDo9IGtlZXBlci5HZXRBbGxDYW5kaWRhdGVzKGN0eCkKICAgIHJlcXVpcmUuTGVuKHQsIGNhbmRpZGF0ZXMsIDMpCiAgICBzb3J0LlNsaWNlU3RhYmxlKGNhbmRpZGF0ZXNbOl0sIGZ1bmMoaSwgaiBpbnQpIGJvb2wgewogICAgICAgIHJldHVybiBjYW5kaWRhdGVzW2ldLldvbkNvdW50ICZsdDsgY2FuZGlkYXRlc1tqXS5Xb25Db3VudAogICAgfSkKICAgIHJlcXVpcmUuRXF1YWwodCwKICAgICAgICBbXXR5cGVzLkNhbmRpZGF0ZXsKICAgICAgICAgICAge0FkZHJlc3M6IGFsaWNlQWRkcmVzcywgV29uQ291bnQ6IDEyfSwKICAgICAgICAgICAge0FkZHJlc3M6IGJvYkFkZHJlc3MsIFdvbkNvdW50OiAzNH0sCiAgICAgICAgICAgIHtBZGRyZXNzOiBjYXJvbEFkZHJlc3MsIFdvbkNvdW50OiA1Nn0sCiAgICAgICAgfSwKICAgICAgICBjYW5kaWRhdGVzLAogICAgKQp9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-handling/x/leaderboard/keeper/candidate_test.go#L41-L76"}}),e._v(" "),t("HighlightBox",{attrs:{type:"note"}},[t("p",[e._v("Note the small hack where the received candidates are sorted by "),t("code",[e._v("WonCount")]),e._v(". The "),t("code",[e._v("GetAllCandidates")]),e._v(" function does not ensure an order, so to be able to easily use "),t("code",[e._v("require.Equal")]),e._v(" an ordering was used.")])]),e._v(" "),t("h3",{attrs:{id:"leaderboard-handling-unit-tests"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#leaderboard-handling-unit-tests"}},[e._v("#")]),e._v(" Leaderboard handling unit tests")]),e._v(" "),t("p",[e._v("You can verify that the leaderboard is updated when the "),t("code",[e._v("keeper.CollectSortAndClipLeaderboard")]),e._v(" function is called.")]),e._v(" "),t("p",[e._v("To change the context time, you can use the SDK context's "),t("code",[e._v("WithBlockTime")]),e._v(" function. For instance, test when a single candidate is "),t("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-handling/x/leaderboard/keeper/end_block_leaderboard_handler_test.go#L13-L41",target:"_blank",rel:"noopener noreferrer"}},[e._v("added between two"),t("OutboundLink")],1),e._v(" existing winners. Or when one candidate replaces its lower score and another enters the leaderboard for the first time:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBUZXN0T25lUGxheWVyQWRkZWRBbmRPbmVVcGRhdGVkVG9MZWFkZXJib2FyZCh0ICp0ZXN0aW5nLlQpIHsKICAgIGtlZXBlciwgY3R4IDo9IGtlZXBlcnRlc3QuTGVhZGVyYm9hcmRLZWVwZXIodCkKICAgIGtlZXBlci5TZXRMZWFkZXJib2FyZChjdHgsIHR5cGVzLkxlYWRlcmJvYXJkewogICAgICAgIFdpbm5lcnM6IFtddHlwZXMuV2lubmVyewogICAgICAgICAgICB7QWRkcmVzczogYWxpY2UsIFdvbkNvdW50OiAxMiwgQWRkZWRBdDogOTk5fSwKICAgICAgICAgICAge0FkZHJlc3M6IGJvYiwgV29uQ291bnQ6IDEwLCBBZGRlZEF0OiA5OTl9LAogICAgICAgIH0sCiAgICB9KQogICAgYm9iQWRkcmVzcywgZXJyIDo9IHNkay5BY2NBZGRyZXNzRnJvbUJlY2gzMihib2IpCiAgICByZXF1aXJlLk5pbCh0LCBlcnIpCiAgICBjYXJvbEFkZHJlc3MsIGVyciA6PSBzZGsuQWNjQWRkcmVzc0Zyb21CZWNoMzIoY2Fyb2wpCiAgICByZXF1aXJlLk5pbCh0LCBlcnIpCiAgICBrZWVwZXIuU2V0Q2FuZGlkYXRlKGN0eCwgdHlwZXMuQ2FuZGlkYXRlewogICAgICAgIEFkZHJlc3M6ICBib2JBZGRyZXNzLAogICAgICAgIFdvbkNvdW50OiAxMywKICAgIH0pCiAgICBrZWVwZXIuU2V0Q2FuZGlkYXRlKGN0eCwgdHlwZXMuQ2FuZGlkYXRlewogICAgICAgIEFkZHJlc3M6ICBjYXJvbEFkZHJlc3MsCiAgICAgICAgV29uQ291bnQ6IDEyLAogICAgfSkKCiAgICBib2JUaW1lIDo9IHRpbWUuVW5peCgxMDAwLCAwKQogICAga2VlcGVyLkNvbGxlY3RTb3J0QW5kQ2xpcExlYWRlcmJvYXJkKGN0eC5XaXRoQmxvY2tUaW1lKGJvYlRpbWUpKQoKICAgIGxlYWRlcmJvYXJkIDo9IGtlZXBlci5HZXRMZWFkZXJib2FyZChjdHgpCiAgICByZXF1aXJlLkxlbih0LCBsZWFkZXJib2FyZC5XaW5uZXJzLCAzKQogICAgcmVxdWlyZS5FcXVhbCh0LAogICAgICAgIFtddHlwZXMuV2lubmVyewogICAgICAgICAgICB7QWRkcmVzczogYm9iLCBXb25Db3VudDogMTMsIEFkZGVkQXQ6IDEwMDB9LAogICAgICAgICAgICB7QWRkcmVzczogY2Fyb2wsIFdvbkNvdW50OiAxMiwgQWRkZWRBdDogMTAwMH0sCiAgICAgICAgICAgIHtBZGRyZXNzOiBhbGljZSwgV29uQ291bnQ6IDEyLCBBZGRlZEF0OiA5OTl9LAogICAgICAgIH0sCiAgICAgICAgbGVhZGVyYm9hcmQuV2lubmVycywKICAgICkKfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-handling/x/leaderboard/keeper/end_block_leaderboard_handler_test.go#L43-L76"}}),e._v(" "),t("p",[e._v("Where:")]),e._v(" "),t("ul",[t("li",[e._v("You put a leaderboard in storage.")]),e._v(" "),t("li",[e._v("Put candidates in the transient storage.")]),e._v(" "),t("li",[e._v("Call the collection of candidates.")]),e._v(" "),t("li",[e._v("Confirm the new leaderboard order and values.")])]),e._v(" "),t("p",[e._v("You can also add a test that confirms the leaderboard is clipped at the maximum length:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBUZXN0T25lUGxheWVyS2lja3NQbGF5ZXJPdXRPZkxlYWRlcmJvYXJkKHQgKnRlc3RpbmcuVCkgewogICAga2VlcGVyLCBjdHggOj0ga2VlcGVydGVzdC5MZWFkZXJib2FyZEtlZXBlcih0KQogICAga2VlcGVyLlNldExlYWRlcmJvYXJkKGN0eCwgdHlwZXMuTGVhZGVyYm9hcmR7CiAgICAgICAgV2lubmVyczogW110eXBlcy5XaW5uZXJ7CiAgICAgICAgICAgIHtBZGRyZXNzOiBhbGljZSwgV29uQ291bnQ6IDEyLCBBZGRlZEF0OiA5OTl9LAogICAgICAgICAgICB7QWRkcmVzczogYm9iLCBXb25Db3VudDogMTAsIEFkZGVkQXQ6IDk5OX0sCiAgICAgICAgfSwKICAgIH0pCiAgICBwYXJhbXMgOj0ga2VlcGVyLkdldFBhcmFtcyhjdHgpCiAgICBwYXJhbXMuTGVuZ3RoID0gMgogICAga2VlcGVyLlNldFBhcmFtcyhjdHgsIHBhcmFtcykKICAgIGNhcm9sQWRkcmVzcywgZXJyIDo9IHNkay5BY2NBZGRyZXNzRnJvbUJlY2gzMihjYXJvbCkKICAgIHJlcXVpcmUuTmlsKHQsIGVycikKICAgIGtlZXBlci5TZXRDYW5kaWRhdGUoY3R4LCB0eXBlcy5DYW5kaWRhdGV7CiAgICAgICAgQWRkcmVzczogIGNhcm9sQWRkcmVzcywKICAgICAgICBXb25Db3VudDogMTEsCiAgICB9KQogICAgY2Fyb2xUaW1lIDo9IHRpbWUuVW5peCgxMDAwLCAwKQogICAga2VlcGVyLkNvbGxlY3RTb3J0QW5kQ2xpcExlYWRlcmJvYXJkKGN0eC5XaXRoQmxvY2tUaW1lKGNhcm9sVGltZSkpCgogICAgbGVhZGVyYm9hcmQgOj0ga2VlcGVyLkdldExlYWRlcmJvYXJkKGN0eCkKICAgIHJlcXVpcmUuTGVuKHQsIGxlYWRlcmJvYXJkLldpbm5lcnMsIDIpCiAgICByZXF1aXJlLkVxdWFsKHQsCiAgICAgICAgW110eXBlcy5XaW5uZXJ7CiAgICAgICAgICAgIHtBZGRyZXNzOiBhbGljZSwgV29uQ291bnQ6IDEyLCBBZGRlZEF0OiA5OTl9LAogICAgICAgICAgICB7QWRkcmVzczogY2Fyb2wsIFdvbkNvdW50OiAxMSwgQWRkZWRBdDogMTAwMH0sCiAgICAgICAgfSwKICAgICAgICBsZWFkZXJib2FyZC5XaW5uZXJzLAogICAgKQp9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-handling/x/leaderboard/keeper/end_block_leaderboard_handler_test.go#L78-L108"}}),e._v(" "),t("p",[e._v("Where "),t("code",[e._v("carol")]),e._v(" kicked "),t("code",[e._v("bob")]),e._v(" out of the leaderboard since its length was enforced at "),t("code",[e._v("2")]),e._v(":")]),e._v(" "),t("h3",{attrs:{id:"hook-unit-tests-on-leaderboard"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#hook-unit-tests-on-leaderboard"}},[e._v("#")]),e._v(" Hook unit tests on leaderboard")]),e._v(" "),t("p",[e._v("Moving to the hooks "),t("em",[e._v("on the leaderboard module's side")]),e._v(", you want to confirm that candidates are added to the transient store when the keeper receives a new update:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBUZXN0T25lQ2FuZGlkYXRlQWRkZWQodCAqdGVzdGluZy5UKSB7CiAgICBrZWVwZXIsIGN0eCA6PSBrZWVwZXJ0ZXN0LkxlYWRlcmJvYXJkS2VlcGVyKHQpCiAgICBrZWVwZXIuSG9va3MoKS5BZnRlclBsYXllckluZm9DaGFuZ2VkKGN0eCwgY2hlY2tlcnN0eXBlcy5QbGF5ZXJJbmZvewogICAgICAgIEluZGV4OiAgICAgICAgICBhbGljZSwKICAgICAgICBXb25Db3VudDogICAgICAgMTIsCiAgICAgICAgTG9zdENvdW50OiAgICAgIDEzLAogICAgICAgIEZvcmZlaXRlZENvdW50OiAxNCwKICAgIH0pCgogICAgYWxpY2VBZGRyZXNzLCBlcnIgOj0gc2RrLkFjY0FkZHJlc3NGcm9tQmVjaDMyKGFsaWNlKQogICAgcmVxdWlyZS5OaWwodCwgZXJyKQogICAgY2FuZGlkYXRlcyA6PSBrZWVwZXIuR2V0QWxsQ2FuZGlkYXRlcyhjdHgpCiAgICByZXF1aXJlLkxlbih0LCBjYW5kaWRhdGVzLCAxKQogICAgcmVxdWlyZS5FcXVhbCh0LAogICAgICAgIHR5cGVzLkNhbmRpZGF0ZXtBZGRyZXNzOiBhbGljZUFkZHJlc3MsIFdvbkNvdW50OiAxMn0sCiAgICAgICAgY2FuZGlkYXRlc1swXSwKICAgICkKfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-handling/x/leaderboard/keeper/hooks_checkers_test.go#L14-L31"}}),e._v(" "),t("p",[e._v("Confirm also that it overwrites when it receives "),t("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-handling/x/leaderboard/keeper/hooks_checkers_test.go#L33-L56",target:"_blank",rel:"noopener noreferrer"}},[e._v("an update for the same address"),t("OutboundLink")],1),e._v(", or adds a second candidate "),t("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-handling/x/leaderboard/keeper/hooks_checkers_test.go#L58-L84",target:"_blank",rel:"noopener noreferrer"}},[e._v("alongside an existing one"),t("OutboundLink")],1),e._v(".")]),e._v(" "),t("h3",{attrs:{id:"hook-unit-tests-on-checkers"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#hook-unit-tests-on-checkers"}},[e._v("#")]),e._v(" Hook unit tests on checkers")]),e._v(" "),t("p",[e._v("You introduced a new type, the "),t("code",[e._v("MultiHook")]),e._v(". You should test that it indeed distributes calls to the elements of the list. This calls for a mock of the "),t("code",[e._v("CheckersHooks")]),e._v(" expected interface.")]),e._v(" "),t("p",[e._v("Run again your "),t("RouterLink",{attrs:{to:"/hands-on-exercise/2-ignite-cli-adv/6-payment-winning.html"}},[e._v("existing script")]),e._v(" that rebuilds all the mocks.")],1),e._v(" "),t("CodeGroup",[t("CodeGroupItem",{attrs:{title:"Local",active:""}},[t("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBtYWtlIG1vY2stZXhwZWN0ZWQta2VlcGVycwo="}})],1),e._v(" "),t("CodeGroupItem",{attrs:{title:"Docker"}},[t("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IFwKICAgIC12ICQocHdkKTovY2hlY2tlcnMgXAogICAgLXcgL2NoZWNrZXJzIFwKICAgIGNoZWNrZXJzX2kgXAogICAgbWFrZSBtb2NrLWV4cGVjdGVkLWtlZXBlcnMK"}})],1)],1),e._v(" "),t("p",[e._v("With that, you can add a test that confirms a multihook with two hooks calls both in order:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBUZXN0TXVsdGlIb29rQ2FsbHNUaGVtKHQgKnRlc3RpbmcuVCkgewogICAgY3RybCA6PSBnb21vY2suTmV3Q29udHJvbGxlcih0KQogICAgZGVmZXIgY3RybC5GaW5pc2goKQogICAgaG9vazEgOj0gdGVzdHV0aWwuTmV3TW9ja0NoZWNrZXJzSG9va3MoY3RybCkKICAgIGhvb2syIDo9IHRlc3R1dGlsLk5ld01vY2tDaGVja2Vyc0hvb2tzKGN0cmwpCiAgICBjYWxsMSA6PSBob29rMS5FWFBFQ1QoKS5BZnRlclBsYXllckluZm9DaGFuZ2VkKGdvbW9jay5BbnkoKSwgdHlwZXMuUGxheWVySW5mb3sKICAgICAgICBJbmRleDogICAgICAgICAgJnF1b3Q7YWxpY2UmcXVvdDssCiAgICAgICAgV29uQ291bnQ6ICAgICAgIDEsCiAgICAgICAgTG9zdENvdW50OiAgICAgIDIsCiAgICAgICAgRm9yZmVpdGVkQ291bnQ6IDMsCiAgICB9KS5UaW1lcygxKQogICAgaG9vazIuRVhQRUNUKCkuQWZ0ZXJQbGF5ZXJJbmZvQ2hhbmdlZChnb21vY2suQW55KCksIHR5cGVzLlBsYXllckluZm97CiAgICAgICAgSW5kZXg6ICAgICAgICAgICZxdW90O2FsaWNlJnF1b3Q7LAogICAgICAgIFdvbkNvdW50OiAgICAgICAxLAogICAgICAgIExvc3RDb3VudDogICAgICAyLAogICAgICAgIEZvcmZlaXRlZENvdW50OiAzLAogICAgfSkuVGltZXMoMSkuQWZ0ZXIoY2FsbDEpCgogICAgbXVsdGkgOj0gdHlwZXMuTmV3TXVsdGlDaGVja2Vyc0hvb2tzKGhvb2sxLCBob29rMikKICAgIG11bHRpLkFmdGVyUGxheWVySW5mb0NoYW5nZWQoc2RrLk5ld0NvbnRleHQobmlsLCB0bXByb3RvLkhlYWRlcnt9LCBmYWxzZSwgbmlsKSwgdHlwZXMuUGxheWVySW5mb3sKICAgICAgICBJbmRleDogICAgICAgICAgJnF1b3Q7YWxpY2UmcXVvdDssCiAgICAgICAgV29uQ291bnQ6ICAgICAgIDEsCiAgICAgICAgTG9zdENvdW50OiAgICAgIDIsCiAgICAgICAgRm9yZmVpdGVkQ291bnQ6IDMsCiAgICB9KQp9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-handling/x/checkers/types/hooks_test.go#L13-L38"}}),e._v(" "),t("p",[e._v("Your existing checkers keeper tests should still be passing.")]),e._v(" "),t("p",[e._v("However, there is a small difficulty that would not surface immediately: when you set the hooks after the "),t("code",[e._v("msgServer")]),e._v(" has been created, because it takes a keeper instance and not a pointer, the "),t("code",[e._v("msgServer")]),e._v(" is created with the "),t("em",[e._v("old")]),e._v(" keeper (the one before the hooks were set).")]),e._v(" "),t("p",[e._v("Therefore, add a setup function that encapsulates the knowledge to circumvent this difficulty:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBzZXR1cE1zZ1NlcnZlcldpdGhPbmVHYW1lRm9yUGxheU1vdmVBbmRIb29rcyh0IHRlc3RpbmcuVEIpICh0eXBlcy5Nc2dTZXJ2ZXIsIGtlZXBlci5LZWVwZXIsIGNvbnRleHQuQ29udGV4dCwKICAgICpnb21vY2suQ29udHJvbGxlciwgKnRlc3R1dGlsLk1vY2tCYW5rRXNjcm93S2VlcGVyLCAqdGVzdHV0aWwuTW9ja0NoZWNrZXJzSG9va3MpIHsKICAgIG1zZ1NlcnZlciwgaywgY29udGV4dCwgY3RybCwgZXNjcm93IDo9IHNldHVwTXNnU2VydmVyV2l0aE9uZUdhbWVGb3JQbGF5TW92ZSh0KQogICAgaG9va01vY2sgOj0gdGVzdHV0aWwuTmV3TW9ja0NoZWNrZXJzSG9va3MoY3RybCkKICAgIGsuU2V0SG9va3MoaG9va01vY2spCiAgICBtc2dTZXJ2ZXIgPSBrZWVwZXIuTmV3TXNnU2VydmVySW1wbChrKQogICAgcmV0dXJuIG1zZ1NlcnZlciwgaywgY29udGV4dCwgY3RybCwgZXNjcm93LCBob29rTW9jawp9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-handling/x/checkers/keeper/msg_server_play_move_test.go#L35-L42"}}),e._v(" "),t("p",[e._v("You can now add a test that confirms that a game just played does not trigger a call to the hooks:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBUZXN0UGxheWVySW5mb05vSG9va09uTm9XaW5uZXIodCAqdGVzdGluZy5UKSB7Cgltc2dTZXJ2ZXIsIGtlZXBlciwgY29udGV4dCwgY3RybCwgZXNjcm93LCBfIDo9IHNldHVwTXNnU2VydmVyV2l0aE9uZUdhbWVGb3JQbGF5TW92ZUFuZEhvb2tzKHQpCiAgICBjdHggOj0gc2RrLlVud3JhcFNES0NvbnRleHQoY29udGV4dCkKICAgIGRlZmVyIGN0cmwuRmluaXNoKCkKICAgIGVzY3Jvdy5FeHBlY3RBbnkoY29udGV4dCkKICAgIGtlZXBlci5TZXRQbGF5ZXJJbmZvKGN0eCwgdHlwZXMuUGxheWVySW5mb3sKICAgICAgICBJbmRleDogYm9iLAogICAgfSkKICAgIGtlZXBlci5TZXRQbGF5ZXJJbmZvKGN0eCwgdHlwZXMuUGxheWVySW5mb3sKICAgICAgICBJbmRleDogY2Fyb2wsCiAgICB9KQogICAgbXNnU2VydmVyLlBsYXlNb3ZlKGNvbnRleHQsICZhbXA7dHlwZXMuTXNnUGxheU1vdmV7CiAgICAgICAgQ3JlYXRvcjogICBib2IsCiAgICAgICAgR2FtZUluZGV4OiAmcXVvdDsxJnF1b3Q7LAogICAgICAgIEZyb21YOiAgICAgMSwKICAgICAgICBGcm9tWTogICAgIDIsCiAgICAgICAgVG9YOiAgICAgICAyLAogICAgICAgIFRvWTogICAgICAgMywKICAgIH0pCn0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-handling/x/checkers/keeper/msg_server_play_move_test.go#L607-L626"}}),e._v(" "),t("p",[e._v("A more interesting addition is the confirmation that a listener is being called when a game is "),t("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-handling/x/checkers/keeper/end_block_server_game_test.go#L684-L737",target:"_blank",rel:"noopener noreferrer"}},[e._v("forfeited"),t("OutboundLink")],1),e._v(" or won:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBUZXN0Q29tcGxldGVHYW1lQ2FsbHNIb29rKHQgKnRlc3RpbmcuVCkgewoJbXNnU2VydmVyLCBrZWVwZXIsIGNvbnRleHQsIGN0cmwsIGVzY3JvdywgaG9va01vY2sgOj0gc2V0dXBNc2dTZXJ2ZXJXaXRoT25lR2FtZUZvclBsYXlNb3ZlQW5kSG9va3ModCkKCWN0eCA6PSBzZGsuVW53cmFwU0RLQ29udGV4dChjb250ZXh0KQogICAgZGVmZXIgY3RybC5GaW5pc2goKQogICAgZXNjcm93LkV4cGVjdEFueShjb250ZXh0KQogICAgYm9iQ2FsbCA6PSBob29rTW9jay5FWFBFQ1QoKS5BZnRlclBsYXllckluZm9DaGFuZ2VkKGN0eCwgdHlwZXMuUGxheWVySW5mb3sKICAgICAgICBJbmRleDogICAgICAgICAgYm9iLAogICAgICAgIFdvbkNvdW50OiAgICAgICAyLAogICAgICAgIExvc3RDb3VudDogICAgICAyLAogICAgICAgIEZvcmZlaXRlZENvdW50OiAzLAogICAgfSkuVGltZXMoMSkKICAgIGhvb2tNb2NrLkVYUEVDVCgpLkFmdGVyUGxheWVySW5mb0NoYW5nZWQoY3R4LCB0eXBlcy5QbGF5ZXJJbmZvewogICAgICAgIEluZGV4OiAgICAgICAgICBjYXJvbCwKICAgICAgICBXb25Db3VudDogICAgICAgNCwKICAgICAgICBMb3N0Q291bnQ6ICAgICAgNiwKICAgICAgICBGb3JmZWl0ZWRDb3VudDogNiwKICAgIH0pLlRpbWVzKDEpLkFmdGVyKGJvYkNhbGwpCgogICAga2VlcGVyLlNldFBsYXllckluZm8oY3R4LCB0eXBlcy5QbGF5ZXJJbmZvewogICAgICAgIEluZGV4OiAgICAgICAgICBib2IsCiAgICAgICAgV29uQ291bnQ6ICAgICAgIDEsCiAgICAgICAgTG9zdENvdW50OiAgICAgIDIsCiAgICAgICAgRm9yZmVpdGVkQ291bnQ6IDMsCiAgICB9KQogICAga2VlcGVyLlNldFBsYXllckluZm8oY3R4LCB0eXBlcy5QbGF5ZXJJbmZvewogICAgICAgIEluZGV4OiAgICAgICAgICBjYXJvbCwKICAgICAgICBXb25Db3VudDogICAgICAgNCwKICAgICAgICBMb3N0Q291bnQ6ICAgICAgNSwKICAgICAgICBGb3JmZWl0ZWRDb3VudDogNiwKICAgIH0pCgogICAgdGVzdHV0aWwuUGxheUFsbE1vdmVzKHQsIG1zZ1NlcnZlciwgY29udGV4dCwgJnF1b3Q7MSZxdW90OywgYm9iLCBjYXJvbCwgdGVzdHV0aWwuR2FtZTFNb3ZlcykKfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-handling/x/checkers/keeper/msg_server_play_move_winner_test.go#L133-L165"}}),e._v(" "),t("h2",{attrs:{id:"integration-tests"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#integration-tests"}},[e._v("#")]),e._v(" Integration tests")]),e._v(" "),t("p",[e._v("To further confirm that your code is working correctly you can add integration tests. Since it starts an app, the hooks are already set up.")]),e._v(" "),t("p",[e._v('You could decide to piggy-back on the existing "checkers" integration tests. However, for the sake of clarity, create a separate folder:')]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBta2RpciAtcCB0ZXN0cy9pbnRlZ3JhdGlvbi9sZWFkZXJib2FyZC9rZWVwZXIK"}}),e._v(" "),t("p",[e._v("Copy the integration test suite from the checkers integration tests, with adjusted imports and others, minus all the balances and denoms. Keep the "),t("code",[e._v("msgServer")]),e._v(", as that is the one that receives messages:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Y29uc3QgKAogICAgYWxpY2UgPSB0ZXN0dXRpbC5BbGljZQogICAgYm9iICAgPSB0ZXN0dXRpbC5Cb2IKICAgIGNhcm9sID0gdGVzdHV0aWwuQ2Fyb2wKKQoKdHlwZSBJbnRlZ3JhdGlvblRlc3RTdWl0ZSBzdHJ1Y3QgewogICAgc3VpdGUuU3VpdGUKCiAgICBhcHAgICAgICAgICAqY2hlY2tlcnNhcHAuQXBwCiAgICBtc2dTZXJ2ZXIgICBjaGVja2Vyc3R5cGVzLk1zZ1NlcnZlcgogICAgY3R4ICAgICAgICAgc2RrLkNvbnRleHQKICAgIHF1ZXJ5Q2xpZW50IHR5cGVzLlF1ZXJ5Q2xpZW50Cn0KCmZ1bmMgVGVzdExlYWRlcmJvYXJkS2VlcGVyVGVzdFN1aXRlKHQgKnRlc3RpbmcuVCkgewogICAgc3VpdGUuUnVuKHQsIG5ldyhJbnRlZ3JhdGlvblRlc3RTdWl0ZSkpCn0KCmZ1bmMgKHN1aXRlICpJbnRlZ3JhdGlvblRlc3RTdWl0ZSkgU2V0dXBUZXN0KCkgewogICAgYXBwIDo9IGNoZWNrZXJzYXBwLlNldHVwKGZhbHNlKQogICAgY3R4IDo9IGFwcC5CYXNlQXBwLk5ld0NvbnRleHQoZmFsc2UsIHRtcHJvdG8uSGVhZGVye1RpbWU6IHRpbWUuTm93KCl9KQoKICAgIGFwcC5BY2NvdW50S2VlcGVyLlNldFBhcmFtcyhjdHgsIGF1dGh0eXBlcy5EZWZhdWx0UGFyYW1zKCkpCiAgICBhcHAuQmFua0tlZXBlci5TZXRQYXJhbXMoY3R4LCBiYW5rdHlwZXMuRGVmYXVsdFBhcmFtcygpKQoKICAgIHF1ZXJ5SGVscGVyIDo9IGJhc2VhcHAuTmV3UXVlcnlTZXJ2ZXJUZXN0SGVscGVyKGN0eCwgYXBwLkludGVyZmFjZVJlZ2lzdHJ5KCkpCiAgICB0eXBlcy5SZWdpc3RlclF1ZXJ5U2VydmVyKHF1ZXJ5SGVscGVyLCBhcHAuTGVhZGVyYm9hcmRLZWVwZXIpCiAgICBxdWVyeUNsaWVudCA6PSB0eXBlcy5OZXdRdWVyeUNsaWVudChxdWVyeUhlbHBlcikKCiAgICBzdWl0ZS5hcHAgPSBhcHAKICAgIHN1aXRlLm1zZ1NlcnZlciA9IGNoZWNrZXJza2VlcGVyLk5ld01zZ1NlcnZlckltcGwoYXBwLkNoZWNrZXJzS2VlcGVyKQogICAgc3VpdGUuY3R4ID0gY3R4CiAgICBzdWl0ZS5xdWVyeUNsaWVudCA9IHF1ZXJ5Q2xpZW50Cn0K"}}),e._v(" "),t("p",[e._v("You can confirm the leaderboard is called when a game is won:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAoc3VpdGUgKkludGVncmF0aW9uVGVzdFN1aXRlKSBzZXR1cFN1aXRlV2l0aE9uZUdhbWVGb3JQbGF5TW92ZSgpIHsKICAgIGdvQ3R4IDo9IHNkay5XcmFwU0RLQ29udGV4dChzdWl0ZS5jdHgpCiAgICBzdWl0ZS5tc2dTZXJ2ZXIuQ3JlYXRlR2FtZShnb0N0eCwgJmFtcDtjaGVja2Vyc3R5cGVzLk1zZ0NyZWF0ZUdhbWV7CiAgICAgICAgQ3JlYXRvcjogYWxpY2UsCiAgICAgICAgQmxhY2s6ICAgYm9iLAogICAgICAgIFJlZDogICAgIGNhcm9sLAogICAgICAgIFdhZ2VyOiAgIDAsCiAgICAgICAgRGVub206ICAgJnF1b3Q7c3Rha2UmcXVvdDssCiAgICB9KQp9CgpmdW5jIChzdWl0ZSAqSW50ZWdyYXRpb25UZXN0U3VpdGUpIFRlc3RQbGF5TW92ZVRvV2lubmVyQWRkZWRUb0xlYWRlcmJvYXJkKCkgewogICAgc3VpdGUuc2V0dXBTdWl0ZVdpdGhPbmVHYW1lRm9yUGxheU1vdmUoKQogICAgc3VpdGUuYXBwLkNoZWNrZXJzS2VlcGVyLlNldFBsYXllckluZm8oc3VpdGUuY3R4LCBjaGVja2Vyc3R5cGVzLlBsYXllckluZm97CiAgICAgICAgSW5kZXg6IGFsaWNlLCBXb25Db3VudDogMTAsCiAgICB9KQogICAgc3VpdGUuYXBwLkNoZWNrZXJzS2VlcGVyLlNldFBsYXllckluZm8oc3VpdGUuY3R4LCBjaGVja2Vyc3R5cGVzLlBsYXllckluZm97CiAgICAgICAgSW5kZXg6IGJvYiwgV29uQ291bnQ6IDEwLAogICAgfSkKICAgIHN1aXRlLmFwcC5MZWFkZXJib2FyZEtlZXBlci5TZXRMZWFkZXJib2FyZChzdWl0ZS5jdHgsIGxlYWRlcmJvYXJkdHlwZXMuTGVhZGVyYm9hcmR7CiAgICAgICAgV2lubmVyczogW11sZWFkZXJib2FyZHR5cGVzLldpbm5lcnsKICAgICAgICAgICAge0FkZHJlc3M6IGFsaWNlLCBXb25Db3VudDogMTAsIEFkZGVkQXQ6IDEwMDB9LAogICAgICAgICAgICB7QWRkcmVzczogYm9iLCBXb25Db3VudDogMTAsIEFkZGVkQXQ6IDk5OX0sCiAgICAgICAgfSwKICAgIH0pCiAgICB0ZXN0dXRpbC5QbGF5QWxsTW92ZXMoc3VpdGUuVCgpLCBzdWl0ZS5tc2dTZXJ2ZXIsIHNkay5XcmFwU0RLQ29udGV4dChzdWl0ZS5jdHgpLCAmcXVvdDsxJnF1b3Q7LCBib2IsIGNhcm9sLCB0ZXN0dXRpbC5HYW1lMU1vdmVzKQogICAgc3VpdGUuYXBwLkxlYWRlcmJvYXJkS2VlcGVyLkNvbGxlY3RTb3J0QW5kQ2xpcExlYWRlcmJvYXJkKHN1aXRlLmN0eCkKICAgIGxlYWRlcmJvYXJkIDo9IHN1aXRlLmFwcC5MZWFkZXJib2FyZEtlZXBlci5HZXRMZWFkZXJib2FyZChzdWl0ZS5jdHgpCiAgICBzdWl0ZS5SZXF1aXJlKCkuRXF1YWxWYWx1ZXMoCiAgICAgICAgW11sZWFkZXJib2FyZHR5cGVzLldpbm5lcnsKICAgICAgICAgICAge0FkZHJlc3M6IGJvYiwgV29uQ291bnQ6IDExLCBBZGRlZEF0OiB1aW50NjQoc3VpdGUuY3R4LkJsb2NrVGltZSgpLlVuaXgoKSl9LAogICAgICAgICAgICB7QWRkcmVzczogYWxpY2UsIFdvbkNvdW50OiAxMCwgQWRkZWRBdDogMTAwMH0sCiAgICAgICAgfSwKICAgICAgICBsZWFkZXJib2FyZC5XaW5uZXJzKQp9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-handling/tests/integration/leaderboard/keeper/msg_server_play_move_test.go"}}),e._v(" "),t("p",[e._v("Or when a game is expired:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAoc3VpdGUgKkludGVncmF0aW9uVGVzdFN1aXRlKSBUZXN0Rm9yZmVpdFBsYXllZFR3aWNlQ2FsbGVkSG9va3MoKSB7CiAgICBzdWl0ZS5zZXR1cFN1aXRlV2l0aE9uZUdhbWVGb3JQbGF5TW92ZSgpCiAgICBnb0N0eCA6PSBzZGsuV3JhcFNES0NvbnRleHQoc3VpdGUuY3R4KQogICAgc3VpdGUubXNnU2VydmVyLlBsYXlNb3ZlKGdvQ3R4LCAmYW1wO3R5cGVzLk1zZ1BsYXlNb3ZlewogICAgICAgIENyZWF0b3I6ICAgYm9iLAogICAgICAgIEdhbWVJbmRleDogJnF1b3Q7MSZxdW90OywKICAgICAgICBGcm9tWDogICAgIDEsCiAgICAgICAgRnJvbVk6ICAgICAyLAogICAgICAgIFRvWDogICAgICAgMiwKICAgICAgICBUb1k6ICAgICAgIDMsCiAgICB9KQogICAgc3VpdGUubXNnU2VydmVyLlBsYXlNb3ZlKGdvQ3R4LCAmYW1wO3R5cGVzLk1zZ1BsYXlNb3ZlewogICAgICAgIENyZWF0b3I6ICAgY2Fyb2wsCiAgICAgICAgR2FtZUluZGV4OiAmcXVvdDsxJnF1b3Q7LAogICAgICAgIEZyb21YOiAgICAgMCwKICAgICAgICBGcm9tWTogICAgIDUsCiAgICAgICAgVG9YOiAgICAgICAxLAogICAgICAgIFRvWTogICAgICAgNCwKICAgIH0pCiAgICBrZWVwZXIgOj0gc3VpdGUuYXBwLkNoZWNrZXJzS2VlcGVyCiAgICBrZWVwZXIuU2V0UGxheWVySW5mbyhzdWl0ZS5jdHgsIHR5cGVzLlBsYXllckluZm97CiAgICAgICAgSW5kZXg6IGJvYiwgV29uQ291bnQ6IDEwLAogICAgfSkKICAgIGtlZXBlci5TZXRQbGF5ZXJJbmZvKHN1aXRlLmN0eCwgdHlwZXMuUGxheWVySW5mb3sKICAgICAgICBJbmRleDogY2Fyb2wsIFdvbkNvdW50OiAxMCwKICAgIH0pCiAgICBzdWl0ZS5hcHAuTGVhZGVyYm9hcmRLZWVwZXIuU2V0TGVhZGVyYm9hcmQoc3VpdGUuY3R4LCBsZWFkZXJib2FyZHR5cGVzLkxlYWRlcmJvYXJkewogICAgICAgIFdpbm5lcnM6IFtdbGVhZGVyYm9hcmR0eXBlcy5XaW5uZXJ7CiAgICAgICAgICAgIHtBZGRyZXNzOiBib2IsIFdvbkNvdW50OiAxMCwgQWRkZWRBdDogMTAwMH0sCiAgICAgICAgICAgIHtBZGRyZXNzOiBjYXJvbCwgV29uQ291bnQ6IDEwLCBBZGRlZEF0OiA5OTl9LAogICAgICAgIH0sCiAgICB9KQogICAgZ2FtZTEsIGZvdW5kIDo9IGtlZXBlci5HZXRTdG9yZWRHYW1lKHN1aXRlLmN0eCwgJnF1b3Q7MSZxdW90OykKICAgIHN1aXRlLlJlcXVpcmUoKS5UcnVlKGZvdW5kKQogICAgb2xkRGVhZGxpbmUgOj0gdHlwZXMuRm9ybWF0RGVhZGxpbmUoc3VpdGUuY3R4LkJsb2NrVGltZSgpLkFkZCh0aW1lLkR1cmF0aW9uKC0xKSkpCiAgICBnYW1lMS5EZWFkbGluZSA9IG9sZERlYWRsaW5lCiAgICBrZWVwZXIuU2V0U3RvcmVkR2FtZShzdWl0ZS5jdHgsIGdhbWUxKQoKICAgIGtlZXBlci5Gb3JmZWl0RXhwaXJlZEdhbWVzKGdvQ3R4KQogICAgc3VpdGUuYXBwLkxlYWRlcmJvYXJkS2VlcGVyLkNvbGxlY3RTb3J0QW5kQ2xpcExlYWRlcmJvYXJkKHN1aXRlLmN0eCkKICAgIGxlYWRlcmJvYXJkIDo9IHN1aXRlLmFwcC5MZWFkZXJib2FyZEtlZXBlci5HZXRMZWFkZXJib2FyZChzdWl0ZS5jdHgpCiAgICBzdWl0ZS5SZXF1aXJlKCkuRXF1YWxWYWx1ZXMoCiAgICAgICAgW11sZWFkZXJib2FyZHR5cGVzLldpbm5lcnsKICAgICAgICAgICAge0FkZHJlc3M6IGNhcm9sLCBXb25Db3VudDogMTEsIEFkZGVkQXQ6IHVpbnQ2NChzdWl0ZS5jdHguQmxvY2tUaW1lKCkuVW5peCgpKX0sCiAgICAgICAgICAgIHtBZGRyZXNzOiBib2IsIFdvbkNvdW50OiAxMCwgQWRkZWRBdDogMTAwMH0sCiAgICAgICAgfSwKICAgICAgICBsZWFkZXJib2FyZC5XaW5uZXJzKQp9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-handling/tests/integration/leaderboard/keeper/end_block_server_game_test.go"}}),e._v(" "),t("p",[e._v("Note how you have to call both "),t("em",[e._v("end blockers")]),e._v(" because there are actually no blocks being produced. This recalls what you did previously when integration-testing the game forfeit.")]),e._v(" "),t("p",[e._v("This completes your checkers v2 chain. If you were to start it anew as is, it would work. If you want to see how you would migrate your blockchain if it were running v1.1, jump straight to the "),t("RouterLink",{attrs:{to:"/hands-on-exercise/4-run-in-prod/4-migration-leaderboard.html"}},[e._v("next section")]),e._v(".")],1),e._v(" "),t("h2",{attrs:{id:"interact-via-the-cli"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#interact-via-the-cli"}},[e._v("#")]),e._v(" Interact via the CLI")]),e._v(" "),t("p",[e._v("Your v2 blockchain is fully functioning. It will work as long as you start it from scratch (i.e. you should not try to migrate).")]),e._v(" "),t("p",[e._v("You should already know your way around testing this way. The simplest way is to use Ignite:")]),e._v(" "),t("CodeGroup",[t("CodeGroupItem",{attrs:{title:"Local",active:""}},[t("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBpZ25pdGUgY2hhaW4gc2VydmUgLS1yZXNldC1vbmNlCg=="}})],1),e._v(" "),t("CodeGroupItem",{attrs:{title:"Docker"}},[t("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgbmV0d29yayBjcmVhdGUgY2hlY2tlcnMtbmV0CiQgZG9ja2VyIHJ1biAtLXJtIC1pdCBcCiAgICAtdiAkKHB3ZCk6L2NoZWNrZXJzIC13IC9jaGVja2VycyBcCiAgICAtcCA0NTAwOjQ1MDAgLXAgMjY2NTc6MjY2NTcgXAogICAgLS1uZXR3b3JrIGNoZWNrZXJzLW5ldCBcCiAgICAtLW5hbWUgY2hlY2tlcnMgXAogICAgY2hlY2tlcnNfaSBcCiAgICBpZ25pdGUgY2hhaW4gc2VydmUgLS1yZXNldC1vbmNlCg=="}})],1)],1),e._v(" "),t("p",[e._v("Use your CosmJS integration tests to run a full game:")]),e._v(" "),t("CodeGroup",[t("CodeGroupItem",{attrs:{title:"Local",active:""}},[t("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBucG0gdGVzdCAtLXByZWZpeCBjbGllbnQK"}})],1),e._v(" "),t("CodeGroupItem",{attrs:{title:"Docker"}},[t("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IFwKICAgIC12ICQocHdkKS9jbGllbnQ6L2NsaWVudCAtdyAvY2xpZW50IFwKICAgIC0tbmV0d29yayBjaGVja2Vycy1uZXQgXAogICAgLS1lbnYgUlBDX1VSTD0mcXVvdDtodHRwOi8vY2hlY2tlcnM6MjY2NTcmcXVvdDsgXAogICAgbm9kZToxOC43LXNsaW0gXAogICAgbnBtIHRlc3QK"}})],1)],1),e._v(" "),t("hr"),e._v(" "),t("p",[e._v("After that, you can query your leaderboard:")]),e._v(" "),t("CodeGroup",[t("CodeGroupItem",{attrs:{title:"Local",active:""}},[t("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBjaGVja2Vyc2QgcXVlcnkgbGVhZGVyYm9hcmQgc2hvdy1sZWFkZXJib2FyZAo="}})],1),e._v(" "),t("CodeGroupItem",{attrs:{title:"Docker"}},[t("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtaXQgXAogICAgY2hlY2tlcnMgXAogICAgY2hlY2tlcnNkIHF1ZXJ5IGxlYWRlcmJvYXJkIHNob3ctbGVhZGVyYm9hcmQK"}})],1)],1),e._v(" "),t("p",[e._v("It should turn something like:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"yaml",base64:"TGVhZGVyYm9hcmQ6CiAgd2lubmVyczoKICAtIGFkZGVkQXQ6ICZxdW90OzE2ODIzNzM5ODImcXVvdDsKICAgIGFkZHJlc3M6IGNvc21vczFmeDZxbHh3dGVlcXhneHdzdzgzd2tmNHM5ZmNubndrOHo4NnNxbAogICAgd29uQ291bnQ6ICZxdW90OzEmcXVvdDsK"}}),e._v(" "),t("p",[e._v("Congratulations, your leaderboard is functional!")]),e._v(" "),t("p",[e._v("If you used Docker, you can stop the container and remove the network:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgbmV0d29yayBybSBjaGVja2Vycy1uZXQK"}}),e._v(" "),t("HighlightBox",{attrs:{type:"synopsis"}},[t("p",[e._v("To summarize, this section has explored:")]),e._v(" "),t("ul",[t("li",[e._v("How to add a leaderboard as a module to an existing blockchain, and the characteristics that a good leaderboard should boast.")]),e._v(" "),t("li",[e._v("How to keep modules loosely coupled, when possible, with the use of hooks.")]),e._v(" "),t("li",[e._v("How to leverage the transient store to save data for use in "),t("code",[e._v("EndBlock")]),e._v(".")]),e._v(" "),t("li",[e._v("How to reduce computations and overall blockchain burden by ordering the leaderboard only once per block, in "),t("code",[e._v("EndBlock")]),e._v(".")]),e._v(" "),t("li",[e._v("Worthwhile unit tests, including recreating the mocks, and integration tests.")])])])],1)}),[],!1,null,null,null);o.default=g.exports}}]);