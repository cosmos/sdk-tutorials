(window.webpackJsonp=window.webpackJsonp||[]).push([[148],{764:function(e,t,a){"use strict";a.r(t);var o=a(1),c=Object(o.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"migrate-the-leaderboard-module-after-production"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#migrate-the-leaderboard-module-after-production"}},[e._v("#")]),e._v(" Migrate the Leaderboard Module After Production")]),e._v(" "),a("HighlightBox",{attrs:{type:"prerequisite"}},[a("p",[e._v("Make sure you have all you need before proceeding:")]),e._v(" "),a("ul",[a("li",[e._v("You understand the concepts of "),a("RouterLink",{attrs:{to:"/academy/2-cosmos-concepts/6-protobuf.html"}},[e._v("Protobuf")]),e._v(", "),a("RouterLink",{attrs:{to:"/academy/2-cosmos-concepts/5-modules.html"}},[e._v("modules")]),e._v(", and "),a("RouterLink",{attrs:{to:"/academy/2-cosmos-concepts/16-migrations.html"}},[e._v("migrations")]),e._v(".")],1),e._v(" "),a("li",[e._v("Go is installed.")]),e._v(" "),a("li",[e._v("You have the checkers blockchain codebase up to the "),a("em",[e._v("Add a Leaderboard Module")]),e._v(". If not, follow the "),a("RouterLink",{attrs:{to:"/hands-on-exercise/4-run-in-prod/3-add-leaderboard.html"}},[e._v("previous steps")]),e._v(" or check out the "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/tree/leaderboard-handling",target:"_blank",rel:"noopener noreferrer"}},[e._v("relevant version"),a("OutboundLink")],1),e._v(".")],1)])]),e._v(" "),a("HighlightBox",{attrs:{type:"learning"}},[a("p",[e._v("In this section, you will:")]),e._v(" "),a("ul",[a("li",[e._v("Add the leaderboard module via migration.")]),e._v(" "),a("li",[e._v("Populate the module's genesis with a proper leaderboard.")])])]),e._v(" "),a("p",[e._v("In previous sections:")]),e._v(" "),a("ul",[a("li",[e._v("You added, and "),a("RouterLink",{attrs:{to:"/hands-on-exercise/4-run-in-prod/2-migration-info.html"}},[e._v("added a migration for")]),e._v(", a player info structure that tallies wins and losses per player. You called it v1.1.")],1),e._v(" "),a("li",[e._v("You added a "),a("RouterLink",{attrs:{to:"/hands-on-exercise/4-run-in-prod/3-add-leaderboard.html"}},[e._v("leaderboard module")]),e._v(", which exists only if you start a new blockchain from scratch. You called it v2.")],1)]),e._v(" "),a("p",[e._v("Here you will reuse some learnings from the v1.1 migration, and adjust them for the special case of a new module.")]),e._v(" "),a("h2",{attrs:{id:"high-level-considerations"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#high-level-considerations"}},[e._v("#")]),e._v(" High level considerations")]),e._v(" "),a("p",[e._v("Here the decision is to start your v2's leaderboard as if all played past games had been counted for the leaderboard. You "),a("em",[e._v("only")]),e._v(" need to go through all player information and add a leaderboard including the information. Migration is a good method to tackle the initial leaderboard.")]),e._v(" "),a("p",[e._v("For the avoidance of doubt, "),a("strong",[e._v("v1.1 and v2 refer to the overall versions of the application")]),e._v(", and not to the "),a("em",[e._v("consensus versions")]),e._v(" of individual modules, which may change or not.")]),e._v(" "),a("h2",{attrs:{id:"what-you-will-do"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#what-you-will-do"}},[e._v("#")]),e._v(" What you will do")]),e._v(" "),a("p",[e._v("To prepare for your v1.1-to-v2 migration, you will:")]),e._v(" "),a("ol",[a("li",[e._v("Add helper functions to process large amounts of data from the latest chain state of type v1.1.")]),e._v(" "),a("li",[e._v("Add a function to migrate your state from v1.1 to v2.")]),e._v(" "),a("li",[e._v("Make sure you can handle large amounts of data.")]),e._v(" "),a("li",[e._v("Put callbacks if necessary.")])]),e._v(" "),a("p",[a("em",[e._v("Why do you need to make sure you can handle large amounts of data?")]),e._v(" The full state at the point of migration may well have millions of players. You do not want your process to grind to a halt because of a lack of memory or I/O capacity.")]),e._v(" "),a("h2",{attrs:{id:"v1-1-to-v2-leaderboard-migration-helper"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#v1-1-to-v2-leaderboard-migration-helper"}},[e._v("#")]),e._v(" v1.1 to v2 leaderboard migration helper")]),e._v(" "),a("p",[e._v("In the migration, there are two time-consuming parts:")]),e._v(" "),a("ol",[a("li",[e._v("Fetching the stored player info records in a paginated way, consuming mostly database resources.")]),e._v(" "),a("li",[e._v("Sorting each intermediate leaderboard, consuming mostly computation resources.")])]),e._v(" "),a("p",[e._v("It looks beneficial to use Go routines in this case too, and to use a "),a("em",[e._v("player info")]),e._v(" channel to pass along arrays of player info records.")]),e._v(" "),a("p",[e._v("In practice, repeatedly building the intermediate leaderboard means adding "),a("em",[e._v("k")]),e._v(" new "),a("code",[e._v("Winner")]),e._v("s to the sorted array, sorting it, clipping it to "),a("code",[e._v("Params.Length")]),e._v(", and repeating. What constitutes a good "),a("em",[e._v("k")]),e._v(" value should be dictated by testing and performance measurements. However, you can start with your best guess in a new file created for this purpose.")]),e._v(" "),a("h3",{attrs:{id:"types-and-interfaces"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#types-and-interfaces"}},[e._v("#")]),e._v(" Types and interfaces")]),e._v(" "),a("p",[e._v("Where do you put this new file? The leaderboard module's consensus version starts at "),a("code",[e._v("2")]),e._v(". The application will go from "),a("em",[e._v("no leaderboard")]),e._v(" to "),a("em",[e._v("leaderboard at version 2")]),e._v(". So it makes sense to create a new folder to encapsulate this knowledge:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBta2RpciAtcCB4L2xlYWRlcmJvYXJkL21pZ3JhdGlvbnMvY3YyL3R5cGVzCg=="}}),e._v(" "),a("p",[e._v("Put your target "),a("em",[e._v("k")]),e._v(" length in:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Y29uc3QgKAogICAgUGxheWVySW5mb0NodW5rU2l6ZSA9IHR5cGVzLkRlZmF1bHRMZW5ndGggKiB1aW50NjQoMikKKQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-migration/x/leaderboard/migrations/cv2/types/keys.go#L6"}}),e._v(" "),a("p",[e._v("With a view to reusing the module's "),a("code",[e._v("Candidate")]),e._v(" types, you can add a convenience method to convert an array of "),a("code",[e._v("PlayerInfo")]),e._v(" to an array of "),a("code",[e._v("Candidate")]),e._v("s:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBNYWtlQ2FuZGlkYXRlc0Zyb21QbGF5ZXJJbmZvcyhwbGF5ZXJJbmZvcyBbXWNoZWNrZXJzdHlwZXMuUGxheWVySW5mbykgKGNhbmRpZGF0ZXMgW11DYW5kaWRhdGUsIGVyciBlcnJvcikgewogICAgY2FuZGlkYXRlcyA9IG1ha2UoW11DYW5kaWRhdGUsIDAsIGxlbihwbGF5ZXJJbmZvcykpCiAgICBmb3IgXywgcmVjZWl2ZWRJbmZvIDo9IHJhbmdlIHBsYXllckluZm9zIHsKICAgICAgICBjYW5kaWRhdGUsIGVyciA6PSBNYWtlQ2FuZGlkYXRlRnJvbVBsYXllckluZm8ocmVjZWl2ZWRJbmZvKQogICAgICAgIGlmIGVyciAhPSBuaWwgewogICAgICAgICAgICByZXR1cm4gbmlsLCBlcnIKICAgICAgICB9CiAgICAgICAgY2FuZGlkYXRlcyA9IGFwcGVuZChjYW5kaWRhdGVzLCBjYW5kaWRhdGUpCiAgICB9CiAgICByZXR1cm4gY2FuZGlkYXRlcywgbmlsCn0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-migration/x/leaderboard//types/leaderboard_checkers.go#L20-L30"}}),e._v(" "),a("h3",{attrs:{id:"playerinfo-extraction"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#playerinfo-extraction"}},[e._v("#")]),e._v(" "),a("code",[e._v("PlayerInfo")]),e._v(" extraction")]),e._v(" "),a("p",[e._v("To extract the "),a("code",[e._v("PlayerInfo")]),e._v(", you need access to a checkers keeper. More precisely, you only need access to its paginated "),a("code",[e._v("PlayerInfoAll")]),e._v(" function.")]),e._v(" "),a("p",[e._v("As usual, describe this dependency in "),a("code",[e._v("expected_keepers.go")]),e._v(":")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"dHlwZSBQbGF5ZXJJbmZvS2VlcGVyIGludGVyZmFjZSB7CiAgICBQbGF5ZXJJbmZvQWxsKGMgY29udGV4dC5Db250ZXh0LCByZXEgKmNoZWNrZXJzdHlwZXMuUXVlcnlBbGxQbGF5ZXJJbmZvUmVxdWVzdCkgKCpjaGVja2Vyc3R5cGVzLlF1ZXJ5QWxsUGxheWVySW5mb1Jlc3BvbnNlLCBlcnJvcikKfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-migration/x/leaderboard/types/expected_keepers.go#L23-L25"}}),e._v(" "),a("p",[e._v("Then put the migration-specific elements in a dedicated folder:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBta2RpciB4L2xlYWRlcmJvYXJkL21pZ3JhdGlvbnMvY3YyL2tlZXBlcgo="}}),e._v(" "),a("p",[e._v("Create the routine that fetches player info from the checkers storage:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"dHlwZSBQbGF5ZXJJbmZvc0NodW5rIHN0cnVjdCB7CiAgICBQbGF5ZXJJbmZvcyBbXWNoZWNrZXJzdHlwZXMuUGxheWVySW5mbwogICAgRXJyb3IgICAgICAgZXJyb3IKfQoKZnVuYyBMb2FkUGxheWVySW5mb3NUb0NoYW5uZWwoY29udGV4dCBjb250ZXh0LkNvbnRleHQsCiAgICBwbGF5ZXJJbmZvc2sgdHlwZXMuUGxheWVySW5mb0tlZXBlciwKICAgIHBsYXllckluZm9zQ2hhbm5lbCBjaGFuJmx0Oy0gUGxheWVySW5mb3NDaHVuaywKICAgIGNodW5rIHVpbnQ2NCkgewogICAgZGVmZXIgZnVuYygpIHsgY2xvc2UocGxheWVySW5mb3NDaGFubmVsKSB9KCkKICAgIHJlc3BvbnNlLCBlcnIgOj0gcGxheWVySW5mb3NrLlBsYXllckluZm9BbGwoY29udGV4dCwgJmFtcDtjaGVja2Vyc3R5cGVzLlF1ZXJ5QWxsUGxheWVySW5mb1JlcXVlc3R7CiAgICAgICAgUGFnaW5hdGlvbjogJmFtcDtxdWVyeS5QYWdlUmVxdWVzdHtMaW1pdDogY2h1bmt9LAogICAgfSkKICAgIGlmIGVyciAhPSBuaWwgewogICAgICAgIHBsYXllckluZm9zQ2hhbm5lbCAmbHQ7LSBQbGF5ZXJJbmZvc0NodW5re1BsYXllckluZm9zOiBuaWwsIEVycm9yOiBlcnJ9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBwbGF5ZXJJbmZvc0NoYW5uZWwgJmx0Oy0gUGxheWVySW5mb3NDaHVua3tQbGF5ZXJJbmZvczogcmVzcG9uc2UuUGxheWVySW5mbywgRXJyb3I6IG5pbH0KCiAgICBmb3IgcmVzcG9uc2UuUGFnaW5hdGlvbi5OZXh0S2V5ICE9IG5pbCB7CiAgICAgICAgcmVzcG9uc2UsIGVyciA9IHBsYXllckluZm9zay5QbGF5ZXJJbmZvQWxsKGNvbnRleHQsICZhbXA7Y2hlY2tlcnN0eXBlcy5RdWVyeUFsbFBsYXllckluZm9SZXF1ZXN0ewogICAgICAgICAgICBQYWdpbmF0aW9uOiAmYW1wO3F1ZXJ5LlBhZ2VSZXF1ZXN0ewogICAgICAgICAgICAgICAgS2V5OiAgIHJlc3BvbnNlLlBhZ2luYXRpb24uTmV4dEtleSwKICAgICAgICAgICAgICAgIExpbWl0OiBjaHVuaywKICAgICAgICAgICAgfSwKICAgICAgICB9KQogICAgICAgIGlmIGVyciAhPSBuaWwgewogICAgICAgICAgICBwbGF5ZXJJbmZvc0NoYW5uZWwgJmx0Oy0gUGxheWVySW5mb3NDaHVua3tQbGF5ZXJJbmZvczogbmlsLCBFcnJvcjogZXJyfQogICAgICAgICAgICByZXR1cm4KICAgICAgICB9CiAgICAgICAgcGxheWVySW5mb3NDaGFubmVsICZsdDstIFBsYXllckluZm9zQ2h1bmt7UGxheWVySW5mb3M6IHJlc3BvbnNlLlBsYXllckluZm8sIEVycm9yOiBuaWx9CiAgICB9Cn0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-migration/x/leaderboard/migrations/cv2/keeper/migration_leaderboard.go#L11-L42"}}),e._v(" "),a("HighlightBox",{attrs:{type:"note"}},[a("p",[e._v("Note that:")]),e._v(" "),a("ul",[a("li",[e._v("This passes along the channel a tuple "),a("code",[e._v("PlayerInfosChunk")]),e._v(" that may contain an error. This is to obtain a result similar to when a function returns an optional error.")]),e._v(" "),a("li",[e._v("It uses the paginated query so as to not overwhelm the memory if there are millions of infos.")]),e._v(" "),a("li",[e._v("It closes the channel upon exit whether there is an error or not via the use of "),a("code",[e._v("defer")]),e._v(".")])])]),e._v(" "),a("p",[e._v("This routine populates the player info channel. What about the routine that consumes it?")]),e._v(" "),a("h3",{attrs:{id:"leaderboard-computation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#leaderboard-computation"}},[e._v("#")]),e._v(" Leaderboard computation")]),e._v(" "),a("p",[e._v("Create the routine function that builds the leaderboard in memory and returns it when complete:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"dHlwZSBMZWFkZXJib2FyZFJlc3VsdCBzdHJ1Y3QgewogICAgTGVhZGVyYm9hcmQgKnR5cGVzLkxlYWRlcmJvYXJkCiAgICBFcnJvciAgICAgICBlcnJvcgp9CgpmdW5jIEhhbmRsZVBsYXllckluZm9zQ2hhbm5lbChwbGF5ZXJJbmZvc0NoYW5uZWwgJmx0Oy1jaGFuIFBsYXllckluZm9zQ2h1bmssCiAgICBsZWFkZXJib2FyZENoYW5uZWwgY2hhbiZsdDstIExlYWRlcmJvYXJkUmVzdWx0LAogICAgbGVhZGVyYm9hcmRMZW5ndGggdWludDY0LAogICAgYWRkZWRBdCB0aW1lLlRpbWUsCiAgICBjaHVuayB1aW50NjQpIHsKICAgIGRlZmVyIGZ1bmMoKSB7IGNsb3NlKGxlYWRlcmJvYXJkQ2hhbm5lbCkgfSgpCiAgICB3aW5uZXJzIDo9IG1ha2UoW110eXBlcy5XaW5uZXIsIDAsIGxlYWRlcmJvYXJkTGVuZ3RoK2NodW5rKQogICAgZm9yIHJlY2VpdmVkSW5mb3MgOj0gcmFuZ2UgcGxheWVySW5mb3NDaGFubmVsIHsKICAgICAgICBpZiByZWNlaXZlZEluZm9zLkVycm9yICE9IG5pbCB7CiAgICAgICAgICAgIGxlYWRlcmJvYXJkQ2hhbm5lbCAmbHQ7LSBMZWFkZXJib2FyZFJlc3VsdHtMZWFkZXJib2FyZDogbmlsLCBFcnJvcjogcmVjZWl2ZWRJbmZvcy5FcnJvcn0KICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgfQogICAgICAgIGlmIHJlY2VpdmVkSW5mb3MuUGxheWVySW5mb3MgIT0gbmlsIHsKICAgICAgICAgICAgY2FuZGlkYXRlcywgZXJyIDo9IHR5cGVzLk1ha2VDYW5kaWRhdGVzRnJvbVBsYXllckluZm9zKHJlY2VpdmVkSW5mb3MuUGxheWVySW5mb3MpCiAgICAgICAgICAgIGlmIGVyciAhPSBuaWwgewogICAgICAgICAgICAgICAgbGVhZGVyYm9hcmRDaGFubmVsICZsdDstIExlYWRlcmJvYXJkUmVzdWx0e0xlYWRlcmJvYXJkOiBuaWwsIEVycm9yOiBlcnJ9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICB3aW5uZXJzID0gdHlwZXMuQWRkQ2FuZGlkYXRlc0F0Tm93KHdpbm5lcnMsIGFkZGVkQXQsIGNhbmRpZGF0ZXMpCiAgICAgICAgICAgIGlmIGxlYWRlcmJvYXJkTGVuZ3RoICZsdDsgdWludDY0KGxlbih3aW5uZXJzKSkgewogICAgICAgICAgICAgICAgd2lubmVycyA9IHdpbm5lcnNbOmxlYWRlcmJvYXJkTGVuZ3RoXQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgbGVhZGVyYm9hcmRDaGFubmVsICZsdDstIExlYWRlcmJvYXJkUmVzdWx0ewogICAgICAgIExlYWRlcmJvYXJkOiAmYW1wO3R5cGVzLkxlYWRlcmJvYXJke1dpbm5lcnM6IHdpbm5lcnN9LAogICAgICAgIEVycm9yOiAgICAgICBuaWwsCiAgICB9Cn0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-migration/x/leaderboard/migrations/cv2/keeper/migration_leaderboard.go#L44-L77"}}),e._v(" "),a("HighlightBox",{attrs:{type:"note"}},[a("p",[e._v("Note that:")]),e._v(" "),a("ul",[a("li",[e._v("The winners are initialized at a "),a("code",[e._v("0")]),e._v(" size but with a capacity of "),a("code",[e._v("Params.Length + chunk")]),e._v(", which is the expected maximum intermediate size it will reach. This initialization should ensure that the slice does not need to have its capacity increased mid-process.")]),e._v(" "),a("li",[e._v("It also passes along a tuple with an optional error.")]),e._v(" "),a("li",[e._v("It closes the channel it populates upon exit whether there is an error or not via the use of "),a("code",[e._v("defer")]),e._v(".")])])]),e._v(" "),a("p",[e._v("This routine populates the leaderboard channel. Where is it consumed?")]),e._v(" "),a("h3",{attrs:{id:"routines-orchestration"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#routines-orchestration"}},[e._v("#")]),e._v(" Routines orchestration")]),e._v(" "),a("p",[e._v("Now you can declare the main function that creates the channels and routines, and collects the leaderboard when done:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBNYXBQbGF5ZXJJbmZvc1JlZHVjZVRvTGVhZGVyYm9hcmQoY29udGV4dCBjb250ZXh0LkNvbnRleHQsCiAgICBrIGtlZXBlci5LZWVwZXIsCiAgICBwbGF5ZXJJbmZvc2sgdHlwZXMuUGxheWVySW5mb0tlZXBlciwKICAgIGxlYWRlcmJvYXJkTGVuZ3RoIHVpbnQ2NCwKICAgIGFkZGVkQXQgdGltZS5UaW1lLAogICAgY2h1bmsgdWludDY0KSAoKnR5cGVzLkxlYWRlcmJvYXJkLCBlcnJvcikgewogICAgcGxheWVySW5mb3NDaGFubmVsIDo9IG1ha2UoY2hhbiBQbGF5ZXJJbmZvc0NodW5rKQogICAgbGVhZGVyYm9hcmRDaGFubmVsIDo9IG1ha2UoY2hhbiBMZWFkZXJib2FyZFJlc3VsdCkKCiAgICBnbyBIYW5kbGVQbGF5ZXJJbmZvc0NoYW5uZWwocGxheWVySW5mb3NDaGFubmVsLCBsZWFkZXJib2FyZENoYW5uZWwsIGxlYWRlcmJvYXJkTGVuZ3RoLCBhZGRlZEF0LCBjaHVuaykKICAgIGdvIExvYWRQbGF5ZXJJbmZvc1RvQ2hhbm5lbChjb250ZXh0LCBwbGF5ZXJJbmZvc2ssIHBsYXllckluZm9zQ2hhbm5lbCwgY2h1bmspCgogICAgcmVzdWx0IDo9ICZsdDstbGVhZGVyYm9hcmRDaGFubmVsCgogICAgcmV0dXJuIHJlc3VsdC5MZWFkZXJib2FyZCwgcmVzdWx0LkVycm9yCn0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-migration/x/leaderboard/migrations/cv2/keeper/migration_leaderboard.go#L79-L89"}}),e._v(" "),a("HighlightBox",{attrs:{type:"note"}},[a("p",[e._v("Note that:")]),e._v(" "),a("ul",[a("li",[e._v("This returns the leaderboard instead of saving it in the keeper. That is because, when "),a("strong",[e._v("introducing a module")]),e._v(", you have to initialize it with a "),a("strong",[e._v("genesis")]),e._v(", and this computed leaderboard will be part of the module's genesis.")]),e._v(" "),a("li",[e._v("It delegates the closing of channels to the routines.")]),e._v(" "),a("li",[e._v("It starts the "),a("em",[e._v("second")]),e._v(" routine first to reduce the likelihood of channel clogging.")])])]),e._v(" "),a("h3",{attrs:{id:"advertising-the-function-to-use"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#advertising-the-function-to-use"}},[e._v("#")]),e._v(" Advertising the function to use")]),e._v(" "),a("p",[e._v("The migration proper needs to introduce the new module and then populate the genesis with the result of the "),a("code",[e._v("MapPlayerInfosReduceToLeaderboard")]),e._v(" function. You can encapsulate and advertise this knowledge in two functions:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBDb21wdXRlTWlncmF0ZWRMZWFkZXJib2FyZChjdHggc2RrLkNvbnRleHQsIHBsYXllckluZm9zayB0eXBlcy5QbGF5ZXJJbmZvS2VlcGVyKSAoKnR5cGVzLkxlYWRlcmJvYXJkLCBlcnJvcikgewogICAgcmV0dXJuIGN2MmtlZXBlci5NYXBQbGF5ZXJJbmZvc1JlZHVjZVRvTGVhZGVyYm9hcmQoCiAgICAgICAgc2RrLldyYXBTREtDb250ZXh0KGN0eCksCiAgICAgICAgcGxheWVySW5mb3NrLAogICAgICAgIHR5cGVzLkRlZmF1bHRMZW5ndGgsCiAgICAgICAgY3R4LkJsb2NrVGltZSgpLAogICAgICAgIGN2MnR5cGVzLlBsYXllckluZm9DaHVua1NpemUpCn0KCmZ1bmMgQ29tcHV0ZUluaXRHZW5lc2lzKGN0eCBzZGsuQ29udGV4dCwgcGxheWVySW5mb3NrIHR5cGVzLlBsYXllckluZm9LZWVwZXIpICgqdHlwZXMuR2VuZXNpc1N0YXRlLCBlcnJvcikgewogICAgbGVhZGVyYm9hcmQsIGVyciA6PSBDb21wdXRlTWlncmF0ZWRMZWFkZXJib2FyZChjdHgsIHBsYXllckluZm9zaykKICAgIGlmIGVyciAhPSBuaWwgewogICAgICAgIHJldHVybiBuaWwsIGVycgogICAgfQogICAgcmV0dXJuICZhbXA7dHlwZXMuR2VuZXNpc1N0YXRlewogICAgICAgIFBhcmFtczogICAgICB0eXBlcy5EZWZhdWx0UGFyYW1zKCksCiAgICAgICAgTGVhZGVyYm9hcmQ6ICpsZWFkZXJib2FyZCwKICAgIH0sIG5pbAp9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-migration/x/leaderboard/migrations/cv2/migration.go#L11-L24"}}),e._v(" "),a("HighlightBox",{attrs:{type:"best-practice"}},[a("p",[e._v("To further limit the dependency of the leaderboard module on the checkers module, you could consider:")]),e._v(" "),a("ul",[a("li",[e._v("Having the new expected interface be based on "),a("code",[e._v("Candidate")]),e._v(" and not "),a("code",[e._v("PlayerInfo")]),e._v(".")]),e._v(" "),a("li",[e._v("And keeping the transformation between one and the other in a file whose name is suffixed with "),a("code",[e._v("_checkers")]),e._v(".")])])]),e._v(" "),a("h2",{attrs:{id:"v1-1-to-v2-migration-proper"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#v1-1-to-v2-migration-proper"}},[e._v("#")]),e._v(" v1.1 to v2 migration proper")]),e._v(" "),a("p",[e._v("You now have in place the functions that will handle the store migration. Next you have to set up the chain of command for these functions to be called by the node at the right point in time.")]),e._v(" "),a("h3",{attrs:{id:"consensus-version-and-name"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#consensus-version-and-name"}},[e._v("#")]),e._v(" Consensus version and name")]),e._v(" "),a("p",[e._v("The "),a("code",[e._v("upgrade")]),e._v(" module keeps in its store the "),a("a",{attrs:{href:"https://docs.cosmos.network/main/core/upgrade.html#tracking-module-versions",target:"_blank",rel:"noopener noreferrer"}},[e._v("different module versions"),a("OutboundLink")],1),e._v(" that are currently running. To signal an upgrade, your module needs to return a different value when queried by the "),a("code",[e._v("upgrade")]),e._v(" module. As it stands, your leaderboard consensus version is "),a("code",[e._v("2")]),e._v(" and that will be its first value when added to the application. To make this explicit, and consistent with the pattern used in the checkers module, you can keep this information in a constant like you did for the checkers module:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIGNvbnN0ICgKICAgICAgICBQbGF5ZXJJbmZvQ2h1bmtTaXplID0gdHlwZXMuRGVmYXVsdExlbmd0aCAqIHVpbnQ2NCgyKQorICAgICAgQ29uc2Vuc3VzVmVyc2lvbiAgICA9IHVpbnQ2NCgyKQogICAgKQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-migration/x/leaderboard/migrations/cv2/types/keys.go#L7"}}),e._v(" "),a("p",[e._v("It can be used by "),a("code",[e._v("module.go")]),e._v(":")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"LSAgZnVuYyAoQXBwTW9kdWxlKSBDb25zZW5zdXNWZXJzaW9uKCkgdWludDY0IHsgcmV0dXJuIDIgfQorICBmdW5jIChBcHBNb2R1bGUpIENvbnNlbnN1c1ZlcnNpb24oKSB1aW50NjQgeyByZXR1cm4gY3YydHlwZXMuQ29uc2Vuc3VzVmVyc2lvbiB9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-migration/x/leaderboard/module.go#L172"}}),e._v(" "),a("HighlightBox",{attrs:{type:"note"}},[a("p",[e._v("The consensus version number has no connection to v1.1 or v2. The consensus version number is for the module, whereas v1.1 or v2 is for the whole application.")])]),e._v(" "),a("p",[e._v("You also have to pick a name for the upgrade you have prepared. This name will identify your specific upgrade when it is mentioned in a "),a("code",[e._v("Plan")]),e._v(" (i.e. an upgrade governance proposal). Use a name that is relevant at the application level:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBta2RpciBhcHAvdXBncmFkZXMvdjFfMXRvdjIK"}}),e._v(" "),a("p",[e._v("In this you save:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Y29uc3QgVXBncmFkZU5hbWUgPSAmcXVvdDt2MV8xdG92MiZxdW90Owo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-migration/app/upgrades/v1_1tov2/keys.go#L3"}}),e._v(" "),a("p",[e._v("You have to inform your app about:")]),e._v(" "),a("ol",[a("li",[e._v("The module being introduced.")]),e._v(" "),a("li",[e._v("The genesis to use for it.")])]),e._v(" "),a("p",[e._v("Prepare these in turn.")]),e._v(" "),a("h3",{attrs:{id:"callback-in-leaderboard-module"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#callback-in-leaderboard-module"}},[e._v("#")]),e._v(" Callback in leaderboard module")]),e._v(" "),a("p",[e._v("Although the module does not upgrade per se, you need to make sure that it does not fail when presented with an upgrade. Call "),a("code",[e._v("RegisterMigration")]),e._v(" with "),a("code",[e._v("nil")]),e._v(" action:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIGltcG9ydCAoCiAgICAgICAgLi4uCisgICAgICBjdjJUeXBlcyAmcXVvdDtnaXRodWIuY29tL2I5bGFiL2NoZWNrZXJzL3gvY2hlY2tlcnNsZWFkZXJib2FyZC9taWdyYXRpb25zL2N2Mi90eXBlcyZxdW90OwogICAgICAgICZxdW90O2dpdGh1Yi5jb20vYjlsYWIvY2hlY2tlcnMveC9sZWFkZXJib2FyZC90eXBlcyZxdW90OwogICAgICAgIC4uLgogICAgKQogICAgZnVuYyAoYW0gQXBwTW9kdWxlKSBSZWdpc3RlclNlcnZpY2VzKGNmZyBtb2R1bGUuQ29uZmlndXJhdG9yKSB7CiAgICAgICAgdHlwZXMuUmVnaXN0ZXJRdWVyeVNlcnZlcihjZmcuUXVlcnlTZXJ2ZXIoKSwgYW0ua2VlcGVyKQorICAgICAgaWYgZXJyIDo9IGNmZy5SZWdpc3Rlck1pZ3JhdGlvbih0eXBlcy5Nb2R1bGVOYW1lLCBjdjJUeXBlcy5Db25zZW5zdXNWZXJzaW9uLCBmdW5jKGN0eCBzZGsuQ29udGV4dCkgZXJyb3IgeworICAgICAgICAgIHJldHVybiBuaWwKKyAgICAgIH0pOyBlcnIgIT0gbmlsIHsKKyAgICAgICAgICBwYW5pYyhmbXQuRXJyb3JmKCZxdW90O2ZhaWxlZCB0byByZWdpc3RlciBjdjIgbGVhZGVyYm9hcmQgbWlncmF0aW9uIG9mICVzOiAldyZxdW90OywgdHlwZXMuTW9kdWxlTmFtZSwgZXJyKSkKKyAgICAgIH0KICAgIH0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-migration/x/leaderboard/module.go#L143-L147"}}),e._v(" "),a("HighlightBox",{attrs:{type:"best-practice"}},[a("p",[e._v("You "),a("em",[e._v("could")]),e._v(" run a proper migration here, if you added a checkers keeper (or rather a "),a("code",[e._v("types.PlayerInfoKeeper")]),e._v(") in your module.\n"),a("br"),a("br"),e._v("\nThe downside is that this keeper would be used only at the time of migration and therefore is a massive overkill, if not a security risk.")])]),e._v(" "),a("h3",{attrs:{id:"callback-in-app"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#callback-in-app"}},[e._v("#")]),e._v(" Callback in "),a("code",[e._v("app")])]),e._v(" "),a("p",[e._v("In a "),a("RouterLink",{attrs:{to:"/hands-on-exercise/4-run-in-prod/2-migration-info.html"}},[e._v("previous section")]),e._v(" you already prepared "),a("code",[e._v("app.go")]),e._v(" to handle a migration, namely "),a("code",[e._v("v1tov1_1")]),e._v(". Here you add to this "),a("code",[e._v("setupUpgradeHandlers")]),e._v(" function in two places:")],1),e._v(" "),a("ol",[a("li",[a("p",[e._v("First, after the "),a("code",[e._v("v1tov1_1")]),e._v(" upgrade method, introduce the way to get the new leaderboard's module genesis:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIC8vIHYxIHRvIHYxLjEgdXBncmFkZSBoYW5kbGVyCiAgICBhcHAuVXBncmFkZUtlZXBlci5TZXRVcGdyYWRlSGFuZGxlcigKICAgICAgICB2MXRvdjFfMS5VcGdyYWRlTmFtZSwKICAgICAgICAuLi4KICAgICkKKyAgLy8gdjEuMSB0byB2MiB1cGdyYWRlIGhhbmRsZXIKKyAgYXBwLlVwZ3JhZGVLZWVwZXIuU2V0VXBncmFkZUhhbmRsZXIoCisgICAgICB2MV8xdG92Mi5VcGdyYWRlTmFtZSwKKyAgICAgIGZ1bmMoY3R4IHNkay5Db250ZXh0LCBwbGFuIHVwZ3JhZGV0eXBlcy5QbGFuLCB2bSBtb2R1bGUuVmVyc2lvbk1hcCkgKG1vZHVsZS5WZXJzaW9uTWFwLCBlcnJvcikgeworICAgICAgICAgIHZtW2xlYWRlcmJvYXJkbW9kdWxldHlwZXMuTW9kdWxlTmFtZV0gPSBsZWFkZXJib2FyZG1vZHVsZW1pZ3JhdGlvbnNjdjJ0eXBlcy5Db25zZW5zdXNWZXJzaW9uCisgICAgICAgICAgZ2VuZXNpcywgZXJyIDo9IGxlYWRlcmJvYXJkbW9kdWxlbWlncmF0aW9uc2N2Mi5Db21wdXRlSW5pdEdlbmVzaXMoY3R4LCBhcHAuQ2hlY2tlcnNLZWVwZXIpCisgICAgICAgICAgaWYgZXJyICE9IG5pbCB7CisgICAgICAgICAgICAgIHJldHVybiB2bSwgZXJyCisgICAgICAgICAgfQorICAgICAgICAgIGdlbiwgZXJyIDo9IGFwcC5hcHBDb2RlYy5NYXJzaGFsSlNPTihnZW5lc2lzKQorICAgICAgICAgIGlmIGVyciAhPSBuaWwgeworICAgICAgICAgICAgICByZXR1cm4gdm0sIGVycgorICAgICAgICAgIH0KKyAgICAgICAgICBhcHAubW0uTW9kdWxlc1tsZWFkZXJib2FyZG1vZHVsZXR5cGVzLk1vZHVsZU5hbWVdLkluaXRHZW5lc2lzKAorICAgICAgICAgICAgICBjdHgsCisgICAgICAgICAgICAgIGFwcC5hcHBDb2RlYywKKyAgICAgICAgICAgICAgZ2VuKQorICAgICAgICAgIHJldHVybiBhcHAubW0uUnVuTWlncmF0aW9ucyhjdHgsIGFwcC5jb25maWd1cmF0b3IsIHZtKQorICAgICAgfSwKKyAgKQogICAgLi4uCg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-migration/app/app.go#L792-L811"}}),e._v(" "),a("HighlightBox",{attrs:{type:"note"}},[a("p",[e._v("Note that:")]),e._v(" "),a("ul",[a("li",[e._v("The version map is populated with the current consensus version of the leaderboard. This stops the leaderboard from being upgraded further.")]),e._v(" "),a("li",[a("code",[e._v("app.CheckersKeeper")]),e._v(" is used. This is the only time the leaderboard module has access to the checkers module.")]),e._v(" "),a("li",[e._v("The genesis needs to be marshalled before being passed to "),a("code",[e._v("InitGenesis")]),e._v(".")])])])],1),e._v(" "),a("li",[a("p",[e._v("Second, inform it that as part of the "),a("code",[e._v("v1_1tov2")]),e._v(" upgrade a new store key is introduced:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIC4uLgogICAgc3dpdGNoIHVwZ3JhZGVJbmZvLk5hbWUgewogICAgY2FzZSB2MXRvdjFfMS5VcGdyYWRlTmFtZToKKyAgY2FzZSB2MV8xdG92Mi5VcGdyYWRlTmFtZToKKyAgICAgIHN0b3JlVXBncmFkZXMgPSAmYW1wO3N0b3JldHlwZXMuU3RvcmVVcGdyYWRlc3sKKyAgICAgICAgICBBZGRlZDogW11zdHJpbmd7bGVhZGVyYm9hcmRtb2R1bGV0eXBlcy5TdG9yZUtleX0sCisgICAgICB9CiAgICB9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/leaderboard-migration/app/app.go#L829-L833"}}),e._v(" "),a("p",[e._v("This is where the genesis will be saved.")])],1)]),e._v(" "),a("p",[e._v("With this, the app is configured to handle the module upgrade.")]),e._v(" "),a("h2",{attrs:{id:"unit-tests"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#unit-tests"}},[e._v("#")]),e._v(" Unit tests")]),e._v(" "),a("p",[e._v("After all these changes it is worthwhile adding tests, at least on the helpers.")]),e._v(" "),a("h3",{attrs:{id:"new-mock-types"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#new-mock-types"}},[e._v("#")]),e._v(" New mock types")]),e._v(" "),a("p",[e._v("You introduced a new expected keeper. If you want to unit test your migration helpers properly, you have to mock this new expected interface:")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("Add to the relevant "),a("code",[e._v("Makefile")]),e._v(" target:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-lang-makefile",base64:"ICAgIG1vY2stZXhwZWN0ZWQta2VlcGVyczoKICAgICAgICAuLi4KICAgICAgICAgICAgLWRlc3RpbmF0aW9uPXgvY2hlY2tlcnMvdGVzdHV0aWwvZXhwZWN0ZWRfa2VlcGVyc19tb2Nrcy5nbworICAgICAgbW9ja2dlbiAtc291cmNlPXgvbGVhZGVyYm9hcmQvdHlwZXMvZXhwZWN0ZWRfa2VlcGVycy5nbyBcCisgICAgICAgICAgLXBhY2thZ2UgdGVzdHV0aWwgXAorICAgICAgICAgIC1kZXN0aW5hdGlvbj14L2xlYWRlcmJvYXJkL3Rlc3R1dGlsL2V4cGVjdGVkX2tlZXBlcnNfbW9ja3MuZ28K"}})],1),e._v(" "),a("li",[a("p",[e._v("Now run it:")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"Local",active:""}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBtYWtlIG1vY2stZXhwZWN0ZWQta2VlcGVycwo="}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"Docker"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IFwKICAgIC12ICQocHdkKTovY2hlY2tlcnMgXAogICAgLXcgL2NoZWNrZXJzIFwKICAgIGNoZWNrZXJzX2kgXAogICAgbWFrZSBtb2NrLWV4cGVjdGVkLWtlZXBlcnMK"}})],1)],1)],1)]),e._v(" "),a("h3",{attrs:{id:"create-the-mock-instance"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#create-the-mock-instance"}},[e._v("#")]),e._v(" Create the mock instance")]),e._v(" "),a("p",[e._v("In a new file, add a function to prepare your new mock:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Y29uc3QgKAogICAgYWxpY2UgPSB0ZXN0dXRpbC5BbGljZQogICAgYm9iICAgPSB0ZXN0dXRpbC5Cb2IKICAgIGNhcm9sID0gdGVzdHV0aWwuQ2Fyb2wKKQoKZnVuYyBzZXR1cE1vY2tGb3JMZWFkZXJib2FyZE1pZ3JhdGlvbih0IHRlc3RpbmcuVEIpIChjb250ZXh0LkNvbnRleHQsICpnb21vY2suQ29udHJvbGxlciwgKnRlc3R1dGlsLk1vY2tQbGF5ZXJJbmZvS2VlcGVyKSB7CiAgICBjdHJsIDo9IGdvbW9jay5OZXdDb250cm9sbGVyKHQpCiAgICBwbGF5ZXJJbmZvTW9jayA6PSB0ZXN0dXRpbC5OZXdNb2NrUGxheWVySW5mb0tlZXBlcihjdHJsKQogICAgXywgY3R4IDo9IGtlZXBlcnRlc3QuTGVhZGVyYm9hcmRLZWVwZXIodCkKICAgIHJldHVybiBzZGsuV3JhcFNES0NvbnRleHQoY3R4KSwgY3RybCwgcGxheWVySW5mb01vY2sKfQo="}}),e._v(" "),a("p",[e._v("In your test, prepare the mock:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBUZXN0Q29tcHV0ZUxlYWRlcmJvYXJkKHQgKnRlc3RpbmcuVCkgewogICAgY29udGV4dCwgY3RybCwgcGxheWVySW5mb01vY2sgOj0gc2V0dXBNb2NrRm9yTGVhZGVyYm9hcmRNaWdyYXRpb24odCkKICAgIC8vIFRPRE8KICAgIGN0cmwuRmluaXNoKCkKfQo="}}),e._v(" "),a("h3",{attrs:{id:"configure-the-mock"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configure-the-mock"}},[e._v("#")]),e._v(" Configure the mock")]),e._v(" "),a("p",[e._v("To use your mock, this time it takes a bit of effort:")]),e._v(" "),a("ul",[a("li",[e._v("To test that it was called correctly, use "),a("code",[e._v(".EXPECT()")]),e._v(" with defined values.")]),e._v(" "),a("li",[e._v("To have it return player infos in chunks, use "),a("code",[e._v(".Return()")]),e._v(" and make sure the pagination's "),a("code",[e._v("NextKey")]),e._v(" is populated when necessary.")]),e._v(" "),a("li",[e._v("To confirm that one call happens before the other, use "),a("code",[e._v("gomock.InOrder()")]),e._v(".")])]),e._v(" "),a("p",[e._v("Imagine that the keeper has:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"UGxheWVySW5mb3M6IFtdY2hlY2tlcnN0eXBlcy5QbGF5ZXJJbmZvewogICAgeyBJbmRleDogYWxpY2UsIFdvbkNvdW50OiAxIH0sCiAgICB7IEluZGV4OiBib2IsIFdvbkNvdW50OiAyIH0sCiAgICB7IEluZGV4OiBjYXJvbCwgV29uQ291bnQ6IDMgfSwKfQo="}}),e._v(" "),a("p",[e._v("Also imagine you want to have it return the info paginated in chunks of size "),a("code",[e._v("2")]),e._v(". This means two calls:")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("The first call:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIGNvbnRleHQsIGN0cmwsIHBsYXllckluZm9Nb2NrIDo9IHNldHVwTW9ja0ZvckxlYWRlcmJvYXJkTWlncmF0aW9uKHQpCi0gIC8vIFRPRE8KKyAgZmlyc3RDYWxsIDo9IHBsYXllckluZm9Nb2NrLkVYUEVDVCgpLgorICAgICAgUGxheWVySW5mb0FsbChjb250ZXh0LCAmYW1wO2NoZWNrZXJzdHlwZXMuUXVlcnlBbGxQbGF5ZXJJbmZvUmVxdWVzdHsKKyAgICAgICAgICBQYWdpbmF0aW9uOiAmYW1wO3F1ZXJ5LlBhZ2VSZXF1ZXN0e0xpbWl0OiAyfSwKKyAgICAgIH0pLgorICAgICAgUmV0dXJuKCZhbXA7Y2hlY2tlcnN0eXBlcy5RdWVyeUFsbFBsYXllckluZm9SZXNwb25zZXsKKyAgICAgICAgICBQbGF5ZXJJbmZvOiBbXWNoZWNrZXJzdHlwZXMuUGxheWVySW5mb3sKKyAgICAgICAgICAgICAgeworICAgICAgICAgICAgICAgICAgSW5kZXg6ICAgIGFsaWNlLAorICAgICAgICAgICAgICAgICAgV29uQ291bnQ6IDEsCisgICAgICAgICAgICAgIH0sCisgICAgICAgICAgICAgIHsKKyAgICAgICAgICAgICAgICAgIEluZGV4OiAgICBib2IsCisgICAgICAgICAgICAgICAgICBXb25Db3VudDogMiwKKyAgICAgICAgICAgICAgfSwKKyAgICAgICAgICB9LAorICAgICAgICAgIFBhZ2luYXRpb246ICZhbXA7cXVlcnkuUGFnZVJlc3BvbnNleworICAgICAgICAgICAgICBOZXh0S2V5OiBbXWJ5dGUoJnF1b3Q7bW9yZSZxdW90OyksCisgICAgICAgICAgfSwKKyAgICAgIH0sIG5pbCkKICAgIC4uLgo="}})],1),e._v(" "),a("li",[a("p",[e._v("The second call:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIGZpcnN0Q2FsbCA6PSBwbGF5ZXJJbmZvTW9jay5FWFBFQ1QoKS4KICAgICAgICAuLi4KICAgICAgICB9LCBuaWwpCisgIHNlY29uZENhbGwgOj0gcGxheWVySW5mb01vY2suRVhQRUNUKCkuCisgICAgICBQbGF5ZXJJbmZvQWxsKGNvbnRleHQsICZhbXA7Y2hlY2tlcnN0eXBlcy5RdWVyeUFsbFBsYXllckluZm9SZXF1ZXN0eworICAgICAgICAgIFBhZ2luYXRpb246ICZhbXA7cXVlcnkuUGFnZVJlcXVlc3R7CisgICAgICAgICAgICAgIEtleTogICBbXWJ5dGUoJnF1b3Q7bW9yZSZxdW90OyksCisgICAgICAgICAgICAgIExpbWl0OiAyLAorICAgICAgICAgIH0sCisgICAgICB9KS4KKyAgICAgIFJldHVybigmYW1wO2NoZWNrZXJzdHlwZXMuUXVlcnlBbGxQbGF5ZXJJbmZvUmVzcG9uc2V7CisgICAgICAgICAgUGxheWVySW5mbzogW11jaGVja2Vyc3R5cGVzLlBsYXllckluZm97CisgICAgICAgICAgICAgIHsKKyAgICAgICAgICAgICAgICAgIEluZGV4OiAgICBjYXJvbCwKKyAgICAgICAgICAgICAgICAgIFdvbkNvdW50OiAzLAorICAgICAgICAgICAgICB9LAorICAgICAgICAgIH0sCisgICAgICAgICAgUGFnaW5hdGlvbjogJmFtcDtxdWVyeS5QYWdlUmVzcG9uc2V7CisgICAgICAgICAgICAgIE5leHRLZXk6IG5pbCwKKyAgICAgICAgICB9LAorICAgICAgfSwgbmlsKQogICAgLi4uCg=="}})],1),e._v(" "),a("li",[a("p",[e._v("Now specify the desired order:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIHNlY29uZENhbGwgOj0gcGxheWVySW5mb01vY2suRVhQRUNUKCkuCiAgICAgICAgLi4uCiAgICAgICAgfSwgbmlsKQorICBnb21vY2suSW5PcmRlcihmaXJzdENhbGwsIHNlY29uZENhbGwpCiAgICAuLi4K"}})],1)]),e._v(" "),a("h3",{attrs:{id:"rest-of-the-test"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rest-of-the-test"}},[e._v("#")]),e._v(" Rest of the test")]),e._v(" "),a("p",[e._v("From there, the test is as usual:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIC4uLgogICAgZ29tb2NrLkluT3JkZXIoZmlyc3RDYWxsLCBzZWNvbmRDYWxsKQoKKyAgbGVhZGVyYm9hcmQsIGVyciA6PSBjdjJrZWVwZXIuTWFwUGxheWVySW5mb3NSZWR1Y2VUb0xlYWRlcmJvYXJkKAorICAgICAgY29udGV4dCwKKyAgICAgIHBsYXllckluZm9Nb2NrLAorICAgICAgMiwKKyAgICAgIHRpbWUuVW5peChpbnQ2NCgxMDAxKSwgMCksCisgICAgICAyKQoKKyAgcmVxdWlyZS5OaWwodCwgZXJyKQorICByZXF1aXJlLkVxdWFsKHQsIDIsIGxlbihsZWFkZXJib2FyZC5XaW5uZXJzKSkKKyAgcmVxdWlyZS5FcXVhbFZhbHVlcyh0LCB0eXBlcy5MZWFkZXJib2FyZHsKKyAgICAgIFdpbm5lcnM6IFtddHlwZXMuV2lubmVyeworICAgICAgICAgIHsKKyAgICAgICAgICAgICAgQWRkcmVzczogIGNhcm9sLAorICAgICAgICAgICAgICBXb25Db3VudDogMywKKyAgICAgICAgICAgICAgQWRkZWRBdDogIDEwMDEsCisgICAgICAgICAgfSwKKyAgICAgICAgICB7CisgICAgICAgICAgICAgIEFkZHJlc3M6ICBib2IsCisgICAgICAgICAgICAgIFdvbkNvdW50OiAyLAorICAgICAgICAgICAgICBBZGRlZEF0OiAgMTAwMSwKKyAgICAgICAgICB9LAorICAgICAgfSwKKyAgfSwgKmxlYWRlcmJvYXJkKQogICAgY3RybC5GaW5pc2goKQo="}}),e._v(" "),a("h3",{attrs:{id:"run-it"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#run-it"}},[e._v("#")]),e._v(" Run it")]),e._v(" "),a("p",[e._v("You can confirm that the test passes by running:")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"Local",active:""}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBnbyB0ZXN0IGdpdGh1Yi5jb20vYjlsYWIvY2hlY2tlcnMveC9sZWFkZXJib2FyZC9taWdyYXRpb25zL2N2Mi9rZWVwZXIK"}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"Docker"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IFwKICAgIC12ICQocHdkKTovY2hlY2tlcnMgXAogICAgLXcgL2NoZWNrZXJzIFwKICAgIGNoZWNrZXJzX2kgXAogICAgZ28gdGVzdCBnaXRodWIuY29tL2I5bGFiL2NoZWNrZXJzL3gvbGVhZGVyYm9hcmQvbWlncmF0aW9ucy9jdjIva2VlcGVyCg=="}})],1)],1),e._v(" "),a("p",[e._v("Given the configuration difficulty of the mock, only this test will do.")]),e._v(" "),a("p",[e._v("It is not possible to add integration tests on the migration proper, because when the app is created it is already at v2.")]),e._v(" "),a("h2",{attrs:{id:"interact-via-the-cli"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#interact-via-the-cli"}},[e._v("#")]),e._v(" Interact via the CLI")]),e._v(" "),a("p",[e._v("You can execute a live upgrade from the command line. The following upgrade process takes inspiration from "),a("a",{attrs:{href:"https://hub.cosmos.network/main/hub-tutorials/live-upgrade-tutorial.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("this one"),a("OutboundLink")],1),e._v(" based on Gaia. You will:")]),e._v(" "),a("ul",[a("li",[e._v("Check out the checkers v1.1 code.")]),e._v(" "),a("li",[e._v("Build the v1.1 checkers executable.")]),e._v(" "),a("li",[e._v("Initialize a local blockchain and network.")]),e._v(" "),a("li",[e._v("Run v1.1 checkers.")]),e._v(" "),a("li",[e._v("Add one or more incomplete games.")]),e._v(" "),a("li",[e._v("Add one or more complete games with the help of a CosmJS integration test.")]),e._v(" "),a("li",[e._v("Create a governance proposal to upgrade with the right plan name at an appropriate block height.")]),e._v(" "),a("li",[e._v("Make the proposal pass.")]),e._v(" "),a("li",[e._v("Wait for v1.1 checkers to halt on its own at the upgrade height.")]),e._v(" "),a("li",[e._v("Check out the checkers v2 code.")]),e._v(" "),a("li",[e._v("Build the v2 checkers executable.")]),e._v(" "),a("li",[e._v("Run v2 checkers.")]),e._v(" "),a("li",[e._v("Confirm that you now have a correct leaderboard.")])]),e._v(" "),a("p",[e._v("Start your engines!")]),e._v(" "),a("h3",{attrs:{id:"launch-v1-1"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#launch-v1-1"}},[e._v("#")]),e._v(" Launch v1.1")]),e._v(" "),a("p",[e._v("After committing your changes, in a shell checkout v1.1 of checkers with the content of the CosmJS client work:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBnaXQgY2hlY2tvdXQgcGxheWVyLWluZm8tbWlncmF0aW9uCiQgZ2l0IHN1Ym1vZHVsZSB1cGRhdGUgLS1pbml0Cg=="}}),e._v(" "),a("p",[e._v("Build the v1.1 executable for your platform:")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"Local",active:""}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBnbyBidWlsZCAtbyByZWxlYXNlL3YxXzEvY2hlY2tlcnNkIGNtZC9jaGVja2Vyc2QvbWFpbi5nbwo="}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"Docker"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IFwKICAgIC12ICQocHdkKTovY2hlY2tlcnMgXAogICAgLXcgL2NoZWNrZXJzIFwKICAgIGNoZWNrZXJzX2kgXAogICAgZ28gYnVpbGQgLW8gcmVsZWFzZS92MV8xL2NoZWNrZXJzZCBjbWQvY2hlY2tlcnNkL21haW4uZ28K"}})],1)],1),e._v(" "),a("p",[e._v("With the "),a("code",[e._v("release/v1_1/checkersd")]),e._v(" executable ready, you can initialize the network.")]),e._v(" "),a("HighlightBox",{attrs:{type:"warn"}},[a("p",[e._v("Because this is an exercise, to avoid messing with your keyring you must always specify "),a("code",[e._v("--keyring-backend test")]),e._v(".")])]),e._v(" "),a("p",[e._v("Add two players:")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"Local",active:""}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCAuL3JlbGVhc2UvdjFfMS9jaGVja2Vyc2Qga2V5cyBhZGQgYWxpY2UgLS1rZXlyaW5nLWJhY2tlbmQgdGVzdAokIC4vcmVsZWFzZS92MV8xL2NoZWNrZXJzZCBrZXlzIGFkZCBib2IgLS1rZXlyaW5nLWJhY2tlbmQgdGVzdAo="}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"Docker"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgbmV0d29yayBjcmVhdGUgY2hlY2tlcnMtbmV0CiQgZG9ja2VyIGNyZWF0ZSAtaXQgXAogICAgLXYgJChwd2QpOi9jaGVja2VycyAtdyAvY2hlY2tlcnMgXAogICAgLS1uZXR3b3JrIGNoZWNrZXJzLW5ldCBcCiAgICAtLW5hbWUgY2hlY2tlcnMgXAogICAgLXAgMjY2NTc6MjY2NTcgXAogICAgY2hlY2tlcnNfaQokIGRvY2tlciBzdGFydCBjaGVja2VycwokIGRvY2tlciBleGVjIC10IGNoZWNrZXJzIFwKICAgIC4vcmVsZWFzZS92MV8xL2NoZWNrZXJzZCBrZXlzIGFkZCBhbGljZSAtLWtleXJpbmctYmFja2VuZCB0ZXN0CiQgZG9ja2VyIGV4ZWMgLXQgY2hlY2tlcnMgXAogICAgLi9yZWxlYXNlL3YxXzEvY2hlY2tlcnNkIGtleXMgYWRkIGJvYiAtLWtleXJpbmctYmFja2VuZCB0ZXN0Cg=="}}),e._v(" "),a("HighlightBox",{attrs:{type:"note"}},[a("p",[e._v("You should not use "),a("code",[e._v("docker run --rm")]),e._v(" here, because when "),a("code",[e._v("checkersd")]),e._v(" stops you do not want to remove the container and thereby destroy the saved keys, and the future genesis too. Instead, you reuse them all in the next calls.")])])],1)],1),e._v(" "),a("p",[e._v("Create a new genesis:")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"Local",active:""}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCAuL3JlbGVhc2UvdjFfMS9jaGVja2Vyc2QgaW5pdCBjaGVja2VycyAtLWNoYWluLWlkIGNoZWNrZXJzLTEK"}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"Docker"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtdCBjaGVja2VycyBcCiAgICAuL3JlbGVhc2UvdjFfMS9jaGVja2Vyc2QgaW5pdCBjaGVja2VycyAtLWNoYWluLWlkIGNoZWNrZXJzLTEK"}})],1)],1),e._v(" "),a("p",[e._v("Give your players the same token amounts that were added by Ignite, as found in "),a("code",[e._v("config.yml")]),e._v(":")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"Local",active:""}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCAuL3JlbGVhc2UvdjFfMS9jaGVja2Vyc2QgYWRkLWdlbmVzaXMtYWNjb3VudCBcCiAgICBhbGljZSAyMDAwMDAwMDBzdGFrZSwyMDAwMHRva2VuIC0ta2V5cmluZy1iYWNrZW5kIHRlc3QKJCAuL3JlbGVhc2UvdjFfMS9jaGVja2Vyc2QgYWRkLWdlbmVzaXMtYWNjb3VudCBcCiAgICBib2IgMTAwMDAwMDAwc3Rha2UsMTAwMDB0b2tlbiAtLWtleXJpbmctYmFja2VuZCB0ZXN0Cg=="}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"Docker"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtdCBjaGVja2VycyBcCiAgICAuL3JlbGVhc2UvdjFfMS9jaGVja2Vyc2QgYWRkLWdlbmVzaXMtYWNjb3VudCBcCiAgICBhbGljZSAyMDAwMDAwMDBzdGFrZSwyMDAwMHRva2VuIC0ta2V5cmluZy1iYWNrZW5kIHRlc3QKJCBkb2NrZXIgZXhlYyAtdCBjaGVja2VycyBcCiAgICAuL3JlbGVhc2UvdjFfMS9jaGVja2Vyc2QgYWRkLWdlbmVzaXMtYWNjb3VudCBcCiAgICBib2IgMTAwMDAwMDAwc3Rha2UsMTAwMDB0b2tlbiAtLWtleXJpbmctYmFja2VuZCB0ZXN0Cg=="}})],1)],1),e._v(" "),a("p",[e._v("To be able to run a quick test, you need to change the voting period of a proposal. This is found in the genesis:")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"Local",active:""}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBqcSAnLmFwcF9zdGF0ZS5nb3Yudm90aW5nX3BhcmFtcy52b3RpbmdfcGVyaW9kJyB+Ly5jaGVja2Vycy9jb25maWcvZ2VuZXNpcy5qc29uCg=="}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"Docker"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtaXQgY2hlY2tlcnMgXAogICAganEgJy5hcHBfc3RhdGUuZ292LnZvdGluZ19wYXJhbXMudm90aW5nX3BlcmlvZCcgL3Jvb3QvLmNoZWNrZXJzL2NvbmZpZy9nZW5lc2lzLmpzb24K"}})],1)],1),e._v(" "),a("p",[e._v("This returns something like:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"json",base64:"JnF1b3Q7MTcyODAwcyZxdW90Owo="}}),e._v(" "),a("p",[e._v("That is two days, which is too long to wait for CLI tests. Choose another value, perhaps 10 minutes (i.e. "),a("code",[e._v('"600s"')]),e._v("). Update it in place in the genesis:")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"Local",active:""}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBjYXQgJmx0OyZsdDsmbHQ7ICQoanEgJy5hcHBfc3RhdGUuZ292LnZvdGluZ19wYXJhbXMudm90aW5nX3BlcmlvZCA9ICZxdW90OzYwMHMmcXVvdDsnIH4vLmNoZWNrZXJzL2NvbmZpZy9nZW5lc2lzLmpzb24pIFwKICAgICZndDsgfi8uY2hlY2tlcnMvY29uZmlnL2dlbmVzaXMuanNvbgo="}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"Docker"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtdCBjaGVja2VycyBcCiAgICBiYXNoIC1jICZxdW90O2NhdCAmbHQ7Jmx0OyZsdDsgXCQoanEgJy5hcHBfc3RhdGUuZ292LnZvdGluZ19wYXJhbXMudm90aW5nX3BlcmlvZCA9IFwmcXVvdDs2MDBzXCZxdW90OycgL3Jvb3QvLmNoZWNrZXJzL2NvbmZpZy9nZW5lc2lzLmpzb24pIFwKICAgICZndDsgL3Jvb3QvLmNoZWNrZXJzL2NvbmZpZy9nZW5lc2lzLmpzb24mcXVvdDsK"}})],1)],1),e._v(" "),a("p",[e._v("You can confirm that the value is in using the earlier command.")]),e._v(" "),a("p",[e._v("Make Alice the chain's validator too by creating a genesis transaction modeled on that done by Ignite, as found in "),a("code",[e._v("config.yml")]),e._v(":")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"Local",active:""}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCAuL3JlbGVhc2UvdjFfMS9jaGVja2Vyc2QgZ2VudHggYWxpY2UgMTAwMDAwMDAwc3Rha2UgXAogICAgLS1rZXlyaW5nLWJhY2tlbmQgdGVzdCAtLWNoYWluLWlkIGNoZWNrZXJzLTEKJCAuL3JlbGVhc2UvdjFfMS9jaGVja2Vyc2QgY29sbGVjdC1nZW50eHMK"}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"Docker"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtdCBjaGVja2VycyBcCiAgICAuL3JlbGVhc2UvdjFfMS9jaGVja2Vyc2QgZ2VudHggYWxpY2UgMTAwMDAwMDAwc3Rha2UgXAogICAgLS1rZXlyaW5nLWJhY2tlbmQgdGVzdCAtLWNoYWluLWlkIGNoZWNrZXJzLTEKJCBkb2NrZXIgZXhlYyAtdCBjaGVja2VycyBcCiAgICAuL3JlbGVhc2UvdjFfMS9jaGVja2Vyc2QgY29sbGVjdC1nZW50eHMK"}})],1)],1),e._v(" "),a("p",[e._v("Now you can start the chain proper:")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"Local",active:""}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCAuL3JlbGVhc2UvdjFfMS9jaGVja2Vyc2Qgc3RhcnQK"}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"Docker"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtaXQgY2hlY2tlcnMgXAogICAgLi9yZWxlYXNlL3YxXzEvY2hlY2tlcnNkIHN0YXJ0IFwKICAgIC0tcnBjLmxhZGRyICZxdW90O3RjcDovLzAuMC4wLjA6MjY2NTcmcXVvdDsK"}}),e._v(" "),a("p",[e._v("Note that you need to force the node to listen on all IP addresses, not just "),a("code",[e._v("127.0.0.1")]),e._v(" as it would do by default.")])],1)],1),e._v(" "),a("hr"),e._v(" "),a("h3",{attrs:{id:"add-games"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#add-games"}},[e._v("#")]),e._v(" Add games")]),e._v(" "),a("p",[e._v("From another shell, create a few un-played games with:")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"Local",active:""}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBleHBvcnQgYWxpY2U9JCguL3JlbGVhc2UvdjFfMS9jaGVja2Vyc2Qga2V5cyBzaG93IGFsaWNlIC1hIC0ta2V5cmluZy1iYWNrZW5kIHRlc3QpCiQgZXhwb3J0IGJvYj0kKC4vcmVsZWFzZS92MV8xL2NoZWNrZXJzZCBrZXlzIHNob3cgYm9iIC1hIC0ta2V5cmluZy1iYWNrZW5kIHRlc3QpCiQgLi9yZWxlYXNlL3YxXzEvY2hlY2tlcnNkIHR4IGNoZWNrZXJzIGNyZWF0ZS1nYW1lIFwKICAgICRhbGljZSAkYm9iIDEwIHN0YWtlIFwKICAgIC0tZnJvbSAkYWxpY2UgLS1rZXlyaW5nLWJhY2tlbmQgdGVzdCAtLXllcyBcCiAgICAtLWNoYWluLWlkIGNoZWNrZXJzLTEgXAogICAgLS1icm9hZGNhc3QtbW9kZSBibG9jawo="}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"Docker"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBleHBvcnQgYWxpY2U9JChkb2NrZXIgZXhlYyBjaGVja2VycyAuL3JlbGVhc2UvdjFfMS9jaGVja2Vyc2Qga2V5cyBzaG93IGFsaWNlIC1hIC0ta2V5cmluZy1iYWNrZW5kIHRlc3QpCiQgZXhwb3J0IGJvYj0kKGRvY2tlciBleGVjIGNoZWNrZXJzIC4vcmVsZWFzZS92MV8xL2NoZWNrZXJzZCBrZXlzIHNob3cgYm9iIC1hIC0ta2V5cmluZy1iYWNrZW5kIHRlc3QpCiQgZG9ja2VyIGV4ZWMgLXQgY2hlY2tlcnMgXAogICAgLi9yZWxlYXNlL3YxXzEvY2hlY2tlcnNkIHR4IGNoZWNrZXJzIGNyZWF0ZS1nYW1lIFwKICAgICRhbGljZSAkYm9iIDEwIHN0YWtlIFwKICAgIC0tZnJvbSAkYWxpY2UgLS1rZXlyaW5nLWJhY2tlbmQgdGVzdCAtLXllcyBcCiAgICAtLWNoYWluLWlkIGNoZWNrZXJzLTEgXAogICAgLS1icm9hZGNhc3QtbW9kZSBibG9jawo="}})],1)],1),e._v(" "),a("HighlightBox",{attrs:{type:"note"}},[a("p",[e._v("The "),a("code",[e._v("--broadcast-mode block")]),e._v(" flag means that you can fire up many such games by just copying the command without facing any sequence errors.")])]),e._v(" "),a("p",[e._v("To get a few complete games, you are going to run the "),a("a",{attrs:{href:"https://github.com/cosmos/academy-checkers-ui/blob/main/test/integration/stored-game-action.ts",target:"_blank",rel:"noopener noreferrer"}},[e._v("integration tests"),a("OutboundLink")],1),e._v(" against it. These tests call a faucet if the accounts do not have enough. Because you do not have a faucet here, you need to credit your test accounts with standard "),a("code",[e._v("bank send")]),e._v(" transactions. You can use the same values as found in the "),a("code",[e._v("before")]),e._v(":")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"Local",active:""}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCAuL3JlbGVhc2UvdjFfMS9jaGVja2Vyc2QgdHggYmFuayBcCiAgICBzZW5kICRhbGljZSBjb3Ntb3MxZng2cWx4d3RlZXF4Z3h3c3c4M3drZjRzOWZjbm53azh6ODZzcWwgMzAwc3Rha2UgXAogICAgLS1mcm9tICRhbGljZSAtLWtleXJpbmctYmFja2VuZCB0ZXN0IFwKICAgIC0tY2hhaW4taWQgY2hlY2tlcnMtMSBcCiAgICAtLWJyb2FkY2FzdC1tb2RlIGJsb2NrIC0teWVzCiQgLi9yZWxlYXNlL3YxXzEvY2hlY2tlcnNkIHR4IGJhbmsgXAogICAgc2VuZCAkYWxpY2UgY29zbW9zMWZ4NnFseHd0ZWVxeGd4d3N3ODN3a2Y0czlmY25ud2s4ejg2c3FsIDEwdG9rZW4gXAogICAgLS1mcm9tICRhbGljZSAtLWtleXJpbmctYmFja2VuZCB0ZXN0IFwKICAgIC0tY2hhaW4taWQgY2hlY2tlcnMtMSBcCiAgICAtLWJyb2FkY2FzdC1tb2RlIGJsb2NrIC0teWVzCiQgLi9yZWxlYXNlL3YxXzEvY2hlY2tlcnNkIHR4IGJhbmsgXAogICAgc2VuZCAkYm9iIGNvc21vczFtcWw5YWF1eDM0NTN0ZGdoazZyemttazQzc3R4dm52aGE0bnYyMiAzMDBzdGFrZSBcCiAgICAtLWZyb20gJGJvYiAtLWtleXJpbmctYmFja2VuZCB0ZXN0IFwKICAgIC0tY2hhaW4taWQgY2hlY2tlcnMtMSBcCiAgICAtLWJyb2FkY2FzdC1tb2RlIGJsb2NrIC0teWVzCiQgLi9yZWxlYXNlL3YxXzEvY2hlY2tlcnNkIHR4IGJhbmsgXAogICAgc2VuZCAkYm9iIGNvc21vczFtcWw5YWF1eDM0NTN0ZGdoazZyemttazQzc3R4dm52aGE0bnYyMiAxMHRva2VuIFwKICAgIC0tZnJvbSAkYm9iIC0ta2V5cmluZy1iYWNrZW5kIHRlc3QgXAogICAgLS1jaGFpbi1pZCBjaGVja2Vycy0xIFwKICAgIC0tYnJvYWRjYXN0LW1vZGUgYmxvY2sgLS15ZXMK"}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"Docker"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtdCBjaGVja2VycyBcCiAgICAuL3JlbGVhc2UvdjFfMS9jaGVja2Vyc2QgdHggYmFuayBcCiAgICBzZW5kICRhbGljZSBjb3Ntb3MxZng2cWx4d3RlZXF4Z3h3c3c4M3drZjRzOWZjbm53azh6ODZzcWwgMzAwc3Rha2UgXAogICAgLS1mcm9tICRhbGljZSAtLWtleXJpbmctYmFja2VuZCB0ZXN0IFwKICAgIC0tY2hhaW4taWQgY2hlY2tlcnMtMSBcCiAgICAtLWJyb2FkY2FzdC1tb2RlIGJsb2NrIC0teWVzCiQgZG9ja2VyIGV4ZWMgLXQgY2hlY2tlcnMgXAogICAgLi9yZWxlYXNlL3YxXzEvY2hlY2tlcnNkIHR4IGJhbmsgXAogICAgc2VuZCAkYWxpY2UgY29zbW9zMWZ4NnFseHd0ZWVxeGd4d3N3ODN3a2Y0czlmY25ud2s4ejg2c3FsIDEwdG9rZW4gXAogICAgLS1mcm9tICRhbGljZSAtLWtleXJpbmctYmFja2VuZCB0ZXN0IFwKICAgIC0tY2hhaW4taWQgY2hlY2tlcnMtMSBcCiAgICAtLWJyb2FkY2FzdC1tb2RlIGJsb2NrIC0teWVzCiQgZG9ja2VyIGV4ZWMgLXQgY2hlY2tlcnMgXAogICAgLi9yZWxlYXNlL3YxXzEvY2hlY2tlcnNkIHR4IGJhbmsgXAogICAgc2VuZCAkYm9iIGNvc21vczFtcWw5YWF1eDM0NTN0ZGdoazZyemttazQzc3R4dm52aGE0bnYyMiAzMDBzdGFrZSBcCiAgICAtLWZyb20gJGJvYiAtLWtleXJpbmctYmFja2VuZCB0ZXN0IFwKICAgIC0tY2hhaW4taWQgY2hlY2tlcnMtMSBcCiAgICAtLWJyb2FkY2FzdC1tb2RlIGJsb2NrIC0teWVzCiQgZG9ja2VyIGV4ZWMgLXQgY2hlY2tlcnMgXAogICAgLi9yZWxlYXNlL3YxXzEvY2hlY2tlcnNkIHR4IGJhbmsgXAogICAgc2VuZCAkYm9iIGNvc21vczFtcWw5YWF1eDM0NTN0ZGdoazZyemttazQzc3R4dm52aGE0bnYyMiAxMHRva2VuIFwKICAgIC0tZnJvbSAkYm9iIC0ta2V5cmluZy1iYWNrZW5kIHRlc3QgXAogICAgLS1jaGFpbi1pZCBjaGVja2Vycy0xIFwKICAgIC0tYnJvYWRjYXN0LW1vZGUgYmxvY2sgLS15ZXMK"}})],1)],1),e._v(" "),a("p",[e._v("With the test accounts sufficiently credited, you can now run the integration tests. Run them three times in a row to create three complete games:")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"Local",active:""}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBwdXNoZCBjbGllbnQgJmFtcDsmYW1wOyBucG0gdGVzdCAmYW1wOyZhbXA7IHBvcGQK"}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"Docker"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IFwKICAgIC12ICQocHdkKS9jbGllbnQ6L2NsaWVudCBcCiAgICAtdyAvY2xpZW50IFwKICAgIC0tbmV0d29yayBjaGVja2Vycy1uZXQgXAogICAgLS1lbnYgUlBDX1VSTD0mcXVvdDtodHRwOi8vY2hlY2tlcnM6MjY2NTcmcXVvdDsgXAogICAgbm9kZToxOC43LXNsaW0gXAogICAgbnBtIHRlc3QK"}})],1)],1),e._v(" "),a("hr"),e._v(" "),a("p",[e._v("You can confirm that you have computed player info:")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"Local",active:""}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCAuL3JlbGVhc2UvdjFfMS9jaGVja2Vyc2QgcXVlcnkgY2hlY2tlcnMgXAogICAgbGlzdC1wbGF5ZXItaW5mbyAtLW91dHB1dCBqc29uIFwKICAgIHwganEgJy5wbGF5ZXJJbmZvJwo="}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"Docker"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtdCBjaGVja2VycyBcCiAgICBiYXNoIC1jICZxdW90Oy4vcmVsZWFzZS92MV8xL2NoZWNrZXJzZCBxdWVyeSBjaGVja2VycyBcCiAgICAgICAgbGlzdC1wbGF5ZXItaW5mbyAtLW91dHB1dCBqc29uIFwKICAgICAgICB8IGpxICcucGxheWVySW5mbycmcXVvdDsK"}})],1)],1),e._v(" "),a("p",[e._v("With enough games in the system, you can move to the software upgrade governance proposal.")]),e._v(" "),a("h3",{attrs:{id:"governance-proposal"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#governance-proposal"}},[e._v("#")]),e._v(" Governance proposal")]),e._v(" "),a("p",[e._v("For the software upgrade governance proposal, you want to make sure that it stops the chain not too far in the future but still after the voting period. With a voting period of 10 minutes, take 15 minutes. How many seconds does a block take?")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"Local",active:""}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBqcSAtciAmcXVvdDsuYXBwX3N0YXRlLm1pbnQucGFyYW1zLmJsb2Nrc19wZXJfeWVhciZxdW90OyBcCiAgICB+Ly5jaGVja2Vycy9jb25maWcvZ2VuZXNpcy5qc29uCg=="}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"Docker"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtdCBjaGVja2VycyBcCiAgICBiYXNoIC1jICdqcSAtciAmcXVvdDsuYXBwX3N0YXRlLm1pbnQucGFyYW1zLmJsb2Nrc19wZXJfeWVhciZxdW90OyAvcm9vdC8uY2hlY2tlcnMvY29uZmlnL2dlbmVzaXMuanNvbicK"}})],1)],1),e._v(" "),a("p",[e._v("This returns something like:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"txt",base64:"NjMxMTUyMAo="}}),e._v(" "),a("p",[e._v("That many "),a("code",[e._v("blocks_per_year")]),e._v(" computes down to 5 seconds per block. At this rate, 15 minutes mean 180 blocks.")]),e._v(" "),a("p",[e._v("What is the current block height? Check:")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"Local",active:""}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCAuL3JlbGVhc2UvdjFfMS9jaGVja2Vyc2Qgc3RhdHVzIFwKICAgIHwganEgLXIgJnF1b3Q7LlN5bmNJbmZvLmxhdGVzdF9ibG9ja19oZWlnaHQmcXVvdDsK"}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"Docker"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtdCBjaGVja2VycyBcCiAgICBiYXNoIC1jICcuL3JlbGVhc2UvdjFfMS9jaGVja2Vyc2Qgc3RhdHVzIFwKICAgICAgICB8IGpxIC1yICZxdW90Oy5TeW5jSW5mby5sYXRlc3RfYmxvY2tfaGVpZ2h0JnF1b3Q7Jwo="}})],1)],1),e._v(" "),a("p",[e._v("This returns something like:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"json",base64:"MTAwMAo="}}),e._v(" "),a("p",[e._v("That means you will use:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"txt",base64:"LS11cGdyYWRlLWhlaWdodCAxMTgwCg=="}}),e._v(" "),a("p",[e._v("What is the minimum deposit for a proposal? Check:")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"Local",active:""}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBqcSAmcXVvdDsuYXBwX3N0YXRlLmdvdi5kZXBvc2l0X3BhcmFtcy5taW5fZGVwb3NpdCZxdW90OyBcCiAgICB+Ly5jaGVja2Vycy9jb25maWcvZ2VuZXNpcy5qc29uCg=="}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"Docker"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtdCBjaGVja2VycyBcCiAgICBiYXNoIC1jICdqcSAmcXVvdDsuYXBwX3N0YXRlLmdvdi5kZXBvc2l0X3BhcmFtcy5taW5fZGVwb3NpdCZxdW90OyBcCiAgICAgICAgL3Jvb3QvLmNoZWNrZXJzL2NvbmZpZy9nZW5lc2lzLmpzb24nCg=="}})],1)],1),e._v(" "),a("p",[e._v("This returns something like:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"json",base64:"WwogICAgewogICAgICAgICZxdW90O2Rlbm9tJnF1b3Q7OiAmcXVvdDtzdGFrZSZxdW90OywKICAgICAgICAmcXVvdDthbW91bnQmcXVvdDs6ICZxdW90OzEwMDAwMDAwJnF1b3Q7CiAgICB9Cl0K"}}),e._v(" "),a("p",[e._v("This is the minimum amount that Alice has to deposit when submitting the proposal. This will do:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"txt",base64:"LS1kZXBvc2l0IDEwMDAwMDAwc3Rha2UK"}}),e._v(" "),a("p",[e._v("Now submit your governance proposal upgrade:")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"Local",active:""}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCAuL3JlbGVhc2UvdjFfMS9jaGVja2Vyc2QgdHggZ292IHN1Ym1pdC1wcm9wb3NhbCBzb2Z0d2FyZS11cGdyYWRlIHYxXzF0b3YyIFwKICAgIC0tdGl0bGUgJnF1b3Q7djFfMXRvdjImcXVvdDsgXAogICAgLS1kZXNjcmlwdGlvbiAmcXVvdDtJbmNyZWFzZSBlbmdhZ2VtZW50IHZpYSB0aGUgdXNlIG9mIGEgbGVhZGVyYm9hcmQmcXVvdDsgXAogICAgLS1mcm9tICRhbGljZSAtLWtleXJpbmctYmFja2VuZCB0ZXN0IC0teWVzIFwKICAgIC0tY2hhaW4taWQgY2hlY2tlcnMtMSBcCiAgICAtLWJyb2FkY2FzdC1tb2RlIGJsb2NrIFwKICAgIC0tdXBncmFkZS1oZWlnaHQgMTE4MCBcCiAgICAtLWRlcG9zaXQgMTAwMDAwMDBzdGFrZQo="}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"Docker"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtdCBjaGVja2VycyBcCiAgICAuL3JlbGVhc2UvdjFfMS9jaGVja2Vyc2QgdHggZ292IHN1Ym1pdC1wcm9wb3NhbCBzb2Z0d2FyZS11cGdyYWRlIHYxXzF0b3YyIFwKICAgIC0tdGl0bGUgJnF1b3Q7djFfMXRvdjImcXVvdDsgXAogICAgLS1kZXNjcmlwdGlvbiAmcXVvdDtJbmNyZWFzZSBlbmdhZ2VtZW50IHZpYSB0aGUgdXNlIG9mIGEgbGVhZGVyYm9hcmQmcXVvdDsgXAogICAgLS1mcm9tICRhbGljZSAtLWtleXJpbmctYmFja2VuZCB0ZXN0IC0teWVzIFwKICAgIC0tY2hhaW4taWQgY2hlY2tlcnMtMSBcCiAgICAtLWJyb2FkY2FzdC1tb2RlIGJsb2NrIFwKICAgIC0tdXBncmFkZS1oZWlnaHQgMTE4MCBcCiAgICAtLWRlcG9zaXQgMTAwMDAwMDBzdGFrZQo="}})],1)],1),e._v(" "),a("p",[e._v("This returns something like:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"yaml",base64:"ICAuLi4KICB0eXBlOiBwcm9wb3NhbF9kZXBvc2l0Ci0gYXR0cmlidXRlczoKICAtIGtleTogcHJvcG9zYWxfaWQKICAgIHZhbHVlOiAmcXVvdDsxJnF1b3Q7CiAgLSBrZXk6IHByb3Bvc2FsX3R5cGUKICAgIHZhbHVlOiBTb2Z0d2FyZVVwZ3JhZGUKICAtIGtleTogdm90aW5nX3BlcmlvZF9zdGFydAogICAgdmFsdWU6ICZxdW90OzEmcXVvdDsKICAuLi4K"}}),e._v(" "),a("p",[e._v("Where "),a("code",[e._v("1")]),e._v(" is the proposal ID you reuse. Have Alice and Bob vote yes on it:")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"Local",active:""}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCAuL3JlbGVhc2UvdjFfMS9jaGVja2Vyc2QgdHggZ292IHZvdGUgMSB5ZXMgXAogICAgLS1mcm9tICRhbGljZSAtLWtleXJpbmctYmFja2VuZCB0ZXN0IC0teWVzIFwKICAgIC0tY2hhaW4taWQgY2hlY2tlcnMtMQokIC4vcmVsZWFzZS92MV8xL2NoZWNrZXJzZCB0eCBnb3Ygdm90ZSAxIHllcyBcCiAgICAtLWZyb20gJGJvYiAtLWtleXJpbmctYmFja2VuZCB0ZXN0IC0teWVzIFwKICAgIC0tY2hhaW4taWQgY2hlY2tlcnMtMQo="}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"Docker"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtdCBjaGVja2VycyBcCiAgICAuL3JlbGVhc2UvdjFfMS9jaGVja2Vyc2QgdHggZ292IHZvdGUgMSB5ZXMgXAogICAgLS1mcm9tICRhbGljZSAtLWtleXJpbmctYmFja2VuZCB0ZXN0IC0teWVzIFwKICAgIC0tY2hhaW4taWQgY2hlY2tlcnMtMQokIGRvY2tlciBleGVjIC10IGNoZWNrZXJzIFwKICAgIC4vcmVsZWFzZS92MV8xL2NoZWNrZXJzZCB0eCBnb3Ygdm90ZSAxIHllcyBcCiAgICAtLWZyb20gJGJvYiAtLWtleXJpbmctYmFja2VuZCB0ZXN0IC0teWVzIFwKICAgIC0tY2hhaW4taWQgY2hlY2tlcnMtMQo="}})],1)],1),e._v(" "),a("p",[e._v("Confirm that it has collected the votes:")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"Local",active:""}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCAuL3JlbGVhc2UvdjFfMS9jaGVja2Vyc2QgcXVlcnkgZ292IHZvdGVzIDEK"}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"Docker"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtdCBjaGVja2VycyBcCiAgICAuL3JlbGVhc2UvdjFfMS9jaGVja2Vyc2QgcXVlcnkgZ292IHZvdGVzIDEK"}})],1)],1),e._v(" "),a("p",[e._v("It should print:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"yaml",base64:"dm90ZXM6Ci0gb3B0aW9uOiBWT1RFX09QVElPTl9ZRVMKICBvcHRpb25zOgogIC0gb3B0aW9uOiBWT1RFX09QVElPTl9ZRVMKICAgIHdlaWdodDogJnF1b3Q7MS4wMDAwMDAwMDAwMDAwMDAwMDAmcXVvdDsKICBwcm9wb3NhbF9pZDogJnF1b3Q7MSZxdW90OwogIHZvdGVyOiBjb3Ntb3MxaHpmdG5zdG1senFmYWowcnozOWhuNXBlMnZwcHowcGh5NHg5Y3QKLSBvcHRpb246IFZPVEVfT1BUSU9OX1lFUwogIG9wdGlvbnM6CiAgLSBvcHRpb246IFZPVEVfT1BUSU9OX1lFUwogICAgd2VpZ2h0OiAmcXVvdDsxLjAwMDAwMDAwMDAwMDAwMDAwMCZxdW90OwogIHByb3Bvc2FsX2lkOiAmcXVvdDsxJnF1b3Q7CiAgdm90ZXI6IGNvc21vczFoajJ4ODJqNDlmdjkwdGd0ZHhyZHc1ZnozdzJ2cWVxcWpocnhsZQo="}}),e._v(" "),a("p",[e._v("See how long you have to wait for the chain to reach the end of the voting period:")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"Local",active:""}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCAuL3JlbGVhc2UvdjFfMS9jaGVja2Vyc2QgcXVlcnkgZ292IHByb3Bvc2FsIDEK"}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"Docker"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtdCBjaGVja2VycyBcCiAgICAuL3JlbGVhc2UvdjFfMS9jaGVja2Vyc2QgcXVlcnkgZ292IHByb3Bvc2FsIDEK"}})],1)],1),e._v(" "),a("p",[e._v("In the end this prints:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"txt",base64:"Li4uCnN0YXR1czogUFJPUE9TQUxfU1RBVFVTX1ZPVElOR19QRVJJT0QKLi4uCnZvdGluZ19lbmRfdGltZTogJnF1b3Q7MjAyMi0wOC0yNVQxMDozODoyMi4yNDA3NjYxMDNaJnF1b3Q7Ci4uLgo="}}),e._v(" "),a("p",[e._v("Wait for this period. Afterward, with the same command you should see:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"txt",base64:"Li4uCnN0YXR1czogUFJPUE9TQUxfU1RBVFVTX1BBU1NFRAouLi4K"}}),e._v(" "),a("p",[e._v("Now wait for the chain to reach the desired block height, which should take five more minutes as per your parameters. When it has reached that height, the shell with the running "),a("code",[e._v("checkersd")]),e._v(" should show something like:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"txt",base64:"Li4uCjY6MjlQTSBJTkYgZmluYWxpemluZyBjb21taXQgb2YgYmxvY2sgaGFzaD1FNkNCNkYxRThDRjQ2OTk1NDM5NTBGNzU2RjNFMTVBRTQ0NzcwMUFCQUM0OThDREJBODY2MzNBQzkzQTczRUU3IGhlaWdodD0xMTgwIG1vZHVsZT1jb25zZW5zdXMgbnVtX3R4cz0wIHJvb3Q9MjFFNTFFNTJBQTNGMDZCRTU5Qzc4Q0UxMUQzMTcxRTZGNzI0MEQyOTdFNEJDRUFCMDdGQzVBODc5NTdCM0JFMgo2OjI5UE0gRVJSIFVQR1JBREUgJnF1b3Q7djFfMXRvdjImcXVvdDsgTkVFREVEIGF0IGhlaWdodDogMTE4MDoKNjoyOVBNIEVSUiBDT05TRU5TVVMgRkFJTFVSRSEhISBlcnI9JnF1b3Q7VVBHUkFERSBcJnF1b3Q7djFfMXRvdjJcJnF1b3Q7IE5FRURFRCBhdCBoZWlnaHQ6IDExODA6ICZxdW90OyBtb2R1bGU9Y29uc2Vuc3VzIHN0YWNrPSZxdW90O2dvcm91dGluZSA2MiBbcnVubmluZ106XG5ydW50aW1lL2RlYnVnLlN0YWNrCi4uLgo2OjI5UE0gSU5GIFN0b3BwaW5nIGJhc2VXQUwgc2VydmljZSBpbXBsPXsmcXVvdDtMb2dnZXImcXVvdDs6e319IG1vZHVsZT1jb25zZW5zdXMgd2FsPS9yb290Ly5jaGVja2Vycy9kYXRhL2NzLndhbC93YWwKNjoyOVBNIElORiBTdG9wcGluZyBHcm91cCBzZXJ2aWNlIGltcGw9eyZxdW90O0RpciZxdW90OzomcXVvdDsvcm9vdC8uY2hlY2tlcnMvZGF0YS9jcy53YWwmcXVvdDssJnF1b3Q7SGVhZCZxdW90Ozp7JnF1b3Q7SUQmcXVvdDs6JnF1b3Q7WnNBbE43REVaQWJWOi9yb290Ly5jaGVja2Vycy9kYXRhL2NzLndhbC93YWwmcXVvdDssJnF1b3Q7UGF0aCZxdW90OzomcXVvdDsvcm9vdC8uY2hlY2tlcnMvZGF0YS9jcy53YWwvd2FsJnF1b3Q7fSwmcXVvdDtJRCZxdW90OzomcXVvdDtncm91cDpac0FsTjdERVpBYlY6L3Jvb3QvLmNoZWNrZXJzL2RhdGEvY3Mud2FsL3dhbCZxdW90OywmcXVvdDtMb2dnZXImcXVvdDs6e319IG1vZHVsZT1jb25zZW5zdXMgd2FsPS9yb290Ly5jaGVja2Vycy9kYXRhL2NzLndhbC93YWwKLi4uCg=="}}),e._v(" "),a("p",[e._v("At this point, run in another shell:")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"Local",active:""}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCAuL3JlbGVhc2UvdjFfMS9jaGVja2Vyc2Qgc3RhdHVzIFwKICAgIHwganEgLXIgJnF1b3Q7LlN5bmNJbmZvLmxhdGVzdF9ibG9ja19oZWlnaHQmcXVvdDsK"}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"Docker"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtaXQgY2hlY2tlcnMgXAogICAgYmFzaCAtYyAnLi9yZWxlYXNlL3YxXzEvY2hlY2tlcnNkIHN0YXR1cyBcCiAgICAgICAgfCBqcSAtciAmcXVvdDsuU3luY0luZm8ubGF0ZXN0X2Jsb2NrX2hlaWdodCZxdW90OycK"}})],1)],1),e._v(" "),a("p",[e._v("You should always get the same value, no matter how many times you try. That is because the chain has stopped. For instance:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"txt",base64:"MTE4MAo="}}),e._v(" "),a("p",[e._v("Stop "),a("code",[e._v("checkersd")]),e._v(" with "),a("kbd",[e._v("CTRL-C")]),e._v(". It has saved a new file:")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"Local",active:""}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBjYXQgfi8uY2hlY2tlcnMvZGF0YS91cGdyYWRlLWluZm8uanNvbgo="}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"Docker"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtaXQgY2hlY2tlcnMgXAogICAgY2F0IC9yb290Ly5jaGVja2Vycy9kYXRhL3VwZ3JhZGUtaW5mby5qc29uCg=="}})],1)],1),e._v(" "),a("p",[e._v("This prints:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"json",base64:"eyZxdW90O25hbWUmcXVvdDs6JnF1b3Q7djFfMXRvdjImcXVvdDssJnF1b3Q7aGVpZ2h0JnF1b3Q7OjExODB9Cg=="}}),e._v(" "),a("p",[e._v("With your node (and therefore your whole blockchain) down, you are ready to move to v2.")]),e._v(" "),a("h3",{attrs:{id:"launch-v2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#launch-v2"}},[e._v("#")]),e._v(" Launch v2")]),e._v(" "),a("p",[e._v("With v1_1 stopped and its state saved, it is time to move to v2. Checkout v2 of checkers:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBnaXQgY2hlY2tvdXQgbGVhZGVyYm9hcmQtbWlncmF0aW9uCg=="}}),e._v(" "),a("p",[e._v("Back in the first shell, build the v2 executable:")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"Local",active:""}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBnbyBidWlsZCAtbyAuL3JlbGVhc2UvdjIvY2hlY2tlcnNkIC4vY21kL2NoZWNrZXJzZC9tYWluLmdvCg=="}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"Docker"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IFwKICAgIC12ICQocHdkKTovY2hlY2tlcnMgXAogICAgLXcgL2NoZWNrZXJzIFwKICAgIGNoZWNrZXJzX2kgXAogICAgZ28gYnVpbGQgLW8gLi9yZWxlYXNlL3YyL2NoZWNrZXJzZCAuL2NtZC9jaGVja2Vyc2QvbWFpbi5nbwo="}})],1)],1),e._v(" "),a("p",[e._v("Launch it:")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"Local",active:""}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCAuL3JlbGVhc2UvdjIvY2hlY2tlcnNkIHN0YXJ0Cg=="}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"Docker"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtaXQgY2hlY2tlcnMgXAogICAgLi9yZWxlYXNlL3YyL2NoZWNrZXJzZCBzdGFydCBcCiAgICAtLXJwYy5sYWRkciAmcXVvdDt0Y3A6Ly8wLjAuMC4wOjI2NjU3JnF1b3Q7Cg=="}})],1)],1),e._v(" "),a("p",[e._v("It should start and display something like:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"txt",base64:"Li4uCjc6MDZQTSBJTkYgYXBwbHlpbmcgdXBncmFkZSAmcXVvdDt2MV8xdG92MiZxdW90OyBhdCBoZWlnaHQ6IDExODAKNzowNlBNIElORiBMZWFkZXJib2FyZCBnZW5lc2lzIHNhdmVkCi4uLgo="}}),e._v(" "),a("p",[e._v("After it has started, you can confirm in another shell that you have the expected leaderboard with:")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"Local",active:""}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCAuL3JlbGVhc2UvdjIvY2hlY2tlcnNkIHF1ZXJ5IGxlYWRlcmJvYXJkIHNob3ctbGVhZGVyYm9hcmQK"}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"Docker"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtdCBjaGVja2VycyBcCiAgICAuL3JlbGVhc2UvdjIvY2hlY2tlcnNkIHF1ZXJ5IGxlYWRlcmJvYXJkIHNob3ctbGVhZGVyYm9hcmQK"}})],1)],1),e._v(" "),a("p",[e._v("This should print something like:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"yaml",base64:"TGVhZGVyYm9hcmQ6CiAgd2lubmVyczoKICAtIGFkZGVkQXQ6ICZxdW90OzE2ODI5ODM2NTkmcXVvdDsKICAgIGFkZHJlc3M6IGNvc21vczFmeDZxbHh3dGVlcXhneHdzdzgzd2tmNHM5ZmNubndrOHo4NnNxbAogICAgd29uQ291bnQ6ICZxdW90OzMmcXVvdDsK"}}),e._v(" "),a("p",[e._v("Note how it took the time of the block when v1_1 stopped.")]),e._v(" "),a("p",[e._v("Congratulations, you have upgraded your blockchain almost as if in production!")]),e._v(" "),a("p",[e._v("You can stop Ignite CLI. If you used Docker that would be:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgc3RvcCBjaGVja2VycwokIGRvY2tlciBybSBjaGVja2VycwokIGRvY2tlciBuZXR3b3JrIHJtIGNoZWNrZXJzLW5ldAo="}}),e._v(" "),a("p",[e._v("Your checkers blockchain is done! It has a leaderboard, which was introduced later in production thanks to migrations.")]),e._v(" "),a("p",[e._v("You no doubt have many ideas about how to improve it. In particular, you could implement the missing "),a("em",[e._v("draw")]),e._v(" mechanism, which in effect has to be accepted by both players.")]),e._v(" "),a("HighlightBox",{attrs:{type:"synopsis"}},[a("p",[e._v("To summarize, this section has explored:")]),e._v(" "),a("ul",[a("li",[e._v("How to add a leaderboard to an existing blockchain.")]),e._v(" "),a("li",[e._v("How to upgrade a blockchain in production, by migrating from v1_1 of the blockchain to v2, and the new store structure that will be introduced by the upgrade.")]),e._v(" "),a("li",[e._v("How to handle the data migrations and logic upgrades implicit during migration, such as with the use of helper functions.")]),e._v(" "),a("li",[e._v("Worthwhile unit tests with regard to leaderboard handling.")]),e._v(" "),a("li",[e._v("A complete procedure for how to conduct the update via the CLI.")])])])],1)}),[],!1,null,null,null);t.default=c.exports}}]);