(window.webpackJsonp=window.webpackJsonp||[]).push([[131],{747:function(e,t,g){"use strict";g.r(t);var o=g(1),a=Object(o.a)({},(function(){var e=this,t=e.$createElement,g=e._self._c||t;return g("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[g("h1",{attrs:{id:"put-your-games-in-order"}},[g("a",{staticClass:"header-anchor",attrs:{href:"#put-your-games-in-order"}},[e._v("#")]),e._v(" Put Your Games in Order")]),e._v(" "),g("HighlightBox",{attrs:{type:"prerequisite"}},[g("p",[e._v("Make sure you have everything you need before proceeding:")]),e._v(" "),g("ul",[g("li",[e._v("You understand the concepts of "),g("RouterLink",{attrs:{to:"/academy/2-cosmos-concepts/1-architecture.html"}},[e._v("ABCI")]),e._v(", "),g("RouterLink",{attrs:{to:"/academy/2-cosmos-concepts/6-protobuf.html"}},[e._v("Protobuf")]),e._v(", and of a "),g("a",{attrs:{href:"https://en.wikipedia.org/wiki/Doubly_linked_list",target:"_blank",rel:"noopener noreferrer"}},[e._v("doubly-linked list"),g("OutboundLink")],1),e._v(".")],1),e._v(" "),g("li",[e._v("Go is installed.")]),e._v(" "),g("li",[e._v("You have the checkers blockchain codebase with "),g("code",[e._v("Winner")]),e._v(", "),g("code",[e._v("GameDeadline")]),e._v(", and "),g("code",[e._v("MoveCount")]),e._v(". If not, follow the "),g("RouterLink",{attrs:{to:"/hands-on-exercise/2-ignite-cli-adv/2-move-count.html"}},[e._v("previous steps")]),e._v(" or check out "),g("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/tree/move-count",target:"_blank",rel:"noopener noreferrer"}},[e._v("the relevant version"),g("OutboundLink")],1),e._v(".")],1)])]),e._v(" "),g("HighlightBox",{attrs:{type:"learning"}},[g("p",[e._v("In this section, you will deal with:")]),e._v(" "),g("ul",[g("li",[e._v("A FIFO data structure")]),e._v(" "),g("li",[e._v("FIFO unit tests")])]),e._v(" "),g("p",[e._v("You will learn:")]),e._v(" "),g("ul",[g("li",[e._v("Modularity and data organization styles")])])]),e._v(" "),g("p",[e._v("In previous steps, you added the "),g("RouterLink",{attrs:{to:"/hands-on-exercise/1-ignite-cli/8-game-winner.html"}},[e._v("game winner")]),e._v(", the "),g("RouterLink",{attrs:{to:"/hands-on-exercise/2-ignite-cli-adv/1-game-deadline.html"}},[e._v("game deadline")]),e._v(", and the "),g("RouterLink",{attrs:{to:"/hands-on-exercise/2-ignite-cli-adv/2-move-count.html"}},[e._v("move count")]),e._v(". These are fields that can help you determine whether a given game is stale or not.")],1),e._v(" "),g("p",[e._v("Specifically:")]),e._v(" "),g("ul",[g("li",[e._v("If the game has a winner, then it is not considered stale.")]),e._v(" "),g("li",[e._v("If the game's deadline is in the future, then it is not stale.")]),e._v(" "),g("li",[e._v("If the game's count is 0 or 1 then it should be deleted when stale.")]),e._v(" "),g("li",[e._v("If the game's count is 2 or more, then it should be forfeited when stale.")])]),e._v(" "),g("h2",{attrs:{id:"some-initial-thoughts"}},[g("a",{staticClass:"header-anchor",attrs:{href:"#some-initial-thoughts"}},[e._v("#")]),e._v(" Some initial thoughts")]),e._v(" "),g("p",[e._v("The key difficulty is to get the list of games that satisfy the "),g("em",[e._v("staleness")]),e._v(" criteria without grinding your blockchain to a halt with an "),g("em",[e._v("O(n)")]),e._v(" call, where "),g("em",[e._v("n")]),e._v(" is the total number of games in storage.")]),e._v(" "),g("p",[e._v("A solution is to introduce a new data structure that will let you find one stale game in "),g("em",[e._v("O(1)")]),e._v(", and access all "),g("em",[e._v("k")]),e._v(" stale games in "),g("em",[e._v("O(k)")]),e._v(".")]),e._v(" "),g("p",[e._v("There are some initial thoughts and code needs to keep in mind during the next sections to be able to implement forfeits in the end.")]),e._v(" "),g("p",[e._v("Before you begin touching your code, ask:")]),e._v(" "),g("ul",[g("li",[e._v("What conditions have to be satisfied for a game to be considered stale and the blockchain to act? There are some pointers in the first paragraph.")]),e._v(" "),g("li",[e._v("How would you get rid of stale games as part of the protocol, that is "),g("em",[e._v("without user inputs")]),e._v("?")]),e._v(" "),g("li",[e._v("How do you optimize performance and data structures so that a few stale games do not cause your blockchain to grind to a halt?")]),e._v(" "),g("li",[e._v("How can you be sure that your blockchain is safe from attacks?")]),e._v(" "),g("li",[e._v("How do you make your changes compatible with future plans for wagers?")]),e._v(" "),g("li",[e._v("Are there errors to report back?")]),e._v(" "),g("li",[e._v("What event should you emit?")])]),e._v(" "),g("h2",{attrs:{id:"code-needs"}},[g("a",{staticClass:"header-anchor",attrs:{href:"#code-needs"}},[e._v("#")]),e._v(" Code needs")]),e._v(" "),g("p",[e._v("Now, think about what possible code changes and additions you should consider:")]),e._v(" "),g("ul",[g("li",[e._v("What Ignite CLI commands, if any, will assist you?")]),e._v(" "),g("li",[e._v("How do you adjust what Ignite CLI created for you?")]),e._v(" "),g("li",[e._v("How would you unit-test these new elements?")]),e._v(" "),g("li",[e._v("How would you use Ignite CLI to locally run a one-node blockchain and interact with it via the CLI to see what you get?")])]),e._v(" "),g("p",[e._v("For now, do not bother yet with future ideas like wager handling.")]),e._v(" "),g("h2",{attrs:{id:"why-would-you-get-rid-of-stale-games"}},[g("a",{staticClass:"header-anchor",attrs:{href:"#why-would-you-get-rid-of-stale-games"}},[e._v("#")]),e._v(" Why would you get rid of stale games?")]),e._v(" "),g("p",[e._v("There is only one way for a game to advance through its lifecycle until resolution, win or draw: to "),g("em",[e._v("play")]),e._v(" it.")]),e._v(" "),g("p",[e._v("Game inactivity could become a factor. What if a player never shows up again? Should a game remain in limbo forever?")]),e._v(" "),g("p",[e._v("Eventually you want to let players wager on the outcome of games, so you do not want games remaining in limbo if they have "),g("em",[e._v("value")]),e._v(" assigned. For this reason, you need a way for games to be forcibly resolved if one player stops responding.")]),e._v(" "),g("HighlightBox",{attrs:{type:"info"}},[g("p",[e._v("The simplest mechanism to expire a game is to use a "),g("strong",[e._v("deadline")]),e._v(". If the deadline is reached, then the game is forcibly terminated and expires. The deadline is pushed back every time a move is played.")])]),e._v(" "),g("p",[e._v("To enforce the termination, it is a good idea to use the "),g("strong",[g("code",[e._v("EndBlock")])]),e._v(" part of the ABCI protocol. The call "),g("code",[e._v("EndBlock")]),e._v(" is triggered when all transactions of the block are delivered, and allows you to tidy up before the block is sealed. In your case, all games that have reached their deadline will be terminated.")]),e._v(" "),g("p",[e._v("How do you find all the games that have reached their deadline? You could use a pseudo-code like:")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"javascript",base64:"ZmluZEFsbChnYW1lID0mZ3Q7IGdhbWUuZGVhZGxpbmUgJmx0OyBub3cpCg=="}}),e._v(" "),g("p",[e._v("This approach is "),g("strong",[e._v("expensive")]),e._v(" in terms of computation. The "),g("code",[e._v("EndBlock")]),e._v(" code should not have to pull up all games out of the storage just to find a few that are relevant. Doing a "),g("code",[e._v("findAll")]),e._v(" costs "),g("a",{attrs:{href:"https://en.wikipedia.org/wiki/Big_O_notation",target:"_blank",rel:"noopener noreferrer"}},[g("code",[e._v("O(n)")]),g("OutboundLink")],1),e._v(", where "),g("code",[e._v("n")]),e._v(" is the total number of games.")]),e._v(" "),g("h2",{attrs:{id:"how-can-you-get-rid-of-expired-games"}},[g("a",{staticClass:"header-anchor",attrs:{href:"#how-can-you-get-rid-of-expired-games"}},[e._v("#")]),e._v(" How can you get rid of expired games?")]),e._v(" "),g("p",[e._v("You need another data structure. The simplest option is a First-In-First-Out (FIFO) that is constantly updated, so that:")]),e._v(" "),g("ul",[g("li",[e._v("When games are played, they are taken out of where they are and sent to the tail.")]),e._v(" "),g("li",[e._v("It follows that games that have not been played for the longest time eventually rise to the head.")])]),e._v(" "),g("p",[e._v("Therefore, when terminating expired games in "),g("code",[e._v("EndBlock")]),e._v(", you deal with the expired games that are at the head of the FIFO. You do not stop until the head includes an ongoing game. The cost is:")]),e._v(" "),g("ul",[g("li",[g("code",[e._v("O(1)")]),e._v(" on each game creation and gameplay.")]),e._v(" "),g("li",[g("code",[e._v("O(k)")]),e._v(" where "),g("code",[e._v("k")]),e._v(" is the number of expired games on each block.")]),e._v(" "),g("li",[g("code",[e._v("k <= n")]),e._v(" where "),g("code",[e._v("n")]),e._v(" is the number of games that exist.")])]),e._v(" "),g("p",[g("code",[e._v("k")]),e._v(" is still an unbounded number of operations. However, if you use the same expiration duration on each game, for "),g("code",[e._v("k")]),e._v(" games to expire together in a block they would all have to have had a move in the same previous block (give or take the block before or after). In the worst case, the largest "),g("code",[e._v("EndBlock")]),e._v(" computation will be proportional to the largest regular block in the past. This is a reasonable risk to take.")]),e._v(" "),g("HighlightBox",{attrs:{type:"remember"}},[g("p",[e._v("This only works if the expiration duration is the same for all games, instead of being a parameter left to a potentially malicious game creator.")])]),e._v(" "),g("h2",{attrs:{id:"new-information"}},[g("a",{staticClass:"header-anchor",attrs:{href:"#new-information"}},[e._v("#")]),e._v(" New information")]),e._v(" "),g("p",[e._v("How do you implement a FIFO from which you extract elements at random positions? Choose a doubly-linked list:")]),e._v(" "),g("ol",[g("li",[g("p",[e._v("You must remember the game ID at the head to pick expired games, and at the tail to send back fresh games. The existing "),g("code",[e._v("SystemInfo")]),e._v(" object is useful, as it is already expandable. Add to its Protobuf declaration:")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-protobuf",base64:"ICAgIG1lc3NhZ2UgU3lzdGVtSW5mbyB7CiAgICAgICAgLi4uCisgICAgICBzdHJpbmcgZmlmb0hlYWRJbmRleCA9IDI7IC8vIFdpbGwgY29udGFpbiB0aGUgaW5kZXggb2YgdGhlIGdhbWUgYXQgdGhlIGhlYWQuCisgICAgICBzdHJpbmcgZmlmb1RhaWxJbmRleCA9IDM7IC8vIFdpbGwgY29udGFpbiB0aGUgaW5kZXggb2YgdGhlIGdhbWUgYXQgdGhlIHRhaWwuCiAgICB9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/fifo-fields/proto/checkers/system_info.proto#L8-L9"}})],1),e._v(" "),g("li",[g("p",[e._v("To make extraction possible, each game must know which other game takes place before it in the FIFO, and which after. Store this double-link information in "),g("code",[e._v("StoredGame")]),e._v(". Add them to the game's Protobuf declaration:")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-protobuf",base64:"ICAgIG1lc3NhZ2UgU3RvcmVkR2FtZSB7CiAgICAgICAgLi4uCisgICAgICBzdHJpbmcgYmVmb3JlSW5kZXggPSA5OyAvLyBQZXJ0YWlucyB0byB0aGUgRklGTy4gVG93YXJkIGhlYWQuCisgICAgICAgc3RyaW5nIGFmdGVySW5kZXggPSAxMDsgLy8gUGVydGFpbnMgdG8gdGhlIEZJRk8uIFRvd2FyZCB0YWlsLgogICAgfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/fifo-fields/proto/checkers/stored_game.proto#L15-L16"}})],1),e._v(" "),g("li",[g("p",[e._v('There must be an "ID" that indicates '),g("em",[e._v("no game")]),e._v(". Use "),g("code",[e._v('"-1"')]),e._v(", which you save as a constant:")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Y29uc3QgKAogICAgTm9GaWZvSW5kZXggPSAmcXVvdDstMSZxdW90OwopCg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/fifo-fields/x/checkers/types/keys.go#L53-L55"}})],1),e._v(" "),g("li",[g("p",[e._v("Instruct Ignite CLI and Protobuf to regenerate the Protobuf files:")]),e._v(" "),g("CodeGroup",[g("CodeGroupItem",{attrs:{title:"Local",active:""}},[g("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBpZ25pdGUgZ2VuZXJhdGUgcHJvdG8tZ28K"}})],1),e._v(" "),g("CodeGroupItem",{attrs:{title:"Docker"}},[g("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IFwKICAgIC12ICQocHdkKTovY2hlY2tlcnMgXAogICAgLXcgL2NoZWNrZXJzIFwKICAgIGNoZWNrZXJzX2kgXAogICAgaWduaXRlIGdlbmVyYXRlIHByb3RvLWdvCg=="}})],1)],1)],1),e._v(" "),g("li",[g("p",[e._v("Adjust the default genesis values, so that it has a proper head and tail:")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIGZ1bmMgRGVmYXVsdEdlbmVzaXMoKSAqR2VuZXNpc1N0YXRlIHsKICAgICAgICByZXR1cm4gJmFtcDtHZW5lc2lzU3RhdGV7CiAgICAgICAgICAgIFN5c3RlbUluZm86IFN5c3RlbUluZm97CiAgICAgICAgICAgICAgICBOZXh0SWQ6ICAgICAgICB1aW50NjQoRGVmYXVsdEluZGV4KSwKKyAgICAgICAgICAgICAgRmlmb0hlYWRJbmRleDogTm9GaWZvSW5kZXgsCisgICAgICAgICAgICAgIEZpZm9UYWlsSW5kZXg6IE5vRmlmb0luZGV4LAogICAgICAgICAgICB9LAogICAgICAgICAgICAuLi4KICAgICAgICB9CiAgICB9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/fifo-fields/x/checkers/types/genesis.go#L15-L16"}})],1)]),e._v(" "),g("h2",{attrs:{id:"fifo-management"}},[g("a",{staticClass:"header-anchor",attrs:{href:"#fifo-management"}},[e._v("#")]),e._v(" FIFO management")]),e._v(" "),g("p",[e._v("Now that the new fields are created, you need to update them to keep your FIFO up-to-date. It's better to create a separate file that encapsulates this knowledge. Create "),g("code",[e._v("x/checkers/keeper/stored_game_in_fifo.go")]),e._v(" with the following:")]),e._v(" "),g("ol",[g("li",[g("p",[e._v("A function to remove from the FIFO:")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAoayBLZWVwZXIpIFJlbW92ZUZyb21GaWZvKGN0eCBzZGsuQ29udGV4dCwgZ2FtZSAqdHlwZXMuU3RvcmVkR2FtZSwgaW5mbyAqdHlwZXMuU3lzdGVtSW5mbykgewogICAgLy8gRG9lcyBpdCBoYXZlIGEgcHJlZGVjZXNzb3I/CiAgICBpZiBnYW1lLkJlZm9yZUluZGV4ICE9IHR5cGVzLk5vRmlmb0luZGV4IHsKICAgICAgICBiZWZvcmVFbGVtZW50LCBmb3VuZCA6PSBrLkdldFN0b3JlZEdhbWUoY3R4LCBnYW1lLkJlZm9yZUluZGV4KQogICAgICAgIGlmICFmb3VuZCB7CiAgICAgICAgICAgIHBhbmljKCZxdW90O0VsZW1lbnQgYmVmb3JlIGluIEZpZm8gd2FzIG5vdCBmb3VuZCZxdW90OykKICAgICAgICB9CiAgICAgICAgYmVmb3JlRWxlbWVudC5BZnRlckluZGV4ID0gZ2FtZS5BZnRlckluZGV4CiAgICAgICAgay5TZXRTdG9yZWRHYW1lKGN0eCwgYmVmb3JlRWxlbWVudCkKICAgICAgICBpZiBnYW1lLkFmdGVySW5kZXggPT0gdHlwZXMuTm9GaWZvSW5kZXggewogICAgICAgICAgICBpbmZvLkZpZm9UYWlsSW5kZXggPSBiZWZvcmVFbGVtZW50LkluZGV4CiAgICAgICAgfQogICAgICAgIC8vIElzIGl0IGF0IHRoZSBGSUZPIGhlYWQ/CiAgICB9IGVsc2UgaWYgaW5mby5GaWZvSGVhZEluZGV4ID09IGdhbWUuSW5kZXggewogICAgICAgIGluZm8uRmlmb0hlYWRJbmRleCA9IGdhbWUuQWZ0ZXJJbmRleAogICAgfQogICAgLy8gRG9lcyBpdCBoYXZlIGEgc3VjY2Vzc29yPwogICAgaWYgZ2FtZS5BZnRlckluZGV4ICE9IHR5cGVzLk5vRmlmb0luZGV4IHsKICAgICAgICBhZnRlckVsZW1lbnQsIGZvdW5kIDo9IGsuR2V0U3RvcmVkR2FtZShjdHgsIGdhbWUuQWZ0ZXJJbmRleCkKICAgICAgICBpZiAhZm91bmQgewogICAgICAgICAgICBwYW5pYygmcXVvdDtFbGVtZW50IGFmdGVyIGluIEZpZm8gd2FzIG5vdCBmb3VuZCZxdW90OykKICAgICAgICB9CiAgICAgICAgYWZ0ZXJFbGVtZW50LkJlZm9yZUluZGV4ID0gZ2FtZS5CZWZvcmVJbmRleAogICAgICAgIGsuU2V0U3RvcmVkR2FtZShjdHgsIGFmdGVyRWxlbWVudCkKICAgICAgICBpZiBnYW1lLkJlZm9yZUluZGV4ID09IHR5cGVzLk5vRmlmb0luZGV4IHsKICAgICAgICAgICAgaW5mby5GaWZvSGVhZEluZGV4ID0gYWZ0ZXJFbGVtZW50LkluZGV4CiAgICAgICAgfQogICAgICAgIC8vIElzIGl0IGF0IHRoZSBGSUZPIHRhaWw/CiAgICB9IGVsc2UgaWYgaW5mby5GaWZvVGFpbEluZGV4ID09IGdhbWUuSW5kZXggewogICAgICAgIGluZm8uRmlmb1RhaWxJbmRleCA9IGdhbWUuQmVmb3JlSW5kZXgKICAgIH0KICAgIGdhbWUuQmVmb3JlSW5kZXggPSB0eXBlcy5Ob0ZpZm9JbmRleAogICAgZ2FtZS5BZnRlckluZGV4ID0gdHlwZXMuTm9GaWZvSW5kZXgKfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/game-fifo/x/checkers/keeper/stored_game_in_fifo.go#L8-L41"}}),e._v(" "),g("p",[e._v("The game passed as an argument is "),g("strong",[e._v("not")]),e._v(" saved in storage here, even if it was updated. Only its fields in memory are adjusted. The "),g("em",[e._v("before")]),e._v(" and "),g("em",[e._v("after")]),e._v(" games are saved in storage. Do a "),g("code",[e._v("SetStoredGame")]),e._v(" after calling this function to avoid having a mix of saves and memory states. The same applies to "),g("code",[e._v("SetSystemInfo")]),e._v(".")])],1),e._v(" "),g("li",[g("p",[e._v("A function to send to the tail:")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAoayBLZWVwZXIpIFNlbmRUb0ZpZm9UYWlsKGN0eCBzZGsuQ29udGV4dCwgZ2FtZSAqdHlwZXMuU3RvcmVkR2FtZSwgaW5mbyAqdHlwZXMuU3lzdGVtSW5mbykgewogICAgaWYgaW5mby5GaWZvSGVhZEluZGV4ID09IHR5cGVzLk5vRmlmb0luZGV4ICZhbXA7JmFtcDsgaW5mby5GaWZvVGFpbEluZGV4ID09IHR5cGVzLk5vRmlmb0luZGV4IHsKICAgICAgICBnYW1lLkJlZm9yZUluZGV4ID0gdHlwZXMuTm9GaWZvSW5kZXgKICAgICAgICBnYW1lLkFmdGVySW5kZXggPSB0eXBlcy5Ob0ZpZm9JbmRleAogICAgICAgIGluZm8uRmlmb0hlYWRJbmRleCA9IGdhbWUuSW5kZXgKICAgICAgICBpbmZvLkZpZm9UYWlsSW5kZXggPSBnYW1lLkluZGV4CiAgICB9IGVsc2UgaWYgaW5mby5GaWZvSGVhZEluZGV4ID09IHR5cGVzLk5vRmlmb0luZGV4IHx8IGluZm8uRmlmb1RhaWxJbmRleCA9PSB0eXBlcy5Ob0ZpZm9JbmRleCB7CiAgICAgICAgcGFuaWMoJnF1b3Q7RmlmbyBzaG91bGQgaGF2ZSBib3RoIGhlYWQgYW5kIHRhaWwgb3Igbm9uZSZxdW90OykKICAgIH0gZWxzZSBpZiBpbmZvLkZpZm9UYWlsSW5kZXggPT0gZ2FtZS5JbmRleCB7CiAgICAgICAgLy8gTm90aGluZyB0byBkbywgYWxyZWFkeSBhdCB0YWlsCiAgICB9IGVsc2UgewogICAgICAgIC8vIFNuaXAgZ2FtZSBvdXQKICAgICAgICBrLlJlbW92ZUZyb21GaWZvKGN0eCwgZ2FtZSwgaW5mbykKCiAgICAgICAgLy8gTm93IGFkZCB0byB0YWlsCiAgICAgICAgY3VycmVudFRhaWwsIGZvdW5kIDo9IGsuR2V0U3RvcmVkR2FtZShjdHgsIGluZm8uRmlmb1RhaWxJbmRleCkKICAgICAgICBpZiAhZm91bmQgewogICAgICAgICAgICBwYW5pYygmcXVvdDtDdXJyZW50IEZpZm8gdGFpbCB3YXMgbm90IGZvdW5kJnF1b3Q7KQogICAgICAgIH0KICAgICAgICBjdXJyZW50VGFpbC5BZnRlckluZGV4ID0gZ2FtZS5JbmRleAogICAgICAgIGsuU2V0U3RvcmVkR2FtZShjdHgsIGN1cnJlbnRUYWlsKQoKICAgICAgICBnYW1lLkJlZm9yZUluZGV4ID0gY3VycmVudFRhaWwuSW5kZXgKICAgICAgICBpbmZvLkZpZm9UYWlsSW5kZXggPSBnYW1lLkluZGV4CiAgICB9Cn0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/game-fifo/x/checkers/keeper/stored_game_in_fifo.go#L43-L68"}}),e._v(" "),g("p",[e._v("Again, it is advisable to do "),g("code",[e._v("SetStoredGame")]),e._v(" and "),g("code",[e._v("SetSystemInfo")]),e._v(" after calling this function.")])],1)]),e._v(" "),g("h2",{attrs:{id:"fifo-integration"}},[g("a",{staticClass:"header-anchor",attrs:{href:"#fifo-integration"}},[e._v("#")]),e._v(" FIFO Integration")]),e._v(" "),g("p",[e._v("With these functions ready, it is time to use them in the message handlers.")]),e._v(" "),g("ol",[g("li",[g("p",[e._v("In the handler when creating a new game, set default values for "),g("code",[e._v("BeforeIndex")]),e._v(" and "),g("code",[e._v("AfterIndex")]),e._v(":")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIC4uLgogICAgc3RvcmVkR2FtZSA6PSB0eXBlcy5TdG9yZWRHYW1lewogICAgICAgIC4uLgorICAgICAgQmVmb3JlSW5kZXg6IHR5cGVzLk5vRmlmb0luZGV4LAorICAgICAgQWZ0ZXJJbmRleDogIHR5cGVzLk5vRmlmb0luZGV4LAogICAgfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/fifo-fields/x/checkers/keeper/msg_server_create_game.go#L31-L32"}}),e._v(" "),g("p",[e._v("Send the new game to the tail because it is freshly created:")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIC4uLgorICBrLktlZXBlci5TZW5kVG9GaWZvVGFpbChjdHgsICZhbXA7c3RvcmVkR2FtZSwgJmFtcDtzeXN0ZW1JbmZvKQogICAgay5LZWVwZXIuU2V0U3RvcmVkR2FtZShjdHgsIHN0b3JlZEdhbWUpCiAgICAuLi4K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/game-fifo/x/checkers/keeper/msg_server_create_game.go#L40"}})],1),e._v(" "),g("li",[g("p",[e._v("In the handler, when playing a move send the game back to the tail because it was freshly updated (unless it was won, in which case it has to be removed):")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIC4uLgogICAgbGFzdEJvYXJkIDo9IGdhbWUuU3RyaW5nKCkKKworICBzeXN0ZW1JbmZvLCBmb3VuZCA6PSBrLktlZXBlci5HZXRTeXN0ZW1JbmZvKGN0eCkKKyAgaWYgIWZvdW5kIHsKKyAgICAgIHBhbmljKCZxdW90O1N5c3RlbUluZm8gbm90IGZvdW5kJnF1b3Q7KQorICB9CisKICAgIGlmIHN0b3JlZEdhbWUuV2lubmVyID09IHJ1bGVzLlBpZWNlU3RyaW5nc1tydWxlcy5OT19QTEFZRVJdIHsKICAgICAgICBzdG9yZWRHYW1lLkJvYXJkID0gbGFzdEJvYXJkCisgICAgICBrLktlZXBlci5TZW5kVG9GaWZvVGFpbChjdHgsICZhbXA7c3RvcmVkR2FtZSwgJmFtcDtzeXN0ZW1JbmZvKQogICAgfSBlbHNlIHsKICAgICAgICBzdG9yZWRHYW1lLkJvYXJkID0gJnF1b3Q7JnF1b3Q7CisgICAgICBrLktlZXBlci5SZW1vdmVGcm9tRmlmbyhjdHgsICZhbXA7c3RvcmVkR2FtZSwgJmFtcDtzeXN0ZW1JbmZvKQogICAgfQoKICAgIC4uLgogICAgay5LZWVwZXIuU2V0U3RvcmVkR2FtZShjdHgsIHN0b3JlZEdhbWUpCisgIGsuS2VlcGVyLlNldFN5c3RlbUluZm8oY3R4LCBzeXN0ZW1JbmZvKQogICAgLi4uCg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/game-fifo/x/checkers/keeper/msg_server_play_move.go#L65-L82"}}),e._v(" "),g("p",[e._v("Note that you also need to call "),g("code",[e._v("SetSystemInfo")]),e._v(".")])],1)]),e._v(" "),g("p",[e._v("You have implemented a FIFO that is updated but never really used. It will be used in the "),g("RouterLink",{attrs:{to:"/hands-on-exercise/2-ignite-cli-adv/4-game-forfeit.html"}},[e._v("next section")]),e._v(".")],1),e._v(" "),g("h2",{attrs:{id:"unit-tests"}},[g("a",{staticClass:"header-anchor",attrs:{href:"#unit-tests"}},[e._v("#")]),e._v(" Unit tests")]),e._v(" "),g("p",[e._v("At this point, your previous unit tests are failing, so they must be fixed. Add "),g("code",[e._v("FifoHeadIndex")]),e._v(" and "),g("code",[e._v("FifoTailIndex")]),e._v(" in your value requirements on "),g("code",[e._v("SystemInfo")]),e._v(" as you "),g("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/game-fifo/x/checkers/keeper/msg_server_create_game_test.go#L46-L47",target:"_blank",rel:"noopener noreferrer"}},[e._v("create games"),g("OutboundLink")],1),e._v(" and "),g("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/game-fifo/x/checkers/keeper/msg_server_play_move_test.go#L98-L99",target:"_blank",rel:"noopener noreferrer"}},[e._v("play moves"),g("OutboundLink")],1),e._v(". Also add "),g("code",[e._v("BeforeIndex")]),e._v(" and "),g("code",[e._v("AfterIndex")]),e._v(" in your value requirements on "),g("code",[e._v("StoredGame")]),e._v(" as you "),g("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/game-fifo/x/checkers/keeper/msg_server_create_game_test.go#L60-L61",target:"_blank",rel:"noopener noreferrer"}},[e._v("create games"),g("OutboundLink")],1),e._v(" and "),g("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/game-fifo/x/checkers/keeper/msg_server_play_move_test.go#L112-L113",target:"_blank",rel:"noopener noreferrer"}},[e._v("play moves"),g("OutboundLink")],1),e._v(".")]),e._v(" "),g("p",[e._v("Edit "),g("code",[e._v("types/genesis_test.go")]),e._v(", so that it incorporates the newly added fields "),g("code",[e._v("FifoHeadIndex")]),e._v(" and "),g("code",[e._v("FifoTailIndex")]),e._v(" with the correct initialization values:")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIGZ1bmMgVGVzdERlZmF1bHRHZW5lc2lzU3RhdGVfRXhwZWN0ZWRJbml0aWFsTmV4dElkKHQgKnRlc3RpbmcuVCkgewogICAgICAgIHJlcXVpcmUuRXF1YWxWYWx1ZXModCwKICAgICAgICAgICAgJmFtcDt0eXBlcy5HZW5lc2lzU3RhdGV7CiAgICAgICAgICAgICAgICBTdG9yZWRHYW1lTGlzdDogW110eXBlcy5TdG9yZWRHYW1le30sCi0gICAgICAgICAgICAgICBTeXN0ZW1JbmZvOiAgICAgdHlwZXMuU3lzdGVtSW5mb3t1aW50NjQoMSl9LCAKKyAgICAgICAgICAgICAgIFN5c3RlbUluZm86ICAgICB0eXBlcy5TeXN0ZW1JbmZveworICAgICAgICAgICAgICAgTmV4dElkOiAgICAgICAgdWludDY0KDEpLAorICAgICAgICAgICAgICAgRmlmb0hlYWRJbmRleDogJnF1b3Q7LTEmcXVvdDssCisgICAgICAgICAgICAgICBGaWZvVGFpbEluZGV4OiAmcXVvdDstMSZxdW90OywKKyAgICAgICAgICAgfSwKICAgICAgICB9LAogICAgICAgIHR5cGVzLkRlZmF1bHRHZW5lc2lzKCkpCiAgICB9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/fifo-fields/x/checkers/types/genesis_test.go#L71-L75"}}),e._v(" "),g("p",[e._v("Next, you should add more specific FIFO tests. For instance, testing what happens to "),g("code",[e._v("SystemInfo")]),e._v(" and "),g("code",[e._v("StoredGame")]),e._v(" as you create up to three new games, instead of "),g("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/game-fifo/x/checkers/keeper/msg_server_create_game_test.go#L165-L232",target:"_blank",rel:"noopener noreferrer"}},[e._v("only checking at the end"),g("OutboundLink")],1),e._v(":")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBUZXN0Q3JlYXRlM0dhbWVzSGFzU2F2ZWRGaWZvKHQgKnRlc3RpbmcuVCkgewogICAgbXNnU3J2ciwga2VlcGVyLCBjb250ZXh0IDo9IHNldHVwTXNnU2VydmVyQ3JlYXRlR2FtZSh0KQogICAgY3R4IDo9IHNkay5VbndyYXBTREtDb250ZXh0KGNvbnRleHQpCiAgICBtc2dTcnZyLkNyZWF0ZUdhbWUoY29udGV4dCwgJmFtcDt0eXBlcy5Nc2dDcmVhdGVHYW1lewogICAgICAgIENyZWF0b3I6IGFsaWNlLAogICAgICAgIEJsYWNrOiAgIGJvYiwKICAgICAgICBSZWQ6ICAgICBjYXJvbCwKICAgIH0pCgogICAgLy8gU2Vjb25kIGdhbWUKICAgIG1zZ1NydnIuQ3JlYXRlR2FtZShjb250ZXh0LCAmYW1wO3R5cGVzLk1zZ0NyZWF0ZUdhbWV7CiAgICAgICAgQ3JlYXRvcjogYm9iLAogICAgICAgIEJsYWNrOiAgIGNhcm9sLAogICAgICAgIFJlZDogICAgIGFsaWNlLAogICAgfSkKICAgIHN5c3RlbUluZm8yLCBmb3VuZCA6PSBrZWVwZXIuR2V0U3lzdGVtSW5mbyhjdHgpCiAgICByZXF1aXJlLlRydWUodCwgZm91bmQpCiAgICByZXF1aXJlLkVxdWFsVmFsdWVzKHQsIHR5cGVzLlN5c3RlbUluZm97CiAgICAgICAgTmV4dElkOiAgICAgICAgMywKICAgICAgICBGaWZvSGVhZEluZGV4OiAmcXVvdDsxJnF1b3Q7LAogICAgICAgIEZpZm9UYWlsSW5kZXg6ICZxdW90OzImcXVvdDssCiAgICB9LCBzeXN0ZW1JbmZvMikKICAgIGdhbWUxLCBmb3VuZCA6PSBrZWVwZXIuR2V0U3RvcmVkR2FtZShjdHgsICZxdW90OzEmcXVvdDspCiAgICByZXF1aXJlLlRydWUodCwgZm91bmQpCiAgICByZXF1aXJlLkVxdWFsVmFsdWVzKHQsIHR5cGVzLlN0b3JlZEdhbWV7CiAgICAgICAgSW5kZXg6ICAgICAgICZxdW90OzEmcXVvdDssCiAgICAgICAgQm9hcmQ6ICAgICAgICZxdW90OypiKmIqYipifGIqYipiKmIqfCpiKmIqYipifCoqKioqKioqfCoqKioqKioqfHIqcipyKnIqfCpyKnIqcipyfHIqcipyKnIqJnF1b3Q7LAogICAgICAgIFR1cm46ICAgICAgICAmcXVvdDtiJnF1b3Q7LAogICAgICAgIEJsYWNrOiAgICAgICBib2IsCiAgICAgICAgUmVkOiAgICAgICAgIGNhcm9sLAogICAgICAgIFdpbm5lcjogICAgICAmcXVvdDsqJnF1b3Q7LAogICAgICAgIERlYWRsaW5lOiAgICB0eXBlcy5Gb3JtYXREZWFkbGluZShjdHguQmxvY2tUaW1lKCkuQWRkKHR5cGVzLk1heFR1cm5EdXJhdGlvbikpLAogICAgICAgIE1vdmVDb3VudDogICB1aW50NjQoMCksCiAgICAgICAgQmVmb3JlSW5kZXg6ICZxdW90Oy0xJnF1b3Q7LAogICAgICAgIEFmdGVySW5kZXg6ICAmcXVvdDsyJnF1b3Q7LAogICAgfSwgZ2FtZTEpCiAgICBnYW1lMiwgZm91bmQgOj0ga2VlcGVyLkdldFN0b3JlZEdhbWUoY3R4LCAmcXVvdDsyJnF1b3Q7KQogICAgcmVxdWlyZS5UcnVlKHQsIGZvdW5kKQogICAgcmVxdWlyZS5FcXVhbFZhbHVlcyh0LCB0eXBlcy5TdG9yZWRHYW1lewogICAgICAgIEluZGV4OiAgICAgICAmcXVvdDsyJnF1b3Q7LAogICAgICAgIEJvYXJkOiAgICAgICAmcXVvdDsqYipiKmIqYnxiKmIqYipiKnwqYipiKmIqYnwqKioqKioqKnwqKioqKioqKnxyKnIqcipyKnwqcipyKnIqcnxyKnIqcipyKiZxdW90OywKICAgICAgICBUdXJuOiAgICAgICAgJnF1b3Q7YiZxdW90OywKICAgICAgICBCbGFjazogICAgICAgY2Fyb2wsCiAgICAgICAgUmVkOiAgICAgICAgIGFsaWNlLAogICAgICAgIFdpbm5lcjogICAgICAmcXVvdDsqJnF1b3Q7LAogICAgICAgIERlYWRsaW5lOiAgICB0eXBlcy5Gb3JtYXREZWFkbGluZShjdHguQmxvY2tUaW1lKCkuQWRkKHR5cGVzLk1heFR1cm5EdXJhdGlvbikpLAogICAgICAgIE1vdmVDb3VudDogICB1aW50NjQoMCksCiAgICAgICAgQmVmb3JlSW5kZXg6ICZxdW90OzEmcXVvdDssCiAgICAgICAgQWZ0ZXJJbmRleDogICZxdW90Oy0xJnF1b3Q7LAogICAgfSwgZ2FtZTIpCgogICAgLy8gVGhpcmQgZ2FtZQogICAgbXNnU3J2ci5DcmVhdGVHYW1lKGNvbnRleHQsICZhbXA7dHlwZXMuTXNnQ3JlYXRlR2FtZXsKICAgICAgICBDcmVhdG9yOiBjYXJvbCwKICAgICAgICBCbGFjazogICBhbGljZSwKICAgICAgICBSZWQ6ICAgICBib2IsCiAgICB9KQogICAgc3lzdGVtSW5mbzMsIGZvdW5kIDo9IGtlZXBlci5HZXRTeXN0ZW1JbmZvKGN0eCkKICAgIHJlcXVpcmUuVHJ1ZSh0LCBmb3VuZCkKICAgIHJlcXVpcmUuRXF1YWxWYWx1ZXModCwgdHlwZXMuU3lzdGVtSW5mb3sKICAgICAgICBOZXh0SWQ6ICAgICAgICA0LAogICAgICAgIEZpZm9IZWFkSW5kZXg6ICZxdW90OzEmcXVvdDssCiAgICAgICAgRmlmb1RhaWxJbmRleDogJnF1b3Q7MyZxdW90OywKICAgIH0sIHN5c3RlbUluZm8zKQogICAgZ2FtZTEsIGZvdW5kID0ga2VlcGVyLkdldFN0b3JlZEdhbWUoY3R4LCAmcXVvdDsxJnF1b3Q7KQogICAgcmVxdWlyZS5UcnVlKHQsIGZvdW5kKQogICAgcmVxdWlyZS5FcXVhbFZhbHVlcyh0LCB0eXBlcy5TdG9yZWRHYW1lewogICAgICAgIEluZGV4OiAgICAgICAmcXVvdDsxJnF1b3Q7LAogICAgICAgIEJvYXJkOiAgICAgICAmcXVvdDsqYipiKmIqYnxiKmIqYipiKnwqYipiKmIqYnwqKioqKioqKnwqKioqKioqKnxyKnIqcipyKnwqcipyKnIqcnxyKnIqcipyKiZxdW90OywKICAgICAgICBUdXJuOiAgICAgICAgJnF1b3Q7YiZxdW90OywKICAgICAgICBCbGFjazogICAgICAgYm9iLAogICAgICAgIFJlZDogICAgICAgICBjYXJvbCwKICAgICAgICBXaW5uZXI6ICAgICAgJnF1b3Q7KiZxdW90OywKICAgICAgICBEZWFkbGluZTogICAgdHlwZXMuRm9ybWF0RGVhZGxpbmUoY3R4LkJsb2NrVGltZSgpLkFkZCh0eXBlcy5NYXhUdXJuRHVyYXRpb24pKSwKICAgICAgICBNb3ZlQ291bnQ6ICAgdWludDY0KDApLAogICAgICAgIEJlZm9yZUluZGV4OiAmcXVvdDstMSZxdW90OywKICAgICAgICBBZnRlckluZGV4OiAgJnF1b3Q7MiZxdW90OywKICAgIH0sIGdhbWUxKQogICAgZ2FtZTIsIGZvdW5kID0ga2VlcGVyLkdldFN0b3JlZEdhbWUoY3R4LCAmcXVvdDsyJnF1b3Q7KQogICAgcmVxdWlyZS5UcnVlKHQsIGZvdW5kKQogICAgcmVxdWlyZS5FcXVhbFZhbHVlcyh0LCB0eXBlcy5TdG9yZWRHYW1lewogICAgICAgIEluZGV4OiAgICAgICAmcXVvdDsyJnF1b3Q7LAogICAgICAgIEJvYXJkOiAgICAgICAmcXVvdDsqYipiKmIqYnxiKmIqYipiKnwqYipiKmIqYnwqKioqKioqKnwqKioqKioqKnxyKnIqcipyKnwqcipyKnIqcnxyKnIqcipyKiZxdW90OywKICAgICAgICBUdXJuOiAgICAgICAgJnF1b3Q7YiZxdW90OywKICAgICAgICBCbGFjazogICAgICAgY2Fyb2wsCiAgICAgICAgUmVkOiAgICAgICAgIGFsaWNlLAogICAgICAgIFdpbm5lcjogICAgICAmcXVvdDsqJnF1b3Q7LAogICAgICAgIERlYWRsaW5lOiAgICB0eXBlcy5Gb3JtYXREZWFkbGluZShjdHguQmxvY2tUaW1lKCkuQWRkKHR5cGVzLk1heFR1cm5EdXJhdGlvbikpLAogICAgICAgIE1vdmVDb3VudDogICB1aW50NjQoMCksCiAgICAgICAgQmVmb3JlSW5kZXg6ICZxdW90OzEmcXVvdDssCiAgICAgICAgQWZ0ZXJJbmRleDogICZxdW90OzMmcXVvdDssCiAgICB9LCBnYW1lMikKICAgIGdhbWUzLCBmb3VuZCA6PSBrZWVwZXIuR2V0U3RvcmVkR2FtZShjdHgsICZxdW90OzMmcXVvdDspCiAgICByZXF1aXJlLlRydWUodCwgZm91bmQpCiAgICByZXF1aXJlLkVxdWFsVmFsdWVzKHQsIHR5cGVzLlN0b3JlZEdhbWV7CiAgICAgICAgSW5kZXg6ICAgICAgICZxdW90OzMmcXVvdDssCiAgICAgICAgQm9hcmQ6ICAgICAgICZxdW90OypiKmIqYipifGIqYipiKmIqfCpiKmIqYipifCoqKioqKioqfCoqKioqKioqfHIqcipyKnIqfCpyKnIqcipyfHIqcipyKnIqJnF1b3Q7LAogICAgICAgIFR1cm46ICAgICAgICAmcXVvdDtiJnF1b3Q7LAogICAgICAgIEJsYWNrOiAgICAgICBhbGljZSwKICAgICAgICBSZWQ6ICAgICAgICAgYm9iLAogICAgICAgIFdpbm5lcjogICAgICAmcXVvdDsqJnF1b3Q7LAogICAgICAgIERlYWRsaW5lOiAgICB0eXBlcy5Gb3JtYXREZWFkbGluZShjdHguQmxvY2tUaW1lKCkuQWRkKHR5cGVzLk1heFR1cm5EdXJhdGlvbikpLAogICAgICAgIE1vdmVDb3VudDogICB1aW50NjQoMCksCiAgICAgICAgQmVmb3JlSW5kZXg6ICZxdW90OzImcXVvdDssCiAgICAgICAgQWZ0ZXJJbmRleDogICZxdW90Oy0xJnF1b3Q7LAogICAgfSwgZ2FtZTMpCn0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/game-fifo/x/checkers/keeper/msg_server_create_game_fifo_test.go#L11-L117"}}),e._v(" "),g("p",[e._v("What happens when you "),g("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/game-fifo/x/checkers/keeper/msg_server_play_move_fifo_test.go#L11-L63",target:"_blank",rel:"noopener noreferrer"}},[e._v("have two games and play once on the "),g("em",[e._v("older")]),e._v(" one"),g("OutboundLink")],1),e._v("? Or have two games and play them twice in turn:")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBUZXN0UGxheU1vdmUyR2FtZXMyTW92ZXNIYXNTYXZlZEZpZm8odCAqdGVzdGluZy5UKSB7CiAgICBtc2dTZXJ2ZXIsIGtlZXBlciwgY29udGV4dCA6PSBzZXR1cE1zZ1NlcnZlcldpdGhPbmVHYW1lRm9yUGxheU1vdmUodCkKICAgIGN0eCA6PSBzZGsuVW53cmFwU0RLQ29udGV4dChjb250ZXh0KQogICAgbXNnU2VydmVyLkNyZWF0ZUdhbWUoY29udGV4dCwgJmFtcDt0eXBlcy5Nc2dDcmVhdGVHYW1lewogICAgICAgIENyZWF0b3I6IGJvYiwKICAgICAgICBCbGFjazogICBjYXJvbCwKICAgICAgICBSZWQ6ICAgICBhbGljZSwKICAgIH0pCiAgICBtc2dTZXJ2ZXIuUGxheU1vdmUoY29udGV4dCwgJmFtcDt0eXBlcy5Nc2dQbGF5TW92ZXsKICAgICAgICBDcmVhdG9yOiAgIGJvYiwKICAgICAgICBHYW1lSW5kZXg6ICZxdW90OzEmcXVvdDssCiAgICAgICAgRnJvbVg6ICAgICAxLAogICAgICAgIEZyb21ZOiAgICAgMiwKICAgICAgICBUb1g6ICAgICAgIDIsCiAgICAgICAgVG9ZOiAgICAgICAzLAogICAgfSkKCiAgICBtc2dTZXJ2ZXIuUGxheU1vdmUoY29udGV4dCwgJmFtcDt0eXBlcy5Nc2dQbGF5TW92ZXsKICAgICAgICBDcmVhdG9yOiAgIGNhcm9sLAogICAgICAgIEdhbWVJbmRleDogJnF1b3Q7MiZxdW90OywKICAgICAgICBGcm9tWDogICAgIDEsCiAgICAgICAgRnJvbVk6ICAgICAyLAogICAgICAgIFRvWDogICAgICAgMiwKICAgICAgICBUb1k6ICAgICAgIDMsCiAgICB9KQogICAgc3lzdGVtSW5mbzEsIGZvdW5kIDo9IGtlZXBlci5HZXRTeXN0ZW1JbmZvKGN0eCkKICAgIHJlcXVpcmUuVHJ1ZSh0LCBmb3VuZCkKICAgIHJlcXVpcmUuRXF1YWxWYWx1ZXModCwgdHlwZXMuU3lzdGVtSW5mb3sKICAgICAgICBOZXh0SWQ6ICAgICAgICAzLAogICAgICAgIEZpZm9IZWFkSW5kZXg6ICZxdW90OzEmcXVvdDssCiAgICAgICAgRmlmb1RhaWxJbmRleDogJnF1b3Q7MiZxdW90OywKICAgIH0sIHN5c3RlbUluZm8xKQogICAgZ2FtZTEsIGZvdW5kIDo9IGtlZXBlci5HZXRTdG9yZWRHYW1lKGN0eCwgJnF1b3Q7MSZxdW90OykKICAgIHJlcXVpcmUuVHJ1ZSh0LCBmb3VuZCkKICAgIHJlcXVpcmUuRXF1YWxWYWx1ZXModCwgdHlwZXMuU3RvcmVkR2FtZXsKICAgICAgICBJbmRleDogICAgICAgJnF1b3Q7MSZxdW90OywKICAgICAgICBCb2FyZDogICAgICAgJnF1b3Q7KmIqYipiKmJ8YipiKmIqYip8KioqYipiKmJ8KipiKioqKip8KioqKioqKip8cipyKnIqcip8KnIqcipyKnJ8cipyKnIqciomcXVvdDssCiAgICAgICAgVHVybjogICAgICAgICZxdW90O3ImcXVvdDssCiAgICAgICAgQmxhY2s6ICAgICAgIGJvYiwKICAgICAgICBSZWQ6ICAgICAgICAgY2Fyb2wsCiAgICAgICAgV2lubmVyOiAgICAgICZxdW90OyomcXVvdDssCiAgICAgICAgRGVhZGxpbmU6ICAgIHR5cGVzLkZvcm1hdERlYWRsaW5lKGN0eC5CbG9ja1RpbWUoKS5BZGQodHlwZXMuTWF4VHVybkR1cmF0aW9uKSksCiAgICAgICAgTW92ZUNvdW50OiAgIHVpbnQ2NCgxKSwKICAgICAgICBCZWZvcmVJbmRleDogJnF1b3Q7LTEmcXVvdDssCiAgICAgICAgQWZ0ZXJJbmRleDogICZxdW90OzImcXVvdDssCiAgICB9LCBnYW1lMSkKICAgIGdhbWUyLCBmb3VuZCA6PSBrZWVwZXIuR2V0U3RvcmVkR2FtZShjdHgsICZxdW90OzImcXVvdDspCiAgICByZXF1aXJlLlRydWUodCwgZm91bmQpCiAgICByZXF1aXJlLkVxdWFsVmFsdWVzKHQsIHR5cGVzLlN0b3JlZEdhbWV7CiAgICAgICAgSW5kZXg6ICAgICAgICZxdW90OzImcXVvdDssCiAgICAgICAgQm9hcmQ6ICAgICAgICZxdW90OypiKmIqYipifGIqYipiKmIqfCoqKmIqYipifCoqYioqKioqfCoqKioqKioqfHIqcipyKnIqfCpyKnIqcipyfHIqcipyKnIqJnF1b3Q7LAogICAgICAgIFR1cm46ICAgICAgICAmcXVvdDtyJnF1b3Q7LAogICAgICAgIEJsYWNrOiAgICAgICBjYXJvbCwKICAgICAgICBSZWQ6ICAgICAgICAgYWxpY2UsCiAgICAgICAgV2lubmVyOiAgICAgICZxdW90OyomcXVvdDssCiAgICAgICAgRGVhZGxpbmU6ICAgIHR5cGVzLkZvcm1hdERlYWRsaW5lKGN0eC5CbG9ja1RpbWUoKS5BZGQodHlwZXMuTWF4VHVybkR1cmF0aW9uKSksCiAgICAgICAgTW92ZUNvdW50OiAgIHVpbnQ2NCgxKSwKICAgICAgICBCZWZvcmVJbmRleDogJnF1b3Q7MSZxdW90OywKICAgICAgICBBZnRlckluZGV4OiAgJnF1b3Q7LTEmcXVvdDssCiAgICB9LCBnYW1lMikKfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/game-fifo/x/checkers/keeper/msg_server_play_move_fifo_test.go#L65-L125"}}),e._v(" "),g("p",[e._v("Run the tests again with the same command as before:")]),e._v(" "),g("CodeGroup",[g("CodeGroupItem",{attrs:{title:"Local",active:""}},[g("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBnbyB0ZXN0IGdpdGh1Yi5jb20vYWxpY2UvY2hlY2tlcnMveC9jaGVja2Vycy9rZWVwZXIK"}})],1),e._v(" "),g("CodeGroupItem",{attrs:{title:"Docker"}},[g("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IFwKICAgIC12ICQocHdkKTovY2hlY2tlcnMgXAogICAgLXcgL2NoZWNrZXJzIFwKICAgIGNoZWNrZXJzX2kgXAogICAgZ28gdGVzdCBnaXRodWIuY29tL2FsaWNlL2NoZWNrZXJzL3gvY2hlY2tlcnMva2VlcGVyCg=="}})],1)],1),e._v(" "),g("h2",{attrs:{id:"interact-via-the-cli"}},[g("a",{staticClass:"header-anchor",attrs:{href:"#interact-via-the-cli"}},[e._v("#")]),e._v(" Interact via the CLI")]),e._v(" "),g("p",[e._v("Time to explore the commands. You need to start afresh because you made numerous additions to the blockchain state:")]),e._v(" "),g("CodeGroup",[g("CodeGroupItem",{attrs:{title:"Local",active:""}},[g("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBpZ25pdGUgY2hhaW4gc2VydmUgLS1yZXNldC1vbmNlCg=="}})],1),e._v(" "),g("CodeGroupItem",{attrs:{title:"Docker"}},[g("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IFwKICAgIC0tbmFtZSBjaGVja2VycyBcCiAgICAtdiAkKHB3ZCk6L2NoZWNrZXJzIFwKICAgIC13IC9jaGVja2VycyBcCiAgICBjaGVja2Vyc19pIFwKICAgIGlnbml0ZSBjaGFpbiBzZXJ2ZSAtLXJlc2V0LW9uY2UK"}})],1)],1),e._v(" "),g("HighlightBox",{attrs:{type:"tip"}},[g("p",[e._v("Do not forget to export "),g("code",[e._v("alice")]),e._v(" and "),g("code",[e._v("bob")]),e._v(" again, as explained in an "),g("RouterLink",{attrs:{to:"/hands-on-exercise/1-ignite-cli/4-create-message.html"}},[e._v('earlier section under "Interact via the CLI"')]),e._v(".")],1)]),e._v(" "),g("PanelList",[g("PanelListItem",{attrs:{number:"1"}},[g("p",[e._v("Is the genesis FIFO information correctly saved?")]),e._v(" "),g("CodeGroup",[g("CodeGroupItem",{attrs:{title:"Local",active:""}},[g("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBjaGVja2Vyc2QgcXVlcnkgY2hlY2tlcnMgc2hvdy1zeXN0ZW0taW5mbwo="}})],1),e._v(" "),g("CodeGroupItem",{attrs:{title:"Docker"}},[g("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtaXQgY2hlY2tlcnMgXAogICAgY2hlY2tlcnNkIHF1ZXJ5IGNoZWNrZXJzIHNob3ctc3lzdGVtLWluZm8K"}})],1)],1),e._v(" "),g("p",[e._v("This should print:")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"txt",base64:"U3lzdGVtSW5mbzoKICAgIGZpZm9IZWFkSW5kZXg6ICZxdW90Oy0xJnF1b3Q7ICMgVGhlcmUgaXMgbm90aGluZwogICAgZmlmb1RhaWxJbmRleDogJnF1b3Q7LTEmcXVvdDsgIyBUaGVyZSBpcyBub3RoaW5nCiAgICBuZXh0SWQ6ICZxdW90OzEmcXVvdDsK"}})],1),e._v(" "),g("PanelListItem",{attrs:{number:"2"}},[g("p",[e._v("If you create a game, is the game as expected?")]),e._v(" "),g("CodeGroup",[g("CodeGroupItem",{attrs:{title:"Local",active:""}},[g("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBjaGVja2Vyc2QgdHggY2hlY2tlcnMgY3JlYXRlLWdhbWUgJGFsaWNlICRib2IgLS1mcm9tICRib2IKJCBjaGVja2Vyc2QgcXVlcnkgY2hlY2tlcnMgc2hvdy1zeXN0ZW0taW5mbwo="}})],1),e._v(" "),g("CodeGroupItem",{attrs:{title:"Docker"}},[g("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtaXQgY2hlY2tlcnMgXAogICAgY2hlY2tlcnNkIHR4IGNoZWNrZXJzIGNyZWF0ZS1nYW1lICRhbGljZSAkYm9iIC0tZnJvbSAkYm9iCiQgZG9ja2VyIGV4ZWMgLWl0IGNoZWNrZXJzIFwKICAgIGNoZWNrZXJzZCBxdWVyeSBjaGVja2VycyBzaG93LXN5c3RlbS1pbmZvCg=="}})],1)],1),e._v(" "),g("p",[e._v("This should print:")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"txt",base64:"U3lzdGVtSW5mbzoKICAgIGZpZm9IZWFkSW5kZXg6ICZxdW90OzEmcXVvdDsgIyBUaGUgZmlyc3QgZ2FtZSB5b3UgY3JlYXRlZAogICAgZmlmb1RhaWxJbmRleDogJnF1b3Q7MSZxdW90OyAjIFRoZSBmaXJzdCBnYW1lIHlvdSBjcmVhdGVkCiAgICBuZXh0SWQ6ICZxdW90OzImcXVvdDsK"}})],1),e._v(" "),g("PanelListItem",{attrs:{number:"3"}},[g("p",[e._v("What about the information saved in the game?")]),e._v(" "),g("CodeGroup",[g("CodeGroupItem",{attrs:{title:"Local",active:""}},[g("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBjaGVja2Vyc2QgcXVlcnkgY2hlY2tlcnMgc2hvdy1zdG9yZWQtZ2FtZSAxCg=="}})],1),e._v(" "),g("CodeGroupItem",{attrs:{title:"Docker"}},[g("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtaXQgY2hlY2tlcnMgXAogICAgY2hlY2tlcnNkIHF1ZXJ5IGNoZWNrZXJzIHNob3ctc3RvcmVkLWdhbWUgMQo="}})],1)],1),e._v(" "),g("p",[e._v("Because it is the only game, this should print:")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"txt",base64:"c3RvcmVkR2FtZToKICAgIGFmdGVySW5kZXg6ICZxdW90Oy0xJnF1b3Q7ICMgTm90aGluZyBiZWNhdXNlIGl0IGlzIGFsb25lCiAgICBiZWZvcmVJbmRleDogJnF1b3Q7LTEmcXVvdDsgIyBOb3RoaW5nIGJlY2F1c2UgaXQgaXMgYWxvbmUKICAgIC4uLgo="}})],1),e._v(" "),g("PanelListItem",{attrs:{number:"4"}},[g("p",[e._v("And if you create another game?")]),e._v(" "),g("CodeGroup",[g("CodeGroupItem",{attrs:{title:"Local",active:""}},[g("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBjaGVja2Vyc2QgdHggY2hlY2tlcnMgY3JlYXRlLWdhbWUgJGFsaWNlICRib2IgLS1mcm9tICRib2IKJCBjaGVja2Vyc2QgcXVlcnkgY2hlY2tlcnMgc2hvdy1zeXN0ZW0taW5mbwo="}})],1),e._v(" "),g("CodeGroupItem",{attrs:{title:"Docker"}},[g("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtaXQgY2hlY2tlcnMgXAogICAgY2hlY2tlcnNkIHR4IGNoZWNrZXJzIGNyZWF0ZS1nYW1lICRhbGljZSAkYm9iIC0tZnJvbSAkYm9iCiQgZG9ja2VyIGV4ZWMgLWl0IGNoZWNrZXJzIFwKICAgIGNoZWNrZXJzZCBxdWVyeSBjaGVja2VycyBzaG93LXN5c3RlbS1pbmZvCg=="}})],1)],1),e._v(" "),g("p",[e._v("This should print:")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"txt",base64:"U3lzdGVtSW5mbzoKICAgIGZpZm9IZWFkSW5kZXg6ICZxdW90OzEmcXVvdDsgIyBUaGUgZmlyc3QgZ2FtZSB5b3UgY3JlYXRlZAogICAgZmlmb1RhaWxJbmRleDogJnF1b3Q7MiZxdW90OyAjIFRoZSBzZWNvbmQgZ2FtZSB5b3UgY3JlYXRlZAogICAgbmV4dElkOiAmcXVvdDszJnF1b3Q7Cg=="}})],1),e._v(" "),g("PanelListItem",{attrs:{number:"5"}},[g("p",[e._v("Did the games also store the correct values?")]),e._v(" "),g("p",[e._v("For the first game:")]),e._v(" "),g("CodeGroup",[g("CodeGroupItem",{attrs:{title:"Local",active:""}},[g("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBjaGVja2Vyc2QgcXVlcnkgY2hlY2tlcnMgc2hvdy1zdG9yZWQtZ2FtZSAxCg=="}})],1),e._v(" "),g("CodeGroupItem",{attrs:{title:"Docker"}},[g("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtaXQgY2hlY2tlcnMgXAogICAgY2hlY2tlcnNkIHF1ZXJ5IGNoZWNrZXJzIHNob3ctc3RvcmVkLWdhbWUgMQo="}})],1)],1),e._v(" "),g("p",[e._v("This should print:")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"txt",base64:"YWZ0ZXJJbmRleDogJnF1b3Q7MiZxdW90OyAjIFRoZSBzZWNvbmQgZ2FtZSB5b3UgY3JlYXRlZApiZWZvcmVJbmRleDogJnF1b3Q7LTEmcXVvdDsgIyBObyBnYW1lCi4uLgo="}}),e._v(" "),g("p",[e._v("For the second game, run:")]),e._v(" "),g("CodeGroup",[g("CodeGroupItem",{attrs:{title:"Local",active:""}},[g("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBjaGVja2Vyc2QgcXVlcnkgY2hlY2tlcnMgc2hvdy1zdG9yZWQtZ2FtZSAyCg=="}})],1),e._v(" "),g("CodeGroupItem",{attrs:{title:"Docker"}},[g("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtaXQgY2hlY2tlcnMgXAogICAgY2hlY2tlcnNkIHF1ZXJ5IGNoZWNrZXJzIHNob3ctc3RvcmVkLWdhbWUgMgo="}})],1)],1),e._v(" "),g("p",[e._v("This should print:")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"txt",base64:"YWZ0ZXJJbmRleDogJnF1b3Q7LTEmcXVvdDsgIyBObyBnYW1lCmJlZm9yZUluZGV4OiAmcXVvdDsxJnF1b3Q7ICMgVGhlIGZpcnN0IGdhbWUgeW91IGNyZWF0ZWQKLi4uCg=="}}),e._v(" "),g("p",[e._v("Your FIFO in effect has the game IDs "),g("code",[e._v("[1, 2]")]),e._v(".")]),e._v(" "),g("p",[e._v("Add a third game, and confirm that your FIFO is "),g("code",[e._v("[1, 2, 3]")]),e._v(".")])],1),e._v(" "),g("PanelListItem",{attrs:{number:"6"}},[g("p",[e._v("What happens if Alice plays a move in game "),g("code",[e._v("2")]),e._v(", the game "),g("em",[e._v("in the middle")]),e._v("?")]),e._v(" "),g("CodeGroup",[g("CodeGroupItem",{attrs:{title:"Local",active:""}},[g("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBjaGVja2Vyc2QgdHggY2hlY2tlcnMgcGxheS1tb3ZlIDIgMSAyIDIgMyAtLWZyb20gJGFsaWNlCiQgY2hlY2tlcnNkIHF1ZXJ5IGNoZWNrZXJzIHNob3ctc3lzdGVtLWluZm8K"}})],1),e._v(" "),g("CodeGroupItem",{attrs:{title:"Docker"}},[g("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtaXQgY2hlY2tlcnMgXAogICAgY2hlY2tlcnNkIHR4IGNoZWNrZXJzIHBsYXktbW92ZSAyIDEgMiAyIDMgLS1mcm9tICRhbGljZQokIGRvY2tlciBleGVjIC1pdCBjaGVja2VycyBcCiAgICBjaGVja2Vyc2QgcXVlcnkgY2hlY2tlcnMgc2hvdy1zeXN0ZW0taW5mbwo="}})],1)],1),e._v(" "),g("p",[e._v("This should print:")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"txt",base64:"U3lzdGVtSW5mbzoKICAgIGZpZm9IZWFkSW5kZXg6ICZxdW90OzEmcXVvdDsgIyBUaGUgZmlyc3QgZ2FtZSB5b3UgY3JlYXRlZAogICAgZmlmb1RhaWxJbmRleDogJnF1b3Q7MiZxdW90OyAjIFRoZSBzZWNvbmQgZ2FtZSB5b3UgY3JlYXRlZCBhbmQgb24gd2hpY2ggQm9iIGp1c3QgcGxheWVkCiAgICBuZXh0SWQ6ICZxdW90OzQmcXVvdDsK"}})],1),e._v(" "),g("PanelListItem",{attrs:{number:"7",last:!0}},[g("p",[e._v("Is game "),g("code",[e._v("3")]),e._v(" in the middle now?")]),e._v(" "),g("CodeGroup",[g("CodeGroupItem",{attrs:{title:"Local",active:""}},[g("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBjaGVja2Vyc2QgcXVlcnkgY2hlY2tlcnMgc2hvdy1zdG9yZWQtZ2FtZSAzCg=="}})],1),e._v(" "),g("CodeGroupItem",{attrs:{title:"Docker"}},[g("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtaXQgY2hlY2tlcnMgXAogICAgY2hlY2tlcnNkIHF1ZXJ5IGNoZWNrZXJzIHNob3ctc3RvcmVkLWdhbWUgMwo="}})],1)],1),e._v(" "),g("p",[e._v("This should print:")]),e._v(" "),g("tm-code-block",{staticClass:"codeblock",attrs:{language:"txt",base64:"c3RvcmVkR2FtZToKICAgIGFmdGVySW5kZXg6ICZxdW90OzImcXVvdDsKICAgIGJlZm9yZUluZGV4OiAmcXVvdDsxJnF1b3Q7CiAgICAuLi4K"}}),e._v(" "),g("p",[e._v("Your FIFO now has the game IDs "),g("code",[e._v("[1, 3, 2]")]),e._v(". You see that game "),g("code",[e._v("2")]),e._v(", which was played on, has been sent to the tail of the FIFO.")]),e._v(" "),g("p",[e._v("Which is what you were expecting.")])],1)],1),e._v(" "),g("br"),e._v(" "),g("HighlightBox",{attrs:{type:"synopsis"}},[g("p",[e._v("To summarize, this section has explored:")]),e._v(" "),g("ul",[g("li",[e._v("The use of a First-In-First-Out (FIFO) data structure to sort games from the least recently played at the top of the list to the most recently played at the bottom, in order to help identify inactive games which may become candidates for forced termination, which reduces undesirable and wasteful data stored on the blockchain.")]),e._v(" "),g("li",[e._v("How forced termination of games is beneficial should you implement a wager system, as it prevents any assigned value from becoming locked into inactive games by causing the inactive player to forfeit the game and lose their wager.")]),e._v(" "),g("li",[e._v("How any code solution which searches the entire data store for inactive games is computationally expensive, needlessly accessing many active games to identify any inactive minority (which may not even exist).")]),e._v(" "),g("li",[e._v("How a FIFO data structure definitionally orders games such that inactive games rise to the top of the list, meaning code solutions can simply run until encountering the first active game and then stop, conserving gas fees.")]),e._v(" "),g("li",[e._v("What new information and functions need to be added to your code; how to integrate them into the message handlers; how to update your unit tests to prevent them from failing due to these changes; and what tests to run to test the code.")]),e._v(" "),g("li",[e._v("How to interact with the CLI to check the effectiveness of your new commands.")])])])],1)}),[],!1,null,null,null);t.default=a.exports}}]);