(window.webpackJsonp=window.webpackJsonp||[]).push([[146],{762:function(e,t,o){"use strict";o.r(t);var a=o(1),l=Object(a.a)({},(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[o("h1",{attrs:{id:"tally-player-info-after-production"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#tally-player-info-after-production"}},[e._v("#")]),e._v(" Tally Player Info After Production")]),e._v(" "),o("HighlightBox",{attrs:{type:"prerequisite"}},[o("p",[e._v("Make sure you have all you need before proceeding:")]),e._v(" "),o("ul",[o("li",[e._v("You understand the concepts of "),o("RouterLink",{attrs:{to:"/academy/2-cosmos-concepts/6-protobuf.html"}},[e._v("Protobuf")]),e._v(" and "),o("RouterLink",{attrs:{to:"/academy/2-cosmos-concepts/16-migrations.html"}},[e._v("migrations")]),e._v(".")],1),e._v(" "),o("li",[e._v("Go is installed.")]),e._v(" "),o("li",[e._v("You have the checkers blockchain codebase up to the "),o("em",[e._v("Simulate Production in Docker")]),e._v(". If not, follow the "),o("RouterLink",{attrs:{to:"/hands-on-exercise/4-run-in-prod/1-run-prod-docker.html"}},[e._v("previous steps")]),e._v(" or check out the "),o("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/tree/run-prod",target:"_blank",rel:"noopener noreferrer"}},[e._v("relevant version"),o("OutboundLink")],1),e._v(".")],1)])]),e._v(" "),o("HighlightBox",{attrs:{type:"learning"}},[o("p",[e._v("In this section, you will:")]),e._v(" "),o("ul",[o("li",[e._v("Add a new storage structure to tally player information.")]),e._v(" "),o("li",[e._v("Upgrade your blockchain in production.")]),e._v(" "),o("li",[e._v("Deal with data migrations and logic upgrades.")])])]),e._v(" "),o("p",[e._v("If you have been running "),o("em",[e._v("v1")]),e._v(" of your checkers blockchain for a while, games have been created, played on, won, and lost. In this section, you will introduce "),o("em",[e._v("v1.1")]),e._v(" of your blockchain where wins and losses and tallied in a new storage data structure.")]),e._v(" "),o("HighlightBox",{attrs:{type:"tip"}},[o("p",[e._v("This is not done in vain. Instead, looking forward, this is done to support the addition of a leaderboard module for your "),o("em",[e._v("v2")]),e._v(" in the "),o("RouterLink",{attrs:{to:"/hands-on-exercise/4-run-in-prod/3-add-leaderboard.html"}},[e._v("next section")]),e._v(".")],1)]),e._v(" "),o("p",[e._v("For now, a good tally should be such that for any player who has "),o("strong",[e._v("ever")]),e._v(" played it should be possible to access a tally of games won. While you are at it, you will add games lost and forfeited. Fortunately, this is possible because all past games and their outcomes are kept in the chain's state. Migration is a good method to tackle the initial tally.")]),e._v(" "),o("p",[e._v("For the avoidance of doubt, "),o("strong",[e._v("v1 and v1.1 refer to the overall versions of the application")]),e._v(", and not to the "),o("em",[e._v("consensus versions")]),e._v(" of individual modules, which may change or not. As it happens, your application has a single module, apart from those coming from the Cosmos SDK.")]),e._v(" "),o("h2",{attrs:{id:"introducing-a-new-data-structure"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#introducing-a-new-data-structure"}},[e._v("#")]),e._v(" Introducing a new data structure")]),e._v(" "),o("p",[e._v("Several things need to be addressed before you can focus all your attention on the migration:")]),e._v(" "),o("ol",[o("li",[e._v("Save and mark as v1 the current data types about to be modified with the new version. Data types that will remain unmodified need not be identified as such.")]),e._v(" "),o("li",[e._v("Prepare your v1.1 blockchain:\n"),o("ol",[o("li",[e._v("Define your new data types.")]),e._v(" "),o("li",[e._v("Add helper functions to encapsulate clearly defined actions.")]),e._v(" "),o("li",[e._v("Adjust the existing code to make use of and update the new data types.")])])]),e._v(" "),o("li",[e._v("Prepare for your v1-to-v1.1 migration:\n"),o("ol",[o("li",[e._v("Add helper functions to process large amounts of data from the latest chain state of v1.")]),e._v(" "),o("li",[e._v("Add a function to migrate your state from v1 to v1.1.")]),e._v(" "),o("li",[e._v("Make sure you can handle large amounts of data.")])])])]),e._v(" "),o("p",[o("em",[e._v("Why do you need to make sure you can handle large amounts of data?")]),e._v(" The full state at the point of migration may well have millions of games. You do not want your process to grind to a halt because of a lack of memory or I/O capacity.")]),e._v(" "),o("h2",{attrs:{id:"preparation"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#preparation"}},[e._v("#")]),e._v(" Preparation")]),e._v(" "),o("p",[e._v("For your convenience, you decide to keep all the migration steps in a new folder, "),o("code",[e._v("x/checkers/migrations")]),e._v(", and subfolders, which needs to be created:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBta2RpciB4L2NoZWNrZXJzL21pZ3JhdGlvbnMK"}}),e._v(" "),o("p",[e._v("Your data types are defined at a given consensus version of the module, not the application level v1. Find out the checkers module's current consensus version:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAoQXBwTW9kdWxlKSBDb25zZW5zdXNWZXJzaW9uKCkgdWludDY0IHsgcmV0dXJuIDIgfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/run-prod/x/checkers/module.go#L166"}}),e._v(" "),o("p",[e._v("Keep a note of it. At some point, you will create a "),o("code",[e._v("cv2")]),e._v(" subfolder (Where "),o("code",[e._v("cv")]),e._v(" is short for "),o("em",[e._v("consensus version")]),e._v(") for anything related to the consensus version at this level.")]),e._v(" "),o("p",[e._v("If your migration happened to require the "),o("em",[e._v("old")]),e._v(" data structure at an earlier consensus version, you would save the old types here.")]),e._v(" "),o("h2",{attrs:{id:"new-v1-1-information"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#new-v1-1-information"}},[e._v("#")]),e._v(" New v1.1 information")]),e._v(" "),o("p",[e._v("It is time to take a closer look at the new data structures being introduced with the version upgrade.")]),e._v(" "),o("HighlightBox",{attrs:{type:"tip"}},[o("p",[e._v("If you feel unsure about creating new data structures with Ignite CLI, look at the "),o("RouterLink",{attrs:{to:"/hands-on-exercise/1-ignite-cli/4-create-message.html"}},[e._v("previous sections")]),e._v(" of the exercise again.")],1)]),e._v(" "),o("p",[e._v("To give the new v1.1 information a data structure, you need the following:")]),e._v(" "),o("ol",[o("li",[o("p",[e._v("Add a set of "),o("strong",[e._v("stats per player")]),e._v(": it makes sense to save one "),o("code",[e._v("struct")]),e._v(" for each player and to map it by address. Remember that a game is stored at a "),o("em",[e._v("notional")]),e._v(" "),o("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/run-prod/x/checkers/keeper/stored_game.go#L24-L28",target:"_blank",rel:"noopener noreferrer"}},[o("code",[e._v("StoredGame/value/123/")]),o("OutboundLink")],1),e._v(", where "),o("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/run-prod/x/checkers/types/key_stored_game.go#L9",target:"_blank",rel:"noopener noreferrer"}},[o("code",[e._v("StoredGame/value/")]),o("OutboundLink")],1),e._v(" is a constant prefix. Similarly, Ignite CLI creates a new constant to use as the prefix for players:")]),e._v(" "),o("CodeGroup",[o("CodeGroupItem",{attrs:{title:"Local",active:""}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBpZ25pdGUgc2NhZmZvbGQgbWFwIHBsYXllckluZm8gXAogICAgd29uQ291bnQ6dWludCBsb3N0Q291bnQ6dWludCBmb3JmZWl0ZWRDb3VudDp1aW50IFwKICAgIC0tbW9kdWxlIGNoZWNrZXJzIC0tbm8tbWVzc2FnZQo="}})],1),e._v(" "),o("CodeGroupItem",{attrs:{title:"Docker"}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IFwKICAgIC12ICQocHdkKTovY2hlY2tlcnMgXAogICAgLXcgL2NoZWNrZXJzIFwKICAgIGNoZWNrZXJzX2kgXAogICAgaWduaXRlIHNjYWZmb2xkIG1hcCBwbGF5ZXJJbmZvIFwKICAgIHdvbkNvdW50OnVpbnQgbG9zdENvdW50OnVpbnQgZm9yZmVpdGVkQ291bnQ6dWludCBcCiAgICAtLW1vZHVsZSBjaGVja2VycyAtLW5vLW1lc3NhZ2UK"}})],1)],1),e._v(" "),o("HighlightBox",{attrs:{type:"info"}},[o("p",[e._v("The new "),o("code",[e._v("PlayerInfo/value/")]),e._v(" prefix for players helps differentiate between the value for players and the value for games prefixed with "),o("code",[e._v("StoredGame/value/")]),e._v(".\n"),o("br"),o("br"),e._v("\nNow you can safely have both "),o("code",[e._v("StoredGame/value/123/")]),e._v(" and "),o("code",[e._v("PlayerInfo/value/123/")]),e._v(" side by side in storage.")])]),e._v(" "),o("p",[e._v("This creates a Protobuf file:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"protobuf",base64:"bWVzc2FnZSBQbGF5ZXJJbmZvIHsKICAgIHN0cmluZyBpbmRleCA9IDE7CiAgICB1aW50NjQgd29uQ291bnQgPSAyOwogICAgdWludDY0IGxvc3RDb3VudCA9IDM7CiAgICB1aW50NjQgZm9yZmVpdGVkQ291bnQgPSA0Owp9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/player-info-object/proto/checkers/player_info.proto#L6-L11"}}),e._v(" "),o("p",[e._v("It also added the map of new objects to the genesis, effectively your v1.1 genesis:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-protobuf",base64:"ICAgIGltcG9ydCAmcXVvdDtjaGVja2Vycy9wbGF5ZXJfaW5mby5wcm90byZxdW90OzsKCiAgICBtZXNzYWdlIEdlbmVzaXNTdGF0ZSB7CiAgICAgICAgLi4uCisgICAgICByZXBlYXRlZCBQbGF5ZXJJbmZvIHBsYXllckluZm9MaXN0ID0gNCBbKGdvZ29wcm90by5udWxsYWJsZSkgPSBmYWxzZV07CiAgICB9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/player-info-object/proto/checkers/genesis.proto#L18"}}),e._v(" "),o("p",[e._v("You will use the player's address as a key to the map.")])],1)]),e._v(" "),o("p",[e._v("With the structure set up, it is time to add the code using these new elements in normal operations, before thinking about any migration.")]),e._v(" "),o("h2",{attrs:{id:"v1-1-player-information-helpers"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#v1-1-player-information-helpers"}},[e._v("#")]),e._v(" v1.1 player information helpers")]),e._v(" "),o("p",[e._v("When a game reaches its resolution, one of the "),o("code",[e._v("count")]),e._v("s needs to add "),o("code",[e._v("+1")]),e._v(".")]),e._v(" "),o("ExpansionPanel",{attrs:{title:"A detailed look into the code"}},[o("p",[e._v("To start, add a private helper function that gets the stats from the storage, updates the numbers as instructed, and saves it back:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBtdXN0QWRkRGVsdGFHYW1lUmVzdWx0VG9QbGF5ZXIoCiAgICBrICpLZWVwZXIsCiAgICBjdHggc2RrLkNvbnRleHQsCiAgICBwbGF5ZXIgc2RrLkFjY0FkZHJlc3MsCiAgICB3b25EZWx0YSB1aW50NjQsCiAgICBsb3N0RGVsdGEgdWludDY0LAogICAgZm9yZmVpdGVkRGVsdGEgdWludDY0LAopIChwbGF5ZXJJbmZvIHR5cGVzLlBsYXllckluZm8pIHsKICAgIHBsYXllckluZm8sIGZvdW5kIDo9IGsuR2V0UGxheWVySW5mbyhjdHgsIHBsYXllci5TdHJpbmcoKSkKICAgIGlmICFmb3VuZCB7CiAgICAgICAgcGxheWVySW5mbyA9IHR5cGVzLlBsYXllckluZm97CiAgICAgICAgICAgIEluZGV4OiAgICAgICAgICBwbGF5ZXIuU3RyaW5nKCksCiAgICAgICAgICAgIFdvbkNvdW50OiAgICAgICAwLAogICAgICAgICAgICBMb3N0Q291bnQ6ICAgICAgMCwKICAgICAgICAgICAgRm9yZmVpdGVkQ291bnQ6IDAsCiAgICAgICAgfQogICAgfQogICAgcGxheWVySW5mby5Xb25Db3VudCArPSB3b25EZWx0YQogICAgcGxheWVySW5mby5Mb3N0Q291bnQgKz0gbG9zdERlbHRhCiAgICBwbGF5ZXJJbmZvLkZvcmZlaXRlZENvdW50ICs9IGZvcmZlaXRlZERlbHRhCiAgICBrLlNldFBsYXllckluZm8oY3R4LCBwbGF5ZXJJbmZvKQogICAgcmV0dXJuIHBsYXllckluZm8KfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/player-info-handling/x/checkers/keeper/player_info_handler.go#L11-L33"}}),e._v(" "),o("p",[e._v("You can easily call this from these public one-liner functions added to the keeper:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAoayAqS2VlcGVyKSBNdXN0QWRkV29uR2FtZVJlc3VsdFRvUGxheWVyKGN0eCBzZGsuQ29udGV4dCwgcGxheWVyIHNkay5BY2NBZGRyZXNzKSB0eXBlcy5QbGF5ZXJJbmZvIHsKICAgIHJldHVybiBtdXN0QWRkRGVsdGFHYW1lUmVzdWx0VG9QbGF5ZXIoaywgY3R4LCBwbGF5ZXIsIDEsIDAsIDApCn0KCmZ1bmMgKGsgKktlZXBlcikgTXVzdEFkZExvc3RHYW1lUmVzdWx0VG9QbGF5ZXIoY3R4IHNkay5Db250ZXh0LCBwbGF5ZXIgc2RrLkFjY0FkZHJlc3MpIHR5cGVzLlBsYXllckluZm8gewogICAgcmV0dXJuIG11c3RBZGREZWx0YUdhbWVSZXN1bHRUb1BsYXllcihrLCBjdHgsIHBsYXllciwgMCwgMSwgMCkKfQoKZnVuYyAoayAqS2VlcGVyKSBNdXN0QWRkRm9yZmVpdGVkR2FtZVJlc3VsdFRvUGxheWVyKGN0eCBzZGsuQ29udGV4dCwgcGxheWVyIHNkay5BY2NBZGRyZXNzKSB0eXBlcy5QbGF5ZXJJbmZvIHsKICAgIHJldHVybiBtdXN0QWRkRGVsdGFHYW1lUmVzdWx0VG9QbGF5ZXIoaywgY3R4LCBwbGF5ZXIsIDAsIDAsIDEpCn0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/player-info-handling/x/checkers/keeper/player_info_handler.go#L35-L45"}}),e._v(" "),o("p",[e._v("Which player should get "),o("code",[e._v("+1")]),e._v(", and on what count? You need to identify the loser and the winner of a game to determine this. Create another private helper:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBnZXRXaW5uZXJBbmRMb3NlckFkZHJlc3NlcyhzdG9yZWRHYW1lICp0eXBlcy5TdG9yZWRHYW1lKSAod2lubmVyQWRkcmVzcyBzZGsuQWNjQWRkcmVzcywgbG9zZXJBZGRyZXNzIHNkay5BY2NBZGRyZXNzKSB7CiAgICBpZiBzdG9yZWRHYW1lLldpbm5lciA9PSBydWxlcy5QaWVjZVN0cmluZ3NbcnVsZXMuTk9fUExBWUVSXSB7CiAgICAgICAgcGFuaWModHlwZXMuRXJyVGhlcmVJc05vV2lubmVyLkVycm9yKCkpCiAgICB9CiAgICByZWRBZGRyZXNzLCBlcnIgOj0gc3RvcmVkR2FtZS5HZXRSZWRBZGRyZXNzKCkKICAgIGlmIGVyciAhPSBuaWwgewogICAgICAgIHBhbmljKGVyci5FcnJvcigpKQogICAgfQogICAgYmxhY2tBZGRyZXNzLCBlcnIgOj0gc3RvcmVkR2FtZS5HZXRCbGFja0FkZHJlc3MoKQogICAgaWYgZXJyICE9IG5pbCB7CiAgICAgICAgcGFuaWMoZXJyLkVycm9yKCkpCiAgICB9CiAgICBpZiBzdG9yZWRHYW1lLldpbm5lciA9PSBydWxlcy5QaWVjZVN0cmluZ3NbcnVsZXMuUkVEX1BMQVlFUl0gewogICAgICAgIHdpbm5lckFkZHJlc3MgPSByZWRBZGRyZXNzCiAgICAgICAgbG9zZXJBZGRyZXNzID0gYmxhY2tBZGRyZXNzCiAgICB9IGVsc2UgaWYgc3RvcmVkR2FtZS5XaW5uZXIgPT0gcnVsZXMuUGllY2VTdHJpbmdzW3J1bGVzLkJMQUNLX1BMQVlFUl0gewogICAgICAgIHdpbm5lckFkZHJlc3MgPSBibGFja0FkZHJlc3MKICAgICAgICBsb3NlckFkZHJlc3MgPSByZWRBZGRyZXNzCiAgICB9IGVsc2UgewogICAgICAgIHBhbmljKGZtdC5TcHJpbnRmKHR5cGVzLkVycldpbm5lck5vdFBhcnNlYWJsZS5FcnJvcigpLCBzdG9yZWRHYW1lLldpbm5lcikpCiAgICB9CiAgICByZXR1cm4gd2lubmVyQWRkcmVzcywgbG9zZXJBZGRyZXNzCn0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/player-info-handling/x/checkers/keeper/player_info_handler.go#L47-L69"}}),e._v(" "),o("p",[e._v("You can call this from these public helper functions added to the keeper:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAoayAqS2VlcGVyKSBNdXN0UmVnaXN0ZXJQbGF5ZXJXaW4oY3R4IHNkay5Db250ZXh0LCBzdG9yZWRHYW1lICp0eXBlcy5TdG9yZWRHYW1lKSAod2lubmVySW5mbyB0eXBlcy5QbGF5ZXJJbmZvLCBsb3NlckluZm8gdHlwZXMuUGxheWVySW5mbykgewogICAgd2lubmVyQWRkcmVzcywgbG9zZXJBZGRyZXNzIDo9IGdldFdpbm5lckFuZExvc2VyQWRkcmVzc2VzKHN0b3JlZEdhbWUpCiAgICByZXR1cm4gay5NdXN0QWRkV29uR2FtZVJlc3VsdFRvUGxheWVyKGN0eCwgd2lubmVyQWRkcmVzcyksCiAgICAgICAgay5NdXN0QWRkTG9zdEdhbWVSZXN1bHRUb1BsYXllcihjdHgsIGxvc2VyQWRkcmVzcykKfQoKZnVuYyAoayAqS2VlcGVyKSBNdXN0UmVnaXN0ZXJQbGF5ZXJGb3JmZWl0KGN0eCBzZGsuQ29udGV4dCwgc3RvcmVkR2FtZSAqdHlwZXMuU3RvcmVkR2FtZSkgKHdpbm5lckluZm8gdHlwZXMuUGxheWVySW5mbywgZm9yZmVpdGVySW5mbyB0eXBlcy5QbGF5ZXJJbmZvKSB7CiAgICB3aW5uZXJBZGRyZXNzLCBsb3NlckFkZHJlc3MgOj0gZ2V0V2lubmVyQW5kTG9zZXJBZGRyZXNzZXMoc3RvcmVkR2FtZSkKICAgIHJldHVybiBrLk11c3RBZGRXb25HYW1lUmVzdWx0VG9QbGF5ZXIoY3R4LCB3aW5uZXJBZGRyZXNzKSwKICAgICAgICBrLk11c3RBZGRGb3JmZWl0ZWRHYW1lUmVzdWx0VG9QbGF5ZXIoY3R4LCBsb3NlckFkZHJlc3MpCn0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/player-info-handling/x/checkers/keeper/player_info_handler.go#L71-L81"}}),e._v(" "),o("HighlightBox",{attrs:{type:"note"}},[o("p",[e._v("Be aware of the two new error types: "),o("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/player-info-handling/x/checkers/types/errors.go#L28",target:"_blank",rel:"noopener noreferrer"}},[o("code",[e._v("ErrThereIsNoWinner")]),o("OutboundLink")],1),e._v(" and "),o("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/player-info-handling/x/checkers/types/errors.go#L27",target:"_blank",rel:"noopener noreferrer"}},[o("code",[e._v("ErrWinnerNotParseable")]),o("OutboundLink")],1),e._v(".")])])],1),e._v(" "),o("h2",{attrs:{id:"v1-1-player-information-handling"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#v1-1-player-information-handling"}},[e._v("#")]),e._v(" v1.1 player information handling")]),e._v(" "),o("p",[e._v("Now call your helper functions:")]),e._v(" "),o("ol",[o("li",[o("p",[e._v("On a win:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIC4uLgogICAgaWYgc3RvcmVkR2FtZS5XaW5uZXIgPT0gcnVsZXMuUGllY2VTdHJpbmdzW3J1bGVzLk5PX1BMQVlFUl0gewogICAgICAgIC4uLgogICAgfSBlbHNlIHsKICAgICAgICAuLi4KICAgICAgICBrLktlZXBlci5NdXN0UGF5V2lubmluZ3MoY3R4LCAmYW1wO3N0b3JlZEdhbWUpCisgICAgICBrLktlZXBlci5NdXN0UmVnaXN0ZXJQbGF5ZXJXaW4oY3R4LCAmYW1wO3N0b3JlZEdhbWUpCiAgICB9CiAgICAuLi4K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/player-info-handling/x/checkers/keeper/msg_server_play_move.go#L80"}})],1),e._v(" "),o("li",[o("p",[e._v("On a forfeit:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIC4uLgogICAgaWYgc3RvcmVkR2FtZS5Nb3ZlQ291bnQgJmx0Oz0gMSB7CiAgICAgICAgLi4uCiAgICB9IGVsc2UgewogICAgICAgIC4uLgogICAgICAgIGsuTXVzdFBheVdpbm5pbmdzKGN0eCwgJmFtcDtzdG9yZWRHYW1lKQorICAgICAgay5NdXN0UmVnaXN0ZXJQbGF5ZXJGb3JmZWl0KGN0eCwgJmFtcDtzdG9yZWRHYW1lKQogICAgfQogICAgLi4uCg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/player-info-handling/x/checkers/keeper/end_block_server_game.go#L57"}})],1)]),e._v(" "),o("p",[e._v("Your player info tallies are now updated and saved on an on-going basis in your running v1.1 blockchain.")]),e._v(" "),o("h2",{attrs:{id:"unit-tests"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#unit-tests"}},[e._v("#")]),e._v(" Unit tests")]),e._v(" "),o("p",[e._v("With all these changes, it is worthwhile adding tests.")]),e._v(" "),o("h3",{attrs:{id:"player-info-handling-unit-tests"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#player-info-handling-unit-tests"}},[e._v("#")]),e._v(" Player info handling unit tests")]),e._v(" "),o("p",[e._v("Confirm with new tests that the player's information is created or updated on a win, a loss, and a forfeit. For instance, after a winning move:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBUZXN0Q29tcGxldGVHYW1lQWRkUGxheWVySW5mbyh0ICp0ZXN0aW5nLlQpIHsKICAgIG1zZ1NlcnZlciwga2VlcGVyLCBjb250ZXh0LCBjdHJsLCBlc2Nyb3cgOj0gc2V0dXBNc2dTZXJ2ZXJXaXRoT25lR2FtZUZvclBsYXlNb3ZlKHQpCiAgICBjdHggOj0gc2RrLlVud3JhcFNES0NvbnRleHQoY29udGV4dCkKICAgIGRlZmVyIGN0cmwuRmluaXNoKCkKICAgIGVzY3Jvdy5FeHBlY3RBbnkoY29udGV4dCkKCiAgICB0ZXN0dXRpbC5QbGF5QWxsTW92ZXModCwgbXNnU2VydmVyLCBjb250ZXh0LCAmcXVvdDsxJnF1b3Q7LCBib2IsIGNhcm9sLCB0ZXN0dXRpbC5HYW1lMU1vdmVzKQoKICAgIGJvYkluZm8sIGZvdW5kIDo9IGtlZXBlci5HZXRQbGF5ZXJJbmZvKGN0eCwgYm9iKQogICAgcmVxdWlyZS5UcnVlKHQsIGZvdW5kKQogICAgcmVxdWlyZS5FcXVhbFZhbHVlcyh0LCB0eXBlcy5QbGF5ZXJJbmZvewogICAgICAgIEluZGV4OiAgICAgICAgICBib2IsCiAgICAgICAgV29uQ291bnQ6ICAgICAgIDEsCiAgICAgICAgTG9zdENvdW50OiAgICAgIDAsCiAgICAgICAgRm9yZmVpdGVkQ291bnQ6IDAsCiAgICB9LCBib2JJbmZvKQogICAgY2Fyb2xJbmZvLCBmb3VuZCA6PSBrZWVwZXIuR2V0UGxheWVySW5mbyhjdHgsIGNhcm9sKQogICAgcmVxdWlyZS5UcnVlKHQsIGZvdW5kKQogICAgcmVxdWlyZS5FcXVhbFZhbHVlcyh0LCB0eXBlcy5QbGF5ZXJJbmZvewogICAgICAgIEluZGV4OiAgICAgICAgICBjYXJvbCwKICAgICAgICBXb25Db3VudDogICAgICAgMCwKICAgICAgICBMb3N0Q291bnQ6ICAgICAgMSwKICAgICAgICBGb3JmZWl0ZWRDb3VudDogMCwKICAgIH0sIGNhcm9sSW5mbykKfQoKZnVuYyBUZXN0Q29tcGxldGVHYW1lVXBkYXRlUGxheWVySW5mbyh0ICp0ZXN0aW5nLlQpIHsKICAgIG1zZ1NlcnZlciwga2VlcGVyLCBjb250ZXh0LCBjdHJsLCBlc2Nyb3cgOj0gc2V0dXBNc2dTZXJ2ZXJXaXRoT25lR2FtZUZvclBsYXlNb3ZlKHQpCiAgICBjdHggOj0gc2RrLlVud3JhcFNES0NvbnRleHQoY29udGV4dCkKICAgIGRlZmVyIGN0cmwuRmluaXNoKCkKICAgIGVzY3Jvdy5FeHBlY3RBbnkoY29udGV4dCkKCiAgICBrZWVwZXIuU2V0UGxheWVySW5mbyhjdHgsIHR5cGVzLlBsYXllckluZm97CiAgICAgICAgSW5kZXg6ICAgICAgICAgIGJvYiwKICAgICAgICBXb25Db3VudDogICAgICAgMSwKICAgICAgICBMb3N0Q291bnQ6ICAgICAgMiwKICAgICAgICBGb3JmZWl0ZWRDb3VudDogMywKICAgIH0pCiAgICBrZWVwZXIuU2V0UGxheWVySW5mbyhjdHgsIHR5cGVzLlBsYXllckluZm97CiAgICAgICAgSW5kZXg6ICAgICAgICAgIGNhcm9sLAogICAgICAgIFdvbkNvdW50OiAgICAgICA0LAogICAgICAgIExvc3RDb3VudDogICAgICA1LAogICAgICAgIEZvcmZlaXRlZENvdW50OiA2LAogICAgfSkKCiAgICB0ZXN0dXRpbC5QbGF5QWxsTW92ZXModCwgbXNnU2VydmVyLCBjb250ZXh0LCAmcXVvdDsxJnF1b3Q7LCBib2IsIGNhcm9sLCB0ZXN0dXRpbC5HYW1lMU1vdmVzKQoKICAgIGJvYkluZm8sIGZvdW5kIDo9IGtlZXBlci5HZXRQbGF5ZXJJbmZvKGN0eCwgYm9iKQogICAgcmVxdWlyZS5UcnVlKHQsIGZvdW5kKQogICAgcmVxdWlyZS5FcXVhbFZhbHVlcyh0LCB0eXBlcy5QbGF5ZXJJbmZvewogICAgICAgIEluZGV4OiAgICAgICAgICBib2IsCiAgICAgICAgV29uQ291bnQ6ICAgICAgIDIsCiAgICAgICAgTG9zdENvdW50OiAgICAgIDIsCiAgICAgICAgRm9yZmVpdGVkQ291bnQ6IDMsCiAgICB9LCBib2JJbmZvKQogICAgY2Fyb2xJbmZvLCBmb3VuZCA6PSBrZWVwZXIuR2V0UGxheWVySW5mbyhjdHgsIGNhcm9sKQogICAgcmVxdWlyZS5UcnVlKHQsIGZvdW5kKQogICAgcmVxdWlyZS5FcXVhbFZhbHVlcyh0LCB0eXBlcy5QbGF5ZXJJbmZvewogICAgICAgIEluZGV4OiAgICAgICAgICBjYXJvbCwKICAgICAgICBXb25Db3VudDogICAgICAgNCwKICAgICAgICBMb3N0Q291bnQ6ICAgICAgNiwKICAgICAgICBGb3JmZWl0ZWRDb3VudDogNiwKICAgIH0sIGNhcm9sSW5mbykKfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/player-info-handling/x/checkers/keeper/msg_server_play_move_winner_test.go#L68-L131"}}),e._v(" "),o("p",[e._v("You can add similar tests that confirm that nothing happens after a "),o("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/player-info-handling/x/checkers/keeper/msg_server_create_game_test.go#L414-L493",target:"_blank",rel:"noopener noreferrer"}},[e._v("game creation"),o("OutboundLink")],1),e._v(" or a "),o("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/player-info-handling/x/checkers/keeper/msg_server_play_move_test.go#L538-L596",target:"_blank",rel:"noopener noreferrer"}},[e._v("non-winning move"),o("OutboundLink")],1),e._v(". You should also check that a "),o("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/player-info-handling/x/checkers/keeper/end_block_server_game_test.go#L577-L682",target:"_blank",rel:"noopener noreferrer"}},[e._v("forfeit is registered"),o("OutboundLink")],1),e._v(".")]),e._v(" "),o("p",[e._v("This completes your checkers v1.1 chain. If you were to start it anew as is, it would work. However, you already have the v1 of checkers running, so you need to migrate everything.")]),e._v(" "),o("h2",{attrs:{id:"v1-to-v1-1-player-information-migration-helper"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#v1-to-v1-1-player-information-migration-helper"}},[e._v("#")]),e._v(" v1 to v1.1 player information migration helper")]),e._v(" "),o("p",[e._v("With your v1.1 blockchain now fully operational on its own, it is time to work on the issue of stored data migration.")]),e._v(" "),o("h3",{attrs:{id:"consensus-version"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#consensus-version"}},[e._v("#")]),e._v(" Consensus version")]),e._v(" "),o("p",[e._v("Your checkers module's current consensus version is 2. You are about to migrate its store, so you need to increment the module's consensus version by "),o("code",[e._v("1")]),e._v(" exactly (to avoid any future surprises). You should make these numbers explicit:")]),e._v(" "),o("ol",[o("li",[o("p",[e._v("Save the v1 consensus version in a new file:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Y29uc3QgKAogICAgQ29uc2Vuc3VzVmVyc2lvbiA9IHVpbnQ2NCgyKQopCg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/player-info-migration/x/checkers/migration/cv2/types/keys.go#L4"}})],1),e._v(" "),o("li",[o("p",[e._v("Similarly, save the new v1.1 consensus version in another new file:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Y29uc3QgKAogICAgQ29uc2Vuc3VzVmVyc2lvbiA9IHVpbnQ2NCgzKQopCg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/player-info-migration/x/checkers/migration/cv3/types/keys.go#L4"}})],1),e._v(" "),o("li",[o("p",[e._v("Inform the module that it is now at the new consensus version:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIGltcG9ydCAoCiAgICAgICAgLi4uCisgICAgICBjdjNUeXBlcyAmcXVvdDtnaXRodWIuY29tL2I5bGFiL2NoZWNrZXJzL3gvY2hlY2tlcnMvbWlncmF0aW9ucy9jdjMvdHlwZXMmcXVvdDsKICAgICkKCi0gIGZ1bmMgKEFwcE1vZHVsZSkgQ29uc2Vuc3VzVmVyc2lvbigpIHVpbnQ2NCB7IHJldHVybiAyIH0KKyAgZnVuYyAoQXBwTW9kdWxlKSBDb25zZW5zdXNWZXJzaW9uKCkgdWludDY0IHsgcmV0dXJuIGN2M1R5cGVzLkNvbnNlbnN1c1ZlcnNpb24gfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/player-info-migration/x/checkers/module.go#L167"}})],1)]),e._v(" "),o("h3",{attrs:{id:"problem-description"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#problem-description"}},[e._v("#")]),e._v(" Problem description")]),e._v(" "),o("p",[e._v("Coming back to the store migration, in other words, you need to tackle the creation of player information. You will build the player information by extracting it from all the existing stored games. In the "),o("a",{attrs:{href:"https://en.wikipedia.org/wiki/MapReduce",target:"_blank",rel:"noopener noreferrer"}},[e._v("map/reduce"),o("OutboundLink")],1),e._v(" parlance, you will "),o("em",[e._v("reduce")]),e._v(" this information from the stored games.")]),e._v(" "),o("p",[e._v("If performance and hardware constraints were not an issue, an easy way to do it would be the following:")]),e._v(" "),o("ol",[o("li",[e._v("Call "),o("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/player-info-handling/x/checkers/keeper/stored_game.go#L50",target:"_blank",rel:"noopener noreferrer"}},[o("code",[e._v("keeper.GetAllStoredGame()")]),o("OutboundLink")],1),e._v(" to get an array with all the games.")]),e._v(" "),o("li",[e._v("Keep only the games that have a winner.")]),e._v(" "),o("li",[e._v("Then for each game:\n"),o("ol",[o("li",[e._v("Call "),o("code",[e._v("keeper.GetPlayerInfo")]),e._v(" or, if that is not found, create player info both for the black player and the red player.")]),e._v(" "),o("li",[e._v("Do "),o("code",[e._v("+1")]),e._v(" on "),o("code",[e._v(".WonCount")]),e._v(" or "),o("code",[e._v(".LostCount")]),e._v(" according to the "),o("code",[e._v("game.Winner")]),e._v(" field. In the current saved state, there is no way to differentiate between a "),o("em",[e._v("normal")]),e._v(" win and a win by forfeit.")]),e._v(" "),o("li",[e._v("Call "),o("code",[e._v("keeper.SetPlayerInfo")]),e._v(" for both black and red players.")])])])]),e._v(" "),o("p",[e._v("Of course, given inevitable resource limitations, you would run into the following problems:")]),e._v(" "),o("ol",[o("li",[e._v("Getting all the games in a single array may not be possible, because your node's RAM may not be able to keep a million of them in memory. Or maybe it fails at 100,000 of them.")]),e._v(" "),o("li",[e._v("Calling "),o("code",[e._v(".GetPlayerInfo")]),e._v(" and "),o("code",[e._v(".SetPlayerInfo")]),e._v(" twice per game just to do "),o("code",[e._v("+1")]),e._v(" adds up quickly. Remember that both of these calls are database calls. You could be facing a 12-hour job, during which your chain is offline.")]),e._v(" "),o("li",[e._v("Doing it all in a sequential manner would take even more time, as each blocking call blocks the whole process.")])]),e._v(" "),o("h3",{attrs:{id:"proposed-solution"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#proposed-solution"}},[e._v("#")]),e._v(" Proposed solution")]),e._v(" "),o("p",[e._v("Fortunately, there exist ways to mitigate these limitations:")]),e._v(" "),o("ol",[o("li",[e._v("You do not need to get all the games at once. The "),o("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/player-info-handling/x/checkers/keeper/grpc_query_stored_game.go#L14",target:"_blank",rel:"noopener noreferrer"}},[o("code",[e._v("keeper.StoredGameAll")]),o("OutboundLink")],1),e._v(" function offers pagination. With this, you can limit the impact on the RAM requirement, at the expense of multiple queries.")]),e._v(" "),o("li",[e._v("Within each subset of games, you can compute in memory the player list and how many wins and losses each player has. With this "),o("em",[e._v("mapping")]),e._v(" done, you can add the (in-memory) intermediary "),o("code",[e._v("WonCount")]),e._v(" and "),o("code",[e._v("LostCount")]),e._v(" sums to each player's stored sums. With this, a "),o("code",[e._v("+1")]),e._v(" is potentially replaced by a "),o("code",[e._v("+k")]),e._v(", at once reducing the number of calls to "),o("code",[e._v(".GetPlayerInfo")]),e._v(" and "),o("code",[e._v(".SetPlayerInfo")]),e._v(".")]),e._v(" "),o("li",[e._v("You can separate the different calls and computations into "),o("a",{attrs:{href:"https://gobyexample.com/goroutines",target:"_blank",rel:"noopener noreferrer"}},[e._v("Go routines"),o("OutboundLink")],1),e._v(" so that a blocking call does not prevent other computations from taking place in the meantime.")])]),e._v(" "),o("p",[e._v("The routines will use "),o("strong",[e._v("channels")]),e._v(" to communicate between themselves and the main function:")]),e._v(" "),o("ol",[o("li",[e._v("A "),o("em",[e._v("stored-game")]),e._v(" channel, that will pass along chunks of games in the "),o("code",[e._v("[]types.StoredGame")]),e._v(" format.")]),e._v(" "),o("li",[e._v("A "),o("em",[e._v("player-info")]),e._v(" channel, that will pass along intermediate computations of player information in the simple "),o("code",[e._v("types.PlayerInfo")]),e._v(" format.")]),e._v(" "),o("li",[e._v("A "),o("em",[e._v("done")]),e._v(" channel, whose only purpose is to flag to the main function when all has been processed.")])]),e._v(" "),o("p",[e._v("Each channel should also be able to pass an optional error, so tuples will be used.")]),e._v(" "),o("p",[e._v("The processing "),o("strong",[e._v("routines")]),e._v(" will be divided as per the following:")]),e._v(" "),o("ol",[o("li",[o("p",[e._v("The "),o("strong",[e._v("game loading")]),e._v(" routine will:")]),e._v(" "),o("ul",[o("li",[e._v("Fetch all games in paginated arrays.")]),e._v(" "),o("li",[e._v("Send the separate arrays on the "),o("em",[e._v("stored-game")]),e._v(" channel.")]),e._v(" "),o("li",[e._v("Send an error on the "),o("em",[e._v("stored-game")]),e._v(" channel if any is encountered.")]),e._v(" "),o("li",[e._v("Close the "),o("em",[e._v("stored-game")]),e._v(" channel after the last array, or on an error.")])])]),e._v(" "),o("li",[o("p",[e._v("The "),o("strong",[e._v("game processing")]),e._v(" routine will:")]),e._v(" "),o("ul",[o("li",[e._v("Receive separate arrays of games from the "),o("em",[e._v("stored-game")]),e._v(" channel.")]),e._v(" "),o("li",[e._v("Compute the aggregate player info records from them (i.e. "),o("strong",[o("em",[e._v("map")])]),e._v(").")]),e._v(" "),o("li",[e._v("Send the results on the "),o("em",[e._v("player-info")]),e._v(" channel.")]),e._v(" "),o("li",[e._v("Pass along an error if it receives any.")]),e._v(" "),o("li",[e._v("Close the "),o("em",[e._v("player-info")]),e._v(" channel after the last stored game, or on an error.")])])]),e._v(" "),o("li",[o("p",[e._v("The "),o("strong",[e._v("player info processing")]),e._v(" routine will:")]),e._v(" "),o("ul",[o("li",[e._v("Receive individual player info records from the "),o("em",[e._v("player-info")]),e._v(" channel.")]),e._v(" "),o("li",[e._v("Fetch the corresponding player info from the store. If it does not exist yet, it will create an empty new one.")]),e._v(" "),o("li",[e._v("Update the won and lost counts (i.e. "),o("strong",[o("em",[e._v("reduce")])]),e._v("). Remember, here it is doing "),o("code",[e._v("+= k")]),e._v(", not "),o("code",[e._v("+= 1")]),e._v(".")]),e._v(" "),o("li",[e._v("Save it back to the store.")]),e._v(" "),o("li",[e._v("Pass along an error if it receives any.")]),e._v(" "),o("li",[e._v("Close the "),o("em",[e._v("done")]),e._v(" channel after the last player info, or on an error.")])])]),e._v(" "),o("li",[o("p",[e._v("The "),o("strong",[e._v("main function")]),e._v(" will:")]),e._v(" "),o("ul",[o("li",[e._v("Create the above 3 channels.")]),e._v(" "),o("li",[e._v("Launch the above 3 routines.")]),e._v(" "),o("li",[e._v("Wait for the flag on the "),o("em",[e._v("done")]),e._v(" channel.")]),e._v(" "),o("li",[e._v("Exit, perhaps with an error.")])])])]),e._v(" "),o("h3",{attrs:{id:"implementation"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#implementation"}},[e._v("#")]),e._v(" Implementation")]),e._v(" "),o("p",[e._v("The processing will take your module's store from consensus version 2 to version 3. Therefore it makes sense to add the function in "),o("code",[e._v("x/checkers/migrations/cv3/keeper")]),e._v(".")]),e._v(" "),o("p",[e._v("The player info processing will handle an in-memory map of player addresses to their information: "),o("code",[e._v("map[string]*types.PlayerInfo")]),e._v(". Create a new file to encapsulate this whole processing. Start by creating a helper that automatically populates it with empty values when information is missing:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBnZXRPck5ld1BsYXllckluZm9Jbk1hcChpbmZvU29GYXIgKm1hcFtzdHJpbmddKnR5cGVzLlBsYXllckluZm8sIHBsYXllckluZGV4IHN0cmluZykgKHBsYXllckluZm8gKnR5cGVzLlBsYXllckluZm8pIHsKICAgIHBsYXllckluZm8sIGZvdW5kIDo9ICgqaW5mb1NvRmFyKVtwbGF5ZXJJbmRleF0KICAgIGlmICFmb3VuZCB7CiAgICAgICAgcGxheWVySW5mbyA9ICZhbXA7dHlwZXMuUGxheWVySW5mb3sKICAgICAgICAgICAgSW5kZXg6ICAgICAgICAgIHBsYXllckluZGV4LAogICAgICAgICAgICBXb25Db3VudDogICAgICAgMCwKICAgICAgICAgICAgTG9zdENvdW50OiAgICAgIDAsCiAgICAgICAgICAgIEZvcmZlaXRlZENvdW50OiAwLAogICAgICAgIH0KICAgICAgICAoKmluZm9Tb0ZhcilbcGxheWVySW5kZXhdID0gcGxheWVySW5mbwogICAgfQogICAgcmV0dXJuIHBsYXllckluZm8KfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/player-info-migration/x/checkers/migrations/cv3/keeper/migration_player_info.go#L13-L25"}}),e._v(" "),o("p",[e._v("Now, create the function to load the games:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"dHlwZSBzdG9yZWRHYW1lc0NodW5rIHN0cnVjdCB7CiAgICBTdG9yZWRHYW1lcyBbXXR5cGVzLlN0b3JlZEdhbWUKICAgIEVycm9yICAgICAgIGVycm9yCn0KCmZ1bmMgbG9hZFN0b3JlZEdhbWVzKGNvbnRleHQgY29udGV4dC5Db250ZXh0LAogICAgayBrZWVwZXIuS2VlcGVyLAogICAgZ2FtZXNDaGFubmVsIGNoYW4mbHQ7LSBzdG9yZWRHYW1lc0NodW5rLAogICAgY2h1bmsgdWludDY0KSB7CiAgICBkZWZlciBmdW5jKCkgeyBjbG9zZShnYW1lc0NoYW5uZWwpIH0oKQogICAgcmVzcG9uc2UsIGVyciA6PSBrLlN0b3JlZEdhbWVBbGwoY29udGV4dCwgJmFtcDt0eXBlcy5RdWVyeUFsbFN0b3JlZEdhbWVSZXF1ZXN0ewogICAgICAgIFBhZ2luYXRpb246ICZhbXA7cXVlcnkuUGFnZVJlcXVlc3R7TGltaXQ6IGNodW5rfSwKICAgIH0pCiAgICBpZiBlcnIgIT0gbmlsIHsKICAgICAgICBnYW1lc0NoYW5uZWwgJmx0Oy0gc3RvcmVkR2FtZXNDaHVua3tFcnJvcjogZXJyfQogICAgICAgIHJldHVybgogICAgfQogICAgZ2FtZXNDaGFubmVsICZsdDstIHN0b3JlZEdhbWVzQ2h1bmt7U3RvcmVkR2FtZXM6IHJlc3BvbnNlLlN0b3JlZEdhbWV9CiAgICBmb3IgcmVzcG9uc2UuUGFnaW5hdGlvbi5OZXh0S2V5ICE9IG5pbCB7CiAgICAgICAgcmVzcG9uc2UsIGVyciA9IGsuU3RvcmVkR2FtZUFsbChjb250ZXh0LCAmYW1wO3R5cGVzLlF1ZXJ5QWxsU3RvcmVkR2FtZVJlcXVlc3R7CiAgICAgICAgICAgIFBhZ2luYXRpb246ICZhbXA7cXVlcnkuUGFnZVJlcXVlc3R7CiAgICAgICAgICAgICAgICBLZXk6ICAgcmVzcG9uc2UuUGFnaW5hdGlvbi5OZXh0S2V5LAogICAgICAgICAgICAgICAgTGltaXQ6IGNodW5rLAogICAgICAgICAgICB9LAogICAgICAgIH0pCiAgICAgICAgaWYgZXJyICE9IG5pbCB7CiAgICAgICAgICAgIGdhbWVzQ2hhbm5lbCAmbHQ7LSBzdG9yZWRHYW1lc0NodW5re0Vycm9yOiBlcnJ9CiAgICAgICAgICAgIHJldHVybgogICAgICAgIH0KICAgICAgICBnYW1lc0NoYW5uZWwgJmx0Oy0gc3RvcmVkR2FtZXNDaHVua3tTdG9yZWRHYW1lczogcmVzcG9uc2UuU3RvcmVkR2FtZX0KICAgIH0KfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/player-info-migration/x/checkers/migrations/cv3/keeper/migration_player_info.go#L27-L58"}}),e._v(" "),o("HighlightBox",{attrs:{type:"note"}},[o("p",[e._v("Note that:")]),e._v(" "),o("ul",[o("li",[e._v("The helper function passes along the channel a tuple "),o("code",[e._v("storedGamesChunk")]),e._v(" that may contain an error. This is to obtain a result similar to when a function returns an optional error .")]),e._v(" "),o("li",[e._v("It uses the paginated query so as to not overwhelm the memory if there are millions of infos.")]),e._v(" "),o("li",[e._v("It closes the channel upon exit whether there is an error or not via the use of "),o("code",[e._v("defer")]),e._v(".")])])]),e._v(" "),o("p",[e._v("Next, create the routine function to process the games:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"dHlwZSBwbGF5ZXJJbmZvVHVwbGUgc3RydWN0IHsKICAgIFBsYXllckluZm8gdHlwZXMuUGxheWVySW5mbwogICAgRXJyb3IgICAgICBlcnJvcgp9CgpmdW5jIGhhbmRsZVN0b3JlZEdhbWVDaGFubmVsKGsga2VlcGVyLktlZXBlciwKICAgIGdhbWVzQ2hhbm5lbCAmbHQ7LWNoYW4gc3RvcmVkR2FtZXNDaHVuaywKICAgIHBsYXllckluZm9DaGFubmVsIGNoYW4mbHQ7LSBwbGF5ZXJJbmZvVHVwbGUpIHsKICAgIGRlZmVyIGZ1bmMoKSB7IGNsb3NlKHBsYXllckluZm9DaGFubmVsKSB9KCkKICAgIGZvciBnYW1lcyA6PSByYW5nZSBnYW1lc0NoYW5uZWwgewogICAgICAgIGlmIGdhbWVzLkVycm9yICE9IG5pbCB7CiAgICAgICAgICAgIHBsYXllckluZm9DaGFubmVsICZsdDstIHBsYXllckluZm9UdXBsZXtFcnJvcjogZ2FtZXMuRXJyb3J9CiAgICAgICAgICAgIHJldHVybgogICAgICAgIH0KICAgICAgICBwbGF5ZXJJbmZvcyA6PSBtYWtlKG1hcFtzdHJpbmddKnR5cGVzLlBsYXllckluZm8sIGxlbihnYW1lcy5TdG9yZWRHYW1lcykpCiAgICAgICAgZm9yIF8sIGdhbWUgOj0gcmFuZ2UgZ2FtZXMuU3RvcmVkR2FtZXMgewogICAgICAgICAgICB2YXIgd2lubmVyIHN0cmluZwogICAgICAgICAgICB2YXIgbG9zZXIgc3RyaW5nCiAgICAgICAgICAgIGlmIGdhbWUuV2lubmVyID09IHJ1bGVzLlBpZWNlU3RyaW5nc1tydWxlcy5CTEFDS19QTEFZRVJdIHsKICAgICAgICAgICAgICAgIHdpbm5lciA9IGdhbWUuQmxhY2sKICAgICAgICAgICAgICAgIGxvc2VyID0gZ2FtZS5SZWQKICAgICAgICAgICAgfSBlbHNlIGlmIGdhbWUuV2lubmVyID09IHJ1bGVzLlBpZWNlU3RyaW5nc1tydWxlcy5SRURfUExBWUVSXSB7CiAgICAgICAgICAgICAgICB3aW5uZXIgPSBnYW1lLlJlZAogICAgICAgICAgICAgICAgbG9zZXIgPSBnYW1lLkJsYWNrCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICB9CiAgICAgICAgICAgIGdldE9yTmV3UGxheWVySW5mb0luTWFwKCZhbXA7cGxheWVySW5mb3MsIHdpbm5lcikuV29uQ291bnQrKwogICAgICAgICAgICBnZXRPck5ld1BsYXllckluZm9Jbk1hcCgmYW1wO3BsYXllckluZm9zLCBsb3NlcikuTG9zdENvdW50KysKICAgICAgICB9CiAgICAgICAgZm9yIF8sIHBsYXllckluZm8gOj0gcmFuZ2UgcGxheWVySW5mb3MgewogICAgICAgICAgICBpZiBwbGF5ZXJJbmZvICE9IG5pbCB7CiAgICAgICAgICAgICAgICBwbGF5ZXJJbmZvQ2hhbm5lbCAmbHQ7LSBwbGF5ZXJJbmZvVHVwbGV7UGxheWVySW5mbzogKnBsYXllckluZm99CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/player-info-migration/x/checkers/migrations/cv3/keeper/migration_player_info.go#L60-L96"}}),e._v(" "),o("HighlightBox",{attrs:{type:"note"}},[o("p",[e._v("Note that:")]),e._v(" "),o("ul",[o("li",[e._v("This function can handle the edge case where black and red both refer to the same player.")]),e._v(" "),o("li",[e._v("It prepares a map with a capacity equal to the number of games. At most the capacity would be double that. This is a value that could be worth investigating for best performance.")]),e._v(" "),o("li",[e._v("Like the helper function, it passes along a tuple with an optional error.")]),e._v(" "),o("li",[e._v("It closes the channel it populates upon exit whether there is an error or not via the use of "),o("code",[e._v("defer")]),e._v(".")])])]),e._v(" "),o("p",[e._v("Create the routine function to process the player info:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBoYW5kbGVQbGF5ZXJJbmZvQ2hhbm5lbChjdHggc2RrLkNvbnRleHQsIGsga2VlcGVyLktlZXBlciwKICAgIHBsYXllckluZm9DaGFubmVsICZsdDstY2hhbiBwbGF5ZXJJbmZvVHVwbGUsCiAgICBkb25lIGNoYW4mbHQ7LSBlcnJvcikgewogICAgZGVmZXIgZnVuYygpIHsgY2xvc2UoZG9uZSkgfSgpCiAgICBmb3IgcmVjZWl2ZWRJbmZvIDo9IHJhbmdlIHBsYXllckluZm9DaGFubmVsIHsKICAgICAgICBpZiByZWNlaXZlZEluZm8uRXJyb3IgIT0gbmlsIHsKICAgICAgICAgICAgZG9uZSAmbHQ7LSByZWNlaXZlZEluZm8uRXJyb3IKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgfQogICAgICAgIGV4aXN0aW5nSW5mbywgZm91bmQgOj0gay5HZXRQbGF5ZXJJbmZvKGN0eCwgcmVjZWl2ZWRJbmZvLlBsYXllckluZm8uSW5kZXgpCiAgICAgICAgaWYgZm91bmQgewogICAgICAgICAgICBleGlzdGluZ0luZm8uV29uQ291bnQgKz0gcmVjZWl2ZWRJbmZvLlBsYXllckluZm8uV29uQ291bnQKICAgICAgICAgICAgZXhpc3RpbmdJbmZvLkxvc3RDb3VudCArPSByZWNlaXZlZEluZm8uUGxheWVySW5mby5Mb3N0Q291bnQKICAgICAgICAgICAgZXhpc3RpbmdJbmZvLkZvcmZlaXRlZENvdW50ICs9IHJlY2VpdmVkSW5mby5QbGF5ZXJJbmZvLkZvcmZlaXRlZENvdW50CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZXhpc3RpbmdJbmZvID0gcmVjZWl2ZWRJbmZvLlBsYXllckluZm8KICAgICAgICB9CiAgICAgICAgay5TZXRQbGF5ZXJJbmZvKGN0eCwgZXhpc3RpbmdJbmZvKQogICAgfQogICAgZG9uZSAmbHQ7LSBuaWwKfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/player-info-migration/x/checkers/migrations/cv3/keeper/migration_player_info.go#L98-L123"}}),e._v(" "),o("HighlightBox",{attrs:{type:"note"}},[o("p",[e._v("Note that:")]),e._v(" "),o("ul",[o("li",[e._v("This function only passes an optional error.")]),e._v(" "),o("li",[e._v("It closes the channel it populates upon exit whether there is an error or not via the use of "),o("code",[e._v("defer")]),e._v(".")])])]),e._v(" "),o("p",[e._v("Now you can create the main function:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBNYXBTdG9yZWRHYW1lc1JlZHVjZVRvUGxheWVySW5mbyhjdHggc2RrLkNvbnRleHQsIGsga2VlcGVyLktlZXBlciwgY2h1bmsgdWludDY0KSBlcnJvciB7CiAgICBjb250ZXh0IDo9IHNkay5XcmFwU0RLQ29udGV4dChjdHgpCiAgICBnYW1lc0NoYW5uZWwgOj0gbWFrZShjaGFuIHN0b3JlZEdhbWVzQ2h1bmspCiAgICBwbGF5ZXJJbmZvQ2hhbm5lbCA6PSBtYWtlKGNoYW4gcGxheWVySW5mb1R1cGxlKQogICAgZG9uZSA6PSBtYWtlKGNoYW4gZXJyb3IpCgogICAgZ28gaGFuZGxlUGxheWVySW5mb0NoYW5uZWwoY3R4LCBrLCBwbGF5ZXJJbmZvQ2hhbm5lbCwgZG9uZSkKICAgIGdvIGhhbmRsZVN0b3JlZEdhbWVDaGFubmVsKGssIGdhbWVzQ2hhbm5lbCwgcGxheWVySW5mb0NoYW5uZWwpCiAgICBnbyBsb2FkU3RvcmVkR2FtZXMoY29udGV4dCwgaywgZ2FtZXNDaGFubmVsLCBjaHVuaykKCiAgICByZXR1cm4gJmx0Oy1kb25lCn0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/player-info-migration/x/checkers/migrations/cv3/keeper/migration_player_info.go#L72-L106"}}),e._v(" "),o("HighlightBox",{attrs:{type:"note"}},[o("p",[e._v("Note that:")]),e._v(" "),o("ul",[o("li",[e._v("The main function delegates the closing of channels to the routines.")]),e._v(" "),o("li",[e._v('It starts the routines in the "reverse" order that they are chained, to reduce the likelihood of channel clogging.')])])]),e._v(" "),o("p",[e._v("Do not forget a suggested chunk size to pass as "),o("code",[e._v("chunk uint64")]),e._v(" to the main function when fetching stored games:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIGNvbnN0ICgKICAgICAgICBDb25zZW5zdXNWZXJzaW9uICAgID0gdWludDY0KDMpCisgICAgICBTdG9yZWRHYW1lQ2h1bmtTaXplID0gMV8wMDAKICAgICkK",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/player-info-migration/x/checkers/migrations/cv3/types/keys.go#L5"}}),e._v(" "),o("p",[e._v("To find the ideal chunk size value, you would have to test with the real state and try different values.")]),e._v(" "),o("h3",{attrs:{id:"unit-tests-2"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#unit-tests-2"}},[e._v("#")]),e._v(" Unit tests")]),e._v(" "),o("p",[e._v("You have added migration helpers and ought to add some unit tests on them. Similarly to other unit tests, you add a setup function in a new file:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBzZXR1cEtlZXBlckZvclYxVG9WMV8xTWlncmF0aW9uKHQgdGVzdGluZy5UQikgKGtlZXBlci5LZWVwZXIsIGNvbnRleHQuQ29udGV4dCkgewogICAgaywgY3R4IDo9IGtlZXBlcnRlc3QuQ2hlY2tlcnNLZWVwZXIodCkKICAgIGNoZWNrZXJzLkluaXRHZW5lc2lzKGN0eCwgKmssICp0eXBlcy5EZWZhdWx0R2VuZXNpcygpKQogICAgcmV0dXJuICprLCBzZGsuV3JhcFNES0NvbnRleHQoY3R4KQp9Cg=="}}),e._v(" "),o("p",[e._v("Add a function that tests simple cases of storage:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBUZXN0QnVpbGRQbGF5ZXJJbmZvc0luUGxhY2UodCAqdGVzdGluZy5UKSB7CiAgICB0ZXN0cyA6PSBbXXN0cnVjdCB7CiAgICAgICAgbmFtZSAgICAgc3RyaW5nCiAgICAgICAgZ2FtZXMgICAgW110eXBlcy5TdG9yZWRHYW1lCiAgICAgICAgZXhwZWN0ZWQgW110eXBlcy5QbGF5ZXJJbmZvCiAgICB9ewogICAgICAgIC8vIFRPRE8KICAgIH0KICAgIGZvciBfLCB0dCA6PSByYW5nZSB0ZXN0cyB7CiAgICAgICAgZm9yIGNodW5rIDo9IHVpbnQ2NCgxKTsgY2h1bmsgJmx0OyA1OyBjaHVuaysrIHsKICAgICAgICAgICAgdC5SdW4oZm10LlNwcmludGYoJnF1b3Q7JXMgY2h1bmsgJWQmcXVvdDssIHR0Lm5hbWUsIGNodW5rKSwgZnVuYyh0ICp0ZXN0aW5nLlQpIHsKICAgICAgICAgICAgICAgIGtlZXBlciwgY29udGV4dCA6PSBzZXR1cEtlZXBlckZvclYxVG9WMV8xTWlncmF0aW9uKHQpCiAgICAgICAgICAgICAgICBjdHggOj0gc2RrLlVud3JhcFNES0NvbnRleHQoY29udGV4dCkKCiAgICAgICAgICAgICAgICBmb3IgXywgZ2FtZSA6PSByYW5nZSB0dC5nYW1lcyB7CiAgICAgICAgICAgICAgICAgICAga2VlcGVyLlNldFN0b3JlZEdhbWUoY3R4LCBnYW1lKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY3YzS2VlcGVyLk1hcFN0b3JlZEdhbWVzUmVkdWNlVG9QbGF5ZXJJbmZvKGN0eCwga2VlcGVyLCBjaHVuaykKCiAgICAgICAgICAgICAgICBwbGF5ZXJJbmZvcyA6PSBrZWVwZXIuR2V0QWxsUGxheWVySW5mbyhjdHgpCiAgICAgICAgICAgICAgICByZXF1aXJlLkVxdWFsKHQsIGxlbih0dC5leHBlY3RlZCksIGxlbihwbGF5ZXJJbmZvcykpCiAgICAgICAgICAgICAgICByZXF1aXJlLkVxdWFsVmFsdWVzKHQsIHR0LmV4cGVjdGVkLCBwbGF5ZXJJbmZvcykKICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICB9Cn0K"}}),e._v(" "),o("p",[e._v("Add the simple tests cases, such as:")]),e._v(" "),o("ol",[o("li",[o("p",[e._v("Nothing:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ewogICAgbmFtZTogICAgICZxdW90O25vdGhpbmcgdG8gYXNzZW1ibGUmcXVvdDssCiAgICBnYW1lczogICAgW110eXBlcy5TdG9yZWRHYW1le30sCiAgICBleHBlY3RlZDogW110eXBlcy5QbGF5ZXJJbmZvKG5pbCksCn0sCg=="}})],1),e._v(" "),o("li",[o("p",[e._v("Single game with a win:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ewogICAgbmFtZTogJnF1b3Q7c2luZ2xlIGdhbWUgd2l0aCB3aW4mcXVvdDssCiAgICBnYW1lczogW110eXBlcy5TdG9yZWRHYW1lewogICAgICAgIHsKICAgICAgICAgICAgSW5kZXg6ICAmcXVvdDsxJnF1b3Q7LAogICAgICAgICAgICBXaW5uZXI6ICZxdW90O2ImcXVvdDssCiAgICAgICAgICAgIEJsYWNrOiAgJnF1b3Q7YWxpY2UmcXVvdDssCiAgICAgICAgICAgIFJlZDogICAgJnF1b3Q7Ym9iJnF1b3Q7LAogICAgICAgIH0sCiAgICB9LAogICAgZXhwZWN0ZWQ6IFtddHlwZXMuUGxheWVySW5mb3sKICAgICAgICB7CiAgICAgICAgICAgIEluZGV4OiAgICAgJnF1b3Q7YWxpY2UmcXVvdDssCiAgICAgICAgICAgIFdvbkNvdW50OiAgMSwKICAgICAgICAgICAgTG9zdENvdW50OiAwLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBJbmRleDogICAgICZxdW90O2JvYiZxdW90OywKICAgICAgICAgICAgV29uQ291bnQ6ICAwLAogICAgICAgICAgICBMb3N0Q291bnQ6IDEsCiAgICAgICAgfSwKICAgIH0sCn0sCg=="}})],1)]),e._v(" "),o("p",[e._v("And so on.")]),e._v(" "),o("p",[e._v("It can also be interesting to measure the time it takes to compute in the case of a large data set depending on the chunk size:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBUZXN0QnVpbGQxMGtQbGF5ZXJJbmZvc0luUGxhY2UodCAqdGVzdGluZy5UKSB7CiAgICBjaHVua3MgOj0gW111aW50NjR7MSwgMTAsIDEwMCwgMV8wMDAsIDEwXzAwMCwgMTAwXzAwMCwgMV8wMDBfMDAwfQogICAgZm9yIF8sIGNodW5rIDo9IHJhbmdlIGNodW5rcyB7CiAgICAgICAga2VlcGVyLCBjb250ZXh0IDo9IHNldHVwS2VlcGVyRm9yVjFUb1YxXzFNaWdyYXRpb24odCkKICAgICAgICBjdHggOj0gc2RrLlVud3JhcFNES0NvbnRleHQoY29udGV4dCkKICAgICAgICBmb3IgaWQgOj0gdWludDY0KDEpOyBpZCAmbHQ7PSAxMDBfMDAwOyBpZCsrIHsKICAgICAgICAgICAga2VlcGVyLlNldFN0b3JlZEdhbWUoY3R4LCB0eXBlcy5TdG9yZWRHYW1lewogICAgICAgICAgICAgICAgSW5kZXg6ICBzdHJjb252LkZvcm1hdFVpbnQoaWQsIDEwKSwKICAgICAgICAgICAgICAgIEJsYWNrOiAgJnF1b3Q7YWxpY2UmcXVvdDssCiAgICAgICAgICAgICAgICBSZWQ6ICAgICZxdW90O2JvYiZxdW90OywKICAgICAgICAgICAgICAgIFdpbm5lcjogJnF1b3Q7YiZxdW90OywKICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICAgICAgYmVmb3JlIDo9IHRpbWUuTm93KCkKICAgICAgICBjdjNLZWVwZXIuTWFwU3RvcmVkR2FtZXNSZWR1Y2VUb1BsYXllckluZm8oY3R4LCBrZWVwZXIsIGNodW5rKQogICAgICAgIGFmdGVyIDo9IHRpbWUuTm93KCkKICAgICAgICBwbGF5ZXJJbmZvcyA6PSBrZWVwZXIuR2V0QWxsUGxheWVySW5mbyhjdHgpCiAgICAgICAgcmVxdWlyZS5FcXVhbCh0LCAyLCBsZW4ocGxheWVySW5mb3MpKQogICAgICAgIHJlcXVpcmUuRXF1YWxWYWx1ZXModCwgW110eXBlcy5QbGF5ZXJJbmZvewogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBJbmRleDogICAgJnF1b3Q7YWxpY2UmcXVvdDssCiAgICAgICAgICAgICAgICBXb25Db3VudDogMTAwXzAwMCwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgSW5kZXg6ICAgICAmcXVvdDtib2ImcXVvdDssCiAgICAgICAgICAgICAgICBMb3N0Q291bnQ6IDEwMF8wMDAsCiAgICAgICAgICAgIH0sCiAgICAgICAgfSwgcGxheWVySW5mb3MpCiAgICAgICAgdC5Mb2dmKCZxdW90O0NodW5rICVkLCBkdXJhdGlvbiAlZCBtaWxsaXNlYyZxdW90OywgY2h1bmssIGFmdGVyLlN1YihiZWZvcmUpLk1pbGxpc2Vjb25kcygpKQogICAgfQp9Cg=="}}),e._v(" "),o("p",[e._v("You can run the tests with the verbose "),o("code",[e._v("-v")]),e._v(" flag to get the log:")]),e._v(" "),o("CodeGroup",[o("CodeGroupItem",{attrs:{title:"Local"}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBnbyB0ZXN0IC12IGdpdGh1Yi5jb20vYWxpY2UvY2hlY2tlcnMveC9jaGVja2Vycy9taWdyYXRpb25zL2N2My9rZWVwZXIK"}})],1),e._v(" "),o("CodeGroupItem",{attrs:{title:"Docker"}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IFwKICAgIC12ICQocHdkKTovY2hlY2tlcnMgXAogICAgLXcgL2NoZWNrZXJzIFwKICAgIGNoZWNrZXJzX2kgXAogICAgZ28gdGVzdCAtdiBnaXRodWIuY29tL2FsaWNlL2NoZWNrZXJzL3gvY2hlY2tlcnMvbWlncmF0aW9ucy9jdjMva2VlcGVyCg=="}})],1)],1),e._v(" "),o("p",[e._v("Among the verbose test results, you can find something like:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"txt",base64:"PT09IFJVTiAgIFRlc3RCdWlsZDEwa1BsYXllckluZm9zSW5QbGFjZQogICAgbWlncmF0aW9uX3BsYXllcl9pbmZvX3Rlc3QuZ286MTUzOiBDaHVuayAxLCBkdXJhdGlvbiAyMjI1IG1pbGxpc2VjCiAgICBtaWdyYXRpb25fcGxheWVyX2luZm9fdGVzdC5nbzoxNTM6IENodW5rIDEwLCBkdXJhdGlvbiAzMTcgbWlsbGlzZWMKICAgIG1pZ3JhdGlvbl9wbGF5ZXJfaW5mb190ZXN0LmdvOjE1MzogQ2h1bmsgMTAwLCBkdXJhdGlvbiAxMjAgbWlsbGlzZWMKICAgIG1pZ3JhdGlvbl9wbGF5ZXJfaW5mb190ZXN0LmdvOjE1MzogQ2h1bmsgMTAwMCwgZHVyYXRpb24gMTAzIG1pbGxpc2VjCiAgICBtaWdyYXRpb25fcGxheWVyX2luZm9fdGVzdC5nbzoxNTM6IENodW5rIDEwMDAwLCBkdXJhdGlvbiAxMjMgbWlsbGlzZWMKICAgIG1pZ3JhdGlvbl9wbGF5ZXJfaW5mb190ZXN0LmdvOjE1MzogQ2h1bmsgMTAwMDAwLCBkdXJhdGlvbiAxNzIgbWlsbGlzZWMKICAgIG1pZ3JhdGlvbl9wbGF5ZXJfaW5mb190ZXN0LmdvOjE1MzogQ2h1bmsgMTAwMDAwMCwgZHVyYXRpb24gMTU4IG1pbGxpc2VjCi0tLSBQQVNTOiBUZXN0QnVpbGQxMGtQbGF5ZXJJbmZvc0luUGxhY2UgKDYuMjZzKQo="}}),e._v(" "),o("h2",{attrs:{id:"v1-to-v1-1-migration-proper"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#v1-to-v1-1-migration-proper"}},[e._v("#")]),e._v(" v1 to v1.1 migration proper")]),e._v(" "),o("p",[e._v("The migration proper needs to execute the previous main function. You can encapsulate this knowledge in a function, which also makes more visible what is expected to take place:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"cGFja2FnZSBjdjMKCmltcG9ydCAoCiAgICAmcXVvdDtnaXRodWIuY29tL2I5bGFiL2NoZWNrZXJzL3gvY2hlY2tlcnMva2VlcGVyJnF1b3Q7CiAgICBjdjNLZWVwZXIgJnF1b3Q7Z2l0aHViLmNvbS9iOWxhYi9jaGVja2Vycy94L2NoZWNrZXJzL21pZ3JhdGlvbnMvY3YzL2tlZXBlciZxdW90OwogICAgc2RrICZxdW90O2dpdGh1Yi5jb20vY29zbW9zL2Nvc21vcy1zZGsvdHlwZXMmcXVvdDsKKQoKZnVuYyBQZXJmb3JtTWlncmF0aW9uKGN0eCBzZGsuQ29udGV4dCwgayBrZWVwZXIuS2VlcGVyLCBzdG9yZWRHYW1lQ2h1bmsgdWludDY0KSBlcnJvciB7CiAgICBjdHguTG9nZ2VyKCkuSW5mbygmcXVvdDtTdGFydCB0byBjb21wdXRlIGNoZWNrZXJzIGdhbWVzIHRvIHBsYXllciBpbmZvIGNhbGN1bGF0aW9uLi4uJnF1b3Q7KQogICAgZXJyIDo9IGN2M0tlZXBlci5NYXBTdG9yZWRHYW1lc1JlZHVjZVRvUGxheWVySW5mbyhjdHgsIGssIHN0b3JlZEdhbWVDaHVuaykKICAgIGlmIGVyciAhPSBuaWwgewogICAgICAgIGN0eC5Mb2dnZXIoKS5FcnJvcigmcXVvdDtDaGVja2VycyBnYW1lcyB0byBwbGF5ZXIgaW5mbyBjb21wdXRhdGlvbiBlbmRlZCB3aXRoIGVycm9yJnF1b3Q7KQogICAgfSBlbHNlIHsKICAgICAgICBjdHguTG9nZ2VyKCkuSW5mbygmcXVvdDtDaGVja2VycyBnYW1lcyB0byBwbGF5ZXIgaW5mbyBjb21wdXRhdGlvbiBkb25lJnF1b3Q7KQogICAgfQogICAgcmV0dXJuIGVycgp9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/player-info-migration/x/checkers/migrations/cv3/migration.go"}}),e._v(" "),o("HighlightBox",{attrs:{type:"note"}},[o("p",[e._v("This does not panic in case of an error. To avoid carrying on a faulty state, the caller of this function will have to handle the panic.")])]),e._v(" "),o("p",[e._v("You have in place the functions that will handle the store migration. Now you have to set up the chain of command for these functions to be called by the node at the right point in time.")]),e._v(" "),o("h3",{attrs:{id:"consensus-version-and-name"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#consensus-version-and-name"}},[e._v("#")]),e._v(" Consensus version and name")]),e._v(" "),o("p",[e._v("The "),o("code",[e._v("upgrade")]),e._v(" module keeps in its store the "),o("a",{attrs:{href:"https://docs.cosmos.network/v0.45/core/upgrade.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("different module versions"),o("OutboundLink")],1),e._v(" that are currently running. To signal an upgrade, your module needs to return a different value when queried by the "),o("code",[e._v("upgrade")]),e._v(" module. You have already prepared this change from "),o("code",[e._v("2")]),e._v(" to "),o("code",[e._v("3")]),e._v(".")]),e._v(" "),o("HighlightBox",{attrs:{type:"remember"}},[o("p",[e._v("The consensus version number bears no resemblance to v1 or v1.1. The consensus version number is for the module, whereas v1 or v1.1 is for the whole application.")])]),e._v(" "),o("p",[e._v("You also have to pick a name for the upgrade you have prepared. This name will identify your specific upgrade when it is mentioned in a "),o("code",[e._v("Plan")]),e._v(" (i.e. an upgrade governance proposal). This is a name relevant at the application level. Keep this information in a sub-folder of "),o("code",[e._v("app")]),e._v(":")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Y29uc3QgKAogICAgVXBncmFkZU5hbWUgPSAmcXVvdDt2MXRvdjFfMSZxdW90OwopCg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/player-info-migration/app/upgrades/v1tov1_1/keys.go#L4"}}),e._v(" "),o("p",[o("code",[e._v('"v1tov1.1"')]),e._v(" would have been more elegant, but dots cause problems in governance proposal names.")]),e._v(" "),o("p",[e._v("You have to inform your app about:")]),e._v(" "),o("ol",[o("li",[e._v("The mapping between the consensus version(s) and the migration process(es).")]),e._v(" "),o("li",[e._v("The mapping between this name and the module(s) consensus version(s).")])]),e._v(" "),o("p",[e._v("Prepare these in turn.")]),e._v(" "),o("h3",{attrs:{id:"callback-in-checkers-module"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#callback-in-checkers-module"}},[e._v("#")]),e._v(" Callback in checkers module")]),e._v(" "),o("p",[e._v("Indicate that the checkers module needs to perform some upgrade steps when it is coming out of the old consensus version by calling "),o("code",[e._v("RegisterMigration")]),e._v(":")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIGltcG9ydCAoCiAgICAgICAgLi4uCisgICAgICBjdjJ0eXBlcyAmcXVvdDtnaXRodWIuY29tL2I5bGFiL2NoZWNrZXJzL3gvY2hlY2tlcnMvbWlncmF0aW9ucy9jdjIvdHlwZXMmcXVvdDsKKyAgICAgIGN2MyAmcXVvdDtnaXRodWIuY29tL2I5bGFiL2NoZWNrZXJzL3gvY2hlY2tlcnMvbWlncmF0aW9ucy9jdjMmcXVvdDsKICAgICAgICBjdjN0eXBlcyAmcXVvdDtnaXRodWIuY29tL2I5bGFiL2NoZWNrZXJzL3gvY2hlY2tlcnMvbWlncmF0aW9ucy9jdjMvdHlwZXMmcXVvdDsKICAgICAgICAuLi4KICAgICkKCiAgICBmdW5jIChhbSBBcHBNb2R1bGUpIFJlZ2lzdGVyU2VydmljZXMoY2ZnIG1vZHVsZS5Db25maWd1cmF0b3IpIHsKICAgICAgICB0eXBlcy5SZWdpc3RlclF1ZXJ5U2VydmVyKGNmZy5RdWVyeVNlcnZlcigpLCBhbS5rZWVwZXIpCgorICAgICAgaWYgZXJyIDo9IGNmZy5SZWdpc3Rlck1pZ3JhdGlvbih0eXBlcy5Nb2R1bGVOYW1lLCBjdjJ0eXBlcy5Db25zZW5zdXNWZXJzaW9uLCBmdW5jKGN0eCBzZGsuQ29udGV4dCkgZXJyb3IgeworICAgICAgICAgIHJldHVybiBjdjMuUGVyZm9ybU1pZ3JhdGlvbihjdHgsIGFtLmtlZXBlciwgY3YzdHlwZXMuU3RvcmVkR2FtZUNodW5rU2l6ZSkKKyAgICAgIH0pOyBlcnIgIT0gbmlsIHsKKyAgICAgICAgICBwYW5pYyhmbXQuRXJyb3JmKCZxdW90O2ZhaWxlZCB0byByZWdpc3RlciBjdjIgcGxheWVyIGluZm8gbWlncmF0aW9uIG9mICVzOiAldyZxdW90OywgdHlwZXMuTW9kdWxlTmFtZSwgZXJyKSkKKyAgICAgIH0KICAgIH0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/player-info-migration/x/checkers/module.go#L146-L150"}}),e._v(" "),o("p",[e._v("Note that:")]),e._v(" "),o("ul",[o("li",[e._v("It decides on the chunk sizes to use at this point.")]),e._v(" "),o("li",[e._v("It moves the consensus version up one version, from "),o("code",[e._v("2")]),e._v(" to "),o("code",[e._v("3")]),e._v(".")])]),e._v(" "),o("h3",{attrs:{id:"callback-in-app"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#callback-in-app"}},[e._v("#")]),e._v(" Callback in "),o("code",[e._v("app")])]),e._v(" "),o("p",[e._v("The function that you are going to write needs a "),o("code",[e._v("Configurator")]),e._v(". This is already created as part of your "),o("code",[e._v("app")]),e._v(" preparation, but it is not kept. Instead of recreating one, adjust your code to make it easily available. Add this field to your "),o("code",[e._v("app")]),e._v(":")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIHR5cGUgQXBwIHN0cnVjdCB7CiAgICAgICAgLi4uCiAgICAgICAgc20gKm1vZHVsZS5TaW11bGF0aW9uTWFuYWdlcgorICAgICAgY29uZmlndXJhdG9yIG1vZHVsZS5Db25maWd1cmF0b3IKICAgIH0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/player-info-migration/app/app.go#L238"}}),e._v(" "),o("p",[e._v("Now adjust the place where the configurator is created:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"LSAgYXBwLm1tLlJlZ2lzdGVyU2VydmljZXMobW9kdWxlLk5ld0NvbmZpZ3VyYXRvcihhcHAuYXBwQ29kZWMsIGFwcC5Nc2dTZXJ2aWNlUm91dGVyKCksIGFwcC5HUlBDUXVlcnlSb3V0ZXIoKSkpCisgIGFwcC5jb25maWd1cmF0b3IgPSBtb2R1bGUuTmV3Q29uZmlndXJhdG9yKGFwcC5hcHBDb2RlYywgYXBwLk1zZ1NlcnZpY2VSb3V0ZXIoKSwgYXBwLkdSUENRdWVyeVJvdXRlcigpKQorICBhcHAubW0uUmVnaXN0ZXJTZXJ2aWNlcyhhcHAuY29uZmlndXJhdG9yKQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/player-info-migration/app/app.go#L532-L533"}}),e._v(" "),o("p",[e._v("Create a function that encapsulates knowledge about all possible upgrades, although there is a single one here. Since it includes "),o("em",[e._v("empty code")]),e._v(" for future use, avoid cluttering the already long "),o("code",[e._v("NewApp")]),e._v(" function:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"aW1wb3J0ICgKICAgICZxdW90O2dpdGh1Yi5jb20vYjlsYWIvY2hlY2tlcnMvYXBwL3VwZ3JhZGVzL3YxdG92MV8xJnF1b3Q7CiAgICBzdG9yZXR5cGVzICZxdW90O2dpdGh1Yi5jb20vY29zbW9zL2Nvc21vcy1zZGsvc3RvcmUvdHlwZXMmcXVvdDsKKQoKZnVuYyAoYXBwICpBcHApIHNldHVwVXBncmFkZUhhbmRsZXJzKCkgewogICAgLy8gdjEgdG8gdjEuMSB1cGdyYWRlIGhhbmRsZXIKICAgIGFwcC5VcGdyYWRlS2VlcGVyLlNldFVwZ3JhZGVIYW5kbGVyKAogICAgICAgIHYxdG92MV8xLlVwZ3JhZGVOYW1lLAogICAgICAgIGZ1bmMoY3R4IHNkay5Db250ZXh0LCBwbGFuIHVwZ3JhZGV0eXBlcy5QbGFuLCB2bSBtb2R1bGUuVmVyc2lvbk1hcCkgKG1vZHVsZS5WZXJzaW9uTWFwLCBlcnJvcikgewogICAgICAgICAgICByZXR1cm4gYXBwLm1tLlJ1bk1pZ3JhdGlvbnMoY3R4LCBhcHAuY29uZmlndXJhdG9yLCB2bSkKICAgICAgICB9LAogICAgKQoKICAgIC8vIFdoZW4gYSBwbGFubmVkIHVwZGF0ZSBoZWlnaHQgaXMgcmVhY2hlZCwgdGhlIG9sZCBiaW5hcnkgd2lsbCBwYW5pYwogICAgLy8gd3JpdGluZyBvbiBkaXNrIHRoZSBoZWlnaHQgYW5kIG5hbWUgb2YgdGhlIHVwZGF0ZSB0aGF0IHRyaWdnZXJlZCBpdAogICAgLy8gVGhpcyB3aWxsIHJlYWQgdGhhdCB2YWx1ZSwgYW5kIGV4ZWN1dGUgdGhlIHByZXBhcmF0aW9ucyBmb3IgdGhlIHVwZ3JhZGUuCiAgICB1cGdyYWRlSW5mbywgZXJyIDo9IGFwcC5VcGdyYWRlS2VlcGVyLlJlYWRVcGdyYWRlSW5mb0Zyb21EaXNrKCkKICAgIGlmIGVyciAhPSBuaWwgewogICAgICAgIHBhbmljKGZtdC5FcnJvcmYoJnF1b3Q7ZmFpbGVkIHRvIHJlYWQgdXBncmFkZSBpbmZvIGZyb20gZGlzazogJXcmcXVvdDssIGVycikpCiAgICB9CgogICAgaWYgYXBwLlVwZ3JhZGVLZWVwZXIuSXNTa2lwSGVpZ2h0KHVwZ3JhZGVJbmZvLkhlaWdodCkgewogICAgICAgIHJldHVybgogICAgfQoKICAgIHZhciBzdG9yZVVwZ3JhZGVzICpzdG9yZXR5cGVzLlN0b3JlVXBncmFkZXMKCiAgICBzd2l0Y2ggdXBncmFkZUluZm8uTmFtZSB7CiAgICBjYXNlIHYxdG92MV8xLlVwZ3JhZGVOYW1lOgogICAgfQoKICAgIGlmIHN0b3JlVXBncmFkZXMgIT0gbmlsIHsKICAgICAgICAvLyBjb25maWd1cmUgc3RvcmUgbG9hZGVyIHRoYXQgY2hlY2tzIGlmIHZlcnNpb24gPT0gdXBncmFkZUhlaWdodCBhbmQgYXBwbGllcyBzdG9yZSB1cGdyYWRlcwogICAgICAgIGFwcC5TZXRTdG9yZUxvYWRlcih1cGdyYWRldHlwZXMuVXBncmFkZVN0b3JlTG9hZGVyKHVwZ3JhZGVJbmZvLkhlaWdodCwgc3RvcmVVcGdyYWRlcykpCiAgICB9Cn0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/player-info-migration/app/app.go#L752-L783"}}),e._v(" "),o("p",[e._v("Now you are ready to inform the app proper. You do this towards the end, after the call to "),o("code",[e._v("app.SetEndBlocker")]),e._v(" and before "),o("code",[e._v("if loadLatest")]),e._v(". At the correct location:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIC4uLgogICAgYXBwLlNldEVuZEJsb2NrZXIoYXBwLkVuZEJsb2NrZXIpCgorICBhcHAuc2V0dXBVcGdyYWRlSGFuZGxlcnMoKQoKICAgIGlmIGxvYWRMYXRlc3QgewogICAgICAgIC4uLgogICAgfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/player-info-migration/app/app.go#L581"}}),e._v(" "),o("HighlightBox",{attrs:{type:"tip"}},[o("p",[e._v("Be aware that the "),o("code",[e._v("monitoring")]),e._v(" module added by Ignite causes difficulty when experimenting below with the CLI. To keep things simple, remove "),o("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/compare/player-info-handling..player-info-migration#diff-0f1d2976054440336a576d47a44a37b80cdf6701dd9113012bce0e3c425819b7L159",target:"_blank",rel:"noopener noreferrer"}},[e._v("all references to "),o("code",[e._v("monitoring")]),o("OutboundLink")],1),e._v(" from "),o("code",[e._v("app.go")]),e._v(".")])]),e._v(" "),o("p",[e._v("When done right, adding the callbacks is a short and easy solution.")]),e._v(" "),o("h3",{attrs:{id:"integration-tests"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#integration-tests"}},[e._v("#")]),e._v(" Integration tests")]),e._v(" "),o("p",[e._v("With changes made in "),o("code",[e._v("app.go")]),e._v(", unit tests are inadequate  you have to test with integration tests. Take inspiration from the upgrade keeper's "),o("a",{attrs:{href:"https://github.com/cosmos/cosmos-sdk/blob/v0.45.4/x/upgrade/keeper/keeper_test.go#L215-L233",target:"_blank",rel:"noopener noreferrer"}},[e._v("own integration tests"),o("OutboundLink")],1),e._v(".")]),e._v(" "),o("p",[e._v("In a new folder dedicated to your migration integration tests, copy the test suite and its setup function, which you created earlier for integration tests, minus the unnecessary "),o("code",[e._v("checkersModuleAddress")]),e._v(" line:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"dHlwZSBJbnRlZ3JhdGlvblRlc3RTdWl0ZSBzdHJ1Y3QgewoJc3VpdGUuU3VpdGUKCglhcHAgICAgICAgICAqY2hlY2tlcnNhcHAuQXBwCgltc2dTZXJ2ZXIgICB0eXBlcy5Nc2dTZXJ2ZXIKCWN0eCAgICAgICAgIHNkay5Db250ZXh0CglxdWVyeUNsaWVudCB0eXBlcy5RdWVyeUNsaWVudAp9CgpmdW5jIFRlc3RVcGdyYWRlVGVzdFN1aXRlKHQgKnRlc3RpbmcuVCkgewoJc3VpdGUuUnVuKHQsIG5ldyhJbnRlZ3JhdGlvblRlc3RTdWl0ZSkpCn0KCmZ1bmMgKHN1aXRlICpJbnRlZ3JhdGlvblRlc3RTdWl0ZSkgU2V0dXBUZXN0KCkgewoJYXBwIDo9IGNoZWNrZXJzYXBwLlNldHVwKGZhbHNlKQoJY3R4IDo9IGFwcC5CYXNlQXBwLk5ld0NvbnRleHQoZmFsc2UsIHRtcHJvdG8uSGVhZGVye1RpbWU6IHRpbWUuTm93KCl9KQoKCWFwcC5BY2NvdW50S2VlcGVyLlNldFBhcmFtcyhjdHgsIGF1dGh0eXBlcy5EZWZhdWx0UGFyYW1zKCkpCglhcHAuQmFua0tlZXBlci5TZXRQYXJhbXMoY3R4LCBiYW5rdHlwZXMuRGVmYXVsdFBhcmFtcygpKQoKCXF1ZXJ5SGVscGVyIDo9IGJhc2VhcHAuTmV3UXVlcnlTZXJ2ZXJUZXN0SGVscGVyKGN0eCwgYXBwLkludGVyZmFjZVJlZ2lzdHJ5KCkpCgl0eXBlcy5SZWdpc3RlclF1ZXJ5U2VydmVyKHF1ZXJ5SGVscGVyLCBhcHAuQ2hlY2tlcnNLZWVwZXIpCglxdWVyeUNsaWVudCA6PSB0eXBlcy5OZXdRdWVyeUNsaWVudChxdWVyeUhlbHBlcikKCglzdWl0ZS5hcHAgPSBhcHAKCXN1aXRlLm1zZ1NlcnZlciA9IGtlZXBlci5OZXdNc2dTZXJ2ZXJJbXBsKGFwcC5DaGVja2Vyc0tlZXBlcikKCXN1aXRlLmN0eCA9IGN0eAoJc3VpdGUucXVlcnlDbGllbnQgPSBxdWVyeUNsaWVudAp9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/player-info-migration/tests/integration/checkers/migrations/cv3/upgrade_integration_suite_test.go"}}),e._v(" "),o("p",[e._v("It is necessary to redeclare, as you cannot import test elements across package boundaries.")]),e._v(" "),o("p",[e._v("The code that runs for these tests is always at consensus version 3. After all, you cannot wish away the player info code during the tests setup. However, you can make the "),o("code",[e._v("upgrade")]),e._v(" module believe that it is still at the old state. Add this step into the suite's setup:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIGFwcC5CYW5rS2VlcGVyLlNldFBhcmFtcyhjdHgsIGJhbmt0eXBlcy5EZWZhdWx0UGFyYW1zKCkpCisgIGluaXRpYWxWTSA6PSBtb2R1bGUuVmVyc2lvbk1hcHt0eXBlcy5Nb2R1bGVOYW1lOiBjdjJ0eXBlcy5Db25zZW5zdXNWZXJzaW9ufQorICBhcHAuVXBncmFkZUtlZXBlci5TZXRNb2R1bGVWZXJzaW9uTWFwKGN0eCwgaW5pdGlhbFZNKQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/player-info-migration/tests/integration/checkers/migrations/cv3/upgrade_integration_suite_test.go#L39-L40"}}),e._v(" "),o("p",[e._v("Now you can add a test in another file. It verifies that the consensus version increases as saved in the upgrade keeper, when calling an upgrade with the right name.")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAoc3VpdGUgKkludGVncmF0aW9uVGVzdFN1aXRlKSBUZXN0VXBncmFkZUNvbnNlbnN1c1ZlcnNpb24oKSB7CiAgICB2bUJlZm9yZSA6PSBzdWl0ZS5hcHAuVXBncmFkZUtlZXBlci5HZXRNb2R1bGVWZXJzaW9uTWFwKHN1aXRlLmN0eCkKICAgIHN1aXRlLlJlcXVpcmUoKS5FcXVhbChjdjJ0eXBlcy5Db25zZW5zdXNWZXJzaW9uLCB2bUJlZm9yZVt0eXBlcy5Nb2R1bGVOYW1lXSkKCiAgICB2MVRvdjFfMVBsYW4gOj0gdXBncmFkZXR5cGVzLlBsYW57CiAgICAgICAgTmFtZTogICB2MXRvdjFfMS5VcGdyYWRlTmFtZSwKICAgICAgICBJbmZvOiAgICZxdW90O3NvbWUgdGV4dCBoZXJlJnF1b3Q7LAogICAgICAgIEhlaWdodDogMTIzNDUwMDAwLAogICAgfQogICAgc3VpdGUuYXBwLlVwZ3JhZGVLZWVwZXIuQXBwbHlVcGdyYWRlKHN1aXRlLmN0eCwgdjFUb3YxXzFQbGFuKQoKICAgIHZtQWZ0ZXIgOj0gc3VpdGUuYXBwLlVwZ3JhZGVLZWVwZXIuR2V0TW9kdWxlVmVyc2lvbk1hcChzdWl0ZS5jdHgpCiAgICBzdWl0ZS5SZXF1aXJlKCkuRXF1YWwoY3YzdHlwZXMuQ29uc2Vuc3VzVmVyc2lvbiwgdm1BZnRlclt0eXBlcy5Nb2R1bGVOYW1lXSkKfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/player-info-migration/tests/integration/checkers/migrations/cv3/upgrade_test.go#L19-L32"}}),e._v(" "),o("p",[e._v("You can also confirm that it panics if you pass it a wrong upgrade name:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAoc3VpdGUgKkludGVncmF0aW9uVGVzdFN1aXRlKSBUZXN0Tm90VXBncmFkZUNvbnNlbnN1c1ZlcnNpb24oKSB7CiAgICB2bUJlZm9yZSA6PSBzdWl0ZS5hcHAuVXBncmFkZUtlZXBlci5HZXRNb2R1bGVWZXJzaW9uTWFwKHN1aXRlLmN0eCkKICAgIHN1aXRlLlJlcXVpcmUoKS5FcXVhbChjdjJ0eXBlcy5Db25zZW5zdXNWZXJzaW9uLCB2bUJlZm9yZVt0eXBlcy5Nb2R1bGVOYW1lXSkKCiAgICBkdW1teVBsYW4gOj0gdXBncmFkZXR5cGVzLlBsYW57CiAgICAgICAgTmFtZTogICB2MXRvdjFfMS5VcGdyYWRlTmFtZSArICZxdW90O25vJnF1b3Q7LAogICAgICAgIEluZm86ICAgJnF1b3Q7c29tZSB0ZXh0IGhlcmUmcXVvdDssCiAgICAgICAgSGVpZ2h0OiAxMjM0NTAwMDAsCiAgICB9CiAgICBkZWZlciBmdW5jKCkgewogICAgICAgIHIgOj0gcmVjb3ZlcigpCiAgICAgICAgc3VpdGUuUmVxdWlyZSgpLk5vdE5pbChyLCAmcXVvdDtUaGUgY29kZSBkaWQgbm90IHBhbmljJnF1b3Q7KQogICAgICAgIHN1aXRlLlJlcXVpcmUoKS5FcXVhbChyLCAmcXVvdDtBcHBseVVwZ3JhZGUgc2hvdWxkIG5ldmVyIGJlIGNhbGxlZCB3aXRob3V0IGZpcnN0IGNoZWNraW5nIEhhc0hhbmRsZXImcXVvdDspCgogICAgICAgIHZtQWZ0ZXIgOj0gc3VpdGUuYXBwLlVwZ3JhZGVLZWVwZXIuR2V0TW9kdWxlVmVyc2lvbk1hcChzdWl0ZS5jdHgpCiAgICAgICAgc3VpdGUuUmVxdWlyZSgpLkVxdWFsKGN2MnR5cGVzLkNvbnNlbnN1c1ZlcnNpb24sIHZtQWZ0ZXJbdHlwZXMuTW9kdWxlTmFtZV0pCiAgICB9KCkKICAgIHN1aXRlLmFwcC5VcGdyYWRlS2VlcGVyLkFwcGx5VXBncmFkZShzdWl0ZS5jdHgsIGR1bW15UGxhbikKfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/player-info-migration/tests/integration/checkers/migrations/cv3/upgrade_test.go#L34-L52"}}),e._v(" "),o("p",[e._v("After that, you can check that the player infos are tallied as expected by adding in storage three completed games and one still in-play, and then triggering the upgrade:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAoc3VpdGUgKkludGVncmF0aW9uVGVzdFN1aXRlKSBUZXN0VXBncmFkZVRhbGx5UGxheWVySW5mbygpIHsKICAgIHN1aXRlLmFwcC5DaGVja2Vyc0tlZXBlci5TZXRTdG9yZWRHYW1lKHN1aXRlLmN0eCwgdHlwZXMuU3RvcmVkR2FtZXsKICAgICAgICBJbmRleDogICZxdW90OzEmcXVvdDssCiAgICAgICAgQmxhY2s6ICBhbGljZSwKICAgICAgICBSZWQ6ICAgIGJvYiwKICAgICAgICBXaW5uZXI6IHJ1bGVzLlBpZWNlU3RyaW5nc1tydWxlcy5CTEFDS19QTEFZRVJdLAogICAgfSkKICAgIHN1aXRlLmFwcC5DaGVja2Vyc0tlZXBlci5TZXRTdG9yZWRHYW1lKHN1aXRlLmN0eCwgdHlwZXMuU3RvcmVkR2FtZXsKICAgICAgICBJbmRleDogICZxdW90OzImcXVvdDssCiAgICAgICAgQmxhY2s6ICBhbGljZSwKICAgICAgICBSZWQ6ICAgIGNhcm9sLAogICAgICAgIFdpbm5lcjogcnVsZXMuUGllY2VTdHJpbmdzW3J1bGVzLlJFRF9QTEFZRVJdLAogICAgfSkKICAgIHN1aXRlLmFwcC5DaGVja2Vyc0tlZXBlci5TZXRTdG9yZWRHYW1lKHN1aXRlLmN0eCwgdHlwZXMuU3RvcmVkR2FtZXsKICAgICAgICBJbmRleDogICZxdW90OzMmcXVvdDssCiAgICAgICAgQmxhY2s6ICBhbGljZSwKICAgICAgICBSZWQ6ICAgIGNhcm9sLAogICAgICAgIFdpbm5lcjogcnVsZXMuUGllY2VTdHJpbmdzW3J1bGVzLkJMQUNLX1BMQVlFUl0sCiAgICB9KQogICAgc3VpdGUuYXBwLkNoZWNrZXJzS2VlcGVyLlNldFN0b3JlZEdhbWUoc3VpdGUuY3R4LCB0eXBlcy5TdG9yZWRHYW1lewogICAgICAgIEluZGV4OiAgJnF1b3Q7NCZxdW90OywKICAgICAgICBCbGFjazogIGFsaWNlLAogICAgICAgIFJlZDogICAgYm9iLAogICAgICAgIFdpbm5lcjogcnVsZXMuUGllY2VTdHJpbmdzW3J1bGVzLk5PX1BMQVlFUl0sCiAgICB9KQogICAgc3VpdGUuUmVxdWlyZSgpLkVxdWFsVmFsdWVzKFtddHlwZXMuUGxheWVySW5mbyhuaWwpLCBzdWl0ZS5hcHAuQ2hlY2tlcnNLZWVwZXIuR2V0QWxsUGxheWVySW5mbyhzdWl0ZS5jdHgpKQoKICAgIHYxVG92MV8xUGxhbiA6PSB1cGdyYWRldHlwZXMuUGxhbnsKICAgICAgICBOYW1lOiAgIHYxdG92MV8xLlVwZ3JhZGVOYW1lLAogICAgICAgIEluZm86ICAgJnF1b3Q7c29tZSB0ZXh0IGhlcmUmcXVvdDssCiAgICAgICAgSGVpZ2h0OiAxMjM0NTAwMDAsCiAgICB9CiAgICBzdWl0ZS5hcHAuVXBncmFkZUtlZXBlci5BcHBseVVwZ3JhZGUoc3VpdGUuY3R4LCB2MVRvdjFfMVBsYW4pCgogICAgZXhwZWN0ZWRJbmZvcyA6PSBtYXBbc3RyaW5nXXR5cGVzLlBsYXllckluZm97CiAgICAgICAgYWxpY2U6IHsKICAgICAgICAgICAgSW5kZXg6ICAgICBhbGljZSwKICAgICAgICAgICAgTG9zdENvdW50OiAxLAogICAgICAgICAgICBXb25Db3VudDogIDIsCiAgICAgICAgfSwKICAgICAgICBib2I6IHsKICAgICAgICAgICAgSW5kZXg6ICAgICBib2IsCiAgICAgICAgICAgIExvc3RDb3VudDogMSwKICAgICAgICB9LAogICAgICAgIGNhcm9sOiB7CiAgICAgICAgICAgIEluZGV4OiAgICAgY2Fyb2wsCiAgICAgICAgICAgIExvc3RDb3VudDogMSwKICAgICAgICAgICAgV29uQ291bnQ6ICAxLAogICAgICAgIH0sCiAgICB9CgogICAgZm9yIHdobywgZXhwZWN0ZWRJbmZvIDo9IHJhbmdlIGV4cGVjdGVkSW5mb3MgewogICAgICAgIHN0b3JlZEluZm8sIGZvdW5kIDo9IHN1aXRlLmFwcC5DaGVja2Vyc0tlZXBlci5HZXRQbGF5ZXJJbmZvKHN1aXRlLmN0eCwgd2hvKQogICAgICAgIHN1aXRlLlJlcXVpcmUoKS5UcnVlKGZvdW5kKQogICAgICAgIHN1aXRlLlJlcXVpcmUoKS5FcXVhbChleHBlY3RlZEluZm8sIHN0b3JlZEluZm8pCiAgICB9Cn0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/player-info-migration/tests/integration/checkers/migrations/cv3/upgrade_test.go#L54-L111"}}),e._v(" "),o("p",[e._v("To run the tests, put the right package path:")]),e._v(" "),o("CodeGroup",[o("CodeGroupItem",{attrs:{title:"Local"}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBnbyB0ZXN0IGdpdGh1Yi5jb20vYWxpY2UvY2hlY2tlcnMvdGVzdHMvaW50ZWdyYXRpb24vY2hlY2tlcnMvbWlncmF0aW9ucy9jdjMK"}})],1),e._v(" "),o("CodeGroupItem",{attrs:{title:"Docker"}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IFwKICAgIC12ICQocHdkKTovY2hlY2tlcnMgXAogICAgLXcgL2NoZWNrZXJzIFwKICAgIGNoZWNrZXJzX2kgXAogICAgZ28gdGVzdCBnaXRodWIuY29tL2FsaWNlL2NoZWNrZXJzL3Rlc3RzL2ludGVncmF0aW9uL2NoZWNrZXJzL21pZ3JhdGlvbnMvY3YzCg=="}})],1)],1),e._v(" "),o("p",[e._v("The tests confirm that you got it right.")]),e._v(" "),o("h2",{attrs:{id:"interact-via-the-cli"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#interact-via-the-cli"}},[e._v("#")]),e._v(" Interact via the CLI")]),e._v(" "),o("p",[e._v("You can already execute a live upgrade from the command line. The following upgrade process takes inspiration from "),o("a",{attrs:{href:"https://hub.cosmos.network/main/hub-tutorials/live-upgrade-tutorial.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("this one"),o("OutboundLink")],1),e._v(" based on Gaia. You will:")]),e._v(" "),o("ul",[o("li",[e._v("Check out the checkers v1 code.")]),e._v(" "),o("li",[e._v("Build the v1 checkers executable.")]),e._v(" "),o("li",[e._v("Initialize a local blockchain and network.")]),e._v(" "),o("li",[e._v("Run v1 checkers.")]),e._v(" "),o("li",[e._v("Add one or more incomplete games.")]),e._v(" "),o("li",[e._v("Add one or more complete games with the help of a CosmJS integration test.")]),e._v(" "),o("li",[e._v("Create a governance proposal to upgrade with the right plan name at an appropriate block height.")]),e._v(" "),o("li",[e._v("Make the proposal pass.")]),e._v(" "),o("li",[e._v("Wait for v1 checkers to halt on its own at the upgrade height.")]),e._v(" "),o("li",[e._v("Check out the checkers v1.1 code.")]),e._v(" "),o("li",[e._v("Build the v1.1 checkers executable.")]),e._v(" "),o("li",[e._v("Run v1.1 checkers.")]),e._v(" "),o("li",[e._v("Confirm that you now have a correct tally of player info.")])]),e._v(" "),o("p",[e._v("Start your engines!")]),e._v(" "),o("h3",{attrs:{id:"launch-v1"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#launch-v1"}},[e._v("#")]),e._v(" Launch v1")]),e._v(" "),o("p",[e._v("After committing your changes, in a shell checkout v1 of checkers with the content of the "),o("em",[e._v("run in production")]),e._v(" work:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBnaXQgY2hlY2tvdXQgcnVuLXByb2QKJCBnaXQgc3VibW9kdWxlIHVwZGF0ZSAtLWluaXQK"}}),e._v(" "),o("p",[e._v("Build the v1 executable for your platform:")]),e._v(" "),o("CodeGroup",[o("CodeGroupItem",{attrs:{title:"Local",active:""}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBnbyBidWlsZCAtbyByZWxlYXNlL3YxL2NoZWNrZXJzZCBjbWQvY2hlY2tlcnNkL21haW4uZ28K"}})],1),e._v(" "),o("CodeGroupItem",{attrs:{title:"Docker"}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IFwKICAgIC12ICQocHdkKTovY2hlY2tlcnMgXAogICAgLXcgL2NoZWNrZXJzIFwKICAgIGNoZWNrZXJzX2kgXAogICAgZ28gYnVpbGQgLW8gcmVsZWFzZS92MS9jaGVja2Vyc2QgY21kL2NoZWNrZXJzZC9tYWluLmdvCg=="}})],1)],1),e._v(" "),o("p",[e._v("With the "),o("code",[e._v("release/v1/checkersd")]),e._v(" executable ready, you can initialize the network.")]),e._v(" "),o("HighlightBox",{attrs:{type:"warn"}},[o("p",[e._v("Because this is an exercise, to avoid messing with your keyring you must always specify "),o("code",[e._v("--keyring-backend test")]),e._v(".")])]),e._v(" "),o("p",[e._v("Add two players:")]),e._v(" "),o("CodeGroup",[o("CodeGroupItem",{attrs:{title:"Local",active:""}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCAuL3JlbGVhc2UvdjEvY2hlY2tlcnNkIGtleXMgYWRkIGFsaWNlIC0ta2V5cmluZy1iYWNrZW5kIHRlc3QKJCAuL3JlbGVhc2UvdjEvY2hlY2tlcnNkIGtleXMgYWRkIGJvYiAtLWtleXJpbmctYmFja2VuZCB0ZXN0Cg=="}})],1),e._v(" "),o("CodeGroupItem",{attrs:{title:"Docker"}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgbmV0d29yayBjcmVhdGUgY2hlY2tlcnMtbmV0CiQgZG9ja2VyIGNyZWF0ZSAtaXQgXAogICAgLXYgJChwd2QpOi9jaGVja2VycyAtdyAvY2hlY2tlcnMgXAogICAgLXAgMjY2NTc6MjY2NTcgXAogICAgLS1uZXR3b3JrIGNoZWNrZXJzLW5ldCBcCiAgICAtLW5hbWUgY2hlY2tlcnMgXAogICAgY2hlY2tlcnNfaQokIGRvY2tlciBzdGFydCBjaGVja2VycwokIGRvY2tlciBleGVjIC10IGNoZWNrZXJzIFwKICAgIC4vcmVsZWFzZS92MS9jaGVja2Vyc2Qga2V5cyBhZGQgYWxpY2UgLS1rZXlyaW5nLWJhY2tlbmQgdGVzdAokIGRvY2tlciBleGVjIC10IGNoZWNrZXJzIFwKICAgIC4vcmVsZWFzZS92MS9jaGVja2Vyc2Qga2V5cyBhZGQgYm9iIC0ta2V5cmluZy1iYWNrZW5kIHRlc3QK"}}),e._v(" "),o("HighlightBox",{attrs:{type:"note"}},[o("p",[e._v("You should "),o("strong",[e._v("not")]),e._v(" use "),o("code",[e._v("docker run --rm")]),e._v(" here because, when "),o("code",[e._v("checkersd")]),e._v(" stops, you do not want to remove the container and thereby destroy the saved keys, and the future genesis too. Instead, reuse them all in the next calls.")])])],1)],1),e._v(" "),o("p",[e._v("Create a new genesis:")]),e._v(" "),o("CodeGroup",[o("CodeGroupItem",{attrs:{title:"Local",active:""}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCAuL3JlbGVhc2UvdjEvY2hlY2tlcnNkIGluaXQgY2hlY2tlcnMtMSAtLWNoYWluLWlkIGNoZWNrZXJzLTEK"}})],1),e._v(" "),o("CodeGroupItem",{attrs:{title:"Docker"}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtdCBjaGVja2VycyBcCiAgICAuL3JlbGVhc2UvdjEvY2hlY2tlcnNkIGluaXQgY2hlY2tlcnMtMSAtLWNoYWluLWlkIGNoZWNrZXJzLTEK"}})],1)],1),e._v(" "),o("p",[e._v("Give your players the same token amounts that were added by Ignite, as found in "),o("code",[e._v("config.yml")]),e._v(":")]),e._v(" "),o("CodeGroup",[o("CodeGroupItem",{attrs:{title:"Local",active:""}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCAuL3JlbGVhc2UvdjEvY2hlY2tlcnNkIGFkZC1nZW5lc2lzLWFjY291bnQgXAogICAgYWxpY2UgMjAwMDAwMDAwc3Rha2UsMjAwMDB0b2tlbiAtLWtleXJpbmctYmFja2VuZCB0ZXN0CiQgLi9yZWxlYXNlL3YxL2NoZWNrZXJzZCBhZGQtZ2VuZXNpcy1hY2NvdW50IFwKICAgIGJvYiAxMDAwMDAwMDBzdGFrZSwxMDAwMHRva2VuIC0ta2V5cmluZy1iYWNrZW5kIHRlc3QK"}})],1),e._v(" "),o("CodeGroupItem",{attrs:{title:"Docker"}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtdCBjaGVja2VycyBcCiAgICAuL3JlbGVhc2UvdjEvY2hlY2tlcnNkIGFkZC1nZW5lc2lzLWFjY291bnQgXAogICAgYWxpY2UgMjAwMDAwMDAwc3Rha2UsMjAwMDB0b2tlbiAtLWtleXJpbmctYmFja2VuZCB0ZXN0CiQgZG9ja2VyIGV4ZWMgLXQgY2hlY2tlcnMgXAogICAgLi9yZWxlYXNlL3YxL2NoZWNrZXJzZCBhZGQtZ2VuZXNpcy1hY2NvdW50IFwKICAgIGJvYiAxMDAwMDAwMDBzdGFrZSwxMDAwMHRva2VuIC0ta2V5cmluZy1iYWNrZW5kIHRlc3QK"}})],1)],1),e._v(" "),o("p",[e._v("To be able to run a quick test, you need to change the voting period of a proposal. This is found in the genesis:")]),e._v(" "),o("CodeGroup",[o("CodeGroupItem",{attrs:{title:"Local",active:""}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBqcSAnLmFwcF9zdGF0ZS5nb3Yudm90aW5nX3BhcmFtcy52b3RpbmdfcGVyaW9kJyB+Ly5jaGVja2Vycy9jb25maWcvZ2VuZXNpcy5qc29uCg=="}})],1),e._v(" "),o("CodeGroupItem",{attrs:{title:"Docker"}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtaXQgY2hlY2tlcnMgXAogICAganEgJy5hcHBfc3RhdGUuZ292LnZvdGluZ19wYXJhbXMudm90aW5nX3BlcmlvZCcgL3Jvb3QvLmNoZWNrZXJzL2NvbmZpZy9nZW5lc2lzLmpzb24K"}})],1)],1),e._v(" "),o("p",[e._v("This returns something like:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"json",base64:"JnF1b3Q7MTcyODAwcyZxdW90Owo="}}),e._v(" "),o("p",[e._v("That is two days, which is too long to wait for CLI tests. Choose another value, perhaps 10 minutes, i.e. "),o("code",[e._v('"600s"')]),e._v(". Update it in place in the genesis:")]),e._v(" "),o("CodeGroup",[o("CodeGroupItem",{attrs:{title:"Local",active:""}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBjYXQgJmx0OyZsdDsmbHQ7ICQoanEgJy5hcHBfc3RhdGUuZ292LnZvdGluZ19wYXJhbXMudm90aW5nX3BlcmlvZCA9ICZxdW90OzYwMHMmcXVvdDsnIH4vLmNoZWNrZXJzL2NvbmZpZy9nZW5lc2lzLmpzb24pIFwKICAgICZndDsgfi8uY2hlY2tlcnMvY29uZmlnL2dlbmVzaXMuanNvbgo="}})],1),e._v(" "),o("CodeGroupItem",{attrs:{title:"Docker"}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtdCBjaGVja2VycyBcCiAgICBiYXNoIC1jICZxdW90O2NhdCAmbHQ7Jmx0OyZsdDsgXCQoanEgJy5hcHBfc3RhdGUuZ292LnZvdGluZ19wYXJhbXMudm90aW5nX3BlcmlvZCA9IFwmcXVvdDs2MDBzXCZxdW90OycgL3Jvb3QvLmNoZWNrZXJzL2NvbmZpZy9nZW5lc2lzLmpzb24pIFwKICAgICZndDsgL3Jvb3QvLmNoZWNrZXJzL2NvbmZpZy9nZW5lc2lzLmpzb24mcXVvdDsK"}})],1),e._v(" "),o("CodeGroupItem",{attrs:{title:"By hand"}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-json",base64:"ICAgIC4uLgotICAmcXVvdDt2b3RpbmdfcGVyaW9kJnF1b3Q7OiAmcXVvdDsxNzI4MDBzJnF1b3Q7CisgICZxdW90O3ZvdGluZ19wZXJpb2QmcXVvdDs6ICZxdW90OzYwMHMmcXVvdDsKICAgIC4uLgo="}})],1)],1),e._v(" "),o("p",[e._v("You can confirm that the value is in using the earlier command.")]),e._v(" "),o("p",[e._v("Make Alice the chain's validator too by creating a genesis transaction modeled on that done by Ignite, as found in "),o("code",[e._v("config.yml")]),e._v(":")]),e._v(" "),o("CodeGroup",[o("CodeGroupItem",{attrs:{title:"Local",active:""}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCAuL3JlbGVhc2UvdjEvY2hlY2tlcnNkIGdlbnR4IGFsaWNlIDEwMDAwMDAwMHN0YWtlIFwKICAgIC0ta2V5cmluZy1iYWNrZW5kIHRlc3QgLS1jaGFpbi1pZCBjaGVja2Vycy0xCiQgLi9yZWxlYXNlL3YxL2NoZWNrZXJzZCBjb2xsZWN0LWdlbnR4cwo="}})],1),e._v(" "),o("CodeGroupItem",{attrs:{title:"Docker"}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtdCBjaGVja2VycyBcCiAgICAuL3JlbGVhc2UvdjEvY2hlY2tlcnNkIGdlbnR4IGFsaWNlIDEwMDAwMDAwMHN0YWtlIFwKICAgIC0ta2V5cmluZy1iYWNrZW5kIHRlc3QgLS1jaGFpbi1pZCBjaGVja2Vycy0xCiQgZG9ja2VyIGV4ZWMgLXQgY2hlY2tlcnMgXAogICAgLi9yZWxlYXNlL3YxL2NoZWNrZXJzZCBjb2xsZWN0LWdlbnR4cwo="}})],1)],1),e._v(" "),o("p",[e._v("Now you can start the chain proper:")]),e._v(" "),o("CodeGroup",[o("CodeGroupItem",{attrs:{title:"Local",active:""}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCAuL3JlbGVhc2UvdjEvY2hlY2tlcnNkIHN0YXJ0Cg=="}})],1),e._v(" "),o("CodeGroupItem",{attrs:{title:"Docker"}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtaXQgY2hlY2tlcnMgXAogICAgLi9yZWxlYXNlL3YxL2NoZWNrZXJzZCBzdGFydCBcCiAgICAtLXJwYy5sYWRkciAmcXVvdDt0Y3A6Ly8wLjAuMC4wOjI2NjU3JnF1b3Q7Cg=="}}),e._v(" "),o("p",[e._v("Note that you need to force the node to listen on all IP addresses, not just "),o("code",[e._v("127.0.0.1")]),e._v(" as it would do by default.")])],1)],1),e._v(" "),o("hr"),e._v(" "),o("h3",{attrs:{id:"add-games"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#add-games"}},[e._v("#")]),e._v(" Add games")]),e._v(" "),o("p",[e._v("From another shell, create a few un-played games with:")]),e._v(" "),o("CodeGroup",[o("CodeGroupItem",{attrs:{title:"Local",active:""}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBleHBvcnQgYWxpY2U9JCguL3JlbGVhc2UvdjEvY2hlY2tlcnNkIGtleXMgc2hvdyBhbGljZSAtYSAtLWtleXJpbmctYmFja2VuZCB0ZXN0KQokIGV4cG9ydCBib2I9JCguL3JlbGVhc2UvdjEvY2hlY2tlcnNkIGtleXMgc2hvdyBib2IgLWEgLS1rZXlyaW5nLWJhY2tlbmQgdGVzdCkKJCAuL3JlbGVhc2UvdjEvY2hlY2tlcnNkIHR4IGNoZWNrZXJzIGNyZWF0ZS1nYW1lIFwKICAgICRhbGljZSAkYm9iIDEwIHN0YWtlIFwKICAgIC0tZnJvbSAkYWxpY2UgLS1rZXlyaW5nLWJhY2tlbmQgdGVzdCAtLXllcyBcCiAgICAtLWNoYWluLWlkIGNoZWNrZXJzLTEgXAogICAgLS1icm9hZGNhc3QtbW9kZSBibG9jawo="}})],1),e._v(" "),o("CodeGroupItem",{attrs:{title:"Docker"}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBleHBvcnQgYWxpY2U9JChkb2NrZXIgZXhlYyBjaGVja2VycyAuL3JlbGVhc2UvdjEvY2hlY2tlcnNkIGtleXMgc2hvdyBhbGljZSAtYSAtLWtleXJpbmctYmFja2VuZCB0ZXN0KQokIGV4cG9ydCBib2I9JChkb2NrZXIgZXhlYyBjaGVja2VycyAuL3JlbGVhc2UvdjEvY2hlY2tlcnNkIGtleXMgc2hvdyBib2IgLWEgLS1rZXlyaW5nLWJhY2tlbmQgdGVzdCkKJCBkb2NrZXIgZXhlYyAtdCBjaGVja2VycyBcCiAgICAuL3JlbGVhc2UvdjEvY2hlY2tlcnNkIHR4IGNoZWNrZXJzIGNyZWF0ZS1nYW1lIFwKICAgICRhbGljZSAkYm9iIDEwIHN0YWtlIFwKICAgIC0tZnJvbSAkYWxpY2UgLS1rZXlyaW5nLWJhY2tlbmQgdGVzdCAtLXllcyBcCiAgICAtLWNoYWluLWlkIGNoZWNrZXJzLTEgXAogICAgLS1icm9hZGNhc3QtbW9kZSBibG9jawo="}})],1)],1),e._v(" "),o("HighlightBox",{attrs:{type:"note"}},[o("p",[e._v("The "),o("code",[e._v("--broadcast-mode block")]),e._v(" flag means that you can fire up many such games by just copying the command without facing any sequence errors.")])]),e._v(" "),o("p",[e._v("To get a few complete games, you are going to run the "),o("a",{attrs:{href:"https://github.com/cosmos/academy-checkers-ui/blob/main/test/integration/stored-game-action.ts",target:"_blank",rel:"noopener noreferrer"}},[e._v("integration tests"),o("OutboundLink")],1),e._v(" against it. These tests expect a faucet to be available. Because that is not the case, you need to:")]),e._v(" "),o("ol",[o("li",[o("p",[e._v("Skip the faucet calls by adjusting the "),o("code",[e._v('"credit test accounts"')]),e._v(" "),o("code",[e._v("before")]),e._v(". Just "),o("code",[e._v("return")]),e._v(" before "),o("a",{attrs:{href:"https://github.com/cosmos/academy-checkers-ui/blob/server-indexing/test/integration/stored-game-action.ts#L65",target:"_blank",rel:"noopener noreferrer"}},[o("code",[e._v("this.timeout")]),o("OutboundLink")],1),e._v(".")])]),e._v(" "),o("li",[o("p",[e._v("Credit your test accounts with standard "),o("code",[e._v("bank send")]),e._v(" transactions. You can use the same values as found in the "),o("code",[e._v("before")]),e._v(":")]),e._v(" "),o("CodeGroup",[o("CodeGroupItem",{attrs:{title:"Local",active:""}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCAuL3JlbGVhc2UvdjEvY2hlY2tlcnNkIHR4IGJhbmsgXAogICAgc2VuZCAkYWxpY2UgY29zbW9zMWZ4NnFseHd0ZWVxeGd4d3N3ODN3a2Y0czlmY25ud2s4ejg2c3FsIDMwMHN0YWtlIFwKICAgIC0tZnJvbSAkYWxpY2UgLS1rZXlyaW5nLWJhY2tlbmQgdGVzdCBcCiAgICAtLWNoYWluLWlkIGNoZWNrZXJzLTEgXAogICAgLS1icm9hZGNhc3QtbW9kZSBibG9jayAtLXllcwokIC4vcmVsZWFzZS92MS9jaGVja2Vyc2QgdHggYmFuayBcCiAgICBzZW5kICRhbGljZSBjb3Ntb3MxZng2cWx4d3RlZXF4Z3h3c3c4M3drZjRzOWZjbm53azh6ODZzcWwgMTB0b2tlbiBcCiAgICAtLWZyb20gJGFsaWNlIC0ta2V5cmluZy1iYWNrZW5kIHRlc3QgXAogICAgLS1jaGFpbi1pZCBjaGVja2Vycy0xIFwKICAgIC0tYnJvYWRjYXN0LW1vZGUgYmxvY2sgLS15ZXMKJCAuL3JlbGVhc2UvdjEvY2hlY2tlcnNkIHR4IGJhbmsgXAogICAgc2VuZCAkYm9iIGNvc21vczFtcWw5YWF1eDM0NTN0ZGdoazZyemttazQzc3R4dm52aGE0bnYyMiAzMDBzdGFrZSBcCiAgICAtLWZyb20gJGJvYiAtLWtleXJpbmctYmFja2VuZCB0ZXN0IFwKICAgIC0tY2hhaW4taWQgY2hlY2tlcnMtMSBcCiAgICAtLWJyb2FkY2FzdC1tb2RlIGJsb2NrIC0teWVzCiQgLi9yZWxlYXNlL3YxL2NoZWNrZXJzZCB0eCBiYW5rIFwKICAgIHNlbmQgJGJvYiBjb3Ntb3MxbXFsOWFhdXgzNDUzdGRnaGs2cnprbWs0M3N0eHZudmhhNG52MjIgMTB0b2tlbiBcCiAgICAtLWZyb20gJGJvYiAtLWtleXJpbmctYmFja2VuZCB0ZXN0IFwKICAgIC0tY2hhaW4taWQgY2hlY2tlcnMtMSBcCiAgICAtLWJyb2FkY2FzdC1tb2RlIGJsb2NrIC0teWVzCg=="}})],1),e._v(" "),o("CodeGroupItem",{attrs:{title:"Docker"}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtdCBjaGVja2VycyBcCiAgICAuL3JlbGVhc2UvdjEvY2hlY2tlcnNkIHR4IGJhbmsgXAogICAgc2VuZCAkYWxpY2UgY29zbW9zMWZ4NnFseHd0ZWVxeGd4d3N3ODN3a2Y0czlmY25ud2s4ejg2c3FsIDMwMHN0YWtlIFwKICAgIC0tZnJvbSAkYWxpY2UgLS1rZXlyaW5nLWJhY2tlbmQgdGVzdCBcCiAgICAtLWNoYWluLWlkIGNoZWNrZXJzLTEgXAogICAgLS1icm9hZGNhc3QtbW9kZSBibG9jayAtLXllcwokIGRvY2tlciBleGVjIC10IGNoZWNrZXJzIFwKICAgIC4vcmVsZWFzZS92MS9jaGVja2Vyc2QgdHggYmFuayBcCiAgICBzZW5kICRhbGljZSBjb3Ntb3MxZng2cWx4d3RlZXF4Z3h3c3c4M3drZjRzOWZjbm53azh6ODZzcWwgMTB0b2tlbiBcCiAgICAtLWZyb20gJGFsaWNlIC0ta2V5cmluZy1iYWNrZW5kIHRlc3QgXAogICAgLS1jaGFpbi1pZCBjaGVja2Vycy0xIFwKICAgIC0tYnJvYWRjYXN0LW1vZGUgYmxvY2sgLS15ZXMKJCBkb2NrZXIgZXhlYyAtdCBjaGVja2VycyBcCiAgICAuL3JlbGVhc2UvdjEvY2hlY2tlcnNkIHR4IGJhbmsgXAogICAgc2VuZCAkYm9iIGNvc21vczFtcWw5YWF1eDM0NTN0ZGdoazZyemttazQzc3R4dm52aGE0bnYyMiAzMDBzdGFrZSBcCiAgICAtLWZyb20gJGJvYiAtLWtleXJpbmctYmFja2VuZCB0ZXN0IFwKICAgIC0tY2hhaW4taWQgY2hlY2tlcnMtMSBcCiAgICAtLWJyb2FkY2FzdC1tb2RlIGJsb2NrIC0teWVzCiQgZG9ja2VyIGV4ZWMgLXQgY2hlY2tlcnMgXAogICAgLi9yZWxlYXNlL3YxL2NoZWNrZXJzZCB0eCBiYW5rIFwKICAgIHNlbmQgJGJvYiBjb3Ntb3MxbXFsOWFhdXgzNDUzdGRnaGs2cnprbWs0M3N0eHZudmhhNG52MjIgMTB0b2tlbiBcCiAgICAtLWZyb20gJGJvYiAtLWtleXJpbmctYmFja2VuZCB0ZXN0IFwKICAgIC0tY2hhaW4taWQgY2hlY2tlcnMtMSBcCiAgICAtLWJyb2FkY2FzdC1tb2RlIGJsb2NrIC0teWVzCg=="}})],1)],1)],1)]),e._v(" "),o("p",[e._v("With the test accounts sufficiently credited, you can now run the integration tests. Run them three times in a row to create three complete games:")]),e._v(" "),o("CodeGroup",[o("CodeGroupItem",{attrs:{title:"Local",active:""}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBwdXNoZCBjbGllbnQgJmFtcDsmYW1wOyBucG0gdGVzdCAmYW1wOyZhbXA7IHBvcGQK"}})],1),e._v(" "),o("CodeGroupItem",{attrs:{title:"Docker"}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IFwKICAgIC12ICQocHdkKS9jbGllbnQ6L2NsaWVudCAtdyAvY2xpZW50IFwKICAgIC0tbmV0d29yayBjaGVja2Vycy1uZXQgXAogICAgLS1lbnYgUlBDX1VSTD0mcXVvdDtodHRwOi8vY2hlY2tlcnM6MjY2NTcmcXVvdDsgXAogICAgbm9kZToxOC43LXNsaW0gXAogICAgbnBtIHRlc3QK"}})],1)],1),e._v(" "),o("hr"),e._v(" "),o("p",[e._v("You can confirm that you have a mix of complete and incomplete games:")]),e._v(" "),o("CodeGroup",[o("CodeGroupItem",{attrs:{title:"Local",active:""}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCAuL3JlbGVhc2UvdjEvY2hlY2tlcnNkIHF1ZXJ5IGNoZWNrZXJzIFwKICAgIGxpc3Qtc3RvcmVkLWdhbWUgLS1vdXRwdXQganNvbiBcCiAgICB8IGpxICcuc3RvcmVkR2FtZVtdIHwgeyAmcXVvdDtpbmRleCZxdW90OzouaW5kZXgsICZxdW90O3dpbm5lciZxdW90Ozoud2lubmVyIH0nCg=="}})],1),e._v(" "),o("CodeGroupItem",{attrs:{title:"Docker"}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtdCBjaGVja2VycyBcCiAgICBiYXNoIC1jICZxdW90Oy4vcmVsZWFzZS92MS9jaGVja2Vyc2QgcXVlcnkgY2hlY2tlcnMgXAogICAgICAgIGxpc3Qtc3RvcmVkLWdhbWUgLS1vdXRwdXQganNvbiBcCiAgICAgICAgfCBqcSAnLnN0b3JlZEdhbWVbXSB8IHsgXCZxdW90O2luZGV4XCZxdW90OzouaW5kZXgsIFwmcXVvdDt3aW5uZXJcJnF1b3Q7Oi53aW5uZXIgfScmcXVvdDsK"}})],1)],1),e._v(" "),o("p",[e._v("With enough games in the system, you can move to the software upgrade governance proposal.")]),e._v(" "),o("h3",{attrs:{id:"governance-proposal"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#governance-proposal"}},[e._v("#")]),e._v(" Governance proposal")]),e._v(" "),o("p",[e._v("For the software upgrade governance proposal, you want to make sure that it stops the chain not too far in the future but still after the voting period. With a voting period of 10 minutes, take 15 minutes. How many seconds does a block take?")]),e._v(" "),o("CodeGroup",[o("CodeGroupItem",{attrs:{title:"Local",active:""}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBqcSAtciAmcXVvdDsuYXBwX3N0YXRlLm1pbnQucGFyYW1zLmJsb2Nrc19wZXJfeWVhciZxdW90OyBcCiAgICB+Ly5jaGVja2Vycy9jb25maWcvZ2VuZXNpcy5qc29uCg=="}})],1),e._v(" "),o("CodeGroupItem",{attrs:{title:"Docker"}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtdCBjaGVja2VycyBcCiAgICBiYXNoIC1jICdqcSAtciAmcXVvdDsuYXBwX3N0YXRlLm1pbnQucGFyYW1zLmJsb2Nrc19wZXJfeWVhciZxdW90OyAvcm9vdC8uY2hlY2tlcnMvY29uZmlnL2dlbmVzaXMuanNvbicK"}})],1)],1),e._v(" "),o("p",[e._v("This returns something like:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"txt",base64:"NjMxMTUyMAo="}}),e._v(" "),o("p",[e._v("That many "),o("code",[e._v("blocks_per_year")]),e._v(" computes down to 5 seconds per block. At this rate, 15 minutes mean 180 blocks.")]),e._v(" "),o("p",[e._v("What is the current block height? Check:")]),e._v(" "),o("CodeGroup",[o("CodeGroupItem",{attrs:{title:"Local",active:""}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCAuL3JlbGVhc2UvdjEvY2hlY2tlcnNkIHN0YXR1cyBcCiAgICB8IGpxIC1yICZxdW90Oy5TeW5jSW5mby5sYXRlc3RfYmxvY2tfaGVpZ2h0JnF1b3Q7Cg=="}})],1),e._v(" "),o("CodeGroupItem",{attrs:{title:"Docker"}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtdCBjaGVja2VycyBcCiAgICBiYXNoIC1jICcuL3JlbGVhc2UvdjEvY2hlY2tlcnNkIHN0YXR1cyBcCiAgICAgICAgfCBqcSAtciAmcXVvdDsuU3luY0luZm8ubGF0ZXN0X2Jsb2NrX2hlaWdodCZxdW90OycK"}})],1)],1),e._v(" "),o("p",[e._v("This returns something like:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"json",base64:"MTAwMAo="}}),e._v(" "),o("p",[e._v("That means you will use:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"txt",base64:"LS11cGdyYWRlLWhlaWdodCAxMTgwCg=="}}),e._v(" "),o("p",[e._v("What is the minimum deposit for a proposal? Check:")]),e._v(" "),o("CodeGroup",[o("CodeGroupItem",{attrs:{title:"Local",active:""}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBqcSAmcXVvdDsuYXBwX3N0YXRlLmdvdi5kZXBvc2l0X3BhcmFtcy5taW5fZGVwb3NpdCZxdW90OyBcCiAgICB+Ly5jaGVja2Vycy9jb25maWcvZ2VuZXNpcy5qc29uCg=="}})],1),e._v(" "),o("CodeGroupItem",{attrs:{title:"Docker"}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtdCBjaGVja2VycyBcCiAgICBiYXNoIC1jICdqcSAmcXVvdDsuYXBwX3N0YXRlLmdvdi5kZXBvc2l0X3BhcmFtcy5taW5fZGVwb3NpdCZxdW90OyBcCiAgICAgICAgL3Jvb3QvLmNoZWNrZXJzL2NvbmZpZy9nZW5lc2lzLmpzb24nCg=="}})],1)],1),e._v(" "),o("p",[e._v("This returns something like:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"json",base64:"WwogICAgewogICAgICAgICZxdW90O2Rlbm9tJnF1b3Q7OiAmcXVvdDtzdGFrZSZxdW90OywKICAgICAgICAmcXVvdDthbW91bnQmcXVvdDs6ICZxdW90OzEwMDAwMDAwJnF1b3Q7CiAgICB9Cl0K"}}),e._v(" "),o("p",[e._v("This is the minimum amount that Alice has to deposit when submitting the proposal. This will do:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"txt",base64:"LS1kZXBvc2l0IDEwMDAwMDAwc3Rha2UK"}}),e._v(" "),o("p",[e._v("Submit your governance proposal upgrade:")]),e._v(" "),o("CodeGroup",[o("CodeGroupItem",{attrs:{title:"Local",active:""}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCAuL3JlbGVhc2UvdjEvY2hlY2tlcnNkIHR4IGdvdiBzdWJtaXQtcHJvcG9zYWwgc29mdHdhcmUtdXBncmFkZSB2MXRvdjFfMSBcCiAgICAtLXRpdGxlICZxdW90O3YxdG92MV8xJnF1b3Q7IFwKICAgIC0tZGVzY3JpcHRpb24gJnF1b3Q7SW50cm9kdWNlIGEgdGFsbHkgb2YgZ2FtZXMgcGVyIHBsYXllciZxdW90OyBcCiAgICAtLWZyb20gJGFsaWNlIC0ta2V5cmluZy1iYWNrZW5kIHRlc3QgLS15ZXMgXAogICAgLS1jaGFpbi1pZCBjaGVja2Vycy0xIFwKICAgIC0tYnJvYWRjYXN0LW1vZGUgYmxvY2sgXAogICAgLS11cGdyYWRlLWhlaWdodCAxMTgwIFwKICAgIC0tZGVwb3NpdCAxMDAwMDAwMHN0YWtlCg=="}})],1),e._v(" "),o("CodeGroupItem",{attrs:{title:"Docker"}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtdCBjaGVja2VycyBcCiAgICAuL3JlbGVhc2UvdjEvY2hlY2tlcnNkIHR4IGdvdiBzdWJtaXQtcHJvcG9zYWwgc29mdHdhcmUtdXBncmFkZSB2MXRvdjFfMSBcCiAgICAtLXRpdGxlICZxdW90O3YxdG92MV8xJnF1b3Q7IFwKICAgIC0tZGVzY3JpcHRpb24gJnF1b3Q7SW50cm9kdWNlIGEgdGFsbHkgb2YgZ2FtZXMgcGVyIHBsYXllciZxdW90OyBcCiAgICAtLWZyb20gJGFsaWNlIC0ta2V5cmluZy1iYWNrZW5kIHRlc3QgLS15ZXMgXAogICAgLS1jaGFpbi1pZCBjaGVja2Vycy0xIFwKICAgIC0tYnJvYWRjYXN0LW1vZGUgYmxvY2sgXAogICAgLS11cGdyYWRlLWhlaWdodCAxMTgwIFwKICAgIC0tZGVwb3NpdCAxMDAwMDAwMHN0YWtlCg=="}})],1)],1),e._v(" "),o("p",[e._v("This returns something with:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"yaml",base64:"ICAuLi4KICB0eXBlOiBwcm9wb3NhbF9kZXBvc2l0Ci0gYXR0cmlidXRlczoKICAtIGtleTogcHJvcG9zYWxfaWQKICAgIHZhbHVlOiAmcXVvdDsxJnF1b3Q7CiAgLSBrZXk6IHByb3Bvc2FsX3R5cGUKICAgIHZhbHVlOiBTb2Z0d2FyZVVwZ3JhZGUKICAtIGtleTogdm90aW5nX3BlcmlvZF9zdGFydAogICAgdmFsdWU6ICZxdW90OzEmcXVvdDsKICAuLi4K"}}),e._v(" "),o("p",[e._v("Where "),o("code",[e._v("1")]),e._v(" is the proposal ID you reuse. Have Alice and Bob vote yes on it:")]),e._v(" "),o("CodeGroup",[o("CodeGroupItem",{attrs:{title:"Local",active:""}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCAuL3JlbGVhc2UvdjEvY2hlY2tlcnNkIHR4IGdvdiB2b3RlIDEgeWVzIFwKICAgIC0tZnJvbSAkYWxpY2UgLS1rZXlyaW5nLWJhY2tlbmQgdGVzdCAtLXllcyBcCiAgICAtLWNoYWluLWlkIGNoZWNrZXJzLTEKJCAuL3JlbGVhc2UvdjEvY2hlY2tlcnNkIHR4IGdvdiB2b3RlIDEgeWVzIFwKICAgIC0tZnJvbSAkYm9iIC0ta2V5cmluZy1iYWNrZW5kIHRlc3QgLS15ZXMgXAogICAgLS1jaGFpbi1pZCBjaGVja2Vycy0xCg=="}})],1),e._v(" "),o("CodeGroupItem",{attrs:{title:"Docker"}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtdCBjaGVja2VycyBcCiAgICAuL3JlbGVhc2UvdjEvY2hlY2tlcnNkIHR4IGdvdiB2b3RlIDEgeWVzIFwKICAgIC0tZnJvbSAkYWxpY2UgLS1rZXlyaW5nLWJhY2tlbmQgdGVzdCAtLXllcyBcCiAgICAtLWNoYWluLWlkIGNoZWNrZXJzLTEKJCBkb2NrZXIgZXhlYyAtdCBjaGVja2VycyBcCiAgICAuL3JlbGVhc2UvdjEvY2hlY2tlcnNkIHR4IGdvdiB2b3RlIDEgeWVzIFwKICAgIC0tZnJvbSAkYm9iIC0ta2V5cmluZy1iYWNrZW5kIHRlc3QgLS15ZXMgXAogICAgLS1jaGFpbi1pZCBjaGVja2Vycy0xCg=="}})],1)],1),e._v(" "),o("p",[e._v("Confirm that it has collected the votes:")]),e._v(" "),o("CodeGroup",[o("CodeGroupItem",{attrs:{title:"Local",active:""}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCAuL3JlbGVhc2UvdjEvY2hlY2tlcnNkIHF1ZXJ5IGdvdiB2b3RlcyAxCg=="}})],1),e._v(" "),o("CodeGroupItem",{attrs:{title:"Docker"}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtdCBjaGVja2VycyBcCiAgICAuL3JlbGVhc2UvdjEvY2hlY2tlcnNkIHF1ZXJ5IGdvdiB2b3RlcyAxCg=="}})],1)],1),e._v(" "),o("p",[e._v("It should print:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"yaml",base64:"dm90ZXM6Ci0gb3B0aW9uOiBWT1RFX09QVElPTl9ZRVMKICBvcHRpb25zOgogIC0gb3B0aW9uOiBWT1RFX09QVElPTl9ZRVMKICAgIHdlaWdodDogJnF1b3Q7MS4wMDAwMDAwMDAwMDAwMDAwMDAmcXVvdDsKICBwcm9wb3NhbF9pZDogJnF1b3Q7MSZxdW90OwogIHZvdGVyOiBjb3Ntb3MxaHpmdG5zdG1senFmYWowcnozOWhuNXBlMnZwcHowcGh5NHg5Y3QKLSBvcHRpb246IFZPVEVfT1BUSU9OX1lFUwogIG9wdGlvbnM6CiAgLSBvcHRpb246IFZPVEVfT1BUSU9OX1lFUwogICAgd2VpZ2h0OiAmcXVvdDsxLjAwMDAwMDAwMDAwMDAwMDAwMCZxdW90OwogIHByb3Bvc2FsX2lkOiAmcXVvdDsxJnF1b3Q7CiAgdm90ZXI6IGNvc21vczFoajJ4ODJqNDlmdjkwdGd0ZHhyZHc1ZnozdzJ2cWVxcWpocnhsZQo="}}),e._v(" "),o("p",[e._v("See how long you have to wait for the chain to reach the end of the voting period:")]),e._v(" "),o("CodeGroup",[o("CodeGroupItem",{attrs:{title:"Local",active:""}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCAuL3JlbGVhc2UvdjEvY2hlY2tlcnNkIHF1ZXJ5IGdvdiBwcm9wb3NhbCAxCg=="}})],1),e._v(" "),o("CodeGroupItem",{attrs:{title:"Docker"}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtdCBjaGVja2VycyBcCiAgICAuL3JlbGVhc2UvdjEvY2hlY2tlcnNkIHF1ZXJ5IGdvdiBwcm9wb3NhbCAxCg=="}})],1)],1),e._v(" "),o("p",[e._v("In the end this prints:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"txt",base64:"Li4uCnN0YXR1czogUFJPUE9TQUxfU1RBVFVTX1ZPVElOR19QRVJJT0QKLi4uCnZvdGluZ19lbmRfdGltZTogJnF1b3Q7MjAyMi0wOC0yNVQxMDozODoyMi4yNDA3NjYxMDNaJnF1b3Q7Ci4uLgo="}}),e._v(" "),o("p",[e._v("Wait for this period. Afterward, with the same command you should see:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"txt",base64:"Li4uCnN0YXR1czogUFJPUE9TQUxfU1RBVFVTX1BBU1NFRAouLi4K"}}),e._v(" "),o("p",[e._v("Now, wait for the chain to reach the desired block height, which should take five more minutes, as per your parameters. When it has reached that height, the shell with the running "),o("code",[e._v("checkersd")]),e._v(" should show something like:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"txt",base64:"Li4uCjY6MjlQTSBJTkYgZmluYWxpemluZyBjb21taXQgb2YgYmxvY2sgaGFzaD1FNkNCNkYxRThDRjQ2OTk1NDM5NTBGNzU2RjNFMTVBRTQ0NzcwMUFCQUM0OThDREJBODY2MzNBQzkzQTczRUU3IGhlaWdodD0xMTgwIG1vZHVsZT1jb25zZW5zdXMgbnVtX3R4cz0wIHJvb3Q9MjFFNTFFNTJBQTNGMDZCRTU5Qzc4Q0UxMUQzMTcxRTZGNzI0MEQyOTdFNEJDRUFCMDdGQzVBODc5NTdCM0JFMgo2OjI5UE0gRVJSIFVQR1JBREUgJnF1b3Q7djF0b3YxXzEmcXVvdDsgTkVFREVEIGF0IGhlaWdodDogMTE4MDoKNjoyOVBNIEVSUiBDT05TRU5TVVMgRkFJTFVSRSEhISBlcnI9JnF1b3Q7VVBHUkFERSBcJnF1b3Q7djF0b3YxXzFcJnF1b3Q7IE5FRURFRCBhdCBoZWlnaHQ6IDExODA6ICZxdW90OyBtb2R1bGU9Y29uc2Vuc3VzIHN0YWNrPSZxdW90O2dvcm91dGluZSA2MiBbcnVubmluZ106XG5ydW50aW1lL2RlYnVnLlN0YWNrCi4uLgo2OjI5UE0gSU5GIFN0b3BwaW5nIGJhc2VXQUwgc2VydmljZSBpbXBsPXsmcXVvdDtMb2dnZXImcXVvdDs6e319IG1vZHVsZT1jb25zZW5zdXMgd2FsPS9yb290Ly5jaGVja2Vycy9kYXRhL2NzLndhbC93YWwKNjoyOVBNIElORiBTdG9wcGluZyBHcm91cCBzZXJ2aWNlIGltcGw9eyZxdW90O0RpciZxdW90OzomcXVvdDsvcm9vdC8uY2hlY2tlcnMvZGF0YS9jcy53YWwmcXVvdDssJnF1b3Q7SGVhZCZxdW90Ozp7JnF1b3Q7SUQmcXVvdDs6JnF1b3Q7WnNBbE43REVaQWJWOi9yb290Ly5jaGVja2Vycy9kYXRhL2NzLndhbC93YWwmcXVvdDssJnF1b3Q7UGF0aCZxdW90OzomcXVvdDsvcm9vdC8uY2hlY2tlcnMvZGF0YS9jcy53YWwvd2FsJnF1b3Q7fSwmcXVvdDtJRCZxdW90OzomcXVvdDtncm91cDpac0FsTjdERVpBYlY6L3Jvb3QvLmNoZWNrZXJzL2RhdGEvY3Mud2FsL3dhbCZxdW90OywmcXVvdDtMb2dnZXImcXVvdDs6e319IG1vZHVsZT1jb25zZW5zdXMgd2FsPS9yb290Ly5jaGVja2Vycy9kYXRhL2NzLndhbC93YWwKLi4uCg=="}}),e._v(" "),o("p",[e._v("At this point, run in another shell:")]),e._v(" "),o("CodeGroup",[o("CodeGroupItem",{attrs:{title:"Local",active:""}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCAuL3JlbGVhc2UvdjEvY2hlY2tlcnNkIHN0YXR1cyBcCiAgICB8IGpxIC1yICZxdW90Oy5TeW5jSW5mby5sYXRlc3RfYmxvY2tfaGVpZ2h0JnF1b3Q7Cg=="}})],1),e._v(" "),o("CodeGroupItem",{attrs:{title:"Docker"}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtaXQgY2hlY2tlcnMgXAogICAgYmFzaCAtYyAnLi9yZWxlYXNlL3YxL2NoZWNrZXJzZCBzdGF0dXMgXAogICAgICAgIHwganEgLXIgJnF1b3Q7LlN5bmNJbmZvLmxhdGVzdF9ibG9ja19oZWlnaHQmcXVvdDsnCg=="}})],1)],1),e._v(" "),o("p",[e._v("You should always get the same value, no matter how many times you try. That is because the chain has stopped. For instance:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"txt",base64:"MTE4MAo="}}),e._v(" "),o("p",[e._v("Stop "),o("code",[e._v("checkersd")]),e._v(" with "),o("kbd",[e._v("CTRL-C")]),e._v(". It has saved a new file:")]),e._v(" "),o("CodeGroup",[o("CodeGroupItem",{attrs:{title:"Local",active:""}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBjYXQgfi8uY2hlY2tlcnMvZGF0YS91cGdyYWRlLWluZm8uanNvbgo="}})],1),e._v(" "),o("CodeGroupItem",{attrs:{title:"Docker"}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtaXQgY2hlY2tlcnMgXAogICAgY2F0IC9yb290Ly5jaGVja2Vycy9kYXRhL3VwZ3JhZGUtaW5mby5qc29uCg=="}})],1)],1),e._v(" "),o("p",[e._v("This prints:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"json",base64:"eyZxdW90O25hbWUmcXVvdDs6JnF1b3Q7djF0b3YxXzEmcXVvdDssJnF1b3Q7aGVpZ2h0JnF1b3Q7OjExODB9Cg=="}}),e._v(" "),o("p",[e._v("With your node (and therefore your whole blockchain) down, you are ready to move to v1.1.")]),e._v(" "),o("h3",{attrs:{id:"launch-v1-1"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#launch-v1-1"}},[e._v("#")]),e._v(" Launch v1.1")]),e._v(" "),o("p",[e._v("With v1 stopped and its state saved, it is time to move to v1.1. Checkout v1.1 of checkers, for instance:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBnaXQgY2hlY2tvdXQgcGxheWVyLWluZm8tbWlncmF0aW9uCg=="}}),e._v(" "),o("p",[e._v("Back in the first shell, build the v1.1 executable:")]),e._v(" "),o("CodeGroup",[o("CodeGroupItem",{attrs:{title:"Local",active:""}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBnbyBidWlsZCAtbyAuL3JlbGVhc2UvdjFfMS9jaGVja2Vyc2QgLi9jbWQvY2hlY2tlcnNkL21haW4uZ28K"}})],1),e._v(" "),o("CodeGroupItem",{attrs:{title:"Docker"}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IFwKICAgIC12ICQocHdkKTovY2hlY2tlcnMgXAogICAgLXcgL2NoZWNrZXJzIFwKICAgIGNoZWNrZXJzX2kgXAogICAgZ28gYnVpbGQgLW8gLi9yZWxlYXNlL3YxXzEvY2hlY2tlcnNkIC4vY21kL2NoZWNrZXJzZC9tYWluLmdvCg=="}})],1)],1),e._v(" "),o("p",[e._v("Launch it:")]),e._v(" "),o("CodeGroup",[o("CodeGroupItem",{attrs:{title:"Local",active:""}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCAuL3JlbGVhc2UvdjFfMS9jaGVja2Vyc2Qgc3RhcnQK"}})],1),e._v(" "),o("CodeGroupItem",{attrs:{title:"Docker"}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtaXQgY2hlY2tlcnMgXAogICAgLi9yZWxlYXNlL3YxXzEvY2hlY2tlcnNkIHN0YXJ0IFwKICAgIC0tcnBjLmxhZGRyICZxdW90O3RjcDovLzAuMC4wLjA6MjY2NTcmcXVvdDsK"}})],1)],1),e._v(" "),o("p",[e._v("It should start and display something like:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"txt",base64:"Li4uCjc6MDZQTSBJTkYgYXBwbHlpbmcgdXBncmFkZSAmcXVvdDt2MXRvdjFfMSZxdW90OyBhdCBoZWlnaHQ6IDExODAKNzowNlBNIElORiBtaWdyYXRpbmcgbW9kdWxlIGNoZWNrZXJzIGZyb20gdmVyc2lvbiAyIHRvIHZlcnNpb24gMwo3OjA2UE0gSU5GIFN0YXJ0IHRvIGNvbXB1dGUgY2hlY2tlcnMgZ2FtZXMgdG8gcGxheWVyIGluZm8gY2FsY3VsYXRpb24uLi4KNzowNlBNIElORiBDaGVja2VycyBnYW1lcyB0byBwbGF5ZXIgaW5mbyBjb21wdXRhdGlvbiBkb25lCi4uLgo="}}),e._v(" "),o("p",[e._v("After it has started, you can confirm in another shell that you have the expected player info with:")]),e._v(" "),o("CodeGroup",[o("CodeGroupItem",{attrs:{title:"Local",active:""}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCAuL3JlbGVhc2UvdjFfMS9jaGVja2Vyc2QgcXVlcnkgY2hlY2tlcnMgbGlzdC1wbGF5ZXItaW5mbwo="}})],1),e._v(" "),o("CodeGroupItem",{attrs:{title:"Docker"}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtdCBjaGVja2VycyBcCiAgICAuL3JlbGVhc2UvdjFfMS9jaGVja2Vyc2QgcXVlcnkgY2hlY2tlcnMgbGlzdC1wbGF5ZXItaW5mbwo="}})],1)],1),e._v(" "),o("p",[e._v("This should print something like:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"yaml",base64:"cGxheWVySW5mbzoKLSBmb3JmZWl0ZWRDb3VudDogJnF1b3Q7MCZxdW90OwogIGluZGV4OiBjb3Ntb3MxZng2cWx4d3RlZXF4Z3h3c3c4M3drZjRzOWZjbm53azh6ODZzcWwKICBsb3N0Q291bnQ6ICZxdW90OzAmcXVvdDsKICB3b25Db3VudDogJnF1b3Q7MyZxdW90OwotIGZvcmZlaXRlZENvdW50OiAmcXVvdDswJnF1b3Q7CiAgaW5kZXg6IGNvc21vczFtcWw5YWF1eDM0NTN0ZGdoazZyemttazQzc3R4dm52aGE0bnYyMgogIGxvc3RDb3VudDogJnF1b3Q7MyZxdW90OwogIHdvbkNvdW50OiAmcXVvdDswJnF1b3Q7Cg=="}}),e._v(" "),o("p",[e._v("Congratulations, you have upgraded your blockchain almost as if in production!")]),e._v(" "),o("p",[e._v("You can stop Ignite CLI. If you used Docker that would be:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgc3RvcCBjaGVja2VycwokIGRvY2tlciBybSBjaGVja2VycwokIGRvY2tlciBuZXR3b3JrIHJtIGNoZWNrZXJzLW5ldAo="}}),e._v(" "),o("p",[e._v("Your checkers blockchain is almost done! It now needs a leaderboard, which is introduced in the next section.")]),e._v(" "),o("HighlightBox",{attrs:{type:"synopsis"}},[o("p",[e._v("To summarize, this section has explored:")]),e._v(" "),o("ul",[o("li",[e._v("How to add a new data structure in storage as a breaking change.")]),e._v(" "),o("li",[e._v("How to upgrade a blockchain in production, by migrating from v1 of the blockchain to v1.1, and the new data structures that will be introduced by the upgrade.")]),e._v(" "),o("li",[e._v("How to handle the data migrations and logic upgrades implicit during migration, such as with the use of private helper functions.")]),e._v(" "),o("li",[e._v("Worthwhile unit tests with regard to player info handling.")]),e._v(" "),o("li",[e._v("Integration tests to further confirm the validity of the upgrade.")]),e._v(" "),o("li",[e._v("A complete procedure for how to conduct the update via the CLI.")])])])],1)}),[],!1,null,null,null);t.default=l.exports}}]);