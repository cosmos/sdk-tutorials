(window.webpackJsonp=window.webpackJsonp||[]).push([[142],{757:function(e,t,o){"use strict";o.r(t);var a=o(1),s=Object(a.a)({},(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[o("h1",{attrs:{id:"integrate-cosmjs-and-keplr"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#integrate-cosmjs-and-keplr"}},[e._v("#")]),e._v(" Integrate CosmJS and Keplr")]),e._v(" "),o("HighlightBox",{attrs:{type:"prerequisite"}},[o("p",[e._v("Make sure you have all you need before proceeding:")]),e._v(" "),o("ul",[o("li",[e._v("You understand the concepts of "),o("RouterLink",{attrs:{to:"/tutorials/7-cosmjs/1-cosmjs-intro.html"}},[e._v("CosmJS")]),e._v(".")],1),e._v(" "),o("li",[e._v("You have the checkers CosmJS codebase up to the external GUI. If not, follow the "),o("RouterLink",{attrs:{to:"/hands-on-exercise/3-cosmjs-adv/3-external-gui.html"}},[e._v("previous steps")]),e._v(" or go ahead and clone and checkout "),o("a",{attrs:{href:"https://github.com/cosmos/academy-checkers-ui/tree/unwired-gui",target:"_blank",rel:"noopener noreferrer"}},[e._v("this branch"),o("OutboundLink")],1),e._v(" to get the version needed for this tutorial.")],1)])]),e._v(" "),o("p",[e._v("In the previous sections:")]),e._v(" "),o("ol",[o("li",[e._v("You created the "),o("RouterLink",{attrs:{to:"/hands-on-exercise/3-cosmjs-adv/1-cosmjs-objects.html"}},[e._v("objects")]),e._v(", and the "),o("RouterLink",{attrs:{to:"/hands-on-exercise/3-cosmjs-adv/2-cosmjs-messages.html"}},[e._v("messages and clients")]),e._v(" that allow you to "),o("strong",[e._v("interface")]),e._v(" any GUI with your checkers blockchain.")],1),e._v(" "),o("li",[e._v("You learned how to "),o("RouterLink",{attrs:{to:"/hands-on-exercise/3-cosmjs-adv/2-cosmjs-messages.html#prepare-your-checkers-chain"}},[e._v("start a running checkers blockchain")]),e._v(", in Docker or on your local computer.")],1),e._v(" "),o("li",[e._v("You imported an external checkers "),o("strong",[e._v("GUI")]),e._v(" to use.")])]),e._v(" "),o("p",[e._v("Now, you must "),o("strong",[e._v("integrate the two")]),e._v(" together:")]),e._v(" "),o("ul",[o("li",[e._v("Adjust the React app to be able to package CosmJS.")]),e._v(" "),o("li",[e._v("Work on the CosmJS integration.")])]),e._v(" "),o("p",[e._v("For the CosmJS integration, you will:")]),e._v(" "),o("ul",[o("li",[e._v("Work with the GUI's data structures.")]),e._v(" "),o("li",[e._v("Fetch all games from the blockchain and display them (without pagination).")]),e._v(" "),o("li",[e._v("Integrate with Keplr for browser-based players.")]),e._v(" "),o("li",[e._v("Create a new game.")]),e._v(" "),o("li",[e._v("Fetch a single game to be played.")]),e._v(" "),o("li",[e._v("Play on the game, making single moves and double moves.")])]),e._v(" "),o("p",[e._v("This exercise assumes that:")]),e._v(" "),o("ol",[o("li",[o("p",[e._v("You are running your "),o("RouterLink",{attrs:{to:"/hands-on-exercise/3-cosmjs-adv/2-cosmjs-messages.html#prepare-your-checkers-chain"}},[e._v("checkers blockchain")]),e._v(" with:")],1),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgbmV0d29yayBjcmVhdGUgY2hlY2tlcnMtbmV0CiQgZG9ja2VyIHJ1biAtLXJtIC1pdCBcCiAgICAtcCAyNjY1NzoyNjY1NyBcCiAgICAtcCAxMzE3OjEzMTcgXAogICAgLS1uYW1lIGNoZWNrZXJzIFwKICAgIC0tbmV0d29yayBjaGVja2Vycy1uZXQgXAogICAgLS1kZXRhY2ggXAogICAgY2hlY2tlcnNkX2k6c3RhbmRhbG9uZSBzdGFydAokIHNsZWVwIDEwCiQgZG9ja2VyIHJ1biAtLXJtIC1pdCBcCiAgICAtcCA0NTAwOjQ1MDAgXAogICAgLS1uYW1lIGNvc21vcy1mYXVjZXQgXAogICAgLS1uZXR3b3JrIGNoZWNrZXJzLW5ldCBcCiAgICAtLWRldGFjaCBcCiAgICBjb3Ntb3MtZmF1Y2V0X2k6MC4yOC4xMSBzdGFydCBodHRwOi8vY2hlY2tlcnM6MjY2NTcKJCBzbGVlcCAyMAo="}})],1),e._v(" "),o("li",[o("p",[e._v("And have the following in "),o("code",[e._v(".env")]),e._v(":")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"ini",base64:"UlBDX1VSTD0mcXVvdDtodHRwOi8vbG9jYWxob3N0OjI2NjU3JnF1b3Q7CkZBVUNFVF9VUkw9JnF1b3Q7aHR0cDovL2xvY2FsaG9zdDo0NTAwJnF1b3Q7Cg=="}})],1)]),e._v(" "),o("h2",{attrs:{id:"prepare-the-integration-with-the-checkers-blockchain"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#prepare-the-integration-with-the-checkers-blockchain"}},[e._v("#")]),e._v(" Prepare the integration with the checkers blockchain")]),e._v(" "),o("p",[e._v("As always, when moving code to a browser, adjustments are needed.")]),e._v(" "),o("h3",{attrs:{id:"prepare-webpack"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#prepare-webpack"}},[e._v("#")]),e._v(" Prepare Webpack")]),e._v(" "),o("p",[e._v("Your GUI uses React v18, which uses Webpack v5. Therefore you need to "),o("a",{attrs:{href:"https://github.com/cosmos/cosmjs/blob/v0.28.11/README.md#webpack-configs",target:"_blank",rel:"noopener noreferrer"}},[e._v("adjust Webpack's configuration"),o("OutboundLink")],1),e._v(" to handle some elements (see also the CosmJS documentation). To modify the Webpack configuration in a non-ejected React app, use "),o("a",{attrs:{href:"https://www.npmjs.com/package/react-app-rewired",target:"_blank",rel:"noopener noreferrer"}},[o("code",[e._v("react-app-rewired")]),o("OutboundLink")],1),e._v(" as "),o("a",{attrs:{href:"https://stackoverflow.com/questions/63280109/how-to-update-webpack-config-for-a-react-project-created-using-create-react-app",target:"_blank",rel:"noopener noreferrer"}},[e._v("explained here"),o("OutboundLink")],1),e._v(":")]),e._v(" "),o("ol",[o("li",[o("p",[e._v("Install the new package:")]),e._v(" "),o("CodeGroup",[o("CodeGroupItem",{attrs:{title:"Local",active:""}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBucG0gaW5zdGFsbCByZWFjdC1hcHAtcmV3aXJlZEAyLjIuMSAtLXNhdmUtZGV2IC0tc2F2ZS1leGFjdAo="}})],1),e._v(" "),o("CodeGroupItem",{attrs:{title:"Docker"}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IFwKICAgIC12ICQocHdkKTovY2xpZW50IFwKICAgIC13IC9jbGllbnQgXAogICAgbm9kZToxOC43LXNsaW0gXAogICAgbnBtIGluc3RhbGwgcmVhY3QtYXBwLXJld2lyZWRAMi4yLjEgLS1zYXZlLWRldiAtLXNhdmUtZXhhY3QK"}})],1)],1)],1),e._v(" "),o("li",[o("p",[e._v("Add a new "),o("code",[e._v("config-overrides.js")]),e._v(":")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"cmVxdWlyZSgmcXVvdDtkb3RlbnYmcXVvdDspLmNvbmZpZygpCmNvbnN0IHdlYnBhY2sgPSByZXF1aXJlKCZxdW90O3dlYnBhY2smcXVvdDspCgptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIG92ZXJyaWRlKGNvbmZpZywgZW52KSB7CiAgICBjb25maWcucGx1Z2lucy5wdXNoKAogICAgICAgIG5ldyB3ZWJwYWNrLlByb3ZpZGVQbHVnaW4oewogICAgICAgICAgICBCdWZmZXI6IFsmcXVvdDtidWZmZXImcXVvdDssICZxdW90O0J1ZmZlciZxdW90O10sCiAgICAgICAgfSksCiAgICAgICAgbmV3IHdlYnBhY2suRW52aXJvbm1lbnRQbHVnaW4oWyZxdW90O1JQQ19VUkwmcXVvdDtdKSwKICAgICkKICAgIGNvbmZpZy5yZXNvbHZlLmZhbGxiYWNrID0gewogICAgICAgIGJ1ZmZlcjogZmFsc2UsCiAgICAgICAgY3J5cHRvOiBmYWxzZSwKICAgICAgICBldmVudHM6IGZhbHNlLAogICAgICAgIHBhdGg6IGZhbHNlLAogICAgICAgIHN0cmVhbTogZmFsc2UsCiAgICAgICAgc3RyaW5nX2RlY29kZXI6IGZhbHNlLAogICAgfQogICAgcmV0dXJuIGNvbmZpZwp9Cg==",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/config-overrides.js#L1-L21"}}),e._v(" "),o("HighlightBox",{attrs:{type:"note"}},[o("p",[e._v("You can also pass along the "),o("code",[e._v("RPC_URL")]),e._v(" as an environment variable, as seen in the code block above.")])])],1),e._v(" "),o("li",[o("p",[e._v("Change the run targets to use "),o("code",[e._v("react-app-rewired")]),e._v(" in "),o("code",[e._v("package.json")]),e._v(":")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-json",base64:"ICAgIHsKICAgICAgICAuLi4KICAgICAgICAmcXVvdDtzY3JpcHRzJnF1b3Q7OiB7CiAgICAgICAgICAgIC4uLgotICAgICAgICAgICZxdW90O3N0YXJ0JnF1b3Q7OiAmcXVvdDtyZWFjdC1zY3JpcHRzIHN0YXJ0JnF1b3Q7LAotICAgICAgICAgICZxdW90O2J1aWxkJnF1b3Q7OiAmcXVvdDtyZWFjdC1zY3JpcHRzIGJ1aWxkJnF1b3Q7LAotICAgICAgICAgICZxdW90O3Rlc3QtcmVhY3QmcXVvdDs6ICZxdW90O3JlYWN0LXNjcmlwdHMgdGVzdCAtLWVudj1qc2RvbSZxdW90OywKKyAgICAgICAgICAmcXVvdDtzdGFydCZxdW90OzogJnF1b3Q7cmVhY3QtYXBwLXJld2lyZWQgc3RhcnQmcXVvdDssCisgICAgICAgICAgJnF1b3Q7YnVpbGQmcXVvdDs6ICZxdW90O3JlYWN0LWFwcC1yZXdpcmVkIGJ1aWxkJnF1b3Q7LAorICAgICAgICAgICZxdW90O3Rlc3QtcmVhY3QmcXVvdDs6ICZxdW90O3JlYWN0LWFwcC1yZXdpcmVkIHRlc3QmcXVvdDssCisgICAgICAgICAgJnF1b3Q7ZWplY3QmcXVvdDs6ICZxdW90O3JlYWN0LXNjcmlwdHMgZWplY3QmcXVvdDsKICAgICAgICB9LAogICAgICAgIC4uLgogICAgfQo=",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/package.json#L8-L11"}}),e._v(" "),o("p",[e._v("Be careful "),o("strong",[e._v("not")]),e._v(" to put "),o("code",[e._v("react-app-rewired")]),e._v(" in the "),o("code",[e._v('"eject"')]),e._v(" command.")])],1)]),e._v(" "),o("p",[e._v("See a "),o("RouterLink",{attrs:{to:"/hands-on-exercise/3-cosmjs-adv/1-cosmjs-objects.html"}},[e._v("previous section")]),e._v(" for how to set "),o("code",[e._v("RPC_URL")]),e._v(" in "),o("code",[e._v("process.env.RPC_URL")]),e._v(". It also assumes that you have an RPC endpoint that runs the checkers blockchain, as explained in the previous section.")],1),e._v(" "),o("h3",{attrs:{id:"gui-data-structures"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#gui-data-structures"}},[e._v("#")]),e._v(" GUI data structures")]),e._v(" "),o("p",[e._v("The checkers GUI uses different data structures, which you must understand to convert them correctly and with less effort.")]),e._v(" "),o("ol",[o("li",[o("p",[e._v("The "),o("code",[e._v("IPlayerInfo")]),e._v(" has a "),o("a",{attrs:{href:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/sharedTypes.ts#L27",target:"_blank",rel:"noopener noreferrer"}},[o("code",[e._v("name: string")]),o("OutboundLink")],1),e._v(" field which can be used as the player's address.")])]),e._v(" "),o("li",[o("p",[e._v("The "),o("code",[e._v("IGameInfo")]),e._v(" has a "),o("a",{attrs:{href:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/sharedTypes.ts#L11",target:"_blank",rel:"noopener noreferrer"}},[o("code",[e._v("board: number[][] | null")]),o("OutboundLink")],1),e._v(" field. You must do a conversion from "),o("code",[e._v("b*b*...")]),e._v(" to this type. And at some point, you must ensure that the alignments are correct.")])]),e._v(" "),o("li",[o("p",[e._v("The "),o("code",[e._v("IGameInfo")]),e._v(" has a "),o("a",{attrs:{href:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/sharedTypes.ts#L17",target:"_blank",rel:"noopener noreferrer"}},[o("code",[e._v("turn: number")]),o("OutboundLink")],1),e._v(", which can be mapped to "),o("code",[e._v('"b"')]),e._v(" or "),o("code",[e._v('"r"')]),e._v(".")])]),e._v(" "),o("li",[o("p",[e._v("The "),o("code",[e._v("IGameInfo")]),e._v(" lacks an "),o("code",[e._v("index")]),e._v(" or "),o("code",[e._v("id")]),e._v(" field. Instead the GUI developer identified games by their index in an array, which is not adequate for this case. You must add an "),o("code",[e._v("index")]),e._v(" field to "),o("code",[e._v("IGameInfo")]),e._v(". This is saved as a "),o("code",[e._v("string")]),e._v(" in the blockchain but in practice is a "),o("strong",[e._v("number")]),e._v(", which the GUI code expects as game index. Add:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-typescript",base64:"ICAgIGV4cG9ydCBpbnRlcmZhY2UgSUdhbWVJbmZvIHsKICAgICAgICAuLi4KKyAgICAgIGluZGV4OiBudW1iZXIKICAgIH0K",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/sharedTypes.ts#L18"}}),e._v(" "),o("p",[e._v("To avoid compilation errors on "),o("code",[e._v("index:")]),e._v(" elsewhere, temporarily add "),o("code",[e._v("index?: number")]),e._v(". Remember to come back to it and remove the "),o("code",[e._v("?")]),e._v(".")])],1)]),e._v(" "),o("h3",{attrs:{id:"board-converter"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#board-converter"}},[e._v("#")]),e._v(" Board converter")]),e._v(" "),o("p",[e._v("In order to correctly convert a "),o("em",[e._v("blockchain")]),e._v(" board into a "),o("em",[e._v("GUI")]),e._v(" board, you want to see how a GUI board is coded. In "),o("code",[e._v("components/Game/Board/Board.tsx")]),e._v(", add a "),o("a",{attrs:{href:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/components/Game/Board/Board.tsx#L18",target:"_blank",rel:"noopener noreferrer"}},[o("code",[e._v("console.log(props.squares)")]),o("OutboundLink")],1),e._v(". Let React recompile, open the browser console, and create a game. You should see printed:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"json",base64:"WwogICAgWzAsIDEsIDAsIDEsIDAsIDEsIDAsIDFdLAogICAgWzEsIDAsIDEsIC4uLiAgICAgICAgICBdLAogICAgLi4uLAogICAgWy4uLiAgICAgICAgICAsIDIsIDAsIDJdLAogICAgWzIsIDAsIDIsIDAsIDIsIDAsIDIsIDBdCl0K"}}),e._v(" "),o("p",[e._v("Where "),o("code",[e._v("1")]),e._v(" represents player 1, i.e. black pieces. Compare that to how a game is saved in the blockchain:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"json",base64:"JnF1b3Q7KmIqYipiKmJ8YipiKmIqYip8KmIqYipiKmJ8KioqKioqKip8KioqKioqKip8cipyKnIqcip8KnIqcipyKnJ8cipyKnIqciomcXVvdDsK"}}),e._v(" "),o("p",[e._v("To convert the board, create a new file "),o("code",[e._v("src/types/checkers/board.ts")]),e._v(" and code as follows:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"Y29uc3Qgcm93U2VwYXJhdG9yID0gJnF1b3Q7fCZxdW90OwpleHBvcnQgY29uc3QgcGllY2VUcmFuc2xhdG9yID0gewogICAgJnF1b3Q7KiZxdW90OzogMCwKICAgIGI6IDEsCiAgICByOiAyLAp9CmV4cG9ydCBjb25zdCBwbGF5ZXJSZXZlcnNlVHJhbnNsYXRvcjogUGxheWVyW10gPSBbJnF1b3Q7YiZxdW90OywgJnF1b3Q7ciZxdW90O107CmV4cG9ydCBjb25zdCBwaWVjZVJldmVyc2VUcmFuc2xhdG9yID0gWyZxdW90OyomcXVvdDssIC4uLnBsYXllclJldmVyc2VUcmFuc2xhdG9yXTsKCmV4cG9ydCBmdW5jdGlvbiBzZXJpYWxpemVkVG9Cb2FyZChzZXJpYWxpemVkOiBzdHJpbmcpOiBudW1iZXJbXVtdIHsKICAgIHJldHVybiBzZXJpYWxpemVkCiAgICAgICAgLnNwbGl0KHJvd1NlcGFyYXRvcikKICAgICAgICAubWFwKChyb3c6IHN0cmluZykgPSZndDsgcm93LnNwbGl0KCZxdW90OyZxdW90OykubWFwKChjaGFyOiBzdHJpbmcpID0mZ3Q7IChwaWVjZVRyYW5zbGF0b3IgYXMgYW55KVtjaGFyXSkpCn0K",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/types/checkers/board.ts#L5-L18"}}),e._v(" "),o("h3",{attrs:{id:"game-converter"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#game-converter"}},[e._v("#")]),e._v(" Game converter")]),e._v(" "),o("p",[e._v("Next you convert a "),o("code",[e._v("StoredGame")]),e._v(" into the "),o("code",[e._v("IGameInfo")]),e._v(" of the GUI:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"ZXhwb3J0IGZ1bmN0aW9uIHN0b3JlZFRvR2FtZUluZm8oZ2FtZTogU3RvcmVkR2FtZSk6IElHYW1lSW5mbyB7CiAgICByZXR1cm4gewogICAgICAgIGJvYXJkOiBzZXJpYWxpemVkVG9Cb2FyZChnYW1lLmJvYXJkKSwKICAgICAgICBjcmVhdGVkOiBuZXcgRGF0ZShEYXRlLm5vdygpKSwKICAgICAgICBpc05ld0dhbWU6IGdhbWUubW92ZUNvdW50LmVxdWFscygwKSwKICAgICAgICBsYXN0OiBuZXcgRGF0ZShEYXRlLnBhcnNlKGdhbWUuZGVhZGxpbmUpIC0gODY0MDAgKiAxMDAwKSwKICAgICAgICBwMTogewogICAgICAgICAgICBuYW1lOiBnYW1lLmJsYWNrLCAvLyBBZGRyZXNzZXMgYXJlIHVzZWQgaW5zdGVhZCBvZiBuYW1lcy4KICAgICAgICAgICAgaXNfYWk6IGZhbHNlLCAvLyBUbyBtYWtlIGl0IHNpbXBsZS4KICAgICAgICAgICAgc2NvcmU6IDAsCiAgICAgICAgfSwKICAgICAgICBwMjogewogICAgICAgICAgICBuYW1lOiBnYW1lLnJlZCwKICAgICAgICAgICAgaXNfYWk6IGZhbHNlLAogICAgICAgICAgICBzY29yZTogMCwKICAgICAgICB9LAogICAgICAgIHR1cm46IChwaWVjZVRyYW5zbGF0b3IgYXMgYW55KVtnYW1lLnR1cm5dLAogICAgICAgIGluZGV4OiBwYXJzZUludChnYW1lLmluZGV4KSwKICAgIH07Cn0KCmV4cG9ydCBmdW5jdGlvbiBzdG9yZWRzVG9HYW1lSW5mb3MoZ2FtZXM6IFN0b3JlZEdhbWVbXSk6IElHYW1lSW5mb1tdIHsKICAgIHJldHVybiBnYW1lcy5tYXAoc3RvcmVkVG9HYW1lSW5mbyk7Cn0K",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/types/checkers/board.ts#L20-L43"}}),e._v(" "),o("HighlightBox",{attrs:{type:"note"}},[o("p",[e._v("Here:")]),e._v(" "),o("ul",[o("li",[e._v("You use Cosmos addresses instead of names.")]),e._v(" "),o("li",[e._v("You put today in the creation date because it is not stored in "),o("code",[e._v("StoredGame")]),e._v(".")]),e._v(" "),o("li",[e._v("You set the "),o("code",[e._v("last")]),e._v(" played date to deadline minus expiry duration (an adequate solution).")]),e._v(" "),o("li",[e._v('The possibility of "AI" is not important.')])])]),e._v(" "),o("HighlightBox",{attrs:{type:"info"}},[o("p",[e._v("Could an AI player and the blockchain mix together? If "),o("em",[e._v("the AI")]),e._v(" has access to a private key that lets it send transactions, it would be a bona fide player. This could be implemented with backend scripts running on a server. See "),o("RouterLink",{attrs:{to:"/hands-on-exercise/3-cosmjs-adv/5-server-side.html"}},[e._v("checkers backend scripts")]),e._v(" for an example of backend scripts for a different use-case.")],1)]),e._v(" "),o("h2",{attrs:{id:"obtain-a-client"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#obtain-a-client"}},[e._v("#")]),e._v(" Obtain a client")]),e._v(" "),o("p",[e._v("For your React components to communicate with the blockchain they need to have access to a "),o("code",[e._v("StargateClient")]),e._v(", and at some point to a "),o("code",[e._v("SigningStargateClient")]),e._v(" too. Among the information they need is the RPC URL.")]),e._v(" "),o("h3",{attrs:{id:"pass-rpc-parameters"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#pass-rpc-parameters"}},[e._v("#")]),e._v(" Pass RPC parameters")]),e._v(" "),o("p",[e._v("The RPC URL is already saved into "),o("code",[e._v("process.env.RPC_URL")]),e._v(" thanks to "),o("code",[e._v("react-app-rewired")]),e._v(". However, it is better to reduce your components' reliance on "),o("code",[e._v("process.env")]),e._v(". A simple way to give the RPC URL to the components is for them to:")]),e._v(" "),o("ul",[o("li",[e._v("Receive an "),o("code",[e._v("rpcUrl: string")]),e._v(" in the properties.")]),e._v(" "),o("li",[e._v("Keep a "),o("code",[e._v("StargateClient")]),e._v(" in the component's state that would be instantiated lazily.")])]),e._v(" "),o("p",[e._v("With this setup, only "),o("code",[e._v("index.tsx")]),e._v(" would use "),o("code",[e._v("process.env.RPC_URL")]),e._v(".")]),e._v(" "),o("p",[e._v("For instance, prepare access to "),o("code",[e._v("rpcUrl")]),e._v(" for "),o("code",[e._v("MenuContainer.tsx")]),e._v(" by adding it to the following:")]),e._v(" "),o("ol",[o("li",[o("p",[e._v("The properties of "),o("code",[e._v("src/components/Menu/MenuContainer.tsx")]),e._v(":")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-typescript",base64:"ICAgIGV4cG9ydCBpbnRlcmZhY2UgSU1lbnVDb250YWluZXJQcm9wcyB7CiAgICAgICAgLi4uCisgICAgICBycGNVcmw6IHN0cmluZwogICAgfQo=",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/components/Menu/MenuContainer.tsx#L14"}})],1),e._v(" "),o("li",[o("p",[e._v("The properties of the component call stack, first in "),o("code",[e._v("src/components/App.tsx")]),e._v(":")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-typescript",base64:"KyAgZXhwb3J0IGludGVyZmFjZSBBcHBQcm9wcyB7CisgICAgICBycGNVcmw6IHN0cmluZzsKKyAgfQoKLSAgY29uc3QgQXBwID0gKCkgPSZndDsgeworICBjb25zdCBBcHAgPSAoeyBycGNVcmwgfTogQXBwUHJvcHMpID0mZ3Q7IHsKICAgICAgICAuLi4KICAgICAgICAgICAgJmx0O1JvdXRlcyZndDsKLSAgICAgICAgICAgICAgJmx0O1JvdXRlIHBhdGg9JnF1b3Q7bWVudSZxdW90OyBlbGVtZW50PXsmbHQ7TWVudUNvbnRhaW5lciBsb2NhdGlvbj17JnF1b3Q7JnF1b3Q7fSAvJmd0O30gLyZndDsKKyAgICAgICAgICAgICAgJmx0O1JvdXRlIHBhdGg9JnF1b3Q7bWVudSZxdW90OyBlbGVtZW50PXsmbHQ7TWVudUNvbnRhaW5lciBsb2NhdGlvbj17JnF1b3Q7JnF1b3Q7fSBycGNVcmw9e3JwY1VybH0gLyZndDt9IC8mZ3Q7CiAgICAgICAgICAgICAgICAuLi4KICAgICAgICAgICAgJmx0Oy9Sb3V0ZXMmZ3Q7CiAgICAgICAgLi4uCiAgICB9Cg==",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/components/App.tsx#L38-L50"}}),e._v(" "),o("HighlightBox",{attrs:{type:"note"}},[o("p",[e._v("You have to create the "),o("em",[e._v("missing")]),e._v(" "),o("code",[e._v("AppProps")]),e._v(" entirely.")])])],1),e._v(" "),o("li",[o("p",[e._v("Finally, to "),o("code",[e._v("src/index.tsx")]),e._v(":")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-typescript",base64:"KyAgaW1wb3J0IF8gZnJvbSAmcXVvdDsuLi9lbnZpcm9ubWVudCZxdW90OwoKICAgIHJvb3QucmVuZGVyKAogICAgICAgICZsdDtSZWFjdC5TdHJpY3RNb2RlJmd0OwogICAgICAgICAgICAmbHQ7QnJvd3NlclJvdXRlciZndDsKLSAgICAgICAgICAgICAgJmx0O0FwcCAvJmd0OworICAgICAgICAgICAgICAmbHQ7QXBwIHJwY1VybD17cHJvY2Vzcy5lbnYuUlBDX1VSTH0gLyZndDsKICAgICAgICAgICAgJmx0Oy9Ccm93c2VyUm91dGVyJmd0OwogICAgICAgICZsdDsvUmVhY3QuU3RyaWN0TW9kZSZndDssCiAgICApCg==",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/index.tsx#L21"}}),e._v(" "),o("HighlightBox",{attrs:{type:"note"}},[o("p",[e._v("If your compiler still believes that "),o("code",[e._v(".RPC_URL")]),e._v(" is "),o("code",[e._v("string | undefined")]),e._v(", you may append an "),o("code",[e._v("!")]),e._v(" to force it to "),o("code",[e._v("string")]),e._v(".")])])],1)]),e._v(" "),o("p",[e._v("Whenever another component needs the "),o("code",[e._v("rpcUrl")]),e._v(" in this tutorial, adapt and reproduce these steps as necessary.")]),e._v(" "),o("h3",{attrs:{id:"create-the-stargateclient"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#create-the-stargateclient"}},[e._v("#")]),e._v(" Create the "),o("code",[e._v("StargateClient")])]),e._v(" "),o("p",[e._v("Whenever you need a "),o("code",[e._v("StargateClient")]),e._v(" in a component, you can repeat the following chain of actions for the component in question. For instance, to prepare the client in the state of "),o("code",[e._v("src/components/Menu/MenuContainer.tsx")]),e._v(":")]),e._v(" "),o("ol",[o("li",[o("p",[e._v("Add the field in the state:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-typescript",base64:"ICAgIGludGVyZmFjZSBJTWVudUNvbnRhaW5lclN0YXRlIHsKICAgICAgICAuLi4KKyAgICAgIGNsaWVudDogQ2hlY2tlcnNTdGFyZ2F0ZUNsaWVudCB8IHVuZGVmaW5lZAogICAgfQo=",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/components/Menu/MenuContainer.tsx#L21"}})],1),e._v(" "),o("li",[o("p",[e._v("Initialize it to "),o("code",[e._v("undefined")]),e._v(" in the constructor:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-typescript",base64:"ICAgIGNvbnN0cnVjdG9yKHByb3BzOiBJTWVudUNvbnRhaW5lclByb3BzKSB7CiAgICAgICAgLi4uCiAgICAgICAgdGhpcy5zdGF0ZSA9IHsKICAgICAgICAgICAgLi4uCisgICAgICAgICAgY2xpZW50OiB1bmRlZmluZWQsCiAgICAgICAgfTsKICAgICAgICAuLi4KICAgIH0K",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/components/Menu/MenuContainer.tsx#L31"}})],1),e._v(" "),o("li",[o("p",[e._v("Add a method that implements the conditional instantiation:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"cHJvdGVjdGVkIGFzeW5jIGdldFN0YXJnYXRlQ2xpZW50KCk6IFByb21pc2UmbHQ7Q2hlY2tlcnNTdGFyZ2F0ZUNsaWVudCZndDsgewogICBjb25zdCBjbGllbnQ6IENoZWNrZXJzU3RhcmdhdGVDbGllbnQgPQogICAgICAgdGhpcy5zdGF0ZS5jbGllbnQgPz8gKGF3YWl0IENoZWNrZXJzU3RhcmdhdGVDbGllbnQuY29ubmVjdCh0aGlzLnByb3BzLnJwY1VybCkpCiAgIGlmICghdGhpcy5zdGF0ZS5jbGllbnQpIHRoaXMuc2V0U3RhdGUoeyBjbGllbnQ6IGNsaWVudCB9KQogICByZXR1cm4gY2xpZW50Cn0K",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/components/Menu/MenuContainer.tsx#L47-L52"}}),e._v(" "),o("HighlightBox",{attrs:{type:"note"}},[o("p",[e._v("This creates it only once by saving the client in the state.")])])],1)]),e._v(" "),o("p",[e._v("Instantiating a "),o("code",[e._v("CheckersSigningStargateClient")]),e._v(" is more involved, as you will see later on.")]),e._v(" "),o("p",[e._v("First, make use of what you already prepared. Why choose to start with "),o("code",[e._v("MenuContainer")]),e._v("? Because that is where all the games are listed.")]),e._v(" "),o("h2",{attrs:{id:"show-all-games"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#show-all-games"}},[e._v("#")]),e._v(" Show all games")]),e._v(" "),o("p",[e._v("To show all games, you only need the read-only "),o("code",[e._v("StargateClient")]),e._v(". There is no need to worry about private keys for now. Where do you query for the games?")]),e._v(" "),o("h3",{attrs:{id:"all-games-container"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#all-games-container"}},[e._v("#")]),e._v(" All games container")]),e._v(" "),o("p",[e._v("Look into "),o("code",[e._v("src/components/Menu/MenuContainer.tsx")]),e._v(" for the "),o("code",[e._v("componentDidMount")]),e._v(" method, which accesses the browser storage for saved games. You can replace the storage logic with the following steps:")]),e._v(" "),o("ul",[o("li",[e._v("Obtain a "),o("code",[e._v("StargateClient")]),e._v(" with the "),o("code",[e._v("getStargateClient")]),e._v(" method.")]),e._v(" "),o("li",[e._v("Obtain the blockchain games (without pagination).")]),e._v(" "),o("li",[e._v("Convert the blockchain games to the format the component expects.")]),e._v(" "),o("li",[e._v("Save them in "),o("code",[e._v("saved: IGameInfo[]")]),e._v(" of the component's state.")])]),e._v(" "),o("p",[e._v("Before adding lines of code in the component, a good next step is to add a new function to "),o("code",[e._v("CheckersStargateClient")]),e._v(" to handle the call and the conversion, or to add a helper function that takes a client as a parameter.")]),e._v(" "),o("h3",{attrs:{id:"a-specific-gui-method"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#a-specific-gui-method"}},[e._v("#")]),e._v(" A specific GUI method")]),e._v(" "),o("p",[e._v("In the future you may want to reuse the "),o("code",[e._v("CheckersStargateClient")]),e._v(" code in another GUI or for backend scripts. To avoid polluting the code, and to avoid a less-elegant helper where you need to pass a Stargate client as a parameter, add "),o("a",{attrs:{href:"https://www.c-sharpcorner.com/article/learn-about-extension-methods-in-typescript/#:~:text=Extension%2Dmethod%20gives%20you%20the,any%20data%2Dtype%20you%20want",target:"_blank",rel:"noopener noreferrer"}},[e._v("an extension method"),o("OutboundLink")],1),e._v(" to "),o("code",[e._v("CheckersStargateClient")]),e._v(".")]),e._v(" "),o("p",[e._v("In a new "),o("code",[e._v("src/types/checkers/extensions-gui.ts")]),e._v(":")]),e._v(" "),o("ol",[o("li",[o("p",[e._v("Declare the new extension method that extends your "),o("code",[e._v("CheckersStargateClient")]),e._v(" "),o("em",[e._v("module")]),e._v(":")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"ZGVjbGFyZSBtb2R1bGUgJnF1b3Q7Li4vLi4vY2hlY2tlcnNfc3RhcmdhdGVjbGllbnQmcXVvdDsgewogICAgaW50ZXJmYWNlIENoZWNrZXJzU3RhcmdhdGVDbGllbnQgewogICAgICAgIGdldEd1aUdhbWVzKCk6IFByb21pc2UmbHQ7SUdhbWVJbmZvW10mZ3Q7CiAgICB9Cn0K",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/types/checkers/extensions-gui.ts#L14-L16"}})],1),e._v(" "),o("li",[o("p",[e._v("Add its implementation:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"typecript",base64:"Q2hlY2tlcnNTdGFyZ2F0ZUNsaWVudC5wcm90b3R5cGUuZ2V0R3VpR2FtZXMgPSBhc3luYyBmdW5jdGlvbiAoKTogUHJvbWlzZSZsdDtJR2FtZUluZm9bXSZndDsgewogICAgcmV0dXJuICgKICAgICAgICBhd2FpdCB0aGlzLmNoZWNrZXJzUXVlcnlDbGllbnQhLmNoZWNrZXJzLmdldEFsbFN0b3JlZEdhbWVzKAogICAgICAgICAgICBVaW50OEFycmF5LmZyb20oW10pLAogICAgICAgICAgICBMb25nLlpFUk8sCiAgICAgICAgICAgIExvbmcuZnJvbU51bWJlcigyMCksCiAgICAgICAgICAgIHRydWUsCiAgICAgICAgKQogICAgKS5zdG9yZWRHYW1lcy5tYXAoc3RvcmVkVG9HYW1lSW5mbykKfQo=",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/types/checkers/extensions-gui.ts#L33-L42"}}),e._v(" "),o("HighlightBox",{attrs:{type:"note"}},[o("p",[e._v("Note this does not care about pagination or games beyond the first 20. This purely-GUI detail is left as an exercise.")])])],1)]),e._v(" "),o("h3",{attrs:{id:"all-games-call"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#all-games-call"}},[e._v("#")]),e._v(" All games call")]),e._v(" "),o("p",[e._v("Next, in "),o("code",[e._v("MenuContainer.tsx")]),e._v(":")]),e._v(" "),o("ol",[o("li",[o("p",[e._v("Add an empty "),o("code",[e._v("import")]),e._v(" for the extension method file, otherwise the method is not known nor compiled:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"aW1wb3J0IHt9IGZyb20gJnF1b3Q7Li4vLi4vdHlwZXMvY2hlY2tlcnMvZXh0ZW5zaW9ucy1ndWkmcXVvdDsK",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/components/Menu/MenuContainer.tsx#L4"}})],1),e._v(" "),o("li",[o("p",[e._v("Change "),o("code",[e._v("componentDidMount")]),e._v(" to "),o("code",[e._v("async")]),e._v(" and replace the storage code with a call to the new method:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-typescript",base64:"LSAgcHVibGljIGNvbXBvbmVudERpZE1vdW50KCk6IHZvaWQgeworICBwdWJsaWMgYXN5bmMgY29tcG9uZW50RGlkTW91bnQoKTogUHJvbWlzZSZsdDt2b2lkJmd0OyB7CiAgICAgICAgY29uc3QgcXVlcmllcyA9IFF1ZXJ5U3RyaW5nLnBhcnNlKHRoaXMucHJvcHMubG9jYXRpb24uc2VhcmNoKQogICAgICAgIGlmIChxdWVyaWVzLm5ld0dhbWUpIHsKICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHNob3dNb2RhbDogdHJ1ZSB9KQogICAgICAgIH0KLSAgICAgIGlmICh0eXBlb2YgU3RvcmFnZSA9PT0gJnF1b3Q7dW5kZWZpbmVkJnF1b3Q7KSB7Ci0gICAgICAgICAgLi4uCi0gICAgICB9Ci0gICAgICAvLyBnYW1lVG9Mb2FkID0gbnVsbDsKICAgICAgICB0aGlzLnNldFN0YXRlKHsKLSAgICAgICAgICBzYXZlZDogTG9ja3IuZ2V0KCZxdW90O3NhdmVkX2dhbWVzJnF1b3Q7KSB8fCBbXSwKKyAgICAgICAgICBzYXZlZDogYXdhaXQgKGF3YWl0IHRoaXMuZ2V0U3RhcmdhdGVDbGllbnQoKSkuZ2V0R3VpR2FtZXMoKSwKICAgICAgICB9KQogICAgfQo=",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/components/Menu/MenuContainer.tsx#L38-L46"}})],1)]),e._v(" "),o("p",[e._v("Restart "),o("code",[e._v("npm start")]),e._v(" and you should see the list of games in your running chain.")]),e._v(" "),o("HighlightBox",{attrs:{type:"tip"}},[o("p",[e._v("Remember that this exercise assumes that you are running a checkers chain as described at the beginning of this section.")])]),e._v(" "),o("p",[e._v("If your list is empty, you can quickly create a game with:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtaXQgY2hlY2tlcnMgc2ggLWMgXAogICAgJnF1b3Q7Y2hlY2tlcnNkIHR4IGNoZWNrZXJzIFwKICAgIGNyZWF0ZS1nYW1lIFwkQUxJQ0UgXCRBTElDRSAwIHN0YWtlIFwKICAgIC0tZnJvbSBhbGljZSAtLWtleXJpbmctYmFja2VuZCB0ZXN0IFwKICAgIC0teWVzJnF1b3Q7Cg=="}}),e._v(" "),o("p",[o("tm-image",{attrs:{src:"/hands-on-exercise/3-cosmjs-adv/images/list-games-1.png"}})],1),e._v(" "),o("h3",{attrs:{id:"individual-game-menu-container"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#individual-game-menu-container"}},[e._v("#")]),e._v(" Individual game menu container")]),e._v(" "),o("p",[e._v("Each game is now listed as a "),o("a",{attrs:{href:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/components/Menu/MenuItem.tsx",target:"_blank",rel:"noopener noreferrer"}},[o("code",[e._v("src/components/Menu/MenuItem.tsx")]),o("OutboundLink")],1),e._v(". However, in "),o("code",[e._v("src/components/Menu/Menu.tsx")]),e._v(" the "),o("code",[e._v("index")]),e._v(" of the game is taken from its "),o("em",[e._v("index")]),e._v(" in the games array, which is not what you want here. The list needs to use the proper "),o("code",[e._v("index")]),e._v(" of each game. In "),o("code",[e._v("Menu.tsx")]),e._v(" make this change:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-typescript",base64:"ICAgIGNvbnN0IE1lbnUgPSAocHJvcHM6IElNZW51UHJvcHMpID0mZ3Q7IHsKICAgICAgICBjb25zdCBtZW51SXRlbXMgPSBwcm9wcy5nYW1lcy5tYXAoKGdhbWUsIGluZGV4KSA9Jmd0OyAoCi0gICAgICAgICAgJmx0O01lbnVJdGVtIC4uLiBpbmRleD17aW5kZXh9IGtleT17JnF1b3Q7Z2FtZSZxdW90OyArIGluZGV4fSAvJmd0OworICAgICAgICAgICZsdDtNZW51SXRlbSAuLi4gaW5kZXg9e2dhbWUuaW5kZXh9IGtleT17JnF1b3Q7Z2FtZSZxdW90OyArIGdhbWUuaW5kZXh9IC8mZ3Q7CiAgICAgICAgKSkKICAgICAgICAuLi4KICAgIH0K",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/components/Menu/Menu.tsx#L21-L23"}}),e._v(" "),o("p",[e._v("If the compiler complains, temporarily add "),o("code",[e._v("!")]),e._v(" (as in "),o("code",[e._v("game.index!")]),e._v(") if you previously added the "),o("code",[e._v("IGameInfo.index")]),e._v(" as "),o("code",[e._v("index?: number")]),e._v(".")]),e._v(" "),o("h2",{attrs:{id:"show-one-game"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#show-one-game"}},[e._v("#")]),e._v(" Show one game")]),e._v(" "),o("p",[e._v("What happens when you click on a game's "),o("kbd",[e._v("Resume Game")]),e._v("? It opens a page of the form "),o("code",[e._v("http://localhost:3000/play/1")]),e._v(". The component is "),o("code",[e._v("src/components/Game/GameContainer.tsx")]),e._v(", from which you have to pick the game information from the blockchain. This process begins as with "),o("code",[e._v("MenuContainer")]),e._v(":")]),e._v(" "),o("ul",[o("li",[e._v("Pass a "),o("a",{attrs:{href:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/components/Game/GameContainer.tsx#L19",target:"_blank",rel:"noopener noreferrer"}},[o("code",[e._v("rpcUrl")]),o("OutboundLink")],1),e._v(" along the chain to "),o("a",{attrs:{href:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/components/App.tsx#L51",target:"_blank",rel:"noopener noreferrer"}},[o("code",[e._v("GameContainerWrapper")]),o("OutboundLink")],1),e._v(" then the "),o("a",{attrs:{href:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/components/App.tsx#L21-L27",target:"_blank",rel:"noopener noreferrer"}},[o("code",[e._v("GameContainer")]),o("OutboundLink")],1),e._v(".")]),e._v(" "),o("li",[e._v("Add a "),o("a",{attrs:{href:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/components/Game/GameContainer.tsx#L39",target:"_blank",rel:"noopener noreferrer"}},[o("code",[e._v("client: CheckersStargateClient | undefined")]),o("OutboundLink")],1),e._v(" state field, "),o("a",{attrs:{href:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/components/Game/GameContainer.tsx#L62",target:"_blank",rel:"noopener noreferrer"}},[e._v("initialize it"),o("OutboundLink")],1),e._v(", and add a "),o("a",{attrs:{href:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/components/Game/GameContainer.tsx#L116-L121",target:"_blank",rel:"noopener noreferrer"}},[e._v("lazy instantiation method"),o("OutboundLink")],1),e._v(".")])]),e._v(" "),o("p",[e._v("Looking into "),o("code",[e._v("GameContainer")]),e._v(", you see that "),o("code",[e._v("componentDidMount")]),e._v(" gets all the games from storage then sets the state with the information. Instead, as you did for all games, you have to take the game from the blockchain.")]),e._v(" "),o("ol",[o("li",[o("p",[e._v("In "),o("code",[e._v("extensions-gui.tsx")]),e._v(" declare another extension method to "),o("code",[e._v("CheckersStargateClient")]),e._v(" dedicated to getting the game as expected by the GUI:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-typescript",base64:"ICAgIGRlY2xhcmUgbW9kdWxlICZxdW90Oy4uLy4uL2NoZWNrZXJzX3N0YXJnYXRlY2xpZW50JnF1b3Q7IHsKICAgICAgICBpbnRlcmZhY2UgQ2hlY2tlcnNTdGFyZ2F0ZUNsaWVudCB7CiAgICAgICAgICAgIC4uLgorICAgICAgICAgIGdldEd1aUdhbWUoaW5kZXg6IHN0cmluZyk6IFByb21pc2UmbHQ7SUdhbWVJbmZvIHwgdW5kZWZpbmVkJmd0OwogICAgICAgIH0KICAgIH0K",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/types/checkers/extensions-gui.ts#L17"}}),e._v(" "),o("p",[e._v("Now define "),o("code",[e._v("getGuiGame")]),e._v(":")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"Q2hlY2tlcnNTdGFyZ2F0ZUNsaWVudC5wcm90b3R5cGUuZ2V0R3VpR2FtZSA9IGFzeW5jIGZ1bmN0aW9uIChpbmRleDogc3RyaW5nKTogUHJvbWlzZSZsdDtJR2FtZUluZm8gfCB1bmRlZmluZWQmZ3Q7IHsKICAgIGNvbnN0IHN0b3JlZEdhbWU6IFN0b3JlZEdhbWUgfCB1bmRlZmluZWQgPSBhd2FpdCB0aGlzLmNoZWNrZXJzUXVlcnlDbGllbnQhLmNoZWNrZXJzLmdldFN0b3JlZEdhbWUoaW5kZXgpCiAgICBpZiAoIXN0b3JlZEdhbWUpIHJldHVybiB1bmRlZmluZWQKICAgIHJldHVybiBzdG9yZWRUb0dhbWVJbmZvKHN0b3JlZEdhbWUpCn0K",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/types/checkers/extensions-gui.ts#L44-L48"}})],1),e._v(" "),o("li",[o("p",[e._v("In "),o("code",[e._v("GameContainer.tsx")]),e._v(" add an empty import to the extension methods:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"aW1wb3J0IHt9IGZyb20gJnF1b3Q7Li4vLi4vdHlwZXMvY2hlY2tlcnMvZXh0ZW5zaW9ucy1ndWkmcXVvdDsK",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/components/Game/GameContainer.tsx#L9"}})],1),e._v(" "),o("li",[o("p",[e._v("Make the "),o("code",[e._v("componentDidMount")]),e._v(" method "),o("code",[e._v("async")]),e._v(":")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"cHVibGljIGFzeW5jIGNvbXBvbmVudERpZE1vdW50KCk6IFByb21pc2UmbHQ7dm9pZCZndDsK",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/components/Game/GameContainer.tsx#L73"}})],1),e._v(" "),o("li",[o("p",[e._v("Split the "),o("code",[e._v("componentDidMount")]),e._v(" method, and move the game loading lines to their own "),o("code",[e._v("loadGame")]),e._v(" function:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-typescript",base64:"LSAgcHVibGljIGNvbXBvbmVudERpZE1vdW50KCk6IHZvaWQgeworICBwdWJsaWMgYXN5bmMgY29tcG9uZW50RGlkTW91bnQoKTogUHJvbWlzZSZsdDt2b2lkJmd0OyB7CiAgICAgICAgLy8gQWxsb3cgYSBwbGF5ZXIgdG8gbWFrZSBhIG1vdmUgYnkgZG91YmxlLWNsaWNraW5nIHRoZSBzY3JlZW4uCiAgICAgICAgLy8gVGhpcyBpcyBtYWlubHkgZm9yIHRvdWNoc2NyZWVuIHVzZXJzLgogICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCZxdW90O2RibGNsaWNrJnF1b3Q7LCB0aGlzLm1ha2VNb3ZlKQorICAgICAgYXdhaXQgdGhpcy5sb2FkR2FtZSgpCisgIH0KKyAgcHVibGljIGFzeW5jIGxvYWRHYW1lKCk6IFByb21pc2UmbHQ7dm9pZCZndDsgewogICAgICAgIGNvbnN0IHNhdmVkR2FtZXM6IElHYW1lSW5mb1tdID0gTG9ja3IuZ2V0KCZxdW90O3NhdmVkX2dhbWVzJnF1b3Q7KSB8fCBbXQogICAgICAgIC4uLgogICAgfQo=",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/components/Game/GameContainer.tsx#L76-L79"}})],1),e._v(" "),o("li",[o("p",[e._v("In "),o("code",[e._v("loadGame")]),e._v(" replace the storage actions with a fetch from the blockchain:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-typescript",base64:"ICAgIHB1YmxpYyBhc3luYyBsb2FkR2FtZSgpOiBQcm9taXNlJmx0O3ZvaWQmZ3Q7IHsKLSAgICAgIGNvbnN0IHNhdmVkR2FtZXM6IElHYW1lSW5mb1tdID0gTG9ja3IuZ2V0KCZxdW90O3NhdmVkX2dhbWVzJnF1b3Q7KSB8fCBbXQotICAgICAgLi4uCi0gICAgICBpZiAoaW5kZXggPT09IDAgJmFtcDsmYW1wOyBzYXZlZEdhbWVzLmxlbmd0aCA9PT0gMCkgeworICAgICAgY29uc3QgZ2FtZTogSUdhbWVJbmZvIHwgdW5kZWZpbmVkID0gYXdhaXQgKAorICAgICAgICAgIGF3YWl0IHRoaXMuZ2V0U3RhcmdhdGVDbGllbnQoKQorICAgICAgKS5nZXRHdWlHYW1lKHRoaXMucHJvcHMuaW5kZXgpCisgICAgICBpZiAoIWdhbWUpIHsKKyAgICAgICAgICBhbGVydCgmcXVvdDtHYW1lIGRvZXMgbm90IGV4aXN0JnF1b3Q7KQogICAgICAgICAgICByZXR1cm4KICAgICAgICB9Ci0gICAgICBjb25zdCBnYW1lOiBJR2FtZUluZm8gPSBzYXZlZEdhbWVzW2luZGV4XQogICAgICAgIHRoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAuLi4KICAgICAgICB9KQogICAgICAgIC4uLgogICAgfQo=",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/components/Game/GameContainer.tsx#L80-L86"}})],1),e._v(" "),o("li",[o("p",[e._v("Adjust the "),o("code",[e._v("setState")]),e._v(" call so that "),o("code",[e._v("isSaved")]),e._v(" is always "),o("code",[e._v("true")]),e._v(":")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-typescript",base64:"ICAgIHB1YmxpYyBhc3luYyBsb2FkR2FtZSgpOiBQcm9taXNlJmx0O3ZvaWQmZ3Q7IHsKICAgICAgICAuLi4KICAgICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgLi4uCi0gICAgICAgICAgaXNTYXZlZDogIXF1ZXJ5cy5uZXdHYW1lLAorICAgICAgICAgIGlzU2F2ZWQ6IHRydWUsCiAgICAgICAgICAgIC4uLgogICAgICAgIH0pOwogICAgICAgIC4uLgogICAgfQo=",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/components/Game/GameContainer.tsx#L91"}}),e._v(" "),o("HighlightBox",{attrs:{type:"note"}},[o("p",[e._v("Here:")]),e._v(" "),o("ul",[o("li",[e._v("You force "),o("code",[e._v("isSaved")]),e._v(" to "),o("code",[e._v("true")]),e._v(" since it is always saved in the blockchain.")]),e._v(" "),o("li",[e._v("Saving "),o("code",[e._v("game.index")]),e._v(" to state is unimportant because it is actually passed in "),o("code",[e._v("IGameContainerProps.index")]),e._v(".")]),e._v(" "),o("li",[e._v("By having a separate "),o("code",[e._v("loadGame")]),e._v(", you can call it again if you know the game has changed.")]),e._v(" "),o("li",[e._v("It is important that this component fetches the game from the blockchain on its own, because the game page "),o("code",[e._v("http://.../play/1")]),e._v(" could be opened out of nowhere and may not have access to the list of games. Moreover, it may be entirely missing from the list.")])])])],1)]),e._v(" "),o("p",[e._v("Restart "),o("code",[e._v("npm start")]),e._v(" and you should now see your game.")]),e._v(" "),o("p",[e._v("To quickly make a move on your created game with an id of "),o("code",[e._v("1")]),e._v(", you can run:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtaXQgY2hlY2tlcnMgXAogICAgY2hlY2tlcnNkIHR4IGNoZWNrZXJzIFwKICAgIHBsYXktbW92ZSAxIDEgMiAyIDMgXAogICAgLS1mcm9tIGFsaWNlIC0ta2V5cmluZy1iYWNrZW5kIHRlc3QgXAogICAgLS15ZXMK"}}),e._v(" "),o("p",[e._v("Refresh the page to confirm the change.")]),e._v(" "),o("p",[o("tm-image",{attrs:{src:"/hands-on-exercise/3-cosmjs-adv/images/show-game-1-move.png"}})],1),e._v(" "),o("h2",{attrs:{id:"integrate-with-keplr"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#integrate-with-keplr"}},[e._v("#")]),e._v(" Integrate with Keplr")]),e._v(" "),o("p",[e._v("So far you have "),o("em",[e._v("only")]),e._v(" made it possible to show the state of games and of the blockchain. This allows your users to poke around without unnecessarily asking them to connect their wallet and thereby disclose their address. However, to create a game or play in one, users need to make transactions. This is where you need to make integration with the Keplr wallet possible.")]),e._v(" "),o("p",[e._v("Install the necessary packages:")]),e._v(" "),o("CodeGroup",[o("CodeGroupItem",{attrs:{title:"Local",active:""}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBucG0gaW5zdGFsbCBAa2VwbHItd2FsbGV0L3R5cGVzQDAuMTAuMTcgLS1zYXZlLWV4YWN0IC0tc2F2ZS1kZXYK"}})],1),e._v(" "),o("CodeGroupItem",{attrs:{title:"Docker"}},[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IFwKICAgIC12ICQocHdkKTovY2xpZW50IFwKICAgIC13IC9jbGllbnQgXAogICAgbm9kZToxOC43LXNsaW0gXAogICAgbnBtIGluc3RhbGwgQGtlcGxyLXdhbGxldC90eXBlc0AwLjEwLjE3IC0tc2F2ZS1leGFjdCAtLXNhdmUtZGV2Cg=="}})],1)],1),e._v(" "),o("h3",{attrs:{id:"identify-the-checkers-blockchain"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#identify-the-checkers-blockchain"}},[e._v("#")]),e._v(" Identify the checkers blockchain")]),e._v(" "),o("p",[e._v("Keplr will need information to differentiate your checkers blockchain from the other chains. You are also going to inform it about your REST API.")]),e._v(" "),o("ol",[o("li",[o("p",[e._v("Adjust your "),o("code",[e._v(".env")]),e._v(" file:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-ini",base64:"ICAgIFJQQ19VUkw9JnF1b3Q7aHR0cDovL2xvY2FsaG9zdDoyNjY1NyZxdW90OworICBSRVNUX1VSTD0mcXVvdDtodHRwOi8vbG9jYWxob3N0OjEzMTcmcXVvdDsKICAgIC4uLgo=",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/.env#L2"}})],1),e._v(" "),o("li",[o("p",[e._v("Adjust the associated type declaration:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-typescript",base64:"ICAgIFJQQ19VUkw6IHN0cmluZworICBSRVNUX1VSTDogc3RyaW5nCiAgICAuLi4K",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/environment.d.ts#L5"}})],1),e._v(" "),o("li",[o("p",[e._v("Adjust its passing through Webpack:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-typescript",base64:"ICAgIG5ldyB3ZWJwYWNrLkVudmlyb25tZW50UGx1Z2luKFsmcXVvdDtSUENfVVJMJnF1b3Q7XSksCisgIG5ldyB3ZWJwYWNrLkVudmlyb25tZW50UGx1Z2luKFsmcXVvdDtSRVNUX1VSTCZxdW90O10pLAogICAgLi4uCg==",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/config-overrides.js#L10"}})],1)]),e._v(" "),o("p",[e._v("With this, prepare your checkers blockchain info in a new "),o("code",[e._v("src/types/checkers/chain.ts")]),e._v(" file:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"aW1wb3J0IHsgQ2hhaW5JbmZvIH0gZnJvbSAmcXVvdDtAa2VwbHItd2FsbGV0L3R5cGVzJnF1b3Q7CmltcG9ydCBfIGZyb20gJnF1b3Q7Li4vLi4vLi4vZW52aXJvbm1lbnQmcXVvdDsKCmV4cG9ydCBjb25zdCBjaGVja2Vyc0NoYWluSWQgPSAmcXVvdDtjaGVja2Vycy0xJnF1b3Q7CgpleHBvcnQgY29uc3QgZ2V0Q2hlY2tlcnNDaGFpbkluZm8gPSAoKTogQ2hhaW5JbmZvID0mZ3Q7ICh7CiAgICBjaGFpbklkOiBjaGVja2Vyc0NoYWluSWQsCiAgICBjaGFpbk5hbWU6ICZxdW90O2NoZWNrZXJzJnF1b3Q7LAogICAgcnBjOiBwcm9jZXNzLmVudi5SUENfVVJMISwKICAgIHJlc3Q6IHByb2Nlc3MuZW52LlJFU1RfVVJMISwKICAgIGJpcDQ0OiB7CiAgICAgICAgY29pblR5cGU6IDExOCwKICAgIH0sCiAgICBiZWNoMzJDb25maWc6IHsKICAgICAgICBiZWNoMzJQcmVmaXhBY2NBZGRyOiAmcXVvdDtjb3Ntb3MmcXVvdDssCiAgICAgICAgYmVjaDMyUHJlZml4QWNjUHViOiAmcXVvdDtjb3Ntb3MmcXVvdDsgKyAmcXVvdDtwdWImcXVvdDssCiAgICAgICAgYmVjaDMyUHJlZml4VmFsQWRkcjogJnF1b3Q7Y29zbW9zJnF1b3Q7ICsgJnF1b3Q7dmFsb3BlciZxdW90OywKICAgICAgICBiZWNoMzJQcmVmaXhWYWxQdWI6ICZxdW90O2Nvc21vcyZxdW90OyArICZxdW90O3ZhbG9wZXJwdWImcXVvdDssCiAgICAgICAgYmVjaDMyUHJlZml4Q29uc0FkZHI6ICZxdW90O2Nvc21vcyZxdW90OyArICZxdW90O3ZhbGNvbnMmcXVvdDssCiAgICAgICAgYmVjaDMyUHJlZml4Q29uc1B1YjogJnF1b3Q7Y29zbW9zJnF1b3Q7ICsgJnF1b3Q7dmFsY29uc3B1YiZxdW90OywKICAgIH0sCiAgICBjdXJyZW5jaWVzOiBbCiAgICAgICAgewogICAgICAgICAgICBjb2luRGVub206ICZxdW90O1NUQUtFJnF1b3Q7LAogICAgICAgICAgICBjb2luTWluaW1hbERlbm9tOiAmcXVvdDtzdGFrZSZxdW90OywKICAgICAgICAgICAgY29pbkRlY2ltYWxzOiAwLAogICAgICAgICAgICBjb2luR2Vja29JZDogJnF1b3Q7c3Rha2UmcXVvdDssCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGNvaW5EZW5vbTogJnF1b3Q7VE9LRU4mcXVvdDssCiAgICAgICAgICAgIGNvaW5NaW5pbWFsRGVub206ICZxdW90O3Rva2VuJnF1b3Q7LAogICAgICAgICAgICBjb2luRGVjaW1hbHM6IDAsCiAgICAgICAgfSwKICAgIF0sCiAgICBmZWVDdXJyZW5jaWVzOiBbCiAgICAgICAgewogICAgICAgICAgICBjb2luRGVub206ICZxdW90O1NUQUtFJnF1b3Q7LAogICAgICAgICAgICBjb2luTWluaW1hbERlbm9tOiAmcXVvdDtzdGFrZSZxdW90OywKICAgICAgICAgICAgY29pbkRlY2ltYWxzOiAwLAogICAgICAgICAgICBjb2luR2Vja29JZDogJnF1b3Q7c3Rha2UmcXVvdDssCiAgICAgICAgICAgIGdhc1ByaWNlU3RlcDogewogICAgICAgICAgICAgICAgbG93OiAxLAogICAgICAgICAgICAgICAgYXZlcmFnZTogMSwKICAgICAgICAgICAgICAgIGhpZ2g6IDEsCiAgICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgIF0sCiAgICBzdGFrZUN1cnJlbmN5OiB7CiAgICAgICAgY29pbkRlbm9tOiAmcXVvdDtTVEFLRSZxdW90OywKICAgICAgICBjb2luTWluaW1hbERlbm9tOiAmcXVvdDtzdGFrZSZxdW90OywKICAgICAgICBjb2luRGVjaW1hbHM6IDAsCiAgICAgICAgY29pbkdlY2tvSWQ6ICZxdW90O3N0YWtlJnF1b3Q7LAogICAgfSwKICAgIGNvaW5UeXBlOiAxMTgsCiAgICBmZWF0dXJlczogW10sCn0pCg==",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/types/checkers/chain.ts"}}),e._v(" "),o("p",[e._v("Note the use of "),o("code",[e._v("process.env.RPC_URL")]),e._v(" again.")]),e._v(" "),o("HighlightBox",{attrs:{type:"note"}},[o("p",[e._v("The "),o("code",[e._v("chainId")]),e._v(" value has to "),o("strong",[e._v("match exactly")]),e._v(" that returned by "),o("code",[e._v("client.getChainId()")]),e._v(", or the transaction signer will balk. The "),o("code",[e._v("ChainInfo")]),e._v(" object is copied from the one you used for Theta in the "),o("RouterLink",{attrs:{to:"/tutorials/7-cosmjs/4-with-keplr.html"}},[e._v("first steps with Keplr")]),e._v(" section.")],1)]),e._v(" "),o("h3",{attrs:{id:"prepare-a-signing-client"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#prepare-a-signing-client"}},[e._v("#")]),e._v(" Prepare a signing client")]),e._v(" "),o("p",[e._v("Just as components that need a "),o("code",[e._v("CheckersStargateClient")]),e._v(" keep one in their state, components that need a "),o("code",[e._v("SigningCheckersStargateClient")]),e._v(" keep one in their state too. Some components may have both.")]),e._v(" "),o("HighlightBox",{attrs:{type:"best-practice"}},[o("p",[e._v("A component may have both "),o("code",[e._v("CheckersStargateClient")]),e._v(" and "),o("code",[e._v("SigningCheckersStargateClient")]),e._v(". That is not a problem. In fact it may benefit your project, because with a simple "),o("code",[e._v("CheckersStargateClient")]),e._v(" you can let your users poke around first, "),o("em",[e._v("and build their trust")]),e._v(", before asking them to connect their Keplr account.")])]),e._v(" "),o("p",[e._v("The steps to take are the same for each such component.")]),e._v(" "),o("p",[e._v("For instance, in "),o("code",[e._v("src/components/Menu/NewGameModal/NewGameModal.tsx")]),e._v(":")]),e._v(" "),o("ol",[o("li",[o("p",[e._v("Add an "),o("a",{attrs:{href:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/components/Menu/NewGameModal/NewGameModal.tsx#L25",target:"_blank",rel:"noopener noreferrer"}},[o("code",[e._v("rpcUrl: string")]),o("OutboundLink")],1),e._v(" to the props, passed along "),o("a",{attrs:{href:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/components/Menu/Menu.tsx#L47",target:"_blank",rel:"noopener noreferrer"}},[o("code",[e._v("Menu.tsx")]),o("OutboundLink")],1),e._v(" which also needs it "),o("a",{attrs:{href:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/components/Menu/Menu.tsx#L17",target:"_blank",rel:"noopener noreferrer"}},[e._v("as a new prop"),o("OutboundLink")],1),e._v(", in turn passed from "),o("a",{attrs:{href:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/components/Menu/MenuContainer.tsx#L82",target:"_blank",rel:"noopener noreferrer"}},[o("code",[e._v("MenuContainer.tsx")]),o("OutboundLink")],1),e._v(".")])]),e._v(" "),o("li",[o("p",[e._v("Add a signing client to the component's state, as well as the potential address of the Keplr user:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-typescript",base64:"ICAgIGludGVyZmFjZSBJTmV3R2FtZU1vZGFsU3RhdGUgewogICAgICAgIC4uLgorICAgICAgY3JlYXRvcjogc3RyaW5nOworICAgICAgc2lnbmluZ0NsaWVudDogQ2hlY2tlcnNTaWduaW5nU3RhcmdhdGVDbGllbnQgfCB1bmRlZmluZWQ7CiAgICB9Cg==",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/components/Menu/NewGameModal/NewGameModal.tsx#L30-L31"}}),e._v(" "),o("p",[e._v("Do not forget to initialize them to nothing in the constructor:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-typescript",base64:"ICAgIHRoaXMuc3RhdGUgPSB7CiAgICAgICAgLi4uCisgICAgICBjcmVhdG9yOiAmcXVvdDsmcXVvdDssCisgICAgICBzaWduaW5nQ2xpZW50OiB1bmRlZmluZWQsCiAgICB9Cg==",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/components/Menu/NewGameModal/NewGameModal.tsx#L50-L51"}}),e._v(" "),o("p",[e._v("The address obtained from Keplr is saved in "),o("code",[e._v("creator")]),e._v(", because it is accessible from the "),o("code",[e._v("OfflineSigner")]),e._v(" but not from the "),o("code",[e._v("SigningStargateClient")]),e._v(".")])],1),e._v(" "),o("li",[o("p",[e._v("Add a tuple type to return both of them:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"aW50ZXJmYWNlIENyZWF0b3JJbmZvIHsKICAgIGNyZWF0b3I6IHN0cmluZzsKICAgIHNpZ25pbmdDbGllbnQ6IENoZWNrZXJzU2lnbmluZ1N0YXJnYXRlQ2xpZW50Owp9Cg==",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/components/Menu/NewGameModal/NewGameModal.tsx#L17-L20"}}),e._v(" "),o("p",[e._v("This is done because the "),o("code",[e._v("setState")]),e._v(" function does not ensure the state is updated immediately after it has been called, so the lazy instantiation method has to return both.")])],1),e._v(" "),o("li",[o("p",[e._v("Inform TypeScript of the "),o("em",[e._v("Keplr "),o("code",[e._v("window")])]),e._v(" object:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"aW1wb3J0IHsgV2luZG93IGFzIEtlcGxyV2luZG93IH0gZnJvbSAmcXVvdDtAa2VwbHItd2FsbGV0L3R5cGVzJnF1b3Q7Ci4uLgpkZWNsYXJlIGdsb2JhbCB7CiAgICBpbnRlcmZhY2UgV2luZG93IGV4dGVuZHMgS2VwbHJXaW5kb3cge30KfQo=",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/components/Menu/NewGameModal/NewGameModal.tsx#L3-L15"}})],1),e._v(" "),o("li",[o("p",[e._v("Add a function that obtains the signing client and signer's address (a.k.a. future transaction "),o("code",[e._v("creator")]),e._v(") by setting up Keplr and connecting to it:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"cHJvdGVjdGVkIGFzeW5jIGdldFNpZ25pbmdTdGFyZ2F0ZUNsaWVudCgpOiBQcm9taXNlJmx0O0NyZWF0b3JJbmZvJmd0OyB7CiAgICBpZiAodGhpcy5zdGF0ZS5jcmVhdG9yICZhbXA7JmFtcDsgdGhpcy5zdGF0ZS5zaWduaW5nQ2xpZW50KQogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGNyZWF0b3I6IHRoaXMuc3RhdGUuY3JlYXRvciwKICAgICAgICAgICAgc2lnbmluZ0NsaWVudDogdGhpcy5zdGF0ZS5zaWduaW5nQ2xpZW50LAogICAgICAgIH0KICAgIGNvbnN0IHsga2VwbHIgfSA9IHdpbmRvdwogICAgaWYgKCFrZXBscikgewogICAgICAgIGFsZXJ0KCZxdW90O1lvdSBuZWVkIHRvIGluc3RhbGwgS2VwbHImcXVvdDspCiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCZxdW90O1lvdSBuZWVkIHRvIGluc3RhbGwgS2VwbHImcXVvdDspCiAgICB9CiAgICBhd2FpdCBrZXBsci5leHBlcmltZW50YWxTdWdnZXN0Q2hhaW4oZ2V0Q2hlY2tlcnNDaGFpbkluZm8oKSkKICAgIGF3YWl0IGtlcGxyLmVuYWJsZShjaGVja2Vyc0NoYWluSWQpCiAgICBjb25zdCBvZmZsaW5lU2lnbmVyOiBPZmZsaW5lU2lnbmVyID0ga2VwbHIuZ2V0T2ZmbGluZVNpZ25lciEoY2hlY2tlcnNDaGFpbklkKQogICAgY29uc3QgY3JlYXRvciA9IChhd2FpdCBvZmZsaW5lU2lnbmVyLmdldEFjY291bnRzKCkpWzBdLmFkZHJlc3MKICAgIGNvbnN0IGNsaWVudDogQ2hlY2tlcnNTaWduaW5nU3RhcmdhdGVDbGllbnQgPSBhd2FpdCBDaGVja2Vyc1NpZ25pbmdTdGFyZ2F0ZUNsaWVudC5jb25uZWN0V2l0aFNpZ25lcigKICAgICAgICB0aGlzLnByb3BzLnJwY1VybCwKICAgICAgICBvZmZsaW5lU2lnbmVyLAogICAgICAgIHsKICAgICAgICAgICAgZ2FzUHJpY2U6IEdhc1ByaWNlLmZyb21TdHJpbmcoJnF1b3Q7MXN0YWtlJnF1b3Q7KSwKICAgICAgICB9LAogICAgKQogICAgdGhpcy5zZXRTdGF0ZSh7IGNyZWF0b3I6IGNyZWF0b3IsIHNpZ25pbmdDbGllbnQ6IGNsaWVudCB9KQogICAgcmV0dXJuIHsgY3JlYXRvcjogY3JlYXRvciwgc2lnbmluZ0NsaWVudDogY2xpZW50IH0KfQo=",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/components/Menu/NewGameModal/NewGameModal.tsx#L61-L84"}}),e._v(" "),o("HighlightBox",{attrs:{type:"note"}},[o("p",[e._v("Setting up Keplr is "),o("a",{attrs:{href:"https://www.merriam-webster.com/dictionary/idempotent#:~:text=Definition%20of%20idempotent,plural%20idempotents",target:"_blank",rel:"noopener noreferrer"}},[e._v("idempotent"),o("OutboundLink")],1),e._v(", so repeating these operations more than once is harmless. You may want to separate these actions into more defined methods at a later optimization stage.\n"),o("br"),o("br"),e._v("\nNote too that a default gas price is passed in, so that you can use "),o("code",[e._v('"auto"')]),e._v(" when sending a transaction.")])])],1)]),e._v(" "),o("p",[e._v("Your component is now ready to send transactions to the blockchain. Why choose "),o("code",[e._v("NewGameModal.tsx")]),e._v(" as the example? Because this is where a new game is created.")]),e._v(" "),o("h2",{attrs:{id:"create-a-new-game"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#create-a-new-game"}},[e._v("#")]),e._v(" Create a new game")]),e._v(" "),o("p",[e._v("This modal window pops up when you click on "),o("kbd",[e._v("New Game")]),e._v(":")]),e._v(" "),o("p",[o("tm-image",{attrs:{src:"/hands-on-exercise/3-cosmjs-adv/images/window-create-game.png"}})],1),e._v(" "),o("p",[e._v("The player names look ready-made to take the player's blockchain addresses.")]),e._v(" "),o("p",[e._v("Examine the code, and focus on "),o("code",[e._v("src/components/Menu/NewGameModal/NewGameModal.tsx")]),e._v(". Thanks to the previous preparation with "),o("code",[e._v("CheckersSigningStargateClient")]),e._v(" it is ready to send transactions:")]),e._v(" "),o("ol",[o("li",[o("p",[e._v("In "),o("code",[e._v("extensions-gui.ts")]),e._v(" declare an extension method to your "),o("code",[e._v("CheckersSigningStargateClient")]),e._v(" that encapsulates knowledge about how to get the newly created game index out of the events:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"ZGVjbGFyZSBtb2R1bGUgJnF1b3Q7Li4vLi4vY2hlY2tlcnNfc2lnbmluZ3N0YXJnYXRlY2xpZW50JnF1b3Q7IHsKICAgIGludGVyZmFjZSBDaGVja2Vyc1NpZ25pbmdTdGFyZ2F0ZUNsaWVudCB7CiAgICAgICAgY3JlYXRlR3VpR2FtZShjcmVhdG9yOiBzdHJpbmcsIGJsYWNrOiBzdHJpbmcsIHJlZDogc3RyaW5nKTogUHJvbWlzZSZsdDtzdHJpbmcmZ3Q7CiAgICB9Cn0K",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/types/checkers/extensions-gui.ts#L26-L28"}}),e._v(" "),o("p",[e._v("Now define it:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"Q2hlY2tlcnNTaWduaW5nU3RhcmdhdGVDbGllbnQucHJvdG90eXBlLmNyZWF0ZUd1aUdhbWUgPSBhc3luYyBmdW5jdGlvbiAoCiAgICBjcmVhdG9yOiBzdHJpbmcsCiAgICBibGFjazogc3RyaW5nLAogICAgcmVkOiBzdHJpbmcsCik6IFByb21pc2UmbHQ7c3RyaW5nJmd0OyB7CiAgICBjb25zdCByZXN1bHQ6IERlbGl2ZXJUeFJlc3BvbnNlID0gYXdhaXQgdGhpcy5jcmVhdGVHYW1lKGNyZWF0b3IsIGJsYWNrLCByZWQsICZxdW90O3N0YWtlJnF1b3Q7LCBMb25nLlpFUk8sICZxdW90O2F1dG8mcXVvdDspCiAgICBjb25zdCBsb2dzOiBMb2dbXSA9IEpTT04ucGFyc2UocmVzdWx0LnJhd0xvZyEpCiAgICByZXR1cm4gZ2V0Q3JlYXRlZEdhbWVJZChnZXRDcmVhdGVHYW1lRXZlbnQobG9nc1swXSkhKQp9Cg==",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/types/checkers/extensions-gui.ts#L64-L72"}}),e._v(" "),o("HighlightBox",{attrs:{type:"note"}},[o("p",[e._v("Keep in mind:")]),e._v(" "),o("ul",[o("li",[e._v("For the sake of simplicity, a possible wager is completely omitted.")]),e._v(" "),o("li",[e._v("The "),o("code",[e._v("getCreatedGameId")]),e._v(" is defined in a "),o("RouterLink",{attrs:{to:"/hands-on-exercise/3-cosmjs-adv/2-cosmjs-messages.html"}},[e._v("previous section")]),e._v(".")],1)])])],1),e._v(" "),o("li",[o("p",[e._v("In "),o("code",[e._v("NewGameModal.tsx")]),e._v(" add an empty import of the extension method so that it is compiled in:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"aW1wb3J0IHt9IGZyb20gJnF1b3Q7c3JjL3R5cGVzL2NoZWNrZXJzL2V4dGVuc2lvbnMtZ3VpJnF1b3Q7Cg==",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/components/Menu/NewGameModal/NewGameModal.tsx#L8"}})],1),e._v(" "),o("li",[o("p",[e._v("Since you are going to paste addresses into the name field, make sure that the GUI does not truncate them. In "),o("code",[e._v("src/components/Menu/NewGameModal/PlayerNameInput.tsx")]),e._v(":")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-typescript",base64:"ICAgIC4uLgotICBtYXhMZW5ndGg9ezIwfQorICBtYXhMZW5ndGg9ezQ1fQo=",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/components/Menu/NewGameModal/PlayerNameInput.tsx#L36"}})],1),e._v(" "),o("li",[o("p",[e._v("Back in "),o("code",[e._v("NewGameModal.tsx")]),e._v(", change the declaration of "),o("code",[e._v("handleSubmit")]),e._v(" and make it "),o("code",[e._v("async")]),e._v(":")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"cHJpdmF0ZSBhc3luYyBoYW5kbGVTdWJtaXQoZXZlbnQ6IGFueSk6IFByb21pc2UmbHQ7dm9pZCZndDsK",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/components/Menu/NewGameModal/NewGameModal.tsx#L128"}})],1),e._v(" "),o("li",[o("p",[e._v("In "),o("code",[e._v("handleSubmit")]),e._v(", avert the need to save to local storage and call your create game extension method:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-typescript",base64:"ICAgIGlmIChwMVZhbGlkICZhbXA7JmFtcDsgcDJWYWxpZCkgewotICAgICAgY29uc3QgaW5mbzogSUdhbWVJbmZvID0gewotICAgICAgICAgIC4uLgotICAgICAgfQotICAgICAgY29uc3Qgc2F2ZWQ6IElHYW1lSW5mb1tdID0gTG9ja3IuZ2V0KCZxdW90O3NhdmVkX2dhbWVzJnF1b3Q7KSB8fCBbXQotICAgICAgTG9ja3Iuc2V0KCZxdW90O3NhdmVkX2dhbWVzJnF1b3Q7LCBbaW5mbywgLi4uc2F2ZWRdKQorICAgICAgY29uc3QgeyBjcmVhdG9yLCBzaWduaW5nQ2xpZW50IH0gPSBhd2FpdCB0aGlzLmdldFNpZ25pbmdTdGFyZ2F0ZUNsaWVudCgpCisgICAgICBjb25zdCBpbmRleDogc3RyaW5nID0gYXdhaXQgc2lnbmluZ0NsaWVudC5jcmVhdGVHdWlHYW1lKGNyZWF0b3IsIHAxTmFtZSwgcDJOYW1lKQogICAgICAgIHRoaXMucHJvcHMuY2xvc2UoKQogICAgfQo=",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/components/Menu/NewGameModal/NewGameModal.tsx#L156-L157"}})],1),e._v(" "),o("li",[o("p",[e._v("Next send the player directly to the newly created game:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-typescript",base64:"ICAgIC4uLgogICAgdGhpcy5wcm9wcy5jbG9zZSgpCisgIHdpbmRvdy5sb2NhdGlvbi5yZXBsYWNlKGAvcGxheS8ke2luZGV4fWApCg==",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/components/Menu/NewGameModal/NewGameModal.tsx#L159"}})],1),e._v(" "),o("li",[o("p",[e._v("In "),o("code",[e._v("render()")]),e._v(" change the React link around the "),o("code",[e._v("Button")]),e._v(" to a regular "),o("code",[e._v("div")]),e._v(" so that window redirection appears smooth:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-typescript",base64:"ICAgIHB1YmxpYyByZW5kZXIoKSB7CiAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgLi4uCi0gICAgICAgICAgJmx0O0xpbmsKLSAgICAgICAgICAgICAgLi4uCi0gICAgICAgICAgJmd0OworICAgICAgICAgICZsdDtkaXYgc3R5bGU9e3RoaXMubGlua1N0eWxlc30gb25DbGljaz17dGhpcy5oYW5kbGVTdWJtaXR9Jmd0OwogICAgICAgICAgICAgICAgJmx0O0J1dHRvbiBjb2xvcj0mcXVvdDtzdWNjZXNzJnF1b3Q7IHNpemU9JnF1b3Q7bGcmcXVvdDsmZ3Q7CiAgICAgICAgICAgICAgICAgICAgUGxheSBHYW1lIQogICAgICAgICAgICAgICAgJmx0Oy9CdXR0b24mZ3Q7Ci0gICAgICAgICAgJmx0Oy9MaW5rJmd0OworICAgICAgICAgICZsdDsvZGl2Jmd0OwogICAgICAgICAgICAuLi4KICAgICAgICApCiAgICB9Cg==",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/components/Menu/NewGameModal/NewGameModal.tsx#L115-L119"}})],1)]),e._v(" "),o("p",[e._v("You have now added game creation to your GUI.")]),e._v(" "),o("p",[e._v("If you do not yet know your Keplr address on the checkers network, you will have to test in two passes. To test properly, you need to:")]),e._v(" "),o("ol",[o("li",[o("p",[e._v("Run the initialization code by pretending to create a game. This makes Keplr prompt you to accept adding the "),o("code",[e._v("checkers")]),e._v(" network and accessing your account. Accept both, but optionally reject the prompt to accept a transaction if your balance is zero.")]),e._v(" "),o("p",[o("tm-image",{attrs:{src:"/hands-on-exercise/3-cosmjs-adv/images/checkers-add-support.png"}}),o("tm-image",{attrs:{src:"/hands-on-exercise/3-cosmjs-adv/images/checkers-access-address.png"}})],1)]),e._v(" "),o("li",[o("p",[e._v("Select "),o("em",[e._v("Checkers")]),e._v(" in Keplr. Make a note of your address, for instance "),o("code",[e._v("cosmos17excjd99u45c4fkzljwlx8eqyn5dplcujkwag8")]),e._v(".")]),e._v(" "),o("p",[o("tm-image",{attrs:{src:"/hands-on-exercise/3-cosmjs-adv/images/list-keplr-beta-support.png"}})],1)]),e._v(" "),o("li",[o("p",[e._v("Use the faucet you started at the beginning of this section to put enough tokens in your Keplr "),o("em",[e._v("Checkers")]),e._v(" account. "),o("code",[e._v('"1000000stake"')]),e._v(" will satisfy by a 10x margin.")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBjdXJsIC0tcmVxdWVzdCBQT1NUIFwKICAgICAgICAtLWhlYWRlciAmcXVvdDtDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2pzb24mcXVvdDsgXAogICAgICAgIC0tZGF0YSAneyZxdW90O2FkZHJlc3MmcXVvdDs6JnF1b3Q7Y29zbW9zMTdleGNqZDk5dTQ1YzRma3psandseDhlcXluNWRwbGN1amt3YWc4JnF1b3Q7LCZxdW90O2Rlbm9tJnF1b3Q7OiZxdW90O3N0YWtlJnF1b3Q7fScgXAogICAgICAgIGxvY2FsaG9zdDo0NTAwL2NyZWRpdAo="}})],1),e._v(" "),o("li",[o("p",[e._v("Now start again to actually create a game. Accept the transaction, and you are redirected to the game page. This time the content of the game is from the blockchain.")])])]),e._v(" "),o("h2",{attrs:{id:"play-a-move"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#play-a-move"}},[e._v("#")]),e._v(" Play a move")]),e._v(" "),o("p",[e._v("In the "),o("code",[e._v("GameContainer.tsx")]),e._v(" there are "),o("code",[e._v("makeMove")]),e._v(" and "),o("code",[e._v("saveGame")]),e._v(" functions. In a blockchain context, "),o("code",[e._v("saveGame")]),e._v(" is irrelevant, as on each move done with a transaction the game will be automatically "),o("em",[e._v("saved")]),e._v(" in the blockchain. So add "),o("code",[e._v("index: -1")]),e._v(" in the game to be saved to get past the compilation error.")]),e._v(" "),o("p",[e._v("Add a "),o("code",[e._v("console.log")]),e._v(" to "),o("code",[e._v("makeMove")]),e._v(" to demonstrate the format it uses:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"Y29uc3QgbW92ZTogUG9zaXRpb25bXSA9IGtleXMubWFwKChrOiBzdHJpbmcpOiBQb3NpdGlvbiA9Jmd0OyBrLnNwbGl0KCZxdW90OywmcXVvdDspLm1hcChOdW1iZXIpIGFzIFBvc2l0aW9uKQpjb25zb2xlLmxvZyhtb3ZlKQo=",url:"https://github.com/cosmos/academy-checkers-ui/blob/unwired-gui/src/components/Game/GameContainer.tsx#L172"}}),e._v(" "),o("p",[e._v("Now play a move with the current interface. Move your first black piece:")]),e._v(" "),o("p",[o("tm-image",{attrs:{src:"/hands-on-exercise/3-cosmjs-adv/images/black-moves-first-piece.png"}})],1),e._v(" "),o("p",[e._v("In the blockchain code, this is "),o("code",[e._v("fromX: 1, fromY: 2, toX: 2, toY: 3")]),e._v(". However, the GUI prints:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"json",base64:"WyBbIDIsIDEgXSwgWyAzLCAyIF0gXQo="}}),e._v(" "),o("p",[e._v("Evidently for each position X and Y are flipped. You can encapsulate this knowledge in a helper function:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"ZXhwb3J0IGZ1bmN0aW9uIGd1aVBvc2l0aW9uVG9Qb3MocG9zaXRpb246IG51bWJlcltdKTogUG9zIHsKICAgIHJldHVybiB7IHg6IHBvc2l0aW9uWzFdLCB5OiBwb3NpdGlvblswXSB9Cn0K",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/types/checkers/board.ts#L45-L47"}}),e._v(" "),o("p",[e._v("This is likely a familiar situation. Go back to the board and do as if your piece was moving twice. This time, the GUI prints an array with three positions:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"json",base64:"WyBbIDIsIDEgXSwgWyAzLCAyIF0sIFsgNCwgMyBdIF0K"}}),e._v(" "),o("p",[e._v("This may not be a legal move but it proves that the GUI lets you make more than one move per turn. You can use this feature to send a transaction with more than one move.")]),e._v(" "),o("p",[e._v("Do some more preparation:")]),e._v(" "),o("ol",[o("li",[o("p",[e._v("In "),o("code",[e._v("extensions-gui.ts")]),e._v(" declare an extension method to "),o("code",[e._v("CheckersStargateClient")]),e._v(" to check whether the move is valid, with parameters as they are given in the GUI components:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-typescript",base64:"ICAgIGRlY2xhcmUgbW9kdWxlICZxdW90Oy4uLy4uL2NoZWNrZXJzX3N0YXJnYXRlY2xpZW50JnF1b3Q7IHsKICAgICAgICBpbnRlcmZhY2UgQ2hlY2tlcnNTdGFyZ2F0ZUNsaWVudCB7CiAgICAgICAgICAgIC4uLgorICAgICAgICAgIGNhblBsYXlHdWlNb3ZlKAorICAgICAgICAgICAgICBnYW1lSW5kZXg6IHN0cmluZywKKyAgICAgICAgICAgICAgcGxheWVySWQ6IG51bWJlciwKKyAgICAgICAgICAgICAgcG9zaXRpb25zOiBudW1iZXJbXVtdLAorICAgICAgICAgICk6IFByb21pc2UmbHQ7UXVlcnlDYW5QbGF5TW92ZVJlc3BvbnNlJmd0OworICAgICAgfQogICAgfQo=",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/types/checkers/extensions-gui.ts#L18-L22"}}),e._v(" "),o("p",[e._v("Now define it:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"Q2hlY2tlcnNTdGFyZ2F0ZUNsaWVudC5wcm90b3R5cGUuY2FuUGxheUd1aU1vdmUgPSBhc3luYyBmdW5jdGlvbiAoCiAgICBnYW1lSW5kZXg6IHN0cmluZywKICAgIHBsYXllcklkOiBudW1iZXIsCiAgICBwb3NpdGlvbnM6IG51bWJlcltdW10sCik6IFByb21pc2UmbHQ7UXVlcnlDYW5QbGF5TW92ZVJlc3BvbnNlJmd0OyB7CiAgICBpZiAocGxheWVySWQgJmx0OyAxIHx8IDIgJmx0OyBwbGF5ZXJJZCkgdGhyb3cgbmV3IEVycm9yKGBXcm9uZyBwbGF5ZXJJZDogJHtwbGF5ZXJJZH1gKQogICAgcmV0dXJuIGF3YWl0IHRoaXMuY2hlY2tlcnNRdWVyeUNsaWVudCEuY2hlY2tlcnMuY2FuUGxheU1vdmUoCiAgICAgICAgZ2FtZUluZGV4LAogICAgICAgIHBsYXllcklkID09PSAxID8gJnF1b3Q7YiZxdW90OyA6ICZxdW90O3ImcXVvdDssCiAgICAgICAgZ3VpUG9zaXRpb25Ub1Bvcyhwb3NpdGlvbnNbMF0pLAogICAgICAgIGd1aVBvc2l0aW9uVG9Qb3MocG9zaXRpb25zWzFdKSwKICAgICkKfQo=",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/types/checkers/extensions-gui.ts#L50-L62"}}),e._v(" "),o("p",[e._v("Note that due to the limits of the "),o("code",[e._v("canPlayGuiMove")]),e._v(" function, you can only test the first move of a multi-move turn. That is, it uses only "),o("code",[e._v("positions[0]")]),e._v(" and "),o("code",[e._v("positions[1]")]),e._v(" of a potentially longer move. You cannot just test the next moves anyway because it will be rejected for sure. For it to be passed, the board would have to be updated first in the blockchain state.")])],1),e._v(" "),o("li",[o("p",[e._v("Declare another extension method, this time for "),o("code",[e._v("CheckersSigningStargateClient")]),e._v(", to actually make the move with parameters as they are given in the GUI components:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-typescript",base64:"ICAgIGRlY2xhcmUgbW9kdWxlICZxdW90Oy4uLy4uL2NoZWNrZXJzX3NpZ25pbmdzdGFyZ2F0ZWNsaWVudCZxdW90OyB7CiAgICAgICAgaW50ZXJmYWNlIENoZWNrZXJzU2lnbmluZ1N0YXJnYXRlQ2xpZW50IHsKICAgICAgICAgICAgLi4uCisgICAgICAgICAgcGxheUd1aU1vdmVzKGNyZWF0b3I6IHN0cmluZywgZ2FtZUluZGV4OiBzdHJpbmcsIHBvc2l0aW9uczogbnVtYmVyW11bXSk6IFByb21pc2UmbHQ7KFBvcyB8IHVuZGVmaW5lZClbXSZndDsKICAgICAgICB9CiAgICB9Cg==",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/types/checkers/extensions-gui.ts#L29"}}),e._v(" "),o("p",[e._v("It returns the captured pieces. Now define it:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"Q2hlY2tlcnNTaWduaW5nU3RhcmdhdGVDbGllbnQucHJvdG90eXBlLnBsYXlHdWlNb3ZlcyA9IGFzeW5jIGZ1bmN0aW9uICgKICAgIGNyZWF0b3I6IHN0cmluZywKICAgIGdhbWVJbmRleDogc3RyaW5nLAogICAgcG9zaXRpb25zOiBudW1iZXJbXVtdLAopOiBQcm9taXNlJmx0OyhQb3MgfCB1bmRlZmluZWQpW10mZ3Q7IHsKICAgIGNvbnN0IHBsYXlNb3ZlTXNnTGlzdDogTXNnUGxheU1vdmVFbmNvZGVPYmplY3RbXSA9IHBvc2l0aW9ucwogICAgICAgIC5zbGljZSgwLCBwb3NpdGlvbnMubGVuZ3RoIC0gMSkKICAgICAgICAubWFwKChwb3NpdGlvbjogbnVtYmVyW10sIGluZGV4OiBudW1iZXIpID0mZ3Q7IHsKICAgICAgICAgICAgY29uc3QgZnJvbTogUG9zID0gZ3VpUG9zaXRpb25Ub1Bvcyhwb3NpdGlvbikKICAgICAgICAgICAgY29uc3QgdG86IFBvcyA9IGd1aVBvc2l0aW9uVG9Qb3MocG9zaXRpb25zW2luZGV4ICsgMV0pCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICB0eXBlVXJsOiB0eXBlVXJsTXNnUGxheU1vdmUsCiAgICAgICAgICAgICAgICB2YWx1ZTogewogICAgICAgICAgICAgICAgICAgIGNyZWF0b3I6IGNyZWF0b3IsCiAgICAgICAgICAgICAgICAgICAgZ2FtZUluZGV4OiBnYW1lSW5kZXgsCiAgICAgICAgICAgICAgICAgICAgZnJvbVg6IExvbmcuZnJvbU51bWJlcihmcm9tLngpLAogICAgICAgICAgICAgICAgICAgIGZyb21ZOiBMb25nLmZyb21OdW1iZXIoZnJvbS55KSwKICAgICAgICAgICAgICAgICAgICB0b1g6IExvbmcuZnJvbU51bWJlcih0by54KSwKICAgICAgICAgICAgICAgICAgICB0b1k6IExvbmcuZnJvbU51bWJlcih0by55KSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0KICAgICAgICB9KQogICAgY29uc3QgcmVzdWx0OiBEZWxpdmVyVHhSZXNwb25zZSA9IGF3YWl0IHRoaXMuc2lnbkFuZEJyb2FkY2FzdChjcmVhdG9yLCBwbGF5TW92ZU1zZ0xpc3QsICZxdW90O2F1dG8mcXVvdDspCiAgICBjb25zdCBsb2dzOiBMb2dbXSA9IEpTT04ucGFyc2UocmVzdWx0LnJhd0xvZyEpCiAgICByZXR1cm4gbG9ncy5tYXAoKGxvZzogTG9nKSA9Jmd0OyBnZXRDYXB0dXJlZFBvcyhnZXRNb3ZlUGxheWVkRXZlbnQobG9nKSEpKQp9Cg==",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/types/checkers/extensions-gui.ts#L74-L99"}}),e._v(" "),o("HighlightBox",{attrs:{type:"note"}},[o("p",[e._v("Note how it maps from the positions array except for the last position. This is to take the "),o("em",[e._v("moves")]),e._v(" out of the "),o("em",[e._v("positions")]),e._v(".")])])],1)]),e._v(" "),o("p",[e._v("With this done:")]),e._v(" "),o("ol",[o("li",[o("p",[e._v("Repeat in "),o("code",[e._v("GameContainer")]),e._v(" what you did in "),o("code",[e._v("NewGameModal")]),e._v(":")]),e._v(" "),o("ol",[o("li",[e._v("Keep a "),o("a",{attrs:{href:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/components/Game/GameContainer.tsx#L40-L41",target:"_blank",rel:"noopener noreferrer"}},[e._v("signing client and "),o("code",[e._v("creator")]),o("OutboundLink")],1),e._v(" in the component's state.")]),e._v(" "),o("li",[o("a",{attrs:{href:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/components/Game/GameContainer.tsx#L63-L64",target:"_blank",rel:"noopener noreferrer"}},[e._v("Initialize"),o("OutboundLink")],1),e._v(" it in the constructor.")]),e._v(" "),o("li",[e._v("Add "),o("a",{attrs:{href:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/components/Game/GameContainer.tsx#L22-L25",target:"_blank",rel:"noopener noreferrer"}},[e._v("a tuple"),o("OutboundLink")],1),e._v(".")]),e._v(" "),o("li",[e._v("Add a method to "),o("a",{attrs:{href:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/components/Game/GameContainer.tsx#L122-L145",target:"_blank",rel:"noopener noreferrer"}},[e._v("lazily instantiate it"),o("OutboundLink")],1),e._v(".")])])]),e._v(" "),o("li",[o("p",[e._v("Change the declaration of "),o("code",[e._v("makeMove")]),e._v(" to make it "),o("code",[e._v("async")]),e._v(":")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"cHVibGljIGFzeW5jIG1ha2VNb3ZlKCk6IFByb21pc2UmbHQ7dm9pZCZndDsK",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/components/Game/GameContainer.tsx#L202"}})],1),e._v(" "),o("li",[o("p",[e._v("In "),o("code",[e._v("makeMove")]),e._v(" make sure that the move is likely to be accepted immediately after the existing code that extracts the move. It uses the read-only "),o("code",[e._v("StargateClient")]),e._v(", which allows players to look around without being asked to disclose their address:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"Y29uc3QgcG9zaXRpb25zOiBQb3NpdGlvbltdID0ga2V5cy5tYXAoKGs6IHN0cmluZyk6IFBvc2l0aW9uID0mZ3Q7IGsuc3BsaXQoJnF1b3Q7LCZxdW90OykubWFwKE51bWJlcikgYXMgUG9zaXRpb24pCgpjb25zdCBjbGllbnQgPSBhd2FpdCB0aGlzLmdldFN0YXJnYXRlQ2xpZW50KCkKY29uc3QgY2FuUGxheU9yTm90ID0gYXdhaXQgY2xpZW50LmNhblBsYXlHdWlNb3ZlKAogICAgdGhpcy5wcm9wcy5pbmRleCwKICAgIHRoaXMuc3RhdGUuYm9hcmQuY3VycmVudF9wbGF5ZXIsCiAgICBwb3NpdGlvbnMsCikKaWYgKCFjYW5QbGF5T3JOb3QucG9zc2libGUpIHsKICAgIGNvbnN0IGVycm9yID0gYENhbm5vdCBtYWtlIHRoaXMgbW92ZSAke2NhblBsYXlPck5vdC5yZWFzb259YAogICAgYWxlcnQoZXJyb3IpCiAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3IpCn0K",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/components/Game/GameContainer.tsx#L211-L223"}}),e._v(" "),o("HighlightBox",{attrs:{type:"note"}},[o("p",[e._v("The move test is made with the "),o("em",[e._v("read-only")]),e._v(" client. This is so that your users can poke around without connecting for as long as possible.")])])],1),e._v(" "),o("li",[o("p",[e._v("With this partial assurance, you can make an actual move:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"Y29uc3QgeyBjcmVhdG9yLCBzaWduaW5nQ2xpZW50IH0gPSBhd2FpdCB0aGlzLmdldFNpZ25pbmdTdGFyZ2F0ZUNsaWVudCgpCmF3YWl0IHNpZ25pbmdDbGllbnQucGxheUd1aU1vdmVzKGNyZWF0b3IsIHRoaXMucHJvcHMuaW5kZXgsIHBvc2l0aW9ucykuY2F0Y2goKGUpID0mZ3Q7IHsKICAgICAgICBjb25zb2xlLmVycm9yKGUpCiAgICAgICAgYWxlcnQoJnF1b3Q7RmFpbGVkIHRvIHBsYXk6ICZxdW90OyArIGUpCiAgICB9KQo=",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/components/Game/GameContainer.tsx#L225-L229"}}),e._v(" "),o("HighlightBox",{attrs:{type:"note"}},[o("p",[e._v("The assurance is "),o("strong",[e._v("partial")]),e._v(" because what was tested with "),o("code",[e._v("canPlayGuiMove")]),e._v(" is whether a player of a certain color can make a move or not. When making the move, it takes the Keplr address without cross-checking whether this is indeed the address of the colored player that tested a move. This "),o("strong",[e._v("could be improved")]),e._v(" either at the cost of another call to get the game, or better by adding the black and red addresses in the component's status.")])]),e._v(" "),o("p",[e._v("The remaining code of the "),o("code",[e._v("makeMove")]),e._v(" method can be deleted.")])],1),e._v(" "),o("li",[o("p",[e._v("Finish with a reload of the game to show its new state:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"typescript",base64:"Y29uc3Qgc2VsZWN0ZWQgPSBPYmplY3QuY3JlYXRlKG51bGwpCnRoaXMuc2V0U3RhdGUoeyBzZWxlY3RlZCB9KQpyZXR1cm4gdGhpcy5sb2FkR2FtZSgpOwo=",url:"https://github.com/cosmos/academy-checkers-ui/blob/gui/src/components/Game/GameContainer.tsx#L233-L235"}}),e._v(" "),o("HighlightBox",{attrs:{type:"tip"}},[o("p",[e._v("There is a potentially hard-to-reproduce-in-production "),o("strong",[e._v("race condition")]),e._v(" bug here. The "),o("code",[e._v("loadGame")]),e._v(" is done immediately after the transaction has completed. However, depending on the implementation of the RPC endpoint, the "),o("code",[e._v("playGuiMoves")]),e._v(" and "),o("code",[e._v("loadGame")]),e._v(" calls may hit two different servers on the backend. In some instances, the server that answers your "),o("code",[e._v("loadGame")]),e._v(" may not have fully updated its store and may in fact serve you the "),o("strong",[e._v("old")]),e._v(" version of your game.\n"),o("br"),o("br"),e._v("\nAs your GUI matures, you may want to show the "),o("em",[e._v("expected")]),e._v(" state of the game before you eventually show its "),o("em",[e._v("finalized")]),e._v(" state. Sometimes you may want to show the expected state of the game even before the transaction has completed, and add visual cues hinting at the fact that it is a "),o("strong",[e._v("provisional")]),e._v(" state.\n"),o("br"),o("br"),e._v("\nThe same can happen when creating a game, where the second server may return "),o("code",[e._v("null")]),e._v(" if it has not been updated yet.")])])],1)]),e._v(" "),o("p",[e._v("Now you can play test in the GUI. Make sure to put your Keplr address as the black player, so that you start with this one. You will need a second account on Keplr with which to play red, otherwise you must play red from the command line. Alternatively, put the same Keplr address for both black and red.")]),e._v(" "),o("p",[e._v("Either way, it is now possible to play the game from the GUI. Congratulations!")]),e._v(" "),o("p",[e._v("If you started the chain in Docker, when you are done you can stop the containers with:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgc3RvcCBjb3Ntb3MtZmF1Y2V0IGNoZWNrZXJzCiQgZG9ja2VyIG5ldHdvcmsgcm0gY2hlY2tlcnMtbmV0Cg=="}}),e._v(" "),o("h2",{attrs:{id:"further-exercise-ideas"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#further-exercise-ideas"}},[e._v("#")]),e._v(" Further exercise ideas")]),e._v(" "),o("ul",[o("li",[e._v("Add pagination to the game list.")]),e._v(" "),o("li",[e._v("Implement typical GUI features, like disabling buttons when their action should be unavailable, or adding a countdown to the forfeit deadline.")]),e._v(" "),o("li",[e._v("Implement a Web socket to listen to changes. That would be useful when there are two players who cannot communicate otherwise (instead of polling).")])]),e._v(" "),o("HighlightBox",{attrs:{type:"synopsis"}},[o("p",[e._v("To summarize, this section has explored:")]),e._v(" "),o("ul",[o("li",[e._v("How to prepare for and then integrate CosmJS and Keplr into the GUI of your checkers blockchain, including how to adjust the React app to be able to package CosmJS.")]),e._v(" "),o("li",[e._v("How to integrate CosmJS, including working with the GUI's data structures, fetching games from the blockchain and displaying them, integrating with Keplr for browser-based players, creating a new game, and fetching a single game to be played.")])])])],1)}),[],!1,null,null,null);t.default=s.exports}}]);