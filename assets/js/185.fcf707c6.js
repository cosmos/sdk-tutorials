(window.webpackJsonp=window.webpackJsonp||[]).push([[185],{801:function(e,t,o){"use strict";o.r(t);var a=o(1),r=Object(a.a)({},(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[o("h1",{attrs:{id:"prepare-a-validator-and-keys"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#prepare-a-validator-and-keys"}},[e._v("#")]),e._v(" Prepare a Validator and Keys")]),e._v(" "),o("p",[e._v("In the "),o("RouterLink",{attrs:{to:"/tutorials/9-path-to-prod/2-software.html"}},[e._v("previous section")]),e._v(", you prepared a binary for your nodes. Some of your nodes will be validators. To propose and sign blocks, validators need ongoing access to important private keys. A regular node does not need such important keys.")],1),e._v(" "),o("p",[e._v("Here you learn how to prepare a validator and handle its keys. This works whether you are preparing a validator to join a preexisting network, or you are setting up your validator to be part of the "),o("RouterLink",{attrs:{to:"/tutorials/9-path-to-prod/4-genesis.html"}},[e._v("genesis")]),e._v(".")],1),e._v(" "),o("h2",{attrs:{id:"private-key-security-considerations"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#private-key-security-considerations"}},[e._v("#")]),e._v(" Private key security considerations")]),e._v(" "),o("p",[e._v("More precisely than needing ongoing access to private keys, validators only need the capability to sign blocks on an ongoing basis. There is a security difference between access to the private key and access to a signing facility:")]),e._v(" "),o("ol",[o("li",[e._v("When your validator has access to the private key, if your validator node has been compromised then your private key is too, and you are at the risk of wrongfully signing malicious blocks "),o("strong",[e._v("forever")]),e._v(".")]),e._v(" "),o("li",[e._v("On the other hand, when you only provide a signing "),o("em",[e._v("service")]),e._v(" to your validator, if your validator node has been compromised then you are "),o("em",[e._v("only")]),e._v(" at the risk of wrongfully signing malicious blocks "),o("strong",[e._v("for as long as the signing service is up")]),e._v(".")])]),e._v(" "),o("p",[e._v("In order to mitigate the danger of "),o("strong",[e._v("point 1")]),e._v(", you can keep your private key in a "),o("a",{attrs:{href:"https://hub.cosmos.network/main/validators/validator-faq.html#how-to-handle-key-management",target:"_blank",rel:"noopener noreferrer"}},[e._v("hardware security module"),o("OutboundLink")],1),e._v(" (a.k.a. HSM), from which it can be retrieved only once, during the HSM's offline setup. This HSM device then remains plugged into the computer that runs the validator or the signing service. See "),o("a",{attrs:{href:"https://hub.cosmos.network/main/validators/security.html#key-management-hsm",target:"_blank",rel:"noopener noreferrer"}},[e._v("here"),o("OutboundLink")],1),e._v(" for the current list of supported devices. To use an HSM you own, you need physical access to the computer into which you plug it.")]),e._v(" "),o("p",[e._v("To implement "),o("strong",[e._v("point 2")]),e._v(", you can use a specialized "),o("a",{attrs:{href:"https://hub.cosmos.network/main/validators/kms/kms.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("key management system"),o("OutboundLink")],1),e._v(" (KMS). This runs on a computer separate from your validator node but has access to the hardware key and "),o("a",{attrs:{href:"https://github.com/iqlusioninc/tmkms/blob/v0.12.2/README.txsigner.md#architecture",target:"_blank",rel:"noopener noreferrer"}},[e._v("contacts your  validator node(s) over the private network"),o("OutboundLink")],1),e._v(" (or is contacted by your validator node(s)) for the purpose of signing blocks. Such a KMS is specialized in the sense that it is, for instance, able to detect attempts to sign two different blocks at the same height.")]),e._v(" "),o("p",[e._v("You can combine these strategies. For instance, if you insist on using an HSM and having your validator node located in the cloud, you can run the KMS on the computer the HSM is physically plugged into, which dials into your remote validator node to provide the signing service.")]),e._v(" "),o("h2",{attrs:{id:"what-validator-keys"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#what-validator-keys"}},[e._v("#")]),e._v(" What validator keys")]),e._v(" "),o("p",[e._v("A validator handles "),o("a",{attrs:{href:"https://hub.cosmos.network/main/validators/validator-faq.html#what-are-the-different-types-of-keys",target:"_blank",rel:"noopener noreferrer"}},[e._v("two"),o("OutboundLink")],1),e._v(", perhaps three, different keys. Each has a different purpose:")]),e._v(" "),o("ol",[o("li",[e._v("The "),o("strong",[e._v("Tendermint consensus key")]),e._v(" is used to sign blocks on an ongoing basis. It is of the key type "),o("code",[e._v("ed25519")]),e._v(", which the KMS can keep. When Bech-encoded, the address is prefixed with "),o("code",[e._v("cosmosvalcons")]),e._v(" and the public key is prefixed with "),o("code",[e._v("cosmosvalconspub")]),e._v(".")]),e._v(" "),o("li",[e._v("The "),o("strong",[e._v("validator operator application key")]),e._v(" is used to create transactions that create or modify validator parameters. It is of type "),o("code",[e._v("secp256k1")]),e._v(", or whichever type the application supports. When Bech-encoded, the address is prefixed with "),o("code",[e._v("cosmosvaloper")]),e._v(".")]),e._v(" "),o("li",[e._v("The "),o("a",{attrs:{href:"https://hub.cosmos.network/main/validators/validator-faq.html#are-validators-required-to-self-delegate-atom",target:"_blank",rel:"noopener noreferrer"}},[o("strong",[e._v("delegator application key")]),o("OutboundLink")],1),e._v(" is used to handle the stake that gives the validator more weight. When Bech-encoded, the address is prefixed with "),o("code",[e._v("cosmos")]),e._v(" and the public key is prefixed with "),o("code",[e._v("cosmospub")]),e._v(".")])]),e._v(" "),o("p",[e._v("Most likely keys 2 and 3 "),o("a",{attrs:{href:"https://github.com/cosmos/cosmos-sdk/blob/v0.46.1/proto/cosmos/staking/v1beta1/tx.proto#L45-L47",target:"_blank",rel:"noopener noreferrer"}},[e._v("are the same"),o("OutboundLink")],1),e._v(" when you are a node operator.")]),e._v(" "),o("h2",{attrs:{id:"hot-and-cold-keys"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#hot-and-cold-keys"}},[e._v("#")]),e._v(" Hot and cold keys")]),e._v(" "),o("p",[e._v("To touch on a point of vocabulary, the Tendermint consensus key can be considered "),o("strong",[e._v("hot")]),e._v(", in that it can and must produce valid signatures at any time. Even when safely housed in an HSM, this key is considered hot because it is usable immediately by your computers. This is a higher security risk compared to "),o("strong",[e._v("cold")]),e._v(" keys, which are kept out of a networked computer altogether, or at least require human approval before being accessed (like an HSM device stored in your desk drawer).")]),e._v(" "),o("p",[e._v("Your validator operator and potential delegator keys should be "),o("strong",[e._v("cold")]),e._v(".")]),e._v(" "),o("h2",{attrs:{id:"workflow-security-considerations"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#workflow-security-considerations"}},[e._v("#")]),e._v(" Workflow security considerations")]),e._v(" "),o("p",[e._v("Besides private key security, your validator should work as intended in a world where computers crash and networks get congested. Failing to address these eventualities could cost a portion of the stakes of you and your delegators. How much depends on certain "),o("a",{attrs:{href:"https://docs.cosmos.network/v0.46/modules/slashing/08_params.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("configured genesis parameters"),o("OutboundLink")],1),e._v(" of the network.")]),e._v(" "),o("p",[e._v("There are two main honest-mistake pitfalls:")]),e._v(" "),o("ol",[o("li",[e._v("Your validator fails in signing or proposing blocks. This can happen if:\n"),o("ul",[o("li",[e._v("Your computer is offline for too long.")]),e._v(" "),o("li",[e._v("Your computer does not receive updates in time.")])])]),e._v(" "),o("li",[e._v("Your validator wrongfully signs two valid blocks of the same height. This can happen if:\n"),o("ul",[o("li",[e._v("You have a misconfigured failover validator.")]),e._v(" "),o("li",[e._v("You have two computers using the same key.")])])])]),e._v(" "),o("p",[e._v("To address "),o("strong",[e._v("point 1")]),e._v(", this sounds like an issue about keeping your computer running and your networks in good shape. There is an added difficulty, though. Because your validator participates in a public network, its address can be "),o("a",{attrs:{href:"https://hub.cosmos.network/main/validators/validator-faq.html#how-can-validators-protect-themselves-from-denial-of-service-attacks",target:"_blank",rel:"noopener noreferrer"}},[e._v("discovered and attacked"),o("OutboundLink")],1),e._v(". To mitigate this risk, you can for instance use a "),o("RouterLink",{attrs:{to:"/tutorials/9-path-to-prod/5-network.html#ddos"}},[e._v("sentry node architecture")]),e._v(" so your validator node is only accessible through private networks, and a number of regular public-facing nodes connect to the network at large and your validator over the private network. These sentry nodes can be placed on the cloud and only relay over the gossip network. You can safely shut them down (not all of them, of course) or start up more. Your sentries should not disclose your validator's address to the P2P network. As an additional feature, if you absolutely trust a few other nodes, you can have your node connect to those directly over a private network.")],1),e._v(" "),o("p",[e._v("To address "),o("strong",[e._v("point 2")]),e._v(", this is where your use of the specialized KMS application that sits between your validator and your HSM can help. This application handles strictly one process at a time and stores the latest signed blocks so that it can detect any attempt at double-signing.")]),e._v(" "),o("p",[e._v("Without such a KMS, you must ensure that only one of your computers signs blocks at a time. In particular, be wary if you adopt an aggressive computer restart policy.")]),e._v(" "),o("h2",{attrs:{id:"key-generation"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#key-generation"}},[e._v("#")]),e._v(" Key generation")]),e._v(" "),o("p",[e._v("Now, take a closer look at generating keys, a consensus and an app key.")]),e._v(" "),o("h3",{attrs:{id:"consensus-key"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#consensus-key"}},[e._v("#")]),e._v(" Consensus key")]),e._v(" "),o("p",[e._v("When you run the standard "),o("code",[e._v("simd init")]),e._v(" command, it creates a default Tendermint consensus key on disk at path "),o("a",{attrs:{href:"https://docs.cosmos.network/main/run-node/run-node.html#initialize-the-chain",target:"_blank",rel:"noopener noreferrer"}},[o("code",[e._v("~/.simapp/config/priv_validator_key.json")]),o("OutboundLink")],1),e._v(". This is convenient if you are starting a testnet, for which the security requirements are low. However, for a more valuable network, you should delete this file to avoid using it by mistake, or "),o("a",{attrs:{href:"https://github.com/iqlusioninc/tmkms/blob/v0.12.2/README.txsigner.md#architecture",target:"_blank",rel:"noopener noreferrer"}},[e._v("import it"),o("OutboundLink")],1),e._v(" into the KMS and then delete it if that is your choice.")]),e._v(" "),o("p",[e._v("To use CometBFT's KMS follow the instructions "),o("a",{attrs:{href:"https://hub.cosmos.network/main/validators/kms/kms.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("here"),o("OutboundLink")],1),e._v(", or how it is applied in the "),o("RouterLink",{attrs:{to:"/hands-on-exercise/4-run-in-prod/1-run-prod-docker.html"}},[e._v("checkers hands-on exercise")]),e._v(". When it is installed, configured, and running, you can ask it for its public key, which will be useful at the genesis stage. It has to be Protobuf JSON encoded, for instance:")],1),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"json",base64:"eyZxdW90O0B0eXBlJnF1b3Q7OiZxdW90Oy9jb3Ntb3MuY3J5cHRvLmVkMjU1MTkuUHViS2V5JnF1b3Q7LCZxdW90O2tleSZxdW90OzomcXVvdDtieWVmWC91S3BnVHN5cmNBWktybVlZb0ZpWEcwdG1UT09hSkZ6aU8zRCtFPSZxdW90O30K"}}),e._v(" "),o("p",[e._v("Note the "),o("code",[e._v("@")]),e._v(" in "),o("code",[e._v('"@type"')]),e._v(".")]),e._v(" "),o("h3",{attrs:{id:"app-key"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#app-key"}},[e._v("#")]),e._v(" App key")]),e._v(" "),o("p",[e._v("For this key, you can follow standard procedures for cold keys on your computer, in the model of "),o("code",[e._v("simd keys ...")]),e._v(".")]),e._v(" "),o("h2",{attrs:{id:"advertise"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#advertise"}},[e._v("#")]),e._v(" Advertise")]),e._v(" "),o("p",[e._v("With your keys set up, you want to eventually cover your validator costs, if not run a profitable business. Part of the equation is to have third-party token holders delegate to your validator so you can collect a commission from their share of the rewards. Also, given that only a limited number of validators can be in the validating pool, you have to increase the amount delegated to your validator in order to gain entry to said pool.")]),e._v(" "),o("p",[e._v("You want to make sure potential delegators can find your validator operator application key, and present your service in an attractive manner. It is highly specific to your chain and can be in dedicated Web 2.0 forums or purpose-built indexed websites.")]),e._v(" "),o("HighlightBox",{attrs:{type:"tip"}},[o("p",[e._v("If you would like to see how to apply what you've learned, you can go straight to the exercise in "),o("RouterLink",{attrs:{to:"/hands-on-exercise/4-run-in-prod/1-run-prod-docker.html"}},[e._v("Simulate production in Docker")]),e._v(" to start from scratch.")],1),e._v(" "),o("p",[e._v("More specifically, you can jump to:")]),e._v(" "),o("ul",[o("li",[o("RouterLink",{attrs:{to:"/hands-on-exercise/4-run-in-prod/1-run-prod-docker.html#keys"}},[e._v("Keys")]),e._v(", to see how to handle validator "),o("strong",[e._v("operator")]),e._v(" keys.")],1),e._v(" "),o("li",[o("RouterLink",{attrs:{to:"/hands-on-exercise/4-run-in-prod/1-run-prod-docker.html#prepare-the-kms"}},[e._v("Prepare the KMS")]),e._v(", to see how to handle validator "),o("strong",[e._v("consensus")]),e._v(" keys.")],1)])]),e._v(" "),o("HighlightBox",{attrs:{type:"synopsis"}},[o("p",[e._v("To summarize, this section has explored:")]),e._v(" "),o("ul",[o("li",[e._v("How to prepare keys for a validator, which needs to be able to sign blocks on an ongoing basis, and handle the validator's keys.")]),e._v(" "),o("li",[e._v("How to use a signing service so that the validator is able to perform its duties with the minimum risk of persistent or permanent compromise.")]),e._v(" "),o("li",[e._v("The benefits of using a hardware security module (HSM) to prevent a private key from being duplicated by a malicious actor.")]),e._v(" "),o("li",[e._v("The benefits of using a key management system (KMS) over a private network to create distance between the validator node and the keys used in validation.")]),e._v(" "),o("li",[e._v("The three types of keys involved: the Tendermint consensus key, the validator operator application key, and the delegator application key.")]),e._v(" "),o("li",[e._v('The difference between "hot" and "cold" keys.')]),e._v(" "),o("li",[e._v("The importance of addressing the potentially negative eventualities of practical networking.")])])])],1)}),[],!1,null,null,null);t.default=r.exports}}]);