(window.webpackJsonp=window.webpackJsonp||[]).push([[149],{765:function(e,a,t){"use strict";t.r(a);var g=t(1),c=Object(g.a)({},(function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"make-a-module-ibc-enabled"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#make-a-module-ibc-enabled"}},[e._v("#")]),e._v(" Make a Module IBC-Enabled")]),e._v(" "),t("p",[e._v("In this section, you will build a conceptual Cosmos SDK blockchain with one module: first as a regular module, and second as an IBC module. This will introduce you to what makes a module IBC-enabled.")]),e._v(" "),t("h2",{attrs:{id:"scaffold-a-leaderboard-chain"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#scaffold-a-leaderboard-chain"}},[e._v("#")]),e._v(" Scaffold a leaderboard chain")]),e._v(" "),t("p",[e._v("By now you should be familiar with scaffolding a chain with Ignite CLI. If not, check out the "),t("RouterLink",{attrs:{to:"/hands-on-exercise/1-ignite-cli/"}},[e._v("Create Your Own Chain")]),e._v(" chapter.")],1),e._v(" "),t("p",[e._v("To begin, scaffold a "),t("code",[e._v("leaderboard")]),e._v(" chain:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"bash",base64:"JCBpZ25pdGUgc2NhZmZvbGQgY2hhaW4gZ2l0aHViLmNvbS9jb3Ntb25hdXQvbGVhZGVyYm9hcmQK"}}),e._v(" "),t("p",[e._v("This creates a chain with "),t("code",[e._v("x/leaderboard")]),e._v(" as a regular SDK module.")]),e._v(" "),t("p",[e._v("Next, scaffold another chain (for example in another git branch), but this time add the "),t("code",[e._v("--no-module")]),e._v(" flag:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"bash",base64:"JCBpZ25pdGUgc2NhZmZvbGQgY2hhaW4gZ2l0aHViLmNvbS9jb3Ntb25hdXQvbGVhZGVyYm9hcmQgLS1uby1tb2R1bGUK"}}),e._v(" "),t("p",[e._v("Now add the "),t("code",[e._v("x/leaderboard")]),e._v(" module as an IBC module with the "),t("code",[e._v("--ibc")]),e._v(" flag:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"bash",base64:"JCBpZ25pdGUgc2NhZmZvbGQgbW9kdWxlIGxlYWRlcmJvYXJkIC0taWJjCg=="}}),e._v(" "),t("p",[e._v("The output you see on the terminal when the module has finished scaffolding already gives a sense of what has to be implemented to create an IBC module:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"bash",base64:"bW9kaWZ5IGFwcC9hcHAuZ28KbW9kaWZ5IHByb3RvL2xlYWRlcmJvYXJkL2dlbmVzaXMucHJvdG8KY3JlYXRlIHByb3RvL2xlYWRlcmJvYXJkL3BhY2tldC5wcm90bwptb2RpZnkgdGVzdHV0aWwva2VlcGVyL2xlYWRlcmJvYXJkLmdvCm1vZGlmeSB4L2xlYWRlcmJvYXJkL2dlbmVzaXMuZ28KY3JlYXRlIHgvbGVhZGVyYm9hcmQvbW9kdWxlX2liYy5nbwpjcmVhdGUgeC9sZWFkZXJib2FyZC90eXBlcy9ldmVudHNfaWJjLmdvCm1vZGlmeSB4L2xlYWRlcmJvYXJkL3R5cGVzL2dlbmVzaXMuZ28KbW9kaWZ5IHgvbGVhZGVyYm9hcmQvdHlwZXMva2V5cy5nbwo="}}),e._v(" "),t("HighlightBox",{attrs:{type:"warning"}},[t("p",[e._v("The code in this section was scaffolded with Ignite CLI v0.22.1. This version includes ibc-go v3 as a dependency, which has "),t("a",{attrs:{href:"https://github.com/cosmos/ibc-go/blob/143e5d85e9d2fc5fc2fc53adc42127a439ee2b79/RELEASES.md#stable-release-policy",target:"_blank",rel:"noopener noreferrer"}},[e._v("reached past end-of-life"),t("OutboundLink")],1),e._v(" and is no longer actively supported.")]),e._v(" "),t("p",[t("strong",[e._v("It is thus highly discouraged to deploy any code in production using ibc-go code scaffolded by Ignite CLI v0.22.1.")])]),e._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/cosmos/ibc-go/blob/main/RELEASES.md#stable-release-policy",target:"_blank",rel:"noopener noreferrer"}},[e._v("All actively supported versions of ibc-go"),t("OutboundLink")],1),e._v(" have reached past v3, so there may be some differences compared to the code in this section. For documentation on the latest version of ibc-go, please refer to the "),t("a",{attrs:{href:"https://ibc.cosmos.network/main/ibc/apps/apps.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("ibc-go docs"),t("OutboundLink")],1),e._v(".\n"),t("br"),t("br"),e._v("\nFor example, channel callbacks from v4 onwards now return a "),t("em",[e._v("version")]),e._v(" string next to an error:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAoaW0gSUJDTW9kdWxlKSBPbkNoYW5PcGVuSW5pdChjdHggc2RrLkNvbnRleHQsCiAgICBvcmRlciBjaGFubmVsdHlwZXMuT3JkZXIsCiAgICBjb25uZWN0aW9uSG9wcyBbXXN0cmluZywKICAgIHBvcnRJRCBzdHJpbmcsCiAgICBjaGFubmVsSUQgc3RyaW5nLAogICAgY2hhbm5lbENhcCAqY2FwYWJpbGl0eXR5cGVzLkNhcGFiaWxpdHksCiAgICBjb3VudGVycGFydHkgY2hhbm5lbHR5cGVzLkNvdW50ZXJwYXJ0eSwKICAgIHZlcnNpb24gc3RyaW5nLAopIChzdHJpbmcsIGVycm9yKSB7CiAgICAuLi4KICAgIHJldHVybiB2ZXJzaW9uLCBuaWwKfQo="}})],1),e._v(" "),t("p",[e._v("For a more detailed view, you can now compare both versions with a "),t("code",[e._v("git diff")]),e._v(".")]),e._v(" "),t("HighlightBox",{attrs:{type:"tip"}},[t("p",[e._v("To make use of "),t("code",[e._v("git diff")]),e._v("s to check the changes, be sure to commit between different (scaffolding) actions.")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBnaXQgZGlmZiAmbHQ7Y29tbWl0X2hhc2hfMSZndDsgJmx0O2NvbW1pdF9oYXNoXzImZ3Q7Cg=="}}),e._v(" "),t("p",[e._v("You can use git or GitHub to visualize the "),t("code",[e._v("git diff")]),e._v("s or alternatively use "),t("a",{attrs:{href:"https://diffy.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("diffy.org"),t("OutboundLink")],1),e._v(".")])],1),e._v(" "),t("h2",{attrs:{id:"ibc-application-module-requirements"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ibc-application-module-requirements"}},[e._v("#")]),e._v(" IBC application module requirements")]),e._v(" "),t("p",[e._v("What does Ignite CLI do behind the scenes when creating an IBC module for you? What do you need to implement if you want to upgrade a regular custom application module to an IBC-enabled module?")]),e._v(" "),t("p",[e._v("The required steps to implement can be found in the "),t("a",{attrs:{href:"https://ibc.cosmos.network/main/ibc/apps/apps.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("ibc-go docs"),t("OutboundLink")],1),e._v(". There you will find:")]),e._v(" "),t("HighlightBox",{attrs:{type:"info"}},[t("p",[t("strong",[e._v("To have your module interact over IBC you must:")])]),e._v(" "),t("ul",[t("li",[e._v("Implement the "),t("code",[e._v("IBCModule")]),e._v(" interface:\n"),t("ul",[t("li",[e._v("Channel (opening) handshake callbacks")]),e._v(" "),t("li",[e._v("Channel closing handshake callbacks")]),e._v(" "),t("li",[e._v("Packet callbacks")])])]),e._v(" "),t("li",[e._v("Bind to a port(s).")]),e._v(" "),t("li",[e._v("Add keeper methods.")]),e._v(" "),t("li",[e._v("Define your packet data and acknowledgement structs as well as how to encode/decode them.")]),e._v(" "),t("li",[e._v("Add a route to the IBC router.")])])]),e._v(" "),t("p",[e._v("Now take a look at the "),t("code",[e._v("git diff")]),e._v(" and see if you can recognize the steps listed above.")]),e._v(" "),t("h3",{attrs:{id:"implementing-the-ibcmodule-interface"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#implementing-the-ibcmodule-interface"}},[e._v("#")]),e._v(" Implementing the "),t("code",[e._v("IBCModule")]),e._v(" interface")]),e._v(" "),t("HighlightBox",{attrs:{type:"docs"}},[t("p",[e._v("For a full explanation, visit the "),t("a",{attrs:{href:"https://ibc.cosmos.network/main/ibc/apps/ibcmodule.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("ibc-go docs"),t("OutboundLink")],1),e._v(".")])]),e._v(" "),t("p",[e._v("The Cosmos SDK expects all IBC modules to implement the "),t("a",{attrs:{href:"https://github.com/cosmos/ibc-go/tree/main/modules/core/05-port/types/module.go",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("IBCModule")]),e._v(" interface"),t("OutboundLink")],1),e._v(". This interface contains all of the callbacks IBC expects modules to implement. This includes callbacks related to:")]),e._v(" "),t("ul",[t("li",[e._v("Channel handshake ("),t("code",[e._v("OnChanOpenInit")]),e._v(", "),t("code",[e._v("OnChanOpenTry")]),e._v(", "),t("code",[e._v("OnChanOpenAck")]),e._v(", and "),t("code",[e._v("OnChanOpenConfirm")]),e._v(")")]),e._v(" "),t("li",[e._v("Channel closing ("),t("code",[e._v("OnChanCloseInit")]),e._v(" and "),t("code",[e._v("OnChanCloseConfirm")]),e._v(")")]),e._v(" "),t("li",[e._v("Packets ("),t("code",[e._v("OnRecvPacket")]),e._v(", "),t("code",[e._v("OnAcknowledgementPacket")]),e._v(", and "),t("code",[e._v("OnTimeoutPacket")]),e._v(").")])]),e._v(" "),t("p",[e._v("Ignite CLI implements this in the file "),t("code",[e._v("x/leaderboard/module_ibc.go")]),e._v(".")]),e._v(" "),t("ExpansionPanel",{attrs:{title:"x/leaderboard/module_ibc.go"}},[t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gT25DaGFuT3BlbkluaXQgaW1wbGVtZW50cyB0aGUgSUJDTW9kdWxlIGludGVyZmFjZQpmdW5jIChhbSBBcHBNb2R1bGUpIE9uQ2hhbk9wZW5Jbml0KAogICAgY3R4IHNkay5Db250ZXh0LAogICAgb3JkZXIgY2hhbm5lbHR5cGVzLk9yZGVyLAogICAgY29ubmVjdGlvbkhvcHMgW11zdHJpbmcsCiAgICBwb3J0SUQgc3RyaW5nLAogICAgY2hhbm5lbElEIHN0cmluZywKICAgIGNoYW5DYXAgKmNhcGFiaWxpdHl0eXBlcy5DYXBhYmlsaXR5LAogICAgY291bnRlcnBhcnR5IGNoYW5uZWx0eXBlcy5Db3VudGVycGFydHksCiAgICB2ZXJzaW9uIHN0cmluZywKKSBlcnJvciB7CgogICAgLy8gUmVxdWlyZSBwb3J0SUQgaXMgdGhlIHBvcnRJRCBtb2R1bGUgaXMgYm91bmQgdG8KICAgIGJvdW5kUG9ydCA6PSBhbS5rZWVwZXIuR2V0UG9ydChjdHgpCiAgICBpZiBib3VuZFBvcnQgIT0gcG9ydElEIHsKICAgICAgICByZXR1cm4gc2RrZXJyb3JzLldyYXBmKHBvcnR0eXBlcy5FcnJJbnZhbGlkUG9ydCwgJnF1b3Q7aW52YWxpZCBwb3J0OiAlcywgZXhwZWN0ZWQgJXMmcXVvdDssIHBvcnRJRCwgYm91bmRQb3J0KQogICAgfQoKICAgIGlmIHZlcnNpb24gIT0gdHlwZXMuVmVyc2lvbiB7CiAgICAgICAgcmV0dXJuIHNka2Vycm9ycy5XcmFwZih0eXBlcy5FcnJJbnZhbGlkVmVyc2lvbiwgJnF1b3Q7Z290ICVzLCBleHBlY3RlZCAlcyZxdW90OywgdmVyc2lvbiwgdHlwZXMuVmVyc2lvbikKICAgIH0KCiAgICAvLyBDbGFpbSBjaGFubmVsIGNhcGFiaWxpdHkgcGFzc2VkIGJhY2sgYnkgSUJDIG1vZHVsZQogICAgaWYgZXJyIDo9IGFtLmtlZXBlci5DbGFpbUNhcGFiaWxpdHkoY3R4LCBjaGFuQ2FwLCBob3N0LkNoYW5uZWxDYXBhYmlsaXR5UGF0aChwb3J0SUQsIGNoYW5uZWxJRCkpOyBlcnIgIT0gbmlsIHsKICAgICAgICByZXR1cm4gZXJyCiAgICB9CgogICAgcmV0dXJuIG5pbAoKfQoKLy8gT25DaGFuT3BlblRyeSBpbXBsZW1lbnRzIHRoZSBJQkNNb2R1bGUgaW50ZXJmYWNlCmZ1bmMgKGFtIEFwcE1vZHVsZSkgT25DaGFuT3BlblRyeSgKICAgIGN0eCBzZGsuQ29udGV4dCwKICAgIG9yZGVyIGNoYW5uZWx0eXBlcy5PcmRlciwKICAgIGNvbm5lY3Rpb25Ib3BzIFtdc3RyaW5nLAogICAgcG9ydElELAogICAgY2hhbm5lbElEIHN0cmluZywKICAgIGNoYW5DYXAgKmNhcGFiaWxpdHl0eXBlcy5DYXBhYmlsaXR5LAogICAgY291bnRlcnBhcnR5IGNoYW5uZWx0eXBlcy5Db3VudGVycGFydHksCiAgICBjb3VudGVycGFydHlWZXJzaW9uIHN0cmluZywKKSAoc3RyaW5nLCBlcnJvcikgewoKICAgIC8vIFJlcXVpcmUgcG9ydElEIGlzIHRoZSBwb3J0SUQgbW9kdWxlIGlzIGJvdW5kIHRvCiAgICBib3VuZFBvcnQgOj0gYW0ua2VlcGVyLkdldFBvcnQoY3R4KQogICAgaWYgYm91bmRQb3J0ICE9IHBvcnRJRCB7CiAgICAgICAgcmV0dXJuICZxdW90OyZxdW90Oywgc2RrZXJyb3JzLldyYXBmKHBvcnR0eXBlcy5FcnJJbnZhbGlkUG9ydCwgJnF1b3Q7aW52YWxpZCBwb3J0OiAlcywgZXhwZWN0ZWQgJXMmcXVvdDssIHBvcnRJRCwgYm91bmRQb3J0KQogICAgfQoKICAgIGlmIGNvdW50ZXJwYXJ0eVZlcnNpb24gIT0gdHlwZXMuVmVyc2lvbiB7CiAgICAgICAgcmV0dXJuICZxdW90OyZxdW90Oywgc2RrZXJyb3JzLldyYXBmKHR5cGVzLkVyckludmFsaWRWZXJzaW9uLCAmcXVvdDtpbnZhbGlkIGNvdW50ZXJwYXJ0eSB2ZXJzaW9uOiBnb3Q6ICVzLCBleHBlY3RlZCAlcyZxdW90OywgY291bnRlcnBhcnR5VmVyc2lvbiwgdHlwZXMuVmVyc2lvbikKICAgIH0KCiAgICAvLyBNb2R1bGUgbWF5IGhhdmUgYWxyZWFkeSBjbGFpbWVkIGNhcGFiaWxpdHkgaW4gT25DaGFuT3BlbkluaXQgaW4gdGhlIGNhc2Ugb2YgY3Jvc3NpbmcgaGVsbG9zCiAgICAvLyAoaWUgY2hhaW5BIGFuZCBjaGFpbkIgYm90aCBjYWxsIENoYW5PcGVuSW5pdCBiZWZvcmUgb25lIG9mIHRoZW0gY2FsbHMgQ2hhbk9wZW5UcnkpCiAgICAvLyBJZiB0aGUgbW9kdWxlIGNhbiBhbHJlYWR5IGF1dGhlbnRpY2F0ZSB0aGUgY2FwYWJpbGl0eSB0aGVuIHRoZSBtb2R1bGUgYWxyZWFkeSBvd25zIGl0IHNvIHdlIGRvbid0IG5lZWQgdG8gY2xhaW0KICAgIC8vIE90aGVyd2lzZSwgdGhlIG1vZHVsZSBkb2VzIG5vdCBoYXZlIGNoYW5uZWwgY2FwYWJpbGl0eSBhbmQgd2UgbXVzdCBjbGFpbSBpdCBmcm9tIElCQwogICAgaWYgIWFtLmtlZXBlci5BdXRoZW50aWNhdGVDYXBhYmlsaXR5KGN0eCwgY2hhbkNhcCwgaG9zdC5DaGFubmVsQ2FwYWJpbGl0eVBhdGgocG9ydElELCBjaGFubmVsSUQpKSB7CiAgICAgICAgLy8gT25seSBjbGFpbSBjaGFubmVsIGNhcGFiaWxpdHkgcGFzc2VkIGJhY2sgYnkgSUJDIG1vZHVsZSBpZiB3ZSBkbyBub3QgYWxyZWFkeSBvd24gaXQKICAgICAgICBpZiBlcnIgOj0gYW0ua2VlcGVyLkNsYWltQ2FwYWJpbGl0eShjdHgsIGNoYW5DYXAsIGhvc3QuQ2hhbm5lbENhcGFiaWxpdHlQYXRoKHBvcnRJRCwgY2hhbm5lbElEKSk7IGVyciAhPSBuaWwgewogICAgICAgICAgICByZXR1cm4gJnF1b3Q7JnF1b3Q7LCBlcnIKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuIHR5cGVzLlZlcnNpb24sIG5pbAoKfQoKLy8gT25DaGFuT3BlbkFjayBpbXBsZW1lbnRzIHRoZSBJQkNNb2R1bGUgaW50ZXJmYWNlCmZ1bmMgKGFtIEFwcE1vZHVsZSkgT25DaGFuT3BlbkFjaygKICAgIGN0eCBzZGsuQ29udGV4dCwKICAgIHBvcnRJRCwKICAgIGNoYW5uZWxJRCBzdHJpbmcsCiAgICBfLAogICAgY291bnRlcnBhcnR5VmVyc2lvbiBzdHJpbmcsCikgZXJyb3IgewogICAgaWYgY291bnRlcnBhcnR5VmVyc2lvbiAhPSB0eXBlcy5WZXJzaW9uIHsKICAgICAgICByZXR1cm4gc2RrZXJyb3JzLldyYXBmKHR5cGVzLkVyckludmFsaWRWZXJzaW9uLCAmcXVvdDtpbnZhbGlkIGNvdW50ZXJwYXJ0eSB2ZXJzaW9uOiAlcywgZXhwZWN0ZWQgJXMmcXVvdDssIGNvdW50ZXJwYXJ0eVZlcnNpb24sIHR5cGVzLlZlcnNpb24pCiAgICB9CiAgICByZXR1cm4gbmlsCn0KCi8vIE9uQ2hhbk9wZW5Db25maXJtIGltcGxlbWVudHMgdGhlIElCQ01vZHVsZSBpbnRlcmZhY2UKZnVuYyAoYW0gQXBwTW9kdWxlKSBPbkNoYW5PcGVuQ29uZmlybSgKICAgIGN0eCBzZGsuQ29udGV4dCwKICAgIHBvcnRJRCwKICAgIGNoYW5uZWxJRCBzdHJpbmcsCikgZXJyb3IgewogICAgcmV0dXJuIG5pbAp9CgovLyBPbkNoYW5DbG9zZUluaXQgaW1wbGVtZW50cyB0aGUgSUJDTW9kdWxlIGludGVyZmFjZQpmdW5jIChhbSBBcHBNb2R1bGUpIE9uQ2hhbkNsb3NlSW5pdCgKICAgIGN0eCBzZGsuQ29udGV4dCwKICAgIHBvcnRJRCwKICAgIGNoYW5uZWxJRCBzdHJpbmcsCikgZXJyb3IgewogICAgLy8gRGlzYWxsb3cgdXNlci1pbml0aWF0ZWQgY2hhbm5lbCBjbG9zaW5nIGZvciBjaGFubmVscwogICAgcmV0dXJuIHNka2Vycm9ycy5XcmFwKHNka2Vycm9ycy5FcnJJbnZhbGlkUmVxdWVzdCwgJnF1b3Q7dXNlciBjYW5ub3QgY2xvc2UgY2hhbm5lbCZxdW90OykKfQoKLy8gT25DaGFuQ2xvc2VDb25maXJtIGltcGxlbWVudHMgdGhlIElCQ01vZHVsZSBpbnRlcmZhY2UKZnVuYyAoYW0gQXBwTW9kdWxlKSBPbkNoYW5DbG9zZUNvbmZpcm0oCiAgICBjdHggc2RrLkNvbnRleHQsCiAgICBwb3J0SUQsCiAgICBjaGFubmVsSUQgc3RyaW5nLAopIGVycm9yIHsKICAgIHJldHVybiBuaWwKfQoKLy8gT25SZWN2UGFja2V0IGltcGxlbWVudHMgdGhlIElCQ01vZHVsZSBpbnRlcmZhY2UKZnVuYyAoYW0gQXBwTW9kdWxlKSBPblJlY3ZQYWNrZXQoCiAgICBjdHggc2RrLkNvbnRleHQsCiAgICBtb2R1bGVQYWNrZXQgY2hhbm5lbHR5cGVzLlBhY2tldCwKICAgIHJlbGF5ZXIgc2RrLkFjY0FkZHJlc3MsCikgaWJjZXhwb3J0ZWQuQWNrbm93bGVkZ2VtZW50IHsKICAgIHZhciBhY2sgY2hhbm5lbHR5cGVzLkFja25vd2xlZGdlbWVudAoKICAgIC8vIHRoaXMgbGluZSBpcyB1c2VkIGJ5IHN0YXJwb3J0IHNjYWZmb2xkaW5nICMgb3JhY2xlL3BhY2tldC9tb2R1bGUvcmVjdgoKICAgIHZhciBtb2R1bGVQYWNrZXREYXRhIHR5cGVzLkxlYWRlcmJvYXJkUGFja2V0RGF0YQogICAgaWYgZXJyIDo9IG1vZHVsZVBhY2tldERhdGEuVW5tYXJzaGFsKG1vZHVsZVBhY2tldC5HZXREYXRhKCkpOyBlcnIgIT0gbmlsIHsKICAgICAgICByZXR1cm4gY2hhbm5lbHR5cGVzLk5ld0Vycm9yQWNrbm93bGVkZ2VtZW50KHNka2Vycm9ycy5XcmFwZihzZGtlcnJvcnMuRXJyVW5rbm93blJlcXVlc3QsICZxdW90O2Nhbm5vdCB1bm1hcnNoYWwgcGFja2V0IGRhdGE6ICVzJnF1b3Q7LCBlcnIuRXJyb3IoKSkuRXJyb3IoKSkKICAgIH0KCiAgICAvLyBEaXNwYXRjaCBwYWNrZXQKICAgIHN3aXRjaCBwYWNrZXQgOj0gbW9kdWxlUGFja2V0RGF0YS5QYWNrZXQuKHR5cGUpIHsKICAgIC8vIHRoaXMgbGluZSBpcyB1c2VkIGJ5IHN0YXJwb3J0IHNjYWZmb2xkaW5nICMgaWJjL3BhY2tldC9tb2R1bGUvcmVjdgogICAgZGVmYXVsdDoKICAgICAgICBlcnJNc2cgOj0gZm10LlNwcmludGYoJnF1b3Q7dW5yZWNvZ25pemVkICVzIHBhY2tldCB0eXBlOiAlVCZxdW90OywgdHlwZXMuTW9kdWxlTmFtZSwgcGFja2V0KQogICAgICAgIHJldHVybiBjaGFubmVsdHlwZXMuTmV3RXJyb3JBY2tub3dsZWRnZW1lbnQoZXJyTXNnKQogICAgfQoKICAgIC8vIE5PVEU6IGFja25vd2xlZGdlbWVudCB3aWxsIGJlIHdyaXR0ZW4gc3luY2hyb25vdXNseSBkdXJpbmcgSUJDIGhhbmRsZXIgZXhlY3V0aW9uLgogICAgcmV0dXJuIGFjawoKfQoKLy8gT25BY2tub3dsZWRnZW1lbnRQYWNrZXQgaW1wbGVtZW50cyB0aGUgSUJDTW9kdWxlIGludGVyZmFjZQpmdW5jIChhbSBBcHBNb2R1bGUpIE9uQWNrbm93bGVkZ2VtZW50UGFja2V0KAogICAgY3R4IHNkay5Db250ZXh0LAogICAgbW9kdWxlUGFja2V0IGNoYW5uZWx0eXBlcy5QYWNrZXQsCiAgICBhY2tub3dsZWRnZW1lbnQgW11ieXRlLAogICAgcmVsYXllciBzZGsuQWNjQWRkcmVzcywKKSBlcnJvciB7CiAgICB2YXIgYWNrIGNoYW5uZWx0eXBlcy5BY2tub3dsZWRnZW1lbnQKICAgIGlmIGVyciA6PSB0eXBlcy5Nb2R1bGVDZGMuVW5tYXJzaGFsSlNPTihhY2tub3dsZWRnZW1lbnQsICZhbXA7YWNrKTsgZXJyICE9IG5pbCB7CiAgICAgICAgcmV0dXJuIHNka2Vycm9ycy5XcmFwZihzZGtlcnJvcnMuRXJyVW5rbm93blJlcXVlc3QsICZxdW90O2Nhbm5vdCB1bm1hcnNoYWwgcGFja2V0IGFja25vd2xlZGdlbWVudDogJXYmcXVvdDssIGVycikKICAgIH0KCiAgICAvLyB0aGlzIGxpbmUgaXMgdXNlZCBieSBzdGFycG9ydCBzY2FmZm9sZGluZyAjIG9yYWNsZS9wYWNrZXQvbW9kdWxlL2FjawoKICAgIHZhciBtb2R1bGVQYWNrZXREYXRhIHR5cGVzLkxlYWRlcmJvYXJkUGFja2V0RGF0YQogICAgaWYgZXJyIDo9IG1vZHVsZVBhY2tldERhdGEuVW5tYXJzaGFsKG1vZHVsZVBhY2tldC5HZXREYXRhKCkpOyBlcnIgIT0gbmlsIHsKICAgICAgICByZXR1cm4gc2RrZXJyb3JzLldyYXBmKHNka2Vycm9ycy5FcnJVbmtub3duUmVxdWVzdCwgJnF1b3Q7Y2Fubm90IHVubWFyc2hhbCBwYWNrZXQgZGF0YTogJXMmcXVvdDssIGVyci5FcnJvcigpKQogICAgfQoKICAgIHZhciBldmVudFR5cGUgc3RyaW5nCgogICAgLy8gRGlzcGF0Y2ggcGFja2V0CiAgICBzd2l0Y2ggcGFja2V0IDo9IG1vZHVsZVBhY2tldERhdGEuUGFja2V0Lih0eXBlKSB7CiAgICAvLyB0aGlzIGxpbmUgaXMgdXNlZCBieSBzdGFycG9ydCBzY2FmZm9sZGluZyAjIGliYy9wYWNrZXQvbW9kdWxlL2FjawogICAgZGVmYXVsdDoKICAgICAgICBlcnJNc2cgOj0gZm10LlNwcmludGYoJnF1b3Q7dW5yZWNvZ25pemVkICVzIHBhY2tldCB0eXBlOiAlVCZxdW90OywgdHlwZXMuTW9kdWxlTmFtZSwgcGFja2V0KQogICAgICAgIHJldHVybiBzZGtlcnJvcnMuV3JhcChzZGtlcnJvcnMuRXJyVW5rbm93blJlcXVlc3QsIGVyck1zZykKICAgIH0KCiAgICBjdHguRXZlbnRNYW5hZ2VyKCkuRW1pdEV2ZW50KAogICAgICAgIHNkay5OZXdFdmVudCgKICAgICAgICAgICAgZXZlbnRUeXBlLAogICAgICAgICAgICBzZGsuTmV3QXR0cmlidXRlKHNkay5BdHRyaWJ1dGVLZXlNb2R1bGUsIHR5cGVzLk1vZHVsZU5hbWUpLAogICAgICAgICAgICBzZGsuTmV3QXR0cmlidXRlKHR5cGVzLkF0dHJpYnV0ZUtleUFjaywgZm10LlNwcmludGYoJnF1b3Q7JXYmcXVvdDssIGFjaykpLAogICAgICAgICksCiAgICApCgogICAgc3dpdGNoIHJlc3AgOj0gYWNrLlJlc3BvbnNlLih0eXBlKSB7CiAgICBjYXNlICpjaGFubmVsdHlwZXMuQWNrbm93bGVkZ2VtZW50X1Jlc3VsdDoKICAgICAgICBjdHguRXZlbnRNYW5hZ2VyKCkuRW1pdEV2ZW50KAogICAgICAgICAgICBzZGsuTmV3RXZlbnQoCiAgICAgICAgICAgICAgICBldmVudFR5cGUsCiAgICAgICAgICAgICAgICBzZGsuTmV3QXR0cmlidXRlKHR5cGVzLkF0dHJpYnV0ZUtleUFja1N1Y2Nlc3MsIHN0cmluZyhyZXNwLlJlc3VsdCkpLAogICAgICAgICAgICApLAogICAgICAgICkKICAgIGNhc2UgKmNoYW5uZWx0eXBlcy5BY2tub3dsZWRnZW1lbnRfRXJyb3I6CiAgICAgICAgY3R4LkV2ZW50TWFuYWdlcigpLkVtaXRFdmVudCgKICAgICAgICAgICAgc2RrLk5ld0V2ZW50KAogICAgICAgICAgICAgICAgZXZlbnRUeXBlLAogICAgICAgICAgICAgICAgc2RrLk5ld0F0dHJpYnV0ZSh0eXBlcy5BdHRyaWJ1dGVLZXlBY2tFcnJvciwgcmVzcC5FcnJvciksCiAgICAgICAgICAgICksCiAgICAgICAgKQogICAgfQoKICAgIHJldHVybiBuaWwKCn0KCi8vIE9uVGltZW91dFBhY2tldCBpbXBsZW1lbnRzIHRoZSBJQkNNb2R1bGUgaW50ZXJmYWNlCmZ1bmMgKGFtIEFwcE1vZHVsZSkgT25UaW1lb3V0UGFja2V0KAogICAgY3R4IHNkay5Db250ZXh0LAogICAgbW9kdWxlUGFja2V0IGNoYW5uZWx0eXBlcy5QYWNrZXQsCiAgICByZWxheWVyIHNkay5BY2NBZGRyZXNzLAopIGVycm9yIHsKICAgIHZhciBtb2R1bGVQYWNrZXREYXRhIHR5cGVzLkxlYWRlcmJvYXJkUGFja2V0RGF0YQogICAgaWYgZXJyIDo9IG1vZHVsZVBhY2tldERhdGEuVW5tYXJzaGFsKG1vZHVsZVBhY2tldC5HZXREYXRhKCkpOyBlcnIgIT0gbmlsIHsKICAgICAgICByZXR1cm4gc2RrZXJyb3JzLldyYXBmKHNka2Vycm9ycy5FcnJVbmtub3duUmVxdWVzdCwgJnF1b3Q7Y2Fubm90IHVubWFyc2hhbCBwYWNrZXQgZGF0YTogJXMmcXVvdDssIGVyci5FcnJvcigpKQogICAgfQoKICAgIC8vIERpc3BhdGNoIHBhY2tldAogICAgc3dpdGNoIHBhY2tldCA6PSBtb2R1bGVQYWNrZXREYXRhLlBhY2tldC4odHlwZSkgewogICAgLy8gdGhpcyBsaW5lIGlzIHVzZWQgYnkgc3RhcnBvcnQgc2NhZmZvbGRpbmcgIyBpYmMvcGFja2V0L21vZHVsZS90aW1lb3V0CiAgICBkZWZhdWx0OgogICAgICAgIGVyck1zZyA6PSBmbXQuU3ByaW50ZigmcXVvdDt1bnJlY29nbml6ZWQgJXMgcGFja2V0IHR5cGU6ICVUJnF1b3Q7LCB0eXBlcy5Nb2R1bGVOYW1lLCBwYWNrZXQpCiAgICAgICAgcmV0dXJuIHNka2Vycm9ycy5XcmFwKHNka2Vycm9ycy5FcnJVbmtub3duUmVxdWVzdCwgZXJyTXNnKQogICAgfQoKICAgIHJldHVybiBuaWwKCn0K"}})],1),e._v(" "),t("p",[e._v("Additionally, in the "),t("code",[e._v("module.go")]),e._v(" file, add the following line (and the corresponding import):")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgdmFyICgKICAgICAgIF8gbW9kdWxlLkFwcE1vZHVsZSAgICAgID0gQXBwTW9kdWxle30KICAgICAgIF8gbW9kdWxlLkFwcE1vZHVsZUJhc2ljID0gQXBwTW9kdWxlQmFzaWN7fQogICAgICAgLy8gQWRkIHRoaXMgbGluZQorICAgICBfIHBvcnR0eXBlcy5JQkNNb2R1bGUgICA9IElCQ01vZHVsZXt9CiAgICkK"}}),e._v(" "),t("h4",{attrs:{id:"channel-handshake-version-negotiation"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#channel-handshake-version-negotiation"}},[e._v("#")]),e._v(" Channel handshake version negotiation")]),e._v(" "),t("p",[e._v("Application modules are expected to verify the versioning used during the channel handshake procedure:")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("OnChanOpenInit")]),e._v(" will verify that the relayer-chosen parameters are valid and perform any custom "),t("code",[e._v("INIT")]),e._v(" logic.\n"),t("ul",[t("li",[e._v("It may return an error if the chosen parameters are invalid, in which case the handshake is aborted. If the provided version string is non-empty, "),t("code",[e._v("OnChanOpenInit")]),e._v(" should return the version string if valid or an error if the provided version is invalid.")]),e._v(" "),t("li",[t("strong",[e._v("If the version string is empty, "),t("code",[e._v("OnChanOpenInit")]),e._v(" is expected to return a default version string representing the version(s) it supports.")]),e._v(" If there is no default version string for the application, it should return an error if the provided version is an empty string.")])])]),e._v(" "),t("li",[t("code",[e._v("OnChanOpenTry")]),e._v(" will verify the relayer-chosen parameters along with the counterparty-chosen version string and perform custom "),t("code",[e._v("TRY")]),e._v(" logic.\n"),t("ul",[t("li",[e._v("If the relayer-chosen parameters are invalid, the callback must return an error to abort the handshake. If the counterparty-chosen version is not compatible with this module's supported versions, the callback must return an error to abort the handshake.")]),e._v(" "),t("li",[e._v("If the versions are compatible, the try callback must select the final version string and return it to core IBC."),t("code",[e._v("OnChanOpenTry")]),e._v(" may also perform custom initialization logic.")])])]),e._v(" "),t("li",[t("code",[e._v("OnChanOpenAck")]),e._v(" will error if the counterparty selected version string is invalid and abort the handshake. It may also perform custom "),t("code",[e._v("ACK")]),e._v(" logic.")])]),e._v(" "),t("HighlightBox",{attrs:{type:"info"}},[t("p",[e._v("Versions must be strings but can implement any versioning structure. Often a simple template is used that combines the name of the application and an iteration number, like "),t("code",[e._v("leaderboard-1")]),e._v(" for the leaderboard IBC module.\n"),t("br"),t("br"),e._v("\nHowever, the version string can also include metadata to indicate attributes of the channel you are supporting, like applicable middleware and the underlying app version. An example of this is the version string for middleware, which is discussed in a "),t("RouterLink",{attrs:{to:"/hands-on-exercise/5-ibc-adv/11-ibc-mw-develop.html"}},[e._v("later section")]),e._v(".")],1)]),e._v(" "),t("h4",{attrs:{id:"packet-callbacks"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#packet-callbacks"}},[e._v("#")]),e._v(" Packet callbacks")]),e._v(" "),t("p",[e._v("The general application packet flow was discussed in "),t("a",{attrs:{href:"https://tutorials.cosmos.network/academy/3-ibc/3-channels.html#application-packet-flow",target:"_blank",rel:"noopener noreferrer"}},[e._v("a previous section"),t("OutboundLink")],1),e._v(". As a refresher, let's take a look at the diagram:")]),e._v(" "),t("p",[t("tm-image",{attrs:{src:"/hands-on-exercise/5-ibc-adv/images/packetflow.png"}})],1),e._v(" "),t("p",[e._v("The packet callbacks in the packet flow can now be identified by investigating the "),t("code",[e._v("IBCModule")]),e._v(" interface.")]),e._v(" "),t("h5",{attrs:{id:"sending-packets"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sending-packets"}},[e._v("#")]),e._v(" Sending packets")]),e._v(" "),t("p",[e._v("Modules "),t("strong",[e._v("do not send packets through callbacks")]),e._v(", since modules initiate the action of sending packets to the IBC module, as opposed to other parts of the packet flow where messages sent to the IBC module must trigger execution on the port-bound module through the use of callbacks. Thus, to send a packet a module simply needs to call "),t("code",[e._v("SendPacket")]),e._v(" on the "),t("code",[e._v("IBCChannelKeeper")]),e._v(".")]),e._v(" "),t("HighlightBox",{attrs:{type:"warning"}},[t("p",[e._v("In order to prevent modules from sending packets on channels they do not own, IBC expects modules to pass in the correct channel capability for the packet's source channel.")])]),e._v(" "),t("HighlightBox",{attrs:{type:"reading"}},[t("p",[e._v("For advanced readers, more on capabilities can be found in the "),t("a",{attrs:{href:"https://ibc.cosmos.network/main/ibc/overview.html#capabilities",target:"_blank",rel:"noopener noreferrer"}},[e._v("ibc-go docs"),t("OutboundLink")],1),e._v(" or the "),t("a",{attrs:{href:"https://github.com/cosmos/cosmos-sdk/blob/6aaf83c894e917836a047b0399dd70a95fd2710d/docs/architecture/adr-003-dynamic-capability-store.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("ADR on the Dynamic Capability Store"),t("OutboundLink")],1),e._v(".")])]),e._v(" "),t("h5",{attrs:{id:"receiving-packets"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#receiving-packets"}},[e._v("#")]),e._v(" Receiving packets")]),e._v(" "),t("p",[e._v("To handle receiving packets, the module must implement the "),t("code",[e._v("OnRecvPacket")]),e._v(" callback. This gets invoked by the IBC module after the packet has been proved valid and correctly processed by the IBC keepers. Thus, the "),t("code",[e._v("OnRecvPacket")]),e._v(" callback only needs to worry about making the appropriate state changes given the packet data without worrying about whether the packet is valid or not.")]),e._v(" "),t("p",[e._v("Modules may return to the IBC handler an acknowledgement which implements the "),t("code",[e._v("Acknowledgement")]),e._v(" interface. The IBC handler will then commit this acknowledgement of the packet so that a relayer may relay the acknowledgement back to the sender module.")]),e._v(" "),t("p",[e._v("The state changes that occurred during this callback will only be written if:")]),e._v(" "),t("ul",[t("li",[e._v("The acknowledgement was successful as indicated by the "),t("code",[e._v("Success()")]),e._v(" function of the acknowledgement.")]),e._v(" "),t("li",[e._v("The acknowledgement returned is nil, indicating that an asynchronous process is occurring.")])]),e._v(" "),t("HighlightBox",{attrs:{type:"note"}},[t("p",[e._v("Applications that process asynchronous acknowledgements must handle reverting state changes when appropriate. Any state changes that occurred during the "),t("code",[e._v("OnRecvPacket")]),e._v(" callback will be written for asynchronous acknowledgements.")])]),e._v(" "),t("p",[e._v("In "),t("code",[e._v("x/leaderboard/module_ibc.go")]),e._v(" scaffolded by Ignite CLI you find "),t("code",[e._v("OnRecvPacket")]),e._v(":")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gT25SZWN2UGFja2V0IGltcGxlbWVudHMgdGhlIElCQ01vZHVsZSBpbnRlcmZhY2UKZnVuYyAoYW0gQXBwTW9kdWxlKSBPblJlY3ZQYWNrZXQoCiAgICBjdHggc2RrLkNvbnRleHQsCiAgICBtb2R1bGVQYWNrZXQgY2hhbm5lbHR5cGVzLlBhY2tldCwKICAgIHJlbGF5ZXIgc2RrLkFjY0FkZHJlc3MsCikgaWJjZXhwb3J0ZWQuQWNrbm93bGVkZ2VtZW50IHsKICAgIHZhciBhY2sgY2hhbm5lbHR5cGVzLkFja25vd2xlZGdlbWVudAogICAgLy8gdGhpcyBsaW5lIGlzIHVzZWQgYnkgc3RhcnBvcnQgc2NhZmZvbGRpbmcgIyBvcmFjbGUvcGFja2V0L21vZHVsZS9yZWN2CiAgICB2YXIgbW9kdWxlUGFja2V0RGF0YSB0eXBlcy5MZWFkZXJib2FyZFBhY2tldERhdGEKICAgIC4uLgogICAgLy8gRGlzcGF0Y2ggcGFja2V0CiAgICBzd2l0Y2ggcGFja2V0IDo9IG1vZHVsZVBhY2tldERhdGEuUGFja2V0Lih0eXBlKSB7CiAgICAvLyB0aGlzIGxpbmUgaXMgdXNlZCBieSBzdGFycG9ydCBzY2FmZm9sZGluZyAjIGliYy9wYWNrZXQvbW9kdWxlL3JlY3YKICAgIGRlZmF1bHQ6CiAgICAgICAgZXJyTXNnIDo9IGZtdC5TcHJpbnRmKCZxdW90O3VucmVjb2duaXplZCAlcyBwYWNrZXQgdHlwZTogJVQmcXVvdDssIHR5cGVzLk1vZHVsZU5hbWUsIHBhY2tldCkKICAgICAgICByZXR1cm4gY2hhbm5lbHR5cGVzLk5ld0Vycm9yQWNrbm93bGVkZ2VtZW50KGVyck1zZykKICAgIH0KICAgIC8vIE5PVEU6IGFja25vd2xlZGdlbWVudCB3aWxsIGJlIHdyaXR0ZW4gc3luY2hyb25vdXNseSBkdXJpbmcgSUJDIGhhbmRsZXIgZXhlY3V0aW9uLgogICAgcmV0dXJuIGFjawp9Cg=="}}),e._v(" "),t("p",[e._v("The "),t("em",[e._v("dispatch packet")]),e._v(" switch statement is added by Ignite CLI. As it is stated in the docs, strictly speaking, you only need to decode the packet data (which is discussed in an upcoming section) and return the acknowledgement after processing the packet. However, the structure provided by Ignite CLI is useful to get set up but can be changed according to the preference of the developer.")]),e._v(" "),t("p",[e._v("As a reminder, this is the "),t("code",[e._v("Acknowledgement")]),e._v(" interface:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gQWNrbm93bGVkZ2VtZW50IGRlZmluZXMgdGhlIGludGVyZmFjZSB1c2VkIHRvIHJldHVybgovLyBhY2tub3dsZWRnZW1lbnRzIGluIHRoZSBPblJlY3ZQYWNrZXQgY2FsbGJhY2suCnR5cGUgQWNrbm93bGVkZ2VtZW50IGludGVyZmFjZSB7CiAgICBTdWNjZXNzKCkgYm9vbAogICAgQWNrbm93bGVkZ2VtZW50KCkgW11ieXRlCn0K"}}),e._v(" "),t("h5",{attrs:{id:"acknowledging-packets"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#acknowledging-packets"}},[e._v("#")]),e._v(" Acknowledging packets")]),e._v(" "),t("p",[e._v("The last step of the packet flow depends on whether you have a happy path, when the packet has been successfully relayed, or a timeout when something went wrong.")]),e._v(" "),t("p",[e._v("After a module writes an "),t("code",[e._v("Acknowledgement")]),e._v(", a relayer can relay it back to the sender module. The sender module can then process the acknowledgement using the "),t("code",[e._v("OnAcknowledgementPacket")]),e._v(" callback. The contents of the "),t("code",[e._v("Acknowledgement")]),e._v(" are entirely up to the modules on the channel (just like the packet data); however, it may often contain information on whether the packet was successfully processed, along with some additional data that could be useful for remediation if the packet processing failed.")]),e._v(" "),t("p",[e._v("Since the modules are responsible for agreeing on an encoding/decoding standard for packet data and acknowledgements, IBC will pass in the acknowledgements as "),t("code",[e._v("[]byte")]),e._v(" to this callback. The callback is responsible for decoding the acknowledgement and processing it.")]),e._v(" "),t("p",[e._v("In "),t("code",[e._v("x/leaderboard/module_ibc.go")]),e._v(" scaffolded by Ignite CLI you will find "),t("code",[e._v("OnAcknowledgementPacket")]),e._v(":")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gT25BY2tub3dsZWRnZW1lbnRQYWNrZXQgaW1wbGVtZW50cyB0aGUgSUJDTW9kdWxlIGludGVyZmFjZQpmdW5jIChhbSBBcHBNb2R1bGUpIE9uQWNrbm93bGVkZ2VtZW50UGFja2V0KAogICAgY3R4IHNkay5Db250ZXh0LAogICAgbW9kdWxlUGFja2V0IGNoYW5uZWx0eXBlcy5QYWNrZXQsCiAgICBhY2tub3dsZWRnZW1lbnQgW11ieXRlLAogICAgcmVsYXllciBzZGsuQWNjQWRkcmVzcywKKSBlcnJvciB7CiAgICB2YXIgYWNrIGNoYW5uZWx0eXBlcy5BY2tub3dsZWRnZW1lbnQKICAgIC4uLiAvL3ZhbGlkYXRpb24KICAgIC8vIHRoaXMgbGluZSBpcyB1c2VkIGJ5IHN0YXJwb3J0IHNjYWZmb2xkaW5nICMgb3JhY2xlL3BhY2tldC9tb2R1bGUvYWNrCiAgICB2YXIgbW9kdWxlUGFja2V0RGF0YSB0eXBlcy5MZWFkZXJib2FyZFBhY2tldERhdGEKICAgIC4uLiAvL3ZhbGlkYXRpb24KICAgIHZhciBldmVudFR5cGUgc3RyaW5nCiAgICAvLyBEaXNwYXRjaCBwYWNrZXQKICAgIHN3aXRjaCBwYWNrZXQgOj0gbW9kdWxlUGFja2V0RGF0YS5QYWNrZXQuKHR5cGUpIHsKICAgIC8vIHRoaXMgbGluZSBpcyB1c2VkIGJ5IHN0YXJwb3J0IHNjYWZmb2xkaW5nICMgaWJjL3BhY2tldC9tb2R1bGUvYWNrCiAgICBkZWZhdWx0OgogICAgICAgIC4uLiAvL2Vyck1zZwogICAgfQogICAgY3R4LkV2ZW50TWFuYWdlcigpLkVtaXRFdmVudCgKICAgICAgICBzZGsuTmV3RXZlbnQoCiAgICAgICAgICAgIC4uLgogICAgICAgICksCiAgICApCiAgICBzd2l0Y2ggcmVzcCA6PSBhY2suUmVzcG9uc2UuKHR5cGUpIHsKICAgIGNhc2UgKmNoYW5uZWx0eXBlcy5BY2tub3dsZWRnZW1lbnRfUmVzdWx0OgogICAgICAgIGN0eC5FdmVudE1hbmFnZXIoKS5FbWl0RXZlbnQoCiAgICAgICAgICAgIHNkay5OZXdFdmVudCgKICAgICAgICAgICAgICAgIC4uLgogICAgICAgICAgICApLAogICAgICAgICkKICAgIGNhc2UgKmNoYW5uZWx0eXBlcy5BY2tub3dsZWRnZW1lbnRfRXJyb3I6CiAgICAgICAgY3R4LkV2ZW50TWFuYWdlcigpLkVtaXRFdmVudCgKICAgICAgICAgICAgc2RrLk5ld0V2ZW50KAogICAgICAgICAgICAgICAgLi4uCiAgICAgICAgICAgICksCiAgICAgICAgKQogICAgfQogICAgcmV0dXJuIG5pbAp9Cg=="}}),e._v(" "),t("p",[e._v("Again, the structure to dispatch the packet with the switch statement as well as the switch statement for the ack (success case or error case) have been structured by Ignite CLI where the "),t("a",{attrs:{href:"https://ibc.cosmos.network/main/ibc/apps/ibcmodule.html#acknowledging-packets",target:"_blank",rel:"noopener noreferrer"}},[e._v("docs"),t("OutboundLink")],1),e._v(" offer more freedom to the developer to implement decoding and processing of the ack.")]),e._v(" "),t("HighlightBox",{attrs:{type:"info"}},[t("p",[e._v("The events that are being emitted are defined in "),t("code",[e._v("x/leaderboard/types/events_ibc.go")]),e._v(".")])]),e._v(" "),t("h5",{attrs:{id:"timing-out-packets"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#timing-out-packets"}},[e._v("#")]),e._v(" Timing out packets")]),e._v(" "),t("p",[e._v("If the timeout for a packet is reached before the packet is successfully received, or the counterparty channel end is closed before the packet is successfully received, then the receiving chain can no longer process it. Thus, the sending chain must process the timeout using "),t("code",[e._v("OnTimeoutPacket")]),e._v(" to handle this situation. Again the IBC module will verify that the timeout is indeed valid, so our module only needs to implement the state machine logic for what to do once a timeout is reached and the packet can no longer be received.")]),e._v(" "),t("p",[e._v("In "),t("code",[e._v("x/leaderboard/module_ibc.go")]),e._v(" scaffolded by Ignite CLI you will find "),t("code",[e._v("OnTimeoutPacket")]),e._v(":")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gT25UaW1lb3V0UGFja2V0IGltcGxlbWVudHMgdGhlIElCQ01vZHVsZSBpbnRlcmZhY2UKZnVuYyAoYW0gQXBwTW9kdWxlKSBPblRpbWVvdXRQYWNrZXQoCiAgICBjdHggc2RrLkNvbnRleHQsCiAgICBtb2R1bGVQYWNrZXQgY2hhbm5lbHR5cGVzLlBhY2tldCwKICAgIHJlbGF5ZXIgc2RrLkFjY0FkZHJlc3MsCikgZXJyb3IgewogICAgdmFyIG1vZHVsZVBhY2tldERhdGEgdHlwZXMuTGVhZGVyYm9hcmRQYWNrZXREYXRhCiAgICAuLi4gLy8gdmFsaWRhdGlvbgogICAgLy8gRGlzcGF0Y2ggcGFja2V0CiAgICBzd2l0Y2ggcGFja2V0IDo9IG1vZHVsZVBhY2tldERhdGEuUGFja2V0Lih0eXBlKSB7CiAgICAvLyB0aGlzIGxpbmUgaXMgdXNlZCBieSBzdGFycG9ydCBzY2FmZm9sZGluZyAjIGliYy9wYWNrZXQvbW9kdWxlL3RpbWVvdXQKICAgIGRlZmF1bHQ6CiAgICAgICAgLi4uIC8vIGVyck1zZwogICAgfQogICAgcmV0dXJuIG5pbAp9Cg=="}}),e._v(" "),t("h4",{attrs:{id:"binding-to-a-port"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#binding-to-a-port"}},[e._v("#")]),e._v(" Binding to a port")]),e._v(" "),t("p",[e._v("Every IBC module binds to a port, with a unique "),t("code",[e._v("portID")]),e._v(" which denotes the type of application.")]),e._v(" "),t("HighlightBox",{attrs:{type:"note"}},[t("p",[e._v("The "),t("code",[e._v("portID")]),e._v(" does not refer to a certain numerical ID, like "),t("code",[e._v("localhost:8080")]),e._v(" with a "),t("code",[e._v("portID")]),e._v(" 8080. Rather it refers to the application module to which the port binds. For IBC modules built with the Cosmos SDK it defaults to the module's name, and for CosmWasm contracts, it defaults to the contract address.")])]),e._v(" "),t("p",[e._v("Currently, ports must be bound on app initialization. In order to bind modules to their respective ports on initialization, the following needs to be implemented:")]),e._v(" "),t("ol",[t("li",[t("p",[e._v("Add port ID to the "),t("code",[e._v("GenesisState")]),e._v(" proto definition:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-protobuf",base64:"ICAgQEAgcHJvdG8vbGVhZGVyYm9hcmQvZ2VuZXNpcy5wcm90bwogICAvLyBHZW5lc2lzU3RhdGUgZGVmaW5lcyB0aGUgbGVhZGVyYm9hcmQgbW9kdWxlJ3MgZ2VuZXNpcyBzdGF0ZS4KICAgbWVzc2FnZSBHZW5lc2lzU3RhdGUgewogICAgICAgUGFyYW1zIHBhcmFtcyA9IDEgWyhnb2dvcHJvdG8ubnVsbGFibGUpID0gZmFsc2VdOworICAgICBzdHJpbmcgcG9ydF9pZCA9IDI7CiAgICAgICAvLyB0aGlzIGxpbmUgaXMgdXNlZCBieSBzdGFycG9ydCBzY2FmZm9sZGluZyAjIGdlbmVzaXMvcHJvdG8vc3RhdGUKICAgfQo="}})],1),e._v(" "),t("li",[t("p",[e._v("Add port ID as a key to the module store in "),t("code",[e._v("x/leaderboard/types/keys.go")]),e._v(":")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgICAgICBAQCBjb25zdCBpbiB4L2xlYWRlcmJvYXJkL3R5cGVzL2tleXMuZ28KICAgICAgICAvLyBNZW1TdG9yZUtleSBkZWZpbmVzIHRoZSBpbi1tZW1vcnkgc3RvcmUga2V5CiAgICAgICAgTWVtU3RvcmVLZXkgPSAmcXVvdDttZW1fbGVhZGVyYm9hcmQmcXVvdDsKKyAgICAgIC8vIFZlcnNpb24gZGVmaW5lcyB0aGUgY3VycmVudCB2ZXJzaW9uIHRoZSBJQkMgbW9kdWxlIHN1cHBvcnRzCisgICAgICBWZXJzaW9uID0gJnF1b3Q7bGVhZGVyYm9hcmQtMSZxdW90OworICAgICAgLy8gUG9ydElEIGlzIHRoZSBkZWZhdWx0IHBvcnQgaWQgdGhhdCBtb2R1bGUgYmluZHMgdG8KKyAgICAgIFBvcnRJRCA9ICZxdW90O2xlYWRlcmJvYXJkJnF1b3Q7CisgICkKKyAgdmFyICgKKyAgICAgIC8vIFBvcnRLZXkgZGVmaW5lcyB0aGUga2V5IHRvIHN0b3JlIHRoZSBwb3J0IElEIGluIHN0b3JlCisgICAgICBQb3J0S2V5ID0gS2V5UHJlZml4KCZxdW90O2xlYWRlcmJvYXJkLXBvcnQtJnF1b3Q7KQogICAgKQo="}}),e._v(" "),t("HighlightBox",{attrs:{type:"note"}},[t("p",[e._v("By default, the "),t("code",[e._v("portID")]),e._v(" is indeed set to the module name, and the application version is set to "),t("code",[e._v("<modulename>-n")]),e._v(" with "),t("code",[e._v("n")]),e._v(" as an incrementing value.")])])],1),e._v(" "),t("li",[t("p",[e._v("Add port ID to "),t("code",[e._v("x/leaderboard/types/genesis.go")]),e._v(":")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIC8vIERlZmF1bHRHZW5lc2lzU3RhdGUgcmV0dXJucyBhIEdlbmVzaXNTdGF0ZSB3aXRoICZxdW90O3RyYW5zZmVyJnF1b3Q7IGFzIHRoZSBkZWZhdWx0IFBvcnRJRC4KICAgIGZ1bmMgRGVmYXVsdEdlbmVzaXNTdGF0ZSgpICpHZW5lc2lzU3RhdGUgewogICAgICAgIHJldHVybiAmYW1wO0dlbmVzaXNTdGF0ZXsKKyAgICAgICAgICAgIFBvcnRJZDogICAgICBQb3J0SUQsCiAgICAgICAgICAgIC8vIGFkZGl0aW9uYWwgay12IGZpZWxkcwogICAgICAgIH0KICAgIH0KICAgIC8vIFZhbGlkYXRlIHBlcmZvcm1zIGJhc2ljIGdlbmVzaXMgc3RhdGUgdmFsaWRhdGlvbiByZXR1cm5pbmcgYW4gZXJyb3IgdXBvbiBhbnkKICAgIC8vIGZhaWx1cmUuCiAgICBmdW5jIChncyBHZW5lc2lzU3RhdGUpIFZhbGlkYXRlKCkgZXJyb3IgeworICAgICAgIGlmIGVyciA6PSBob3N0LlBvcnRJZGVudGlmaWVyVmFsaWRhdG9yKGdzLlBvcnRJZCk7IGVyciAhPSBuaWwgeworICAgICAgICAgICAgcmV0dXJuIGVycgorICAgICAgICB9CiAgICAgICAgLy9hZGR0aW9uYWwgdmFsaWRhdGlvbnMKICAgICAgICByZXR1cm4gZ3MuUGFyYW1zLlZhbGlkYXRlKCkKICAgIH0K"}})],1),e._v(" "),t("li",[t("p",[e._v("Bind the IBC module to the port in "),t("code",[e._v("x/leaderboard/genesis.go")]),e._v(":")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIEBAIEluaXRHZW5lc2lzCiAgICBmdW5jIEluaXRHZW5lc2lzKGN0eCBzZGsuQ29udGV4dCwgayBrZWVwZXIuS2VlcGVyLCBnZW5TdGF0ZSB0eXBlcy5HZW5lc2lzU3RhdGUpIHsKICAgICAgICAvLyB0aGlzIGxpbmUgaXMgdXNlZCBieSBzdGFycG9ydCBzY2FmZm9sZGluZyAjIGdlbmVzaXMvbW9kdWxlL2luaXQKKyAgICAgIGsuU2V0UG9ydChjdHgsIGdlblN0YXRlLlBvcnRJZCkKKyAgICAgIC8vIE9ubHkgdHJ5IHRvIGJpbmQgdG8gcG9ydCBpZiBpdCBpcyBub3QgYWxyZWFkeSBib3VuZCwgc2luY2Ugd2UgbWF5IGFscmVhZHkgb3duCisgICAgICAvLyBwb3J0IGNhcGFiaWxpdHkgZnJvbSBjYXBhYmlsaXR5IEluaXRHZW5lc2lzCisgICAgICBpZiAhay5Jc0JvdW5kKGN0eCwgZ2VuU3RhdGUuUG9ydElkKSB7CisgICAgICAgICAgLy8gbW9kdWxlIGJpbmRzIHRvIHRoZSBwb3J0IG9uIEluaXRDaGFpbgorICAgICAgICAgIC8vIGFuZCBjbGFpbXMgdGhlIHJldHVybmVkIGNhcGFiaWxpdHkKKyAgICAgICAgICBlcnIgOj0gay5CaW5kUG9ydChjdHgsIGdlblN0YXRlLlBvcnRJZCkKKyAgICAgICAgICBpZiBlcnIgIT0gbmlsIHsKKyAgICAgICAgICAgICAgcGFuaWMoJnF1b3Q7Y291bGQgbm90IGNsYWltIHBvcnQgY2FwYWJpbGl0eTogJnF1b3Q7ICsgZXJyLkVycm9yKCkpCisgICAgICAgICAgfQogICAgICAgfQogICAgICAgay5TZXRQYXJhbXMoY3R4LCBnZW5TdGF0ZS5QYXJhbXMpCiAgICB9CiAgICBAQCBFeHBvcnRHZW5lc2lzCiAgICBmdW5jIEV4cG9ydEdlbmVzaXMoY3R4IHNkay5Db250ZXh0LCBrIGtlZXBlci5LZWVwZXIpICp0eXBlcy5HZW5lc2lzU3RhdGUgewogICAgICAgIGdlbmVzaXMgOj0gdHlwZXMuRGVmYXVsdEdlbmVzaXMoKQogICAgICAgIGdlbmVzaXMuUGFyYW1zID0gay5HZXRQYXJhbXMoY3R4KQorICAgICAgZ2VuZXNpcy5Qb3J0SWQgPSBrLkdldFBvcnQoY3R4KQogICAgICAgIC8vIHRoaXMgbGluZSBpcyB1c2VkIGJ5IHN0YXJwb3J0IHNjYWZmb2xkaW5nICMgZ2VuZXNpcy9tb2R1bGUvZXhwb3J0CiAgICAgICAgcmV0dXJuIGdlbmVzaXMKICAgIH0K"}}),e._v(" "),t("p",[e._v("Where:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gSXNCb3VuZCBjaGVja3MgaWYgdGhlICBtb2R1bGUgaXMgYWxyZWFkeSBib3VuZCB0byB0aGUgZGVzaXJlZCBwb3J0CmZ1bmMgKGsgS2VlcGVyKSBJc0JvdW5kKGN0eCBzZGsuQ29udGV4dCwgcG9ydElEIHN0cmluZykgYm9vbCB7CiAgICBfLCBvayA6PSBrLnNjb3BlZEtlZXBlci5HZXRDYXBhYmlsaXR5KGN0eCwgaG9zdC5Qb3J0UGF0aChwb3J0SUQpKQogICAgcmV0dXJuIG9rCn0KLy8gQmluZFBvcnQgZGVmaW5lcyBhIHdyYXBwZXIgZnVuY3Rpb24gZm9yIHRoZSBwb3J0IEtlZXBlcidzIGZ1bmN0aW9uIGluCi8vIG9yZGVyIHRvIGV4cG9zZSBpdCB0byB0aGUgbW9kdWxlJ3MgSW5pdEdlbmVzaXMgZnVuY3Rpb24KZnVuYyAoayBLZWVwZXIpIEJpbmRQb3J0KGN0eCBzZGsuQ29udGV4dCwgcG9ydElEIHN0cmluZykgZXJyb3IgewogICAgY2FwIDo9IGsucG9ydEtlZXBlci5CaW5kUG9ydChjdHgsIHBvcnRJRCkKICAgIHJldHVybiBrLkNsYWltQ2FwYWJpbGl0eShjdHgsIGNhcCwgaG9zdC5Qb3J0UGF0aChwb3J0SUQpKQp9Cg=="}}),e._v(" "),t("p",[e._v("The module binds to the desired port(s) and returns the capabilities.")])],1)]),e._v(" "),t("h4",{attrs:{id:"keeper"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#keeper"}},[e._v("#")]),e._v(" Keeper")]),e._v(" "),t("p",[e._v("Previous steps sometimes referenced keeper methods that deal with binding to and getting and setting a port, claiming and authenticating capabilities. These methods need to be added to the keeper.")]),e._v(" "),t("p",[e._v("For a full overview, check out the "),t("a",{attrs:{href:"https://ibc.cosmos.network/main/ibc/apps/keeper.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("ibc-go docs"),t("OutboundLink")],1),e._v(" and compare it with the "),t("code",[e._v("x/leaderboard/keeper/keeper.go")]),e._v(" file.")]),e._v(" "),t("p",[e._v("You will notice that Ignite CLI uses a custom "),t("code",[e._v("cosmosibckeeper")]),e._v(" package which you can find "),t("a",{attrs:{href:"https://github.com/ignite/cli/tree/develop/ignite/pkg/cosmosibckeeper",target:"_blank",rel:"noopener noreferrer"}},[e._v("here"),t("OutboundLink")],1),e._v(".")]),e._v(" "),t("h4",{attrs:{id:"routing-and-app-go"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#routing-and-app-go"}},[e._v("#")]),e._v(" Routing and "),t("code",[e._v("app.go")])]),e._v(" "),t("p",[e._v("When looking at "),t("code",[e._v("app.go")]),e._v(" you will see some minor additions, the most prominent of which is adding a route to the "),t("code",[e._v("Leaderboard")]),e._v(" module on the "),t("code",[e._v("IBC Router")]),e._v(".")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIEBAIGZ1bmMgTmV3IGluIGFwcC9hcHAuZ28KICAgIGliY1JvdXRlciA6PSBpYmNwb3J0dHlwZXMuTmV3Um91dGVyKCkKICAgIGliY1JvdXRlci5BZGRSb3V0ZShpYmN0cmFuc2ZlcnR5cGVzLk1vZHVsZU5hbWUsIHRyYW5zZmVySUJDTW9kdWxlKQogICAgaWJjUm91dGVyLkFkZFJvdXRlKG1vbml0b3JpbmdwdHlwZXMuTW9kdWxlTmFtZSwgbW9uaXRvcmluZ01vZHVsZSkKKyAgaWJjUm91dGVyLkFkZFJvdXRlKGxlYWRlcmJvYXJkbW9kdWxldHlwZXMuTW9kdWxlTmFtZSwgbGVhZGVyYm9hcmRNb2R1bGUpCiAgICAvLyB0aGlzIGxpbmUgaXMgdXNlZCBieSBzdGFycG9ydCBzY2FmZm9sZGluZyAjIGliYy9hcHAvcm91dGVyCiAgICBhcHAuSUJDS2VlcGVyLlNldFJvdXRlcihpYmNSb3V0ZXIpCg=="}}),e._v(" "),t("HighlightBox",{attrs:{type:"synopsis"}},[t("p",[e._v("To summarize, this section has explored:")]),e._v(" "),t("ul",[t("li",[e._v("How to build an SDK blockchain, as a regular module.")]),e._v(" "),t("li",[e._v("How to build an SDK blockchain, as an IBC module.")]),e._v(" "),t("li",[e._v("How application modules verify the versioning used during the channel handshake procedure.")]),e._v(" "),t("li",[e._v("Packet callbacks, and specifically how sending, receiving, acknowledging, and timing out is handled in the packet flow.")]),e._v(" "),t("li",[e._v("How to bind to a port, and the necessity of adding appropriate keeper methods to the keeper.")])])]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"undefined",base64:""}})],1)}),[],!1,null,null,null);a.default=c.exports}}]);