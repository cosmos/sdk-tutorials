(window.webpackJsonp=window.webpackJsonp||[]).push([[155],{771:function(e,a,t){"use strict";t.r(a);var c=t(1),o=Object(c.a)({},(function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"adding-packet-and-acknowledgement-data"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#adding-packet-and-acknowledgement-data"}},[e._v("#")]),e._v(" Adding Packet and Acknowledgement Data")]),e._v(" "),t("p",[e._v("This section demonstrates how to define packets and acks (acknowledgements) for the leaderboard blockchain.")]),e._v(" "),t("HighlightBox",{attrs:{type:"note"}},[t("p",[e._v("This blockchain will mostly be receiving packets from the checkers blockchain or other gaming chains, not sending them. This will be handled in the "),t("RouterLink",{attrs:{to:"/hands-on-exercise/5-ibc-adv/7-ibc-app-leaderboard.html"}},[e._v("checkers blockchain extension section")]),e._v(".")],1)]),e._v(" "),t("p",[e._v("In this section, you will add an additional packet definition that will enable the Leaderboard chain to send a packet to connected game chains when a player has entered the top of the rankings. It is up to you if you want to include this in the Leaderboard chain you will build in the checkers extension exercise.")]),e._v(" "),t("p",[e._v("The documentation on how to define packets and acks in the Inter-Blockchain Communication Protocol (IBC) can be found in "),t("a",{attrs:{href:"https://ibc.cosmos.network/main/ibc/apps/packets_acks.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("the ibc-go docs"),t("OutboundLink")],1),e._v(".")]),e._v(" "),t("h2",{attrs:{id:"scaffold-a-packet-with-ignite-cli"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#scaffold-a-packet-with-ignite-cli"}},[e._v("#")]),e._v(" Scaffold a packet with Ignite CLI")]),e._v(" "),t("p",[e._v("You are now going to scaffold the IBC packet data with Ignite CLI, and compare it once more with "),t("em",[e._v("git diff")]),e._v(":")]),e._v(" "),t("CodeGroup",[t("CodeGroupItem",{attrs:{title:"Local"}},[t("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBpZ25pdGUgc2NhZmZvbGQgcGFja2V0IGliY1RvcFJhbmsgXAogICAgcGxheWVySWQgcmFuazp1aW50IHNjb3JlOnVpbnQgXAogICAgLS1hY2sgcGxheWVySWQgXAogICAgLS1tb2R1bGUgbGVhZGVyYm9hcmQK"}})],1),e._v(" "),t("CodeGroupItem",{attrs:{title:"Docker"}},[t("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IFwKICAgIC12ICQocHdkKTovbGVhZGVyYm9hcmQgXAogICAgLXcgL2xlYWRlcmJvYXJkIFwKICAgIGlnbml0ZWhxL2NsaTowLjIyLjEgXAogICAgc2NhZmZvbGQgcGFja2V0IGliY1RvcFJhbmsgXAogICAgcGxheWVySWQgcmFuazp1aW50IHNjb3JlOnVpbnQgXAogICAgLS1hY2sgcGxheWVySWQgXAogICAgLS1tb2R1bGUgbGVhZGVyYm9hcmQK"}})],1)],1),e._v(" "),t("HighlightBox",{attrs:{type:"note"}},[t("p",[e._v("The packet is called "),t("code",[e._v("ibcTopRank")]),e._v(", which includes the fields "),t("code",[e._v("playerId")]),e._v(", "),t("code",[e._v("rank")]),e._v(", and "),t("code",[e._v("score")]),e._v(". Additionally, you send back the "),t("code",[e._v("playerId")]),e._v(" of the player who entered the top of the rankings through the "),t("code",[e._v("Acknowledgement")]),e._v(".")])]),e._v(" "),t("p",[e._v("The output on the terminal gives an overview of the changes made:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"bash",base64:"bW9kaWZ5IHByb3RvL2xlYWRlcmJvYXJkL3BhY2tldC5wcm90bwptb2RpZnkgcHJvdG8vbGVhZGVyYm9hcmQvdHgucHJvdG8KbW9kaWZ5IHgvbGVhZGVyYm9hcmQvY2xpZW50L2NsaS90eC5nbwpjcmVhdGUgeC9sZWFkZXJib2FyZC9jbGllbnQvY2xpL3R4X2liY190b3BfcmFuay5nbwptb2RpZnkgeC9sZWFkZXJib2FyZC9oYW5kbGVyLmdvCmNyZWF0ZSB4L2xlYWRlcmJvYXJkL2tlZXBlci9pYmNfdG9wX3JhbmsuZ28KY3JlYXRlIHgvbGVhZGVyYm9hcmQva2VlcGVyL21zZ19zZXJ2ZXJfaWJjX3RvcF9yYW5rLmdvCm1vZGlmeSB4L2xlYWRlcmJvYXJkL21vZHVsZV9pYmMuZ28KbW9kaWZ5IHgvbGVhZGVyYm9hcmQvdHlwZXMvY29kZWMuZ28KbW9kaWZ5IHgvbGVhZGVyYm9hcmQvdHlwZXMvZXZlbnRzX2liYy5nbwpjcmVhdGUgeC9sZWFkZXJib2FyZC90eXBlcy9tZXNzYWdlc19pYmNfdG9wX3JhbmsuZ28KY3JlYXRlIHgvbGVhZGVyYm9hcmQvdHlwZXMvbWVzc2FnZXNfaWJjX3RvcF9yYW5rX3Rlc3QuZ28KY3JlYXRlIHgvbGVhZGVyYm9hcmQvdHlwZXMvcGFja2V0X2liY190b3BfcmFuay5nbwoK8J+OiSBDcmVhdGVkIGEgcGFja2V0IGBpYmNUb3BSYW5rYC4K"}}),e._v(" "),t("p",[e._v("In the next paragraphs, you will investigate each of the most important additions to the code.")]),e._v(" "),t("h2",{attrs:{id:"proto-definitions"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#proto-definitions"}},[e._v("#")]),e._v(" Proto definitions")]),e._v(" "),t("p",[e._v("The first additions are to the proto definitions in the "),t("code",[e._v("packet.proto")]),e._v(" and "),t("code",[e._v("tx.proto")]),e._v(" files:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-protobuf",base64:"ICAgbWVzc2FnZSBMZWFkZXJib2FyZFBhY2tldERhdGEgewogICAgICAgb25lb2YgcGFja2V0IHsKICAgICAgICAgICBOb0RhdGEgbm9EYXRhID0gMTsKICAgICAgICAgICAvLyB0aGlzIGxpbmUgaXMgdXNlZCBieSBzdGFycG9ydCBzY2FmZm9sZGluZyAjIGliYy9wYWNrZXQvcHJvdG8vZmllbGQKKyAgICAgICAgIEliY1RvcFJhbmtQYWNrZXREYXRhIGliY1RvcFJhbmtQYWNrZXQgPSAyOwogICAgICAgICAgIC8vIHRoaXMgbGluZSBpcyB1c2VkIGJ5IHN0YXJwb3J0IHNjYWZmb2xkaW5nICMgaWJjL3BhY2tldC9wcm90by9maWVsZC9udW1iZXIKICAgICAgIH0KICAgfQo=",url:"https://github.com/b9lab/cosmos-ibc-docker/blob/main/separate/leaderboard/ida-content/proto/leaderboard/packet.proto#L10"}}),e._v(" "),t("p",[e._v("One addition is "),t("code",[e._v("IbcTopRankPacketData")]),e._v(":")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"protobuf",base64:"Ly8gSWJjVG9wUmFua1BhY2tldERhdGEgZGVmaW5lcyBhIHN0cnVjdCBmb3IgdGhlIHBhY2tldCBwYXlsb2FkCm1lc3NhZ2UgSWJjVG9wUmFua1BhY2tldERhdGEgewogIHN0cmluZyBwbGF5ZXJJZCA9IDE7CiAgdWludDY0IHJhbmsgPSAyOwogIHVpbnQ2NCBzY29yZSA9IDM7Cn0K",url:"https://github.com/b9lab/cosmos-ibc-docker/blob/main/separate/leaderboard/ida-content/proto/leaderboard/packet.proto#L19-L24"}}),e._v(" "),t("p",[e._v("The next addition is the ack:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"protobuf",base64:"Ly8gSWJjVG9wUmFua1BhY2tldEFjayBkZWZpbmVzIGEgc3RydWN0IGZvciB0aGUgcGFja2V0IGFja25vd2xlZGdlbWVudAptZXNzYWdlIEliY1RvcFJhbmtQYWNrZXRBY2sgewogICAgc3RyaW5nIHBsYXllcklkID0gMTsKfQo=",url:"https://github.com/b9lab/cosmos-ibc-docker/blob/main/separate/leaderboard/ida-content/proto/leaderboard/packet.proto#L27-L29"}}),e._v(" "),t("p",[e._v("And in "),t("code",[e._v("tx.proto")]),e._v(" a Message service is added:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-protobuf",base64:"ICAgLy8gTXNnIGRlZmluZXMgdGhlIE1zZyBzZXJ2aWNlLgogICBzZXJ2aWNlIE1zZyB7CisgICAgIHJwYyBTZW5kSWJjVG9wUmFuayhNc2dTZW5kSWJjVG9wUmFuaykgcmV0dXJucyAoTXNnU2VuZEliY1RvcFJhbmtSZXNwb25zZSk7CiAgICAgICAvLyB0aGlzIGxpbmUgaXMgdXNlZCBieSBzdGFycG9ydCBzY2FmZm9sZGluZyAjIHByb3RvL3R4L3JwYwogICB9Cg==",url:"https://github.com/b9lab/cosmos-ibc-docker/blob/main/separate/leaderboard/ida-content/proto/leaderboard/tx.proto#L11"}}),e._v(" "),t("p",[e._v("Where:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"protobuf",base64:"bWVzc2FnZSBNc2dTZW5kSWJjVG9wUmFuayB7CiAgc3RyaW5nIGNyZWF0b3IgPSAxOwogIHN0cmluZyBwb3J0ID0gMjsKICBzdHJpbmcgY2hhbm5lbElEID0gMzsKICB1aW50NjQgdGltZW91dFRpbWVzdGFtcCA9IDQ7CiAgc3RyaW5nIHBsYXllcklkID0gNTsKICB1aW50NjQgcmFuayA9IDY7CiAgdWludDY0IHNjb3JlID0gNzsKfQoKbWVzc2FnZSBNc2dTZW5kSWJjVG9wUmFua1Jlc3BvbnNlIHsKfQo=",url:"https://github.com/b9lab/cosmos-ibc-docker/blob/main/separate/leaderboard/ida-content/proto/leaderboard/tx.proto#L15-L27"}}),e._v(" "),t("HighlightBox",{attrs:{type:"info"}},[t("p",[e._v("The proto message "),t("code",[e._v("MsgSendIbcTopRank")]),e._v(" includes the field "),t("code",[e._v("timeoutTimestamp")]),e._v(", which is added by Ignite CLI when scaffolding an IBC packet. This is an IBC channel parameter that is important in IBC and Ignite CLI abstracts this away, removing the need for the user to add this manually.")])]),e._v(" "),t("HighlightBox",{attrs:{type:"note"}},[t("p",[e._v("The proto definitions will be compiled into "),t("code",[e._v("types/packet.pb.go")]),e._v(" and "),t("code",[e._v("types/tx.pb.go")]),e._v(".")])]),e._v(" "),t("h2",{attrs:{id:"cli-commands"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cli-commands"}},[e._v("#")]),e._v(" CLI commands")]),e._v(" "),t("p",[e._v("Ignite CLI also creates CLI commands to send packets and adds them to the "),t("code",[e._v("client/cli/")]),e._v(" folder.")]),e._v(" "),t("p",[e._v("Packets can be sent from the CLI with the following command:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"bash",base64:"JCBsZWFkZXJib2FyZGQgdHggbGVhZGVyYm9hcmQgc2VuZC1pYmMtdG9wLXJhbmsgXAogICAgW3BvcnRJRF0gW2NoYW5uZWxJRF0gW3BsYXllcklkXSBbcmFua10gW3Njb3JlXQo="}}),e._v(" "),t("h2",{attrs:{id:"sendpacket-and-packet-callback-logic"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sendpacket-and-packet-callback-logic"}},[e._v("#")]),e._v(" "),t("code",[e._v("SendPacket")]),e._v(" and packet callback logic")]),e._v(" "),t("p",[e._v("When scaffolding an IBC module with Ignite CLI, you already saw the implementation of the "),t("code",[e._v("IBCModule")]),e._v(" interface, including a bare-bones packet callbacks structure. Now that you have also scaffolded a packet (and ack), the callbacks have been added with logic to handle the receive, ack, and timeout scenarios.")]),e._v(" "),t("p",[e._v("Additionally, for the sending of a packet, a message server has been added that handles a SendPacket message, in this case "),t("code",[e._v("MsgSendIbcTopRank")]),e._v(".")]),e._v(" "),t("HighlightBox",{attrs:{type:"tip"}},[t("p",[e._v("IBC allows some freedom to the developers regarding how to implement the custom logic, decoding and encoding packets, and processing acks. The provided structure is but one example of how to tackle this. Therefore, it makes sense to focus on the general flow to handle user messages or IBC callbacks rather than the specific implementation by Ignite CLI.")])]),e._v(" "),t("h3",{attrs:{id:"sending-packets"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sending-packets"}},[e._v("#")]),e._v(" Sending packets")]),e._v(" "),t("p",[e._v("To handle a user submitting a message to send an IBC packet, a message server is added to the handler:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-go",base64:"ICAgIGZ1bmMgTmV3SGFuZGxlcihrIGtlZXBlci5LZWVwZXIpIHNkay5IYW5kbGVyIHsKKyAgICAgIG1zZ1NlcnZlciA6PSBrZWVwZXIuTmV3TXNnU2VydmVySW1wbChrKQoKICAgICAgICByZXR1cm4gZnVuYyhjdHggc2RrLkNvbnRleHQsIG1zZyBzZGsuTXNnKSAoKnNkay5SZXN1bHQsIGVycm9yKSB7CiAgICAgICAgICAgIGN0eCA9IGN0eC5XaXRoRXZlbnRNYW5hZ2VyKHNkay5OZXdFdmVudE1hbmFnZXIoKSkKCiAgICAgICAgICAgIHN3aXRjaCBtc2cgOj0gbXNnLih0eXBlKSB7CisgICAgICAgICAgY2FzZSAqdHlwZXMuTXNnU2VuZEliY1RvcFJhbms6CisgICAgICAgICAgICAgIHJlcywgZXJyIDo9IG1zZ1NlcnZlci5TZW5kSWJjVG9wUmFuayhzZGsuV3JhcFNES0NvbnRleHQoY3R4KSwgbXNnKQorICAgICAgICAgICAgICByZXR1cm4gc2RrLldyYXBTZXJ2aWNlUmVzdWx0KGN0eCwgcmVzLCBlcnIpCiAgICAgICAgICAgICAgICAvLyB0aGlzIGxpbmUgaXMgdXNlZCBieSBzdGFycG9ydCBzY2FmZm9sZGluZyAjIDEKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGVyck1zZyA6PSBmbXQuU3ByaW50ZigmcXVvdDt1bnJlY29nbml6ZWQgJXMgbWVzc2FnZSB0eXBlOiAlVCZxdW90OywgdHlwZXMuTW9kdWxlTmFtZSwgbXNnKQogICAgICAgICAgICAgICAgcmV0dXJuIG5pbCwgc2RrZXJyb3JzLldyYXAoc2RrZXJyb3JzLkVyclVua25vd25SZXF1ZXN0LCBlcnJNc2cpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cg==",url:"https://github.com/b9lab/cosmos-ibc-docker/blob/main/separate/leaderboard/ida-content/x/leaderboard/handler.go#L13-L30"}}),e._v(" "),t("p",[e._v("It calls the "),t("code",[e._v("SendIbcTopRank")]),e._v(" method on the message server, defined as:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAoayBtc2dTZXJ2ZXIpIFNlbmRJYmNUb3BSYW5rKGdvQ3R4IGNvbnRleHQuQ29udGV4dCwgbXNnICp0eXBlcy5Nc2dTZW5kSWJjVG9wUmFuaykgKCp0eXBlcy5Nc2dTZW5kSWJjVG9wUmFua1Jlc3BvbnNlLCBlcnJvcikgewogICAgY3R4IDo9IHNkay5VbndyYXBTREtDb250ZXh0KGdvQ3R4KQoKICAgIC8vIFRPRE86IGxvZ2ljIGJlZm9yZSB0cmFuc21pdHRpbmcgdGhlIHBhY2tldAoKICAgIC8vIENvbnN0cnVjdCB0aGUgcGFja2V0CiAgICB2YXIgcGFja2V0IHR5cGVzLkliY1RvcFJhbmtQYWNrZXREYXRhCgogICAgcGFja2V0LlBsYXllcklkID0gbXNnLlBsYXllcklkCiAgICBwYWNrZXQuUmFuayA9IG1zZy5SYW5rCiAgICBwYWNrZXQuU2NvcmUgPSBtc2cuU2NvcmUKCiAgICAvLyBUcmFuc21pdCB0aGUgcGFja2V0CiAgICBlcnIgOj0gay5UcmFuc21pdEliY1RvcFJhbmtQYWNrZXQoCiAgICAgICAgY3R4LAogICAgICAgIHBhY2tldCwKICAgICAgICBtc2cuUG9ydCwKICAgICAgICBtc2cuQ2hhbm5lbElELAogICAgICAgIGNsaWVudHR5cGVzLlplcm9IZWlnaHQoKSwKICAgICAgICBtc2cuVGltZW91dFRpbWVzdGFtcCwKICAgICkKICAgIGlmIGVyciAhPSBuaWwgewogICAgICAgIHJldHVybiBuaWwsIGVycgogICAgfQoKICAgIHJldHVybiAmYW1wO3R5cGVzLk1zZ1NlbmRJYmNUb3BSYW5rUmVzcG9uc2V7fSwgbmlsCn0K",url:"https://github.com/b9lab/cosmos-ibc-docker/blob/main/separate/leaderboard/ida-content/x/leaderboard/keeper/msg_server_ibc_top_rank.go#L11"}}),e._v(" "),t("p",[e._v("This in turn calls the "),t("code",[e._v("TransmitIbcTopRankPacket")]),e._v(" method on the module's keeper, defined in "),t("code",[e._v("x/leaderboard/keeper/ibc_top_rank.go")]),e._v(". This method gets all of the required metadata from core IBC before sending the packet using the ChannelKeeper's "),t("code",[e._v("SendPacket")]),e._v(" function:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAoayBLZWVwZXIpIFRyYW5zbWl0SWJjVG9wUmFua1BhY2tldCgKICAgIGN0eCBzZGsuQ29udGV4dCwKICAgIHBhY2tldERhdGEgdHlwZXMuSWJjVG9wUmFua1BhY2tldERhdGEsCiAgICBzb3VyY2VQb3J0LAogICAgc291cmNlQ2hhbm5lbCBzdHJpbmcsCiAgICB0aW1lb3V0SGVpZ2h0IGNsaWVudHR5cGVzLkhlaWdodCwKICAgIHRpbWVvdXRUaW1lc3RhbXAgdWludDY0LAopIGVycm9yIHsKCiAgICBzb3VyY2VDaGFubmVsRW5kLCBmb3VuZCA6PSBrLkNoYW5uZWxLZWVwZXIuR2V0Q2hhbm5lbChjdHgsIHNvdXJjZVBvcnQsIHNvdXJjZUNoYW5uZWwpCiAgICAuLi4gLy8gZXJyb3IgdmFsaWRhdGlvbgoKICAgIGRlc3RpbmF0aW9uUG9ydCA6PSBzb3VyY2VDaGFubmVsRW5kLkdldENvdW50ZXJwYXJ0eSgpLkdldFBvcnRJRCgpCiAgICBkZXN0aW5hdGlvbkNoYW5uZWwgOj0gc291cmNlQ2hhbm5lbEVuZC5HZXRDb3VudGVycGFydHkoKS5HZXRDaGFubmVsSUQoKQoKICAgIC8vIGdldCB0aGUgbmV4dCBzZXF1ZW5jZQogICAgc2VxdWVuY2UsIGZvdW5kIDo9IGsuQ2hhbm5lbEtlZXBlci5HZXROZXh0U2VxdWVuY2VTZW5kKGN0eCwgc291cmNlUG9ydCwgc291cmNlQ2hhbm5lbCkKICAgIC4uLiAvLyBlcnJvciB2YWxpZGF0aW9uCgogICAgY2hhbm5lbENhcCwgb2sgOj0gay5TY29wZWRLZWVwZXIuR2V0Q2FwYWJpbGl0eShjdHgsIGhvc3QuQ2hhbm5lbENhcGFiaWxpdHlQYXRoKHNvdXJjZVBvcnQsIHNvdXJjZUNoYW5uZWwpKQogICAgLi4uIC8vIGVycm9yIHZhbGlkYXRpb24KCiAgICBwYWNrZXRCeXRlcywgZXJyIDo9IHBhY2tldERhdGEuR2V0Qnl0ZXMoKQogICAgLi4uIC8vIGVycm9yIHZhbGlkYXRpb24KCiAgICBwYWNrZXQgOj0gY2hhbm5lbHR5cGVzLk5ld1BhY2tldCgKICAgICAgICBwYWNrZXRCeXRlcywKICAgICAgICBzZXF1ZW5jZSwKICAgICAgICBzb3VyY2VQb3J0LAogICAgICAgIHNvdXJjZUNoYW5uZWwsCiAgICAgICAgZGVzdGluYXRpb25Qb3J0LAogICAgICAgIGRlc3RpbmF0aW9uQ2hhbm5lbCwKICAgICAgICB0aW1lb3V0SGVpZ2h0LAogICAgICAgIHRpbWVvdXRUaW1lc3RhbXAsCiAgICApCgogICAgaWYgZXJyIDo9IGsuQ2hhbm5lbEtlZXBlci5TZW5kUGFja2V0KGN0eCwgY2hhbm5lbENhcCwgcGFja2V0KTsgZXJyICE9IG5pbCB7CiAgICAgICAgcmV0dXJuIGVycgogICAgfQoKICAgIHJldHVybiBuaWwKfQo=",url:"https://github.com/b9lab/cosmos-ibc-docker/blob/main/separate/leaderboard/ida-content/x/leaderboard/keeper/ibc_top_rank.go#L15"}}),e._v(" "),t("HighlightBox",{attrs:{type:"note"}},[t("p",[e._v("When you want to add additional custom logic before transmitting the packet, you do this in the "),t("code",[e._v("SendIbcTopRank")]),e._v(" method on the message server.")])]),e._v(" "),t("h3",{attrs:{id:"receiving-packets"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#receiving-packets"}},[e._v("#")]),e._v(" Receiving packets")]),e._v(" "),t("p",[e._v("In a previous section you examined the "),t("code",[e._v("OnRecvPacket")]),e._v(" callback in the "),t("code",[e._v("x/leaderboard/module_ibc.go")]),e._v(" file. There, Ignite CLI had set up a structure to dispatch the packet depending on packet type through a switch statement. Now by adding the "),t("code",[e._v("IbcTopRank")]),e._v(" packet, a case has been added:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gQCBzd2l0Y2ggcGFja2V0IDo9IG1vZHVsZVBhY2tldERhdGEuUGFja2V0Lih0eXBlKSBpbiBPblJlY3ZQYWNrZXQKY2FzZSAqdHlwZXMuTGVhZGVyYm9hcmRQYWNrZXREYXRhX0liY1RvcFJhbmtQYWNrZXQ6CiAgICBwYWNrZXRBY2ssIGVyciA6PSBhbS5rZWVwZXIuT25SZWN2SWJjVG9wUmFua1BhY2tldChjdHgsIG1vZHVsZVBhY2tldCwgKnBhY2tldC5JYmNUb3BSYW5rUGFja2V0KQogICAgaWYgZXJyICE9IG5pbCB7CiAgICAgICAgYWNrID0gY2hhbm5lbHR5cGVzLk5ld0Vycm9yQWNrbm93bGVkZ2VtZW50KGVyci5FcnJvcigpKQogICAgfSBlbHNlIHsKICAgICAgICAvLyBFbmNvZGUgcGFja2V0IGFja25vd2xlZGdlbWVudAogICAgICAgIHBhY2tldEFja0J5dGVzLCBlcnIgOj0gdHlwZXMuTW9kdWxlQ2RjLk1hcnNoYWxKU09OKCZhbXA7cGFja2V0QWNrKQogICAgICAgIGlmIGVyciAhPSBuaWwgewogICAgICAgICAgICByZXR1cm4gY2hhbm5lbHR5cGVzLk5ld0Vycm9yQWNrbm93bGVkZ2VtZW50KHNka2Vycm9ycy5XcmFwKHNka2Vycm9ycy5FcnJKU09OTWFyc2hhbCwgZXJyLkVycm9yKCkpLkVycm9yKCkpCiAgICAgICAgfQogICAgICAgIGFjayA9IGNoYW5uZWx0eXBlcy5OZXdSZXN1bHRBY2tub3dsZWRnZW1lbnQoc2RrLk11c3RTb3J0SlNPTihwYWNrZXRBY2tCeXRlcykpCiAgICB9CiAgICBjdHguRXZlbnRNYW5hZ2VyKCkuRW1pdEV2ZW50KAogICAgICAgIHNkay5OZXdFdmVudCgKICAgICAgICAgICAgdHlwZXMuRXZlbnRUeXBlSWJjVG9wUmFua1BhY2tldCwKICAgICAgICAgICAgc2RrLk5ld0F0dHJpYnV0ZShzZGsuQXR0cmlidXRlS2V5TW9kdWxlLCB0eXBlcy5Nb2R1bGVOYW1lKSwKICAgICAgICAgICAgc2RrLk5ld0F0dHJpYnV0ZSh0eXBlcy5BdHRyaWJ1dGVLZXlBY2tTdWNjZXNzLCBmbXQuU3ByaW50ZigmcXVvdDsldCZxdW90OywgZXJyICE9IG5pbCkpLAogICAgICAgICksCiAgICApCg==",url:"https://github.com/b9lab/cosmos-ibc-docker/blob/main/separate/leaderboard/ida-content/x/leaderboard/module_ibc.go#L144"}}),e._v(" "),t("p",[e._v("The first line of code in the case statement calls the application's "),t("code",[e._v("OnRecvIbcTopRankPacket")]),e._v(" callback on the keeper to process the reception of the packet:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gT25SZWN2SWJjVG9wUmFua1BhY2tldCBwcm9jZXNzZXMgcGFja2V0IHJlY2VwdGlvbgpmdW5jIChrIEtlZXBlcikgT25SZWN2SWJjVG9wUmFua1BhY2tldChjdHggc2RrLkNvbnRleHQsIHBhY2tldCBjaGFubmVsdHlwZXMuUGFja2V0LCBkYXRhIHR5cGVzLkliY1RvcFJhbmtQYWNrZXREYXRhKSAocGFja2V0QWNrIHR5cGVzLkliY1RvcFJhbmtQYWNrZXRBY2ssIGVyciBlcnJvcikgewogICAgLy8gdmFsaWRhdGUgcGFja2V0IGRhdGEgdXBvbiByZWNlaXZpbmcKICAgIGlmIGVyciA6PSBkYXRhLlZhbGlkYXRlQmFzaWMoKTsgZXJyICE9IG5pbCB7CiAgICAgICAgcmV0dXJuIHBhY2tldEFjaywgZXJyCiAgICB9CgogICAgLy8gVE9ETzogcGFja2V0IHJlY2VwdGlvbiBsb2dpYwoKICAgIHJldHVybiBwYWNrZXRBY2ssIG5pbAp9Cg==",url:"https://github.com/b9lab/cosmos-ibc-docker/blob/main/separate/leaderboard/ida-content/x/leaderboard/keeper/ibc_top_rank.go#L70"}}),e._v(" "),t("HighlightBox",{attrs:{type:"note"}},[t("p",[e._v("Remember that the "),t("code",[e._v("OnRecvPacket")]),e._v(" callback writes an acknowledgement as well (this course covers the synchronous write ack case).")])]),e._v(" "),t("h3",{attrs:{id:"acknowledging-packets"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#acknowledging-packets"}},[e._v("#")]),e._v(" Acknowledging packets")]),e._v(" "),t("p",[e._v("Similarly to the "),t("code",[e._v("OnRecvPacket")]),e._v(" case before, Ignite CLI has already prepared the structure of the "),t("code",[e._v("OnAcknowledgementPacket")]),e._v(" with the switch statement. Again, scaffolding the packet adds a case to the switch:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gQCBzd2l0Y2ggcGFja2V0IDo9IG1vZHVsZVBhY2tldERhdGEuUGFja2V0Lih0eXBlKSBpbiBPbkFja25vd2xlZGdlbWVudFBhY2tldApjYXNlICp0eXBlcy5MZWFkZXJib2FyZFBhY2tldERhdGFfSWJjVG9wUmFua1BhY2tldDoKICAgIGVyciA6PSBhbS5rZWVwZXIuT25BY2tub3dsZWRnZW1lbnRJYmNUb3BSYW5rUGFja2V0KGN0eCwgbW9kdWxlUGFja2V0LCAqcGFja2V0LkliY1RvcFJhbmtQYWNrZXQsIGFjaykKICAgIGlmIGVyciAhPSBuaWwgewogICAgICAgIHJldHVybiBlcnIKICAgIH0KICAgIGV2ZW50VHlwZSA9IHR5cGVzLkV2ZW50VHlwZUliY1RvcFJhbmtQYWNrZXQK"}}),e._v(" "),t("p",[e._v("This calls into the newly created application keeper's ack packet callback:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAoayBLZWVwZXIpIE9uQWNrbm93bGVkZ2VtZW50SWJjVG9wUmFua1BhY2tldChjdHggc2RrLkNvbnRleHQsIHBhY2tldCBjaGFubmVsdHlwZXMuUGFja2V0LCBkYXRhIHR5cGVzLkliY1RvcFJhbmtQYWNrZXREYXRhLCBhY2sgY2hhbm5lbHR5cGVzLkFja25vd2xlZGdlbWVudCkgZXJyb3IgewogICAgc3dpdGNoIGRpc3BhdGNoZWRBY2sgOj0gYWNrLlJlc3BvbnNlLih0eXBlKSB7CiAgICBjYXNlICpjaGFubmVsdHlwZXMuQWNrbm93bGVkZ2VtZW50X0Vycm9yOgoKICAgICAgICAvLyBUT0RPOiBmYWlsZWQgYWNrbm93bGVkZ2VtZW50IGxvZ2ljCiAgICAgICAgXyA9IGRpc3BhdGNoZWRBY2suRXJyb3IKCiAgICAgICAgcmV0dXJuIG5pbAogICAgY2FzZSAqY2hhbm5lbHR5cGVzLkFja25vd2xlZGdlbWVudF9SZXN1bHQ6CiAgICAgICAgLy8gRGVjb2RlIHRoZSBwYWNrZXQgYWNrbm93bGVkZ2VtZW50CiAgICAgICAgdmFyIHBhY2tldEFjayB0eXBlcy5JYmNUb3BSYW5rUGFja2V0QWNrCgogICAgICAgIGlmIGVyciA6PSB0eXBlcy5Nb2R1bGVDZGMuVW5tYXJzaGFsSlNPTihkaXNwYXRjaGVkQWNrLlJlc3VsdCwgJmFtcDtwYWNrZXRBY2spOyBlcnIgIT0gbmlsIHsKICAgICAgICAgICAgLy8gVGhlIGNvdW50ZXItcGFydHkgbW9kdWxlIGRvZXNuJ3QgaW1wbGVtZW50IHRoZSBjb3JyZWN0IGFja25vd2xlZGdlbWVudCBmb3JtYXQKICAgICAgICAgICAgcmV0dXJuIGVycm9ycy5OZXcoJnF1b3Q7Y2Fubm90IHVubWFyc2hhbCBhY2tub3dsZWRnZW1lbnQmcXVvdDspCiAgICAgICAgfQoKICAgICAgICAvLyBUT0RPOiBzdWNjZXNzZnVsIGFja25vd2xlZGdlbWVudCBsb2dpYwoKICAgICAgICByZXR1cm4gbmlsCiAgICBkZWZhdWx0OgogICAgICAgIC8vIFRoZSBjb3VudGVyLXBhcnR5IG1vZHVsZSBkb2Vzbid0IGltcGxlbWVudCB0aGUgY29ycmVjdCBhY2tub3dsZWRnZW1lbnQgZm9ybWF0CiAgICAgICAgcmV0dXJuIGVycm9ycy5OZXcoJnF1b3Q7aW52YWxpZCBhY2tub3dsZWRnZW1lbnQgZm9ybWF0JnF1b3Q7KQogICAgfQp9Cg==",url:"https://github.com/b9lab/cosmos-ibc-docker/blob/main/separate/leaderboard/ida-content/x/leaderboard/keeper/ibc_top_rank.go#L119"}}),e._v(" "),t("p",[e._v("This allows us to add custom application logic for both failed and successful acks.")]),e._v(" "),t("h3",{attrs:{id:"timing-out-packets"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#timing-out-packets"}},[e._v("#")]),e._v(" Timing out packets")]),e._v(" "),t("p",[e._v("Timing out the packets follows the same flow, adding a case to the switch statement in "),t("code",[e._v("OnTimeoutPacket")]),e._v(", calling into the keeper's timeout packet callback where the custom logic can be implemented. It is left to the reader to investigate this independently.")]),e._v(" "),t("h3",{attrs:{id:"extra-details"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#extra-details"}},[e._v("#")]),e._v(" Extra details")]),e._v(" "),t("p",[e._v("Next to the above, some additions have also been made to the "),t("code",[e._v("types")]),e._v(" package. These include "),t("a",{attrs:{href:"https://github.com/b9lab/cosmos-ibc-docker/blob/main/separate/leaderboard/ida-content/x/leaderboard/types/codec.go",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("codec.go")]),t("OutboundLink")],1),e._v(", "),t("a",{attrs:{href:"https://github.com/b9lab/cosmos-ibc-docker/blob/main/separate/leaderboard/ida-content/x/leaderboard/types/events_ibc.go",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("events_ibc.go")]),t("OutboundLink")],1),e._v(", and "),t("a",{attrs:{href:"https://github.com/b9lab/cosmos-ibc-docker/blob/main/separate/leaderboard/ida-content/x/leaderboard/types/messages_ibc_top_rank.go",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("messages_ibc_top_rank.go")]),t("OutboundLink")],1),e._v(".")]),e._v(" "),t("p",[e._v("Again, the reader is invited to check these out independently.")]),e._v(" "),t("HighlightBox",{attrs:{type:"info"}},[t("p",[e._v("Events in IBC are important because relayers process events to check if there are packets (or acknowledgements) to relay.\n"),t("br"),t("br"),e._v("\nIgnite CLI has scaffolded some events in "),t("code",[e._v("x/leaderboard/types/events_ibc.go")]),e._v(" for timeout and the "),t("code",[e._v("ibcTopRank")]),e._v(" packet which you have defined:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"cGFja2FnZSB0eXBlcwoKLy8gSUJDIGV2ZW50cwpjb25zdCAoCiAgICBFdmVudFR5cGVUaW1lb3V0ICAgICAgICAgID0gJnF1b3Q7dGltZW91dCZxdW90OwogICAgRXZlbnRUeXBlSWJjVG9wUmFua1BhY2tldCA9ICZxdW90O2liY1RvcFJhbmtfcGFja2V0JnF1b3Q7CiAgICAvLyB0aGlzIGxpbmUgaXMgdXNlZCBieSBzdGFycG9ydCBzY2FmZm9sZGluZyAjIGliYy9wYWNrZXQvZXZlbnQKCiAgICBBdHRyaWJ1dGVLZXlBY2tTdWNjZXNzID0gJnF1b3Q7c3VjY2VzcyZxdW90OwogICAgQXR0cmlidXRlS2V5QWNrICAgICAgICA9ICZxdW90O2Fja25vd2xlZGdlbWVudCZxdW90OwogICAgQXR0cmlidXRlS2V5QWNrRXJyb3IgICA9ICZxdW90O2Vycm9yJnF1b3Q7CikK",url:"https://github.com/b9lab/cosmos-ibc-docker/blob/main/separate/leaderboard/ida-content/x/leaderboard/types/events_ibc.go"}}),e._v(" "),t("p",[e._v("Here are found both the "),t("code",[e._v("Event")]),e._v(" type and the attributes it contains.\n"),t("br"),t("br"),e._v("\nThese are not the only relevant events for IBC, though, the others can be found in the core IBC source code:")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://github.com/cosmos/ibc-go/blob/main/modules/core/02-client/types/events.go",target:"_blank",rel:"noopener noreferrer"}},[e._v("Client events"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/cosmos/ibc-go/blob/main/modules/core/03-connection/types/events.go",target:"_blank",rel:"noopener noreferrer"}},[e._v("Connection events"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/cosmos/ibc-go/blob/main/modules/core/04-channel/types/events.go",target:"_blank",rel:"noopener noreferrer"}},[e._v("Channel events"),t("OutboundLink")],1)])]),e._v(" "),t("p",[e._v("You can go back to the code examined so far to take note of the events emitted.")])],1),e._v(" "),t("HighlightBox",{attrs:{type:"synopsis"}},[t("p",[e._v("To summarize, this section has explored:")]),e._v(" "),t("ul",[t("li",[e._v("Scaffolding a chain with an IBC-enabled module, with both chain and module called leaderboard.")]),e._v(" "),t("li",[e._v("How Ignite CLI made sure to implement the "),t("code",[e._v("IBCModule")]),e._v(" interface, including channel handshake and packet callbacks.")]),e._v(" "),t("li",[e._v("How Ignite CLI has bound our IBC module to a port and added a route to the IBC router.")]),e._v(" "),t("li",[e._v("Scaffolding an IBC packet, "),t("code",[e._v("IbcTopRankPacket")]),e._v(".")]),e._v(" "),t("li",[e._v("How Ignite CLI defined the packet and ack data.")]),e._v(" "),t("li",[e._v("How Ignite CLI sets up the basic message handling and packet handling to send, receive, acknowledge, and timeout packets.")])])]),e._v(" "),t("HighlightBox",{attrs:{type:"note"}},[t("p",[e._v("Even though the ability to send and receive packets is now enabled, no application logic to execute has yet been implemented. This is outside the scope of this section. The reader is invited to follow the "),t("RouterLink",{attrs:{to:"/hands-on-exercise/5-ibc-adv/6-ibc-app-checkers.html"}},[e._v("checkers blockchain extension exercise")]),e._v(".")],1)]),e._v(" "),t("HighlightBox",{attrs:{type:"note"}},[t("p",[e._v("When scaffolding a packet, Ignite CLI will ensure the chain can act both as the sender or receiver of a packet by default. This is a symmetrical setup which makes sense for some applications, like ICS20.\n"),t("br"),t("br"),e._v("\nHowever, it is also possible to have an asymmetrical setup where one chain will always be the source "),t("em",[e._v("or")]),e._v(" destination chain for a given packet, not both. In this case, the message server and packet callbacks can be updated to error when, for example, a chain receives a packet though it is supposed to exclusively be the destination chain. Interchain Accounts or ICS27 is an example of this asymmetrical situation, as is the checkers extension exercise.")])])],1)}),[],!1,null,null,null);a.default=o.exports}}]);