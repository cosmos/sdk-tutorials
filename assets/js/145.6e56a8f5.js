(window.webpackJsonp=window.webpackJsonp||[]).push([[145],{762:function(e,t,a){"use strict";a.r(t);var o=a(1),c=Object(o.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"simulate-production-in-docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#simulate-production-in-docker"}},[e._v("#")]),e._v(" Simulate Production in Docker")]),e._v(" "),a("HighlightBox",{attrs:{type:"prerequisite"}},[a("p",[e._v("Make sure you have everything you need before proceeding:")]),e._v(" "),a("ul",[a("li",[e._v("You understand the concepts of "),a("RouterLink",{attrs:{to:"/tutorials/9-path-to-prod/"}},[e._v("production")]),e._v(".")],1),e._v(" "),a("li",[e._v("Docker is installed and you "),a("RouterLink",{attrs:{to:"/tutorials/5-docker-intro/"}},[e._v("understand it")]),e._v(".")],1),e._v(" "),a("li",[e._v("You have the checkers "),a("strong",[e._v("Go")]),e._v(" blockchain codebase with the CosmJS elements. If not, follow the "),a("RouterLink",{attrs:{to:"/hands-on-exercise/3-cosmjs-adv/5-server-side.html"}},[e._v("previous steps")]),e._v(" or check out the "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/tree/cosmjs-elements",target:"_blank",rel:"noopener noreferrer"}},[e._v("relevant version"),a("OutboundLink")],1),e._v(".")],1),e._v(" "),a("li",[e._v("You have the checkers "),a("strong",[e._v("CosmJS")]),e._v(" codebase. If not, follow the "),a("RouterLink",{attrs:{to:"/hands-on-exercise/3-cosmjs-adv/5-server-side.html"}},[e._v("previous steps")]),e._v(" or checkout the "),a("a",{attrs:{href:"https://github.com/cosmos/academy-checkers-ui/tree/server-indexing",target:"_blank",rel:"noopener noreferrer"}},[e._v("relevant version"),a("OutboundLink")],1),e._v(".")],1)])]),e._v(" "),a("HighlightBox",{attrs:{type:"learning"}},[a("p",[e._v("In this section, you will:")]),e._v(" "),a("ul",[a("li",[e._v("Prepare Docker elements.")]),e._v(" "),a("li",[e._v("Handle keys.")]),e._v(" "),a("li",[e._v("Prepare blockchain nodes.")]),e._v(" "),a("li",[e._v("Prepare a blockchain genesis.")]),e._v(" "),a("li",[e._v("Compose the lot in one orchestrated ensemble.")]),e._v(" "),a("li",[e._v("Test it.")])])]),e._v(" "),a("p",[e._v("Before you launch yourself fully into production, it would be interesting to simulate a set of independent nodes on your computer. This can be prepared and orchestrated with "),a("a",{attrs:{href:"https://docs.docker.com/get-started/08_using_compose",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker Compose"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("h2",{attrs:{id:"target-setup"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#target-setup"}},[e._v("#")]),e._v(" Target setup")]),e._v(" "),a("p",[e._v("In order to mimic a real setup, find an objective on which to focus. Here the objective is:")]),e._v(" "),a("ul",[a("li",[e._v("Three independent parties - Alice, Bob, and Carol.")]),e._v(" "),a("li",[e._v("Two independent validator nodes, run by Alice and Bob respectively, that can only communicate with their own sentries and do not expose RPC endpoints.")]),e._v(" "),a("li",[e._v("Additionally, Alice's validator node uses Tendermint Key Management System (TMKMS) on a separate machine.")]),e._v(" "),a("li",[e._v("The two sentry nodes, run by Alice and Bob, expose endpoints to the "),a("em",[e._v("world")]),e._v(".")]),e._v(" "),a("li",[e._v("A regular node, run by Carol, that can communicate with the "),a("em",[e._v("world")]),e._v(" and exposes endpoints for use by clients.")])]),e._v(" "),a("h2",{attrs:{id:"docker-elements"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-elements"}},[e._v("#")]),e._v(" Docker elements")]),e._v(" "),a("p",[e._v("Before looking at the specific Compose elements, you need to define what the "),a("em",[e._v("regular")]),e._v(" Docker elements are.")]),e._v(" "),a("p",[e._v("You will run containers. You can start by giving them meaningful names:")]),e._v(" "),a("ul",[a("li",[e._v("Alice's containers: "),a("code",[e._v("sentry-alice")]),e._v(", "),a("code",[e._v("val-alice")]),e._v(", and "),a("code",[e._v("kms-alice")]),e._v(".")]),e._v(" "),a("li",[e._v("Bob's containers: "),a("code",[e._v("sentry-bob")]),e._v(" and "),a("code",[e._v("val-bob")]),e._v(".")]),e._v(" "),a("li",[e._v("Carol's container: "),a("code",[e._v("node-carol")]),e._v(".")])]),e._v(" "),a("p",[e._v("Docker lets you simulate private networks. To meaningfully achieve the above target setup in terms of network separation, you use Docker's user-defined networks. This means:")]),e._v(" "),a("ul",[a("li",[e._v("Alice's validator and key management system (KMS) are on their private network: name it "),a("code",[e._v("net-alice-kms")]),e._v(".")]),e._v(" "),a("li",[e._v("Alice's validator and sentry are on their private network: name it "),a("code",[e._v("net-alice")]),e._v(".")]),e._v(" "),a("li",[e._v("Bob's validator and sentry are on their private network: name it "),a("code",[e._v("net-bob")]),e._v(".")]),e._v(" "),a("li",[e._v("There is a public network, i.e. "),a("em",[e._v("the world")]),e._v(", on which both sentries and Carol's node run: name it "),a("code",[e._v("net-public")]),e._v(".")])]),e._v(" "),a("p",[e._v("Although every machine on the network is a bit different, in terms of Docker images there are only two image types:")]),e._v(" "),a("ol",[a("li",[e._v("The Tendermint nodes (validators, sentries, and regular nodes) will run "),a("code",[e._v("checkersd")]),e._v(" within containers created from a single Docker image.")]),e._v(" "),a("li",[e._v("The Tendermint KMS node will run TMKMS from a different Docker image.")])]),e._v(" "),a("h3",{attrs:{id:"the-node-image"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#the-node-image"}},[e._v("#")]),e._v(" The node image")]),e._v(" "),a("p",[e._v("The node image contains, and runs by default, the checkers executable. You first have to compile it, and then build the image.")]),e._v(" "),a("p",[e._v("First, build the executable(s) that will be launched by Docker Compose within the Docker images. Depending on your platform, you will use "),a("code",[e._v("checkersd-linux-amd64")]),e._v(" or "),a("code",[e._v("checkersd-linux-arm64")]),e._v(".")]),e._v(" "),a("p",[e._v("Update your "),a("code",[e._v("Makefile")]),e._v(" with:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"lang-makefile",base64:"YnVpbGQtbGludXg6CiAgICBHT09TPWxpbnV4IEdPQVJDSD1hbWQ2NCBnbyBidWlsZCAtbyAuL2J1aWxkL2NoZWNrZXJzZC1saW51eC1hbWQ2NCAuL2NtZC9jaGVja2Vyc2QvbWFpbi5nbwogICAgR09PUz1saW51eCBHT0FSQ0g9YXJtNjQgZ28gYnVpbGQgLW8gLi9idWlsZC9jaGVja2Vyc2QtbGludXgtYXJtNjQgLi9jbWQvY2hlY2tlcnNkL21haW4uZ28KCmRvLWNoZWNrc3VtLWxpbnV4OgogICAgY2QgYnVpbGQgJmFtcDsmYW1wOyBzaGEyNTZzdW0gXAogICAgICAgIGNoZWNrZXJzZC1saW51eC1hbWQ2NCBjaGVja2Vyc2QtbGludXgtYXJtNjQgXAogICAgICAgICZndDsgY2hlY2tlcnMtY2hlY2tzdW0tbGludXgKCmJ1aWxkLWxpbnV4LXdpdGgtY2hlY2tzdW06IGJ1aWxkLWxpbnV4IGRvLWNoZWNrc3VtLWxpbnV4CgpidWlsZC1kYXJ3aW46CiAgICBHT09TPWRhcndpbiBHT0FSQ0g9YW1kNjQgZ28gYnVpbGQgLW8gLi9idWlsZC9jaGVja2Vyc2QtZGFyd2luLWFtZDY0IC4vY21kL2NoZWNrZXJzZC9tYWluLmdvCiAgICBHT09TPWRhcndpbiBHT0FSQ0g9YXJtNjQgZ28gYnVpbGQgLW8gLi9idWlsZC9jaGVja2Vyc2QtZGFyd2luLWFybTY0IC4vY21kL2NoZWNrZXJzZC9tYWluLmdvCgpidWlsZC1hbGw6IGJ1aWxkLWxpbnV4IGJ1aWxkLWRhcndpbgoKZG8tY2hlY2tzdW0tZGFyd2luOgogICAgY2QgYnVpbGQgJmFtcDsmYW1wOyBzaGEyNTZzdW0gXAogICAgICAgIGNoZWNrZXJzZC1kYXJ3aW4tYW1kNjQgY2hlY2tlcnNkLWRhcndpbi1hcm02NCBcCiAgICAgICAgJmd0OyBjaGVja2Vycy1jaGVja3N1bS1kYXJ3aW4KCmJ1aWxkLWRhcndpbi13aXRoLWNoZWNrc3VtOiBidWlsZC1hbGwtZGFyd2luIGRvLWNoZWNrc3VtLWRhcndpbgoKYnVpbGQtd2l0aC1jaGVja3N1bTogYnVpbGQtbGludXgtd2l0aC1jaGVja3N1bSBidWlsZC1kYXJ3aW4td2l0aC1jaGVja3N1bQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/run-prod/Makefile#L33-L45"}}),e._v(" "),a("p",[e._v("If you have a CPU architecture that is neither "),a("code",[e._v("amd64")]),e._v(" nor "),a("code",[e._v("arm64")]),e._v(", update your "),a("code",[e._v("Makefile")]),e._v(" accordingly.")]),e._v(" "),a("HighlightBox",{attrs:{type:"note"}},[a("p",[e._v("If you copy-pasted directly into "),a("code",[e._v("Makefile")]),e._v(", do not forget to convert the spaces into tabs.")])]),e._v(" "),a("p",[e._v("Now run either command:")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"Local"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBtYWtlIGJ1aWxkLXdpdGgtY2hlY2tzdW0K"}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"With checkers_i"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IFwKICAgIC12ICQocHdkKTovY2hlY2tlcnMgXAogICAgLXcgL2NoZWNrZXJzIFwKICAgIGNoZWNrZXJzX2kgXAogICAgbWFrZSBidWlsZC13aXRoLWNoZWNrc3VtCg=="}}),e._v(" "),a("p",[e._v("Use this command if you already built this "),a("code",[e._v("checkers_i")]),e._v(" image, as this will take less time.")])],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"With golang:1.18.7"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IFwKICAgIC12ICQocHdkKTovY2hlY2tlcnMgXAogICAgLXcgL2NoZWNrZXJzIFwKICAgIGdvbGFuZzoxLjE4LjcgXAogICAgbWFrZSBidWlsZC13aXRoLWNoZWNrc3VtCg=="}}),e._v(" "),a("p",[e._v("Use this command if you did not already have the "),a("code",[e._v("checkers_i")]),e._v(" image. This command may take longer but should always work.")])],1)],1),e._v(" "),a("hr"),e._v(" "),a("p",[e._v("Now include the relevant executable inside your "),a("strong",[e._v("production")]),e._v(" image. You need to use a Debian/Ubuntu base image because you compiled on one in the previous step. Create a new "),a("code",[e._v("Dockerfile-checkersd-debian")]),e._v(" with:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"ockerfile",base64:"RlJPTSAtLXBsYXRmb3JtPWxpbnV4IGRlYmlhbjoxMS1zbGltCkFSRyBCVUlMREFSQ0gKCkVOViBMT0NBTD0vdXNyL2xvY2FsCgpDT1BZIGJ1aWxkL2NoZWNrZXJzZC1saW51eC0ke0JVSUxEQVJDSH0gJHtMT0NBTH0vYmluL2NoZWNrZXJzZAoKRU5UUllQT0lOVCBbICZxdW90O2NoZWNrZXJzZCZxdW90OyBdCg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/run-prod/prod-sim/Dockerfile-checkersd-debian"}}),e._v(" "),a("p",[e._v("Build the image with:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgYnVpbGQgLWYgcHJvZC1zaW0vRG9ja2VyZmlsZS1jaGVja2Vyc2QtZGViaWFuIC4gLXQgY2hlY2tlcnNkX2kK"}}),e._v(" "),a("ExpansionPanel",{attrs:{title:"Troubleshooting"}},[a("p",[e._v("Depending on your installed version of Docker, you may have to add the flags:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"txt",base64:"LS1idWlsZC1hcmcgQlVJTERBUkNIPWFtZDY0Cg=="}}),e._v(" "),a("p",[e._v("Or just manually replace "),a("code",[e._v("${BUILDARCH}")]),e._v(" with "),a("code",[e._v("amd64")]),e._v(" or whichever is your architecture.")])],1),e._v(" "),a("ExpansionPanel",{attrs:{title:"With alpine"}},[a("p",[e._v("Because you want to simulate production, you can make the case that you prefer to use the smaller "),a("code",[e._v("alpine")]),e._v(" Docker image. Alpine and Debian use different C compilers with different "),a("strong",[e._v("dynamically")]),e._v("-linked C library dependencies. This makes their compiled executables incompatible – at least with the "),a("code",[e._v("go build")]),e._v(" commands as they are declared in the Makefile.")]),e._v(" "),a("p",[e._v("In this case, you have the choice between:")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("Compiling from within alpine, using a "),a("a",{attrs:{href:"https://docs.docker.com/build/building/multi-stage/",target:"_blank",rel:"noopener noreferrer"}},[e._v("multi-stage Docker build"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"ockerfile",base64:"RlJPTSAtLXBsYXRmb3JtPWxpbnV4IGdvbGFuZzoxLjE4LjctYWxwaW5lIEFTIGJ1aWxkZXIKClJVTiBhcGsgdXBkYXRlClJVTiBhcGsgYWRkIG1ha2UKCldPUktESVIgL29yaWdpbmFsCkFERCAuIC9vcmlnaW5hbApSVU4gZ28gYnVpbGQgLW8gLi9idWlsZC9jaGVja2Vyc2QgLi9jbWQvY2hlY2tlcnNkL21haW4uZ28KCkZST00gLS1wbGF0Zm9ybT1saW51eCBhbHBpbmUKCkVOViBMT0NBTD0vdXNyL2xvY2FsCgpDT1BZIC0tZnJvbT1idWlsZGVyIC9vcmlnaW5hbC9idWlsZC9jaGVja2Vyc2QgJHtMT0NBTH0vYmluL2NoZWNrZXJzZAoKRU5UUllQT0lOVCBbICZxdW90O2NoZWNrZXJzZCZxdW90OyBdCg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/run-prod/prod-sim/Dockerfile-checkersd-alpine"}}),e._v(" "),a("p",[e._v("Then building the image with:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgYnVpbGQgLWYgcHJvZC1zaW0vRG9ja2VyZmlsZS1jaGVja2Vyc2QtYWxwaW5lIC4gLXQgY2hlY2tlcnNkX2kK"}})],1),e._v(" "),a("li",[a("p",[e._v("Instructing the compiler to link the C libraries "),a("strong",[e._v("statically")]),e._v(" with the use of the "),a("code",[e._v("CGO_ENABLED=0")]),e._v(" "),a("a",{attrs:{href:"https://medium.com/pragmatic-programmers/compiling-your-go-application-for-co-ntainers-b513190471aa",target:"_blank",rel:"noopener noreferrer"}},[e._v("option"),a("OutboundLink")],1),e._v(" in "),a("code",[e._v("go build")]),e._v(", or even in your "),a("code",[e._v("Makefile")]),e._v(":")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff-make",base64:"ICAgIGJ1aWxkLWxpbnV4OgotICAgICAgR09PUz1saW51eCBHT0FSQ0g9YW1kNjQgZ28gYnVpbGQgLW8gLi9idWlsZC9jaGVja2Vyc2QtbGludXgtYW1kNjQgLi9jbWQvY2hlY2tlcnNkL21haW4uZ28KLSAgICAgIEdPT1M9bGludXggR09BUkNIPWFybTY0IGdvIGJ1aWxkIC1vIC4vYnVpbGQvY2hlY2tlcnNkLWxpbnV4LWFybTY0IC4vY21kL2NoZWNrZXJzZC9tYWluLmdvCisgICAgICBDR09fRU5BQkxFRD0wIEdPT1M9bGludXggR09BUkNIPWFtZDY0IGdvIGJ1aWxkIC1vIC4vYnVpbGQvY2hlY2tlcnNkLWxpbnV4LWFtZDY0IC4vY21kL2NoZWNrZXJzZC9tYWluLmdvCisgICAgICBDR09fRU5BQkxFRD0wIEdPT1M9bGludXggR09BUkNIPWFybTY0IGdvIGJ1aWxkIC1vIC4vYnVpbGQvY2hlY2tlcnNkLWxpbnV4LWFybTY0IC4vY21kL2NoZWNrZXJzZC9tYWluLmdvCg=="}}),e._v(" "),a("p",[e._v("Then run "),a("code",[e._v("make build-with-checksum")]),e._v(" again and use "),a("code",[e._v("alpine")]),e._v(" in a new Dockerfile:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"ockerfile",base64:"RlJPTSAtLXBsYXRmb3JtPWxpbnV4IGFscGluZQpBUkcgQlVJTERBUkNICgpFTlYgTE9DQUw9L3Vzci9sb2NhbAoKQ09QWSBidWlsZC9jaGVja2Vyc2QtbGludXgtJHtCVUlMREFSQ0h9ICR7TE9DQUx9L2Jpbi9jaGVja2Vyc2QKCkVOVFJZUE9JTlQgWyAmcXVvdDtjaGVja2Vyc2QmcXVvdDsgXQo="}})],1)]),e._v(" "),a("p",[e._v("For maximum portability of your executables, you may in fact want to add "),a("code",[e._v("CGO_ENABLED=0")]),e._v(" to all your "),a("code",[e._v("go build")]),e._v(" commands.")])]),e._v(" "),a("p",[e._v("Now you can run it:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IGNoZWNrZXJzZF9pIGhlbHAK"}}),e._v(" "),a("p",[e._v("You should see a recognizable list of commands.")]),e._v(" "),a("p",[e._v("Each Docker container will run "),a("code",[e._v("checkersd")]),e._v(" as "),a("code",[e._v("root")]),e._v(", which does not matter because it all happens in a container. Therefore, there is no need to create a specific additional user like you would in a serious production setting. For the same reason, there is also no need to create a service to launch it.")]),e._v(" "),a("h3",{attrs:{id:"the-key-manager-image"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#the-key-manager-image"}},[e._v("#")]),e._v(" The key manager image")]),e._v(" "),a("p",[e._v("Alice runs the "),a("a",{attrs:{href:"https://github.com/iqlusioninc/tmkms",target:"_blank",rel:"noopener noreferrer"}},[e._v("Tendermint Key Management System"),a("OutboundLink")],1),e._v(" on a separate machine. You need to prepare its image. The image will contain the executable, which you have to compile from its Rust code.")]),e._v(" "),a("p",[e._v("There are several considerations to clarify:")]),e._v(" "),a("ul",[a("li",[e._v("How will you build it?")]),e._v(" "),a("li",[e._v("What device will store the key?")]),e._v(" "),a("li",[e._v("What KMS version works with your node version?")])]),e._v(" "),a("p",[e._v("The "),a("strong",[e._v("build step")]),e._v(" is a good opportunity to use a "),a("a",{attrs:{href:"https://docs.docker.com/build/building/multi-stage/",target:"_blank",rel:"noopener noreferrer"}},[e._v("multi-stage Docker build"),a("OutboundLink")],1),e._v(". With this technique:")]),e._v(" "),a("ol",[a("li",[e._v("You define a disposable image (the first stage) that clones the code and compiles it. This involves the download of Rust crates (i.e. packages). This image ends up being large but is then disposed of.")]),e._v(" "),a("li",[e._v("You define a slim image (the second stage) in which you only copy the compiled file. This is the image you keep for production. It ends up being small.")])]),e._v(" "),a("p",[e._v("The disposable image needs to use Rust of at least version 1.56. Fortunately, there are ready-made Docker images. Pick "),a("a",{attrs:{href:"https://hub.docker.com/layers/library/rust/1.64.0/images/sha256-44ba8b8d8a2993694926cc847e1cce27937550c2e9eade4d9887ba90b2a2063f",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("rust:1.64.0")]),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("p",[e._v("Next, the executable needs to be compiled for the specific "),a("strong",[e._v("device")]),e._v(" onto which your key will be stored. You do not use hardware keys in this setup. So, when building it, you use the "),a("a",{attrs:{href:"https://github.com/iqlusioninc/tmkms/blob/c56b496e1bb1187482d7a6fad23c4566329c951e/src/keyring/providers/softsign.rs",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("softsign")]),e._v(" extension"),a("OutboundLink")],1),e._v(". This is achieved by adding the flag "),a("code",[e._v("--features=softsign")]),e._v(".")]),e._v(" "),a("p",[e._v("Finally, what "),a("strong",[e._v("version")]),e._v(" of the TMKMS should you compile? A given TMKMS version can work with a limited set of specific Tendermint versions. Find the Tendermint version of your checkers code with:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBncmVwIHRlbmRlcm1pbnQvdGVuZGVybWludCBnby5tb2QK"}}),e._v(" "),a("p",[e._v("It should return something like this:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"txt",base64:"Z2l0aHViLmNvbS90ZW5kZXJtaW50L3RlbmRlcm1pbnQgdjAuMzQuMTkK"}}),e._v(" "),a("HighlightBox",{attrs:{type:"tip"}},[a("p",[e._v("Because here it is version 0.34, it is a good idea to use the KMS from "),a("a",{attrs:{href:"https://github.com/iqlusioninc/tmkms/blob/main/CHANGELOG.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("version 0.10.0"),a("OutboundLink")],1),e._v(" upwards. At the time of writing, "),a("strong",[e._v("version 0.12.2")]),e._v(" still seems to support Tendermint v0.34. It is under the "),a("a",{attrs:{href:"https://github.com/iqlusioninc/tmkms/tree/v0.12.2",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("v0.12.2")]),a("OutboundLink")],1),e._v(" tag on Github. Pick this one.")])]),e._v(" "),a("p",[e._v("Having collected the requisites, you can create the multi-staged Docker image in a new "),a("code",[e._v("Dockerfile-ubuntu-tmkms")]),e._v(":")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"With debian"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"ockerfile",base64:"RlJPTSAtLXBsYXRmb3JtPWxpbnV4IHJ1c3Q6MS42NC4wIEFTIGJ1aWxkZXIKClJVTiBhcHQtZ2V0IHVwZGF0ZQpSVU4gYXB0LWdldCBpbnN0YWxsIGxpYnVzYi0xLjAtMC1kZXYgLS15ZXMKCkVOViBMT0NBTD0vdXNyL2xvY2FsCkVOViBSVVNURkxBR1M9LUN0YXJnZXQtZmVhdHVyZT0rYWVzLCtzc3NlMwpFTlYgVE1LTVNfVkVSU0lPTj12MC4xMi4yCgpXT1JLRElSIC9yb290ClJVTiBnaXQgY2xvbmUgLS1icmFuY2ggJHtUTUtNU19WRVJTSU9OfSBodHRwczovL2dpdGh1Yi5jb20vaXFsdXNpb25pbmMvdG1rbXMuZ2l0CldPUktESVIgL3Jvb3QvdG1rbXMKUlVOIGNhcmdvIGJ1aWxkIC0tcmVsZWFzZSAtLWZlYXR1cmVzPXNvZnRzaWduCgojIFRoZSBwcm9kdWN0aW9uIGltYWdlIHN0YXJ0cyBoZXJlCkZST00gLS1wbGF0Zm9ybT1saW51eCBkZWJpYW46MTEtc2xpbQoKQ09QWSAtLWZyb209YnVpbGRlciAvcm9vdC90bWttcy90YXJnZXQvcmVsZWFzZS90bWttcyAke0xPQ0FMfS9iaW4KCkVOVFJZUE9JTlQgWyAmcXVvdDt0bWttcyZxdW90OyBdCg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/run-prod/prod-sim/Dockerfile-tmkms-debian"}}),e._v(" "),a("p",[e._v("Build the image as usual with:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgYnVpbGQgLWYgcHJvZC1zaW0vRG9ja2VyZmlsZS10bWttcy1kZWJpYW4gLiAtdCB0bWttc19pOnYwLjEyLjIK"}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"With alpine"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"ockerfile",base64:"RlJPTSAtLXBsYXRmb3JtPWxpbnV4IHJ1c3Q6MS42NC4wLWFscGluZSBBUyBidWlsZGVyCgpSVU4gYXBrIHVwZGF0ZQpSVU4gYXBrIGFkZCBsaWJ1c2ItZGV2PTEuMC4yNi1yMCBtdXNsLWRldiBnaXQKCkVOViBMT0NBTD0vdXNyL2xvY2FsCkVOViBSVVNURkxBR1M9LUN0YXJnZXQtZmVhdHVyZT0rYWVzLCtzc3NlMwpFTlYgVE1LTVNfVkVSU0lPTj12MC4xMi4yCgpXT1JLRElSIC9yb290ClJVTiBnaXQgY2xvbmUgLS1icmFuY2ggJHtUTUtNU19WRVJTSU9OfSBodHRwczovL2dpdGh1Yi5jb20vaXFsdXNpb25pbmMvdG1rbXMuZ2l0CldPUktESVIgL3Jvb3QvdG1rbXMKUlVOIGNhcmdvIGJ1aWxkIC0tcmVsZWFzZSAtLWZlYXR1cmVzPXNvZnRzaWduCgojIFRoZSBwcm9kdWN0aW9uIGltYWdlIHN0YXJ0cyBoZXJlCkZST00gLS1wbGF0Zm9ybT1saW51eCBhbHBpbmUKCkNPUFkgLS1mcm9tPWJ1aWxkZXIgL3Jvb3QvdG1rbXMvdGFyZ2V0L3JlbGVhc2UvdG1rbXMgJHtMT0NBTH0vYmluCgpFTlRSWVBPSU5UIFsgJnF1b3Q7dG1rbXMmcXVvdDsgXQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/run-prod/prod-sim/Dockerfile-tmkms-alpine"}}),e._v(" "),a("p",[e._v("Build the image as usual with:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgYnVpbGQgLWYgcHJvZC1zaW0vRG9ja2VyZmlsZS10bWttcy1hbHBpbmUgLiAtdCB0bWttc19pOnYwLjEyLjIK"}})],1)],1),e._v(" "),a("hr"),e._v(" "),a("p",[e._v("As you can see, the production stage is only three lines.")]),e._v(" "),a("ul",[a("li",[e._v("If you built with Debian, the image should be about 90 MB.")]),e._v(" "),a("li",[e._v("If you built with Alpine, the image should be about 20 MB.")])]),e._v(" "),a("p",[e._v("Now run it:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IHRta21zX2k6djAuMTIuMgo="}}),e._v(" "),a("p",[e._v("It returns you information about usage. You have just built the Tendermint Key Management System.")]),e._v(" "),a("h2",{attrs:{id:"blockchain-elements"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#blockchain-elements"}},[e._v("#")]),e._v(" Blockchain elements")]),e._v(" "),a("p",[e._v("Each container needs access to its private information, such as keys, genesis, and database. To facilitate data access and separation between containers, create folders that will map as a volume to the default "),a("code",[e._v("/root/.checkers")]),e._v(" or "),a("code",[e._v("/root/tmkms")]),e._v(" inside containers. One for each container:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBta2RpciAtcCBwcm9kLXNpbS9rbXMtYWxpY2UKJCBta2RpciAtcCBwcm9kLXNpbS9ub2RlLWNhcm9sCiQgbWtkaXIgLXAgcHJvZC1zaW0vc2VudHJ5LWFsaWNlCiQgbWtkaXIgLXAgcHJvZC1zaW0vc2VudHJ5LWJvYgokIG1rZGlyIC1wIHByb2Qtc2ltL3ZhbC1hbGljZQokIG1rZGlyIC1wIHByb2Qtc2ltL3ZhbC1ib2IK",url:"https://github.com/cosmos/b9-checkers-academy-draft/tree/run-prod/prod-sim"}}),e._v(" "),a("p",[e._v("Also add the desktop computers of Alice and Bob, so that they never have to put keys on a server that should never see them:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBta2RpciAtcCBwcm9kLXNpbS9kZXNrLWFsaWNlCiQgbWtkaXIgLXAgcHJvZC1zaW0vZGVzay1ib2IK",url:"https://github.com/cosmos/b9-checkers-academy-draft/tree/run-prod/prod-sim"}}),e._v(" "),a("p",[e._v("For instance, when running a container for "),a("code",[e._v("val-alice")]),e._v(", you would create the volume mapping with a command like:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC4uLiBcCiAgICAtdiAkKHB3ZCkvcHJvZC1zaW0vdmFsLWFsaWNlOi9yb290Ly5jaGVja2VycyBcCiAgICBjaGVja2Vyc2RfaSAuLi4K"}}),e._v(" "),a("p",[e._v("And for the KMS, like so:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC4uLiBcCiAgICAtdiAkKHB3ZCkvcHJvZC1zaW0va21zLWFsaWNlOi9yb290L3Rta21zIFwKICAgIHRta21zX2k6djAuMTIuMiAuLi4K"}}),e._v(" "),a("h3",{attrs:{id:"basic-initialization"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#basic-initialization"}},[e._v("#")]),e._v(" Basic initialization")]),e._v(" "),a("p",[e._v("Before you can change the configuration you need to initialize it. Do it on all nodes with this one-liner:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBlY2hvIC1lIGRlc2stYWxpY2UnXG4nZGVzay1ib2InXG4nbm9kZS1jYXJvbCdcbidzZW50cnktYWxpY2UnXG4nc2VudHJ5LWJvYidcbid2YWwtYWxpY2UnXG4ndmFsLWJvYiBcCiAgICB8IHhhcmdzIC1JIHt9IFwKICAgIGRvY2tlciBydW4gLS1ybSAtaSBcCiAgICAtdiAkKHB3ZCkvcHJvZC1zaW0ve306L3Jvb3QvLmNoZWNrZXJzIFwKICAgIGNoZWNrZXJzZF9pIFwKICAgIGluaXQgY2hlY2tlcnMK"}}),e._v(" "),a("p",[e._v("As a secondary effect, this also creates the first shot of "),a("code",[e._v("config/genesis.json")]),e._v(" on every node, although you will start work with the one on "),a("code",[e._v("desk-alice")]),e._v(".")]),e._v(" "),a("p",[e._v("Early decisions that you can make at this stage are:")]),e._v(" "),a("ul",[a("li",[e._v("Deciding that the chain will be named "),a("code",[e._v("checkers-1")]),e._v(". It is a convention to append a number in case it has to go through a hard fork.")]),e._v(" "),a("li",[e._v("Deciding that the staking denomination will be called "),a("code",[e._v("upawn")]),e._v(", which will be understood as 1 PAWN equals 1 million of "),a("code",[e._v("upawn")]),e._v(".")])]),e._v(" "),a("HighlightBox",{attrs:{type:"note"}},[a("p",[e._v("Do you need that many decimals? Yes and no. Depending on your version of the Cosmos SDK, there is a hard-coded value of base tokens that a validator has to stake, and the number is "),a("code",[e._v("10,000,000")]),e._v(". If you do not have enough decimals, the "),a("em",[e._v("human")]),e._v(" token would have to have a lot of zeroes.")])]),e._v(" "),a("p",[e._v("The default initialization sets the base token to "),a("code",[e._v("stake")]),e._v(", so to get it to be "),a("code",[e._v("upawn")]),e._v(" you need to make some changes:")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("In the authoritative "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/run-prod/prod-sim/desk-alice/config/genesis.json#L63",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("config/genesis.json")]),a("OutboundLink")],1),e._v(" ("),a("code",[e._v("desk-alice")]),e._v("'s):")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IFwKICAgIC12ICQocHdkKS9wcm9kLXNpbS9kZXNrLWFsaWNlOi9yb290Ly5jaGVja2VycyBcCiAgICAtLWVudHJ5cG9pbnQgc2VkIFwKICAgIGNoZWNrZXJzZF9pIFwKICAgIC1pICdzLyZxdW90O3N0YWtlJnF1b3Q7LyZxdW90O3VwYXduJnF1b3Q7L2cnIC9yb290Ly5jaGVja2Vycy9jb25maWcvZ2VuZXNpcy5qc29uCg=="}}),e._v(" "),a("p",[e._v("Note how the command overrides the default "),a("code",[e._v("checkersd")]),e._v(" entry point and replaces it with "),a("code",[e._v("--entrypoint sed")]),e._v(".")])],1),e._v(" "),a("li",[a("p",[e._v("In all seven "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/run-prod/prod-sim/desk-alice/config/app.toml#L11",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("config/app.toml")]),a("OutboundLink")],1),e._v(":")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBlY2hvIC1lIGRlc2stYWxpY2UnXG4nZGVzay1ib2InXG4nbm9kZS1jYXJvbCdcbidzZW50cnktYWxpY2UnXG4nc2VudHJ5LWJvYidcbid2YWwtYWxpY2UnXG4ndmFsLWJvYiBcCiAgICB8IHhhcmdzIC1JIHt9IFwKICAgIGRvY2tlciBydW4gLS1ybSAtaSBcCiAgICAtdiAkKHB3ZCkvcHJvZC1zaW0ve306L3Jvb3QvLmNoZWNrZXJzIFwKICAgIC0tZW50cnlwb2ludCBzZWQgXAogICAgY2hlY2tlcnNkX2kgXAogICAgLUVpICdzLyhbMC05XSspc3Rha2UvXDF1cGF3bi9nJyAvcm9vdC8uY2hlY2tlcnMvY29uZmlnL2FwcC50b21sCg=="}})],1)]),e._v(" "),a("p",[e._v("Make sure that "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/run-prod/prod-sim/desk-alice/config/client.toml#L9",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("config/client.toml")]),a("OutboundLink")],1),e._v(" mentions "),a("code",[e._v("checkers-1")]),e._v(", the chain's name:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBlY2hvIC1lIGRlc2stYWxpY2UnXG4nZGVzay1ib2InXG4nbm9kZS1jYXJvbCdcbidzZW50cnktYWxpY2UnXG4nc2VudHJ5LWJvYidcbid2YWwtYWxpY2UnXG4ndmFsLWJvYiBcCiAgICB8IHhhcmdzIC1JIHt9IFwKICAgIGRvY2tlciBydW4gLS1ybSAtaSBcCiAgICAtdiAkKHB3ZCkvcHJvZC1zaW0ve306L3Jvb3QvLmNoZWNrZXJzIFwKICAgIC0tZW50cnlwb2ludCBzZWQgXAogICAgY2hlY2tlcnNkX2kgXAogICAgLUVpICdzL15jaGFpbi1pZCA9IC4qJC9jaGFpbi1pZCA9ICZxdW90O2NoZWNrZXJzLTEmcXVvdDsvZycgXAogICAgL3Jvb3QvLmNoZWNrZXJzL2NvbmZpZy9jbGllbnQudG9tbAo="}}),e._v(" "),a("h3",{attrs:{id:"keys"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#keys"}},[e._v("#")]),e._v(" Keys")]),e._v(" "),a("p",[e._v("Some keys are created automatically, like the "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/run-prod/prod-sim/node-carol/config/node_key.json",target:"_blank",rel:"noopener noreferrer"}},[e._v("node keys"),a("OutboundLink")],1),e._v(". For others, you have to create them yourself. You will create:")]),e._v(" "),a("ul",[a("li",[e._v("The validator operator keys for Alice and Bob.")]),e._v(" "),a("li",[e._v("The consensus keys, whether they stay on Bob's node or are kept inside Alice's KMS.")])]),e._v(" "),a("p",[e._v("Start with the keys for the validators and Alice's KMS Tendermint key.")]),e._v(" "),a("h3",{attrs:{id:"validator-operator-keys"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#validator-operator-keys"}},[e._v("#")]),e._v(" Validator operator keys")]),e._v(" "),a("p",[e._v('First, you need to create the two validators\' operation keys. Such a key is not meant to stay on the validating node when it runs, it is meant to be used at certain junctures only (for instance, to stake on behalf of Alice or Bob, as from their respective desktop computers). So you are going to create them by running "desktop" containers:')]),e._v(" "),a("ol",[a("li",[e._v("Use the "),a("code",[e._v("--keyring-backend file")]),e._v(".")]),e._v(" "),a("li",[e._v("Keep them in the mapped volume with "),a("code",[e._v("--keyring-dir /root/.checkers/keys")]),e._v(".")])]),e._v(" "),a("p",[e._v("Create on "),a("code",[e._v("desk-alice")]),e._v(" the operator key for "),a("code",[e._v("val-alice")]),e._v(":")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IFwKICAgIC12ICQocHdkKS9wcm9kLXNpbS9kZXNrLWFsaWNlOi9yb290Ly5jaGVja2VycyBcCiAgICBjaGVja2Vyc2RfaSBcCiAgICBrZXlzIFwKICAgIC0ta2V5cmluZy1iYWNrZW5kIGZpbGUgLS1rZXlyaW5nLWRpciAvcm9vdC8uY2hlY2tlcnMva2V5cyBcCiAgICBhZGQgYWxpY2UK"}}),e._v(" "),a("p",[e._v("Use a passphrase you can remember. It does not need to be exceptionally complex as this is all a local simulation. This exercise uses "),a("code",[e._v("password")]),e._v(" and stores this detail on file, which will become handy.")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBlY2hvIC1uIHBhc3N3b3JkICZndDsgcHJvZC1zaW0vZGVzay1hbGljZS9rZXlzL3Bhc3NwaHJhc2UudHh0Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/run-prod/prod-sim/desk-alice/keys/passphrase.txt"}}),e._v(" "),a("p",[e._v("Because with this prod simulation you care less about safety, so much less in fact, you can even keep the mnemonic on file too.")]),e._v(" "),a("p",[e._v("Do the same for "),a("code",[e._v("val-bob")]),e._v(":")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IFwKICAgIC12ICQocHdkKS9wcm9kLXNpbS9kZXNrLWJvYjovcm9vdC8uY2hlY2tlcnMgXAogICAgY2hlY2tlcnNkX2kgXAogICAga2V5cyBcCiAgICAtLWtleXJpbmctYmFja2VuZCBmaWxlIC0ta2V5cmluZy1kaXIgL3Jvb3QvLmNoZWNrZXJzL2tleXMgXAogICAgYWRkIGJvYgokIGVjaG8gLW4gcGFzc3dvcmQgJmd0OyBwcm9kLXNpbS9kZXNrLWJvYi9rZXlzL3Bhc3NwaHJhc2UudHh0Cg=="}}),e._v(" "),a("h3",{attrs:{id:"alice-s-consensus-key-on-the-kms"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#alice-s-consensus-key-on-the-kms"}},[e._v("#")]),e._v(" Alice's consensus key on the KMS")]),e._v(" "),a("p",[e._v("To get the KMS to work, you have to:")]),e._v(" "),a("ul",[a("li",[e._v("Prepare the KMS.")]),e._v(" "),a("li",[e._v("Import Alice's consensus key into the KMS' "),a("code",[e._v("softsign")]),e._v(" "),a("em",[e._v("device")]),e._v(".")]),e._v(" "),a("li",[e._v("Have the KMS and the node talk to each other.")])]),e._v(" "),a("h3",{attrs:{id:"prepare-the-kms"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prepare-the-kms"}},[e._v("#")]),e._v(" Prepare the KMS")]),e._v(" "),a("p",[e._v("As per "),a("a",{attrs:{href:"https://github.com/iqlusioninc/tmkms/tree/v0.12.2#configuration-tmkms-init",target:"_blank",rel:"noopener noreferrer"}},[e._v("the documentation"),a("OutboundLink")],1),e._v(", initialize the KMS folder:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IFwKICAgIC12ICQocHdkKS9wcm9kLXNpbS9rbXMtYWxpY2U6L3Jvb3QvdG1rbXMgXAogICAgdG1rbXNfaTp2MC4xMi4yIFwKICAgIGluaXQgL3Jvb3QvdG1rbXMK"}}),e._v(" "),a("p",[e._v("In the newly-created "),a("code",[e._v("kms-alice/tmkms.toml")]),e._v(" file:")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("Make sure that you use the right protocol version. In your case:")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"TOML"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"toml",base64:"W1t2YWxpZGF0b3JdXQouLi4KcHJvdG9jb2xfdmVyc2lvbiA9ICZxdW90O3YwLjM0JnF1b3Q7Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/run-prod/prod-sim/kms-alice/tmkms.toml#L27"}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"One-liner"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWkgXAogIC12ICQocHdkKS9wcm9kLXNpbS9rbXMtYWxpY2U6L3Jvb3QvdG1rbXMgXAogIC0tZW50cnlwb2ludCBzZWQgXAogIHRta21zX2k6djAuMTIuMiBcCiAgLUVpICdzL15wcm90b2NvbF92ZXJzaW9uID0gLiokL3Byb3RvY29sX3ZlcnNpb24gPSAmcXVvdDt2MC4zNCZxdW90Oy9nJyBcCiAgL3Jvb3QvdG1rbXMvdG1rbXMudG9tbAo="}})],1)],1)],1),e._v(" "),a("li",[a("p",[e._v("Pick an expressive name for the file that will contain the "),a("code",[e._v("softsign")]),e._v(" key for "),a("code",[e._v("val-alice")]),e._v(":")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"TOML"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"toml",base64:"W1twcm92aWRlcnMuc29mdHNpZ25dXQouLi4KcGF0aCA9ICZxdW90Oy9yb290L3Rta21zL3NlY3JldHMvdmFsLWFsaWNlLWNvbnNlbnN1cy5rZXkmcXVvdDsK",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/run-prod/prod-sim/kms-alice/tmkms.toml#L19"}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"One-liner"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWkgXAogIC12ICQocHdkKS9wcm9kLXNpbS9rbXMtYWxpY2U6L3Jvb3QvdG1rbXMgXAogIC0tZW50cnlwb2ludCBzZWQgXAogIHRta21zX2k6djAuMTIuMiBcCiAgLUVpICdzL3BhdGggPSAmcXVvdDtcL3Jvb3RcL3Rta21zXC9zZWNyZXRzXC9jb3Ntb3NodWItMy1jb25zZW5zdXMua2V5JnF1b3Q7L3BhdGggPSAmcXVvdDtcL3Jvb3RcL3Rta21zXC9zZWNyZXRzXC92YWwtYWxpY2UtY29uc2Vuc3VzLmtleSZxdW90Oy9nJyBcCiAgL3Jvb3QvdG1rbXMvdG1rbXMudG9tbAo="}})],1)],1)],1),e._v(" "),a("li",[a("p",[e._v("Replace "),a("code",[e._v("cosmoshub-3")]),e._v(" with "),a("code",[e._v("checkers-1")]),e._v(", the name of your blockchain, wherever the former appears:")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"TOML"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"toml",base64:"W1tjaGFpbl1dCmlkID0gJnF1b3Q7Y2hlY2tlcnMtMSZxdW90OwouLi4KW1twcm92aWRlcnMuc29mdHNpZ25dXQpjaGFpbl9pZHMgPSBbJnF1b3Q7Y2hlY2tlcnMtMSZxdW90O10KLi4uCltbdmFsaWRhdG9yXV0KY2hhaW5faWQgPSAmcXVvdDtjaGVja2Vycy0xJnF1b3Q7Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/run-prod/prod-sim/kms-alice/tmkms.toml#L24"}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"One-liner"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWkgXAogICAgLXYgJChwd2QpL3Byb2Qtc2ltL2ttcy1hbGljZTovcm9vdC90bWttcyBcCiAgICAtLWVudHJ5cG9pbnQgc2VkIFwKICAgIHRta21zX2k6djAuMTIuMiBcCiAgICAtRWkgJ3MvY29zbW9zaHViLTMvY2hlY2tlcnMtMS9nJyAvcm9vdC90bWttcy90bWttcy50b21sCg=="}})],1)],1)],1)]),e._v(" "),a("h3",{attrs:{id:"import-the-consensus-key"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#import-the-consensus-key"}},[e._v("#")]),e._v(" Import the consensus key")]),e._v(" "),a("p",[e._v("Now you need to import "),a("code",[e._v("val-alice")]),e._v("'s consensus key in "),a("code",[e._v("secrets/val-alice-consensus.key")]),e._v(".")]),e._v(" "),a("p",[e._v("The private key will no longer be needed on "),a("code",[e._v("val-alice")]),e._v(". However, during the genesis creation Alice will need access to her consensus public key. Save it in a new "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/run-prod/prod-sim/desk-alice/config/pub_validator_key-val-alice.json",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("pub_validator_key-val-alice.json")]),a("OutboundLink")],1),e._v(" on Alice's desk without any new line:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLXQgXAogICAgLXYgJChwd2QpL3Byb2Qtc2ltL3ZhbC1hbGljZTovcm9vdC8uY2hlY2tlcnMgXAogICAgY2hlY2tlcnNkX2kgXAogICAgdGVuZGVybWludCBzaG93LXZhbGlkYXRvciBcCiAgICB8IHRyIC1kICdcbicgfCB0ciAtZCAnXHInIFwKICAgICZndDsgcHJvZC1zaW0vZGVzay1hbGljZS9jb25maWcvcHViX3ZhbGlkYXRvcl9rZXktdmFsLWFsaWNlLmpzb24K"}}),e._v(" "),a("p",[e._v("The consensus private key should not reside on the validator. You can simulate that by moving it out:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBjcCBwcm9kLXNpbS92YWwtYWxpY2UvY29uZmlnL3ByaXZfdmFsaWRhdG9yX2tleS5qc29uIFwKICBwcm9kLXNpbS9kZXNrLWFsaWNlL2NvbmZpZy9wcml2X3ZhbGlkYXRvcl9rZXktdmFsLWFsaWNlLmpzb24KJCBtdiBwcm9kLXNpbS92YWwtYWxpY2UvY29uZmlnL3ByaXZfdmFsaWRhdG9yX2tleS5qc29uIFwKICBwcm9kLXNpbS9rbXMtYWxpY2Uvc2VjcmV0cy9wcml2X3ZhbGlkYXRvcl9rZXktdmFsLWFsaWNlLmpzb24K"}}),e._v(" "),a("p",[e._v("Import it into the "),a("code",[e._v("softsign")]),e._v(' "device" as defined in '),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/run-prod/prod-sim/kms-alice/tmkms.toml#L19",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("tmkms.toml")]),a("OutboundLink")],1),e._v(":")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWkgXAogICAgLXYgJChwd2QpL3Byb2Qtc2ltL2ttcy1hbGljZTovcm9vdC90bWttcyBcCiAgICAtdyAvcm9vdC90bWttcyBcCiAgICB0bWttc19pOnYwLjEyLjIgXAogICAgc29mdHNpZ24gaW1wb3J0IHNlY3JldHMvcHJpdl92YWxpZGF0b3Jfa2V5LXZhbC1hbGljZS5qc29uIFwKICAgIHNlY3JldHMvdmFsLWFsaWNlLWNvbnNlbnN1cy5rZXkK"}}),e._v(" "),a("p",[e._v("On start, "),a("code",[e._v("val-alice")]),e._v(" may still recreate a missing private key file due to how defaults are handled in the code. To prevent that, you can instead copy it from "),a("code",[e._v("sentry-alice")]),e._v(" where it has no value.")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBjcCBwcm9kLXNpbS9zZW50cnktYWxpY2UvY29uZmlnL3ByaXZfdmFsaWRhdG9yX2tleS5qc29uIFwKICAgIHByb2Qtc2ltL3ZhbC1hbGljZS9jb25maWcvCg=="}}),e._v(" "),a("p",[e._v("With the key created you now set up the connection from "),a("code",[e._v("kms-alice")]),e._v(" to "),a("code",[e._v("val-alice")]),e._v(".")]),e._v(" "),a("h3",{attrs:{id:"set-up-the-kms-connection"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#set-up-the-kms-connection"}},[e._v("#")]),e._v(" Set up the KMS connection")]),e._v(" "),a("p",[e._v("Choose a port unused on "),a("code",[e._v("val-alice")]),e._v(", for instance "),a("code",[e._v("26659")]),e._v(", and inform "),a("code",[e._v("kms-alice")]),e._v(":")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"TOML"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"toml",base64:"W1t2YWxpZGF0b3JdXQouLi4KYWRkciA9ICZxdW90O3RjcDovL3ZhbC1hbGljZToyNjY1OSZxdW90Owo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/run-prod/prod-sim/kms-alice/tmkms.toml#L25"}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"One-liner"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWkgXAogICAgLXYgJChwd2QpL3Byb2Qtc2ltL2ttcy1hbGljZTovcm9vdC90bWttcyBcCiAgICAtLWVudHJ5cG9pbnQgc2VkIFwKICAgIHRta21zX2k6djAuMTIuMiBcCiAgICAtRWkgJ3MvXmFkZHIgPSAmcXVvdDt0Y3A6LiokL2FkZHIgPSAmcXVvdDt0Y3A6XC9cL3ZhbC1hbGljZToyNjY1OSZxdW90Oy9nJyAvcm9vdC90bWttcy90bWttcy50b21sCg=="}})],1)],1),e._v(" "),a("p",[e._v("In the above, "),a("code",[e._v("val-alice")]),e._v(" is the future network name of Alice's validator, and it will indeed be resolved to an IP address via Docker's internal DNS. In a real production setup, you would use a fully resolved IP address to avoid the vagaries of DNS.")]),e._v(" "),a("p",[e._v("Do not forget, you must inform Alice's validator that it should indeed listen on port "),a("code",[e._v("26659")]),e._v(". In "),a("code",[e._v("val-alice/config/config.toml")]),e._v(":")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"TOML"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"toml",base64:"cHJpdl92YWxpZGF0b3JfbGFkZHIgPSAmcXVvdDt0Y3A6Ly8wLjAuMC4wOjI2NjU5JnF1b3Q7Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/run-prod/prod-sim/val-alice/config/config.toml#L68"}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"One-liner"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWkgXAogIC12ICQocHdkKS9wcm9kLXNpbS92YWwtYWxpY2U6L3Jvb3QvLmNoZWNrZXJzIFwKICAtLWVudHJ5cG9pbnQgc2VkIFwKICBjaGVja2Vyc2RfaSBcCiAgLUVpICdzL3ByaXZfdmFsaWRhdG9yX2xhZGRyID0gJnF1b3Q7JnF1b3Q7L3ByaXZfdmFsaWRhdG9yX2xhZGRyID0gJnF1b3Q7dGNwOlwvXC8wLjAuMC4wOjI2NjU5JnF1b3Q7L2cnIFwKICAvcm9vdC8uY2hlY2tlcnMvY29uZmlnL2NvbmZpZy50b21sCg=="}})],1)],1),e._v(" "),a("HighlightBox",{attrs:{type:"note"}},[a("p",[e._v("Make it listen on an IP address that is within the KMS private network.")])]),e._v(" "),a("p",[a("code",[e._v("0.0.0.0")]),e._v(" represents all addresses of the node. In a real production setup, you would choose the IP address of the network card that is on the network common with "),a("code",[e._v("kms-alice")]),e._v(".")]),e._v(" "),a("ul",[a("li",[e._v("Make sure it will not look for the consensus key on file:")])]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"TOML"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"toml",base64:"IyBwcml2X3ZhbGlkYXRvcl9rZXlfZmlsZSA9ICZxdW90O2NvbmZpZy9wcml2X3ZhbGlkYXRvcl9rZXkuanNvbiZxdW90Owo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/run-prod/prod-sim/val-alice/config/config.toml#L61"}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"One-liner"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWkgXAogIC12ICQocHdkKS9wcm9kLXNpbS92YWwtYWxpY2U6L3Jvb3QvLmNoZWNrZXJzIFwKICAtLWVudHJ5cG9pbnQgc2VkIFwKICBjaGVja2Vyc2RfaSBcCiAgLUVpICdzL15wcml2X3ZhbGlkYXRvcl9rZXlfZmlsZS8jIHByaXZfdmFsaWRhdG9yX2tleV9maWxlL2cnIFwKICAvcm9vdC8uY2hlY2tlcnMvY29uZmlnL2NvbmZpZy50b21sCg=="}})],1)],1),e._v(" "),a("ul",[a("li",[e._v("Make sure it will not look for the consensus state file either, as this is taken care of by the KMS:")])]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"TOML"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"toml",base64:"IyBwcml2X3ZhbGlkYXRvcl9zdGF0ZV9maWxlID0gJnF1b3Q7ZGF0YS9wcml2X3ZhbGlkYXRvcl9zdGF0ZS5qc29uJnF1b3Q7Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/run-prod/prod-sim/val-alice/config/config.toml#L64"}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"One-liner"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWkgXAogIC12ICQocHdkKS9wcm9kLXNpbS92YWwtYWxpY2U6L3Jvb3QvLmNoZWNrZXJzIFwKICAtLWVudHJ5cG9pbnQgc2VkIFwKICBjaGVja2Vyc2RfaSBcCiAgLUVpICdzL15wcml2X3ZhbGlkYXRvcl9zdGF0ZV9maWxlLyMgcHJpdl92YWxpZGF0b3Jfc3RhdGVfZmlsZS9nJyBcCiAgL3Jvb3QvLmNoZWNrZXJzL2NvbmZpZy9jb25maWcudG9tbAo="}})],1)],1),e._v(" "),a("p",[e._v("Before moving on, make sure that the validator still has a "),a("code",[e._v("priv_validator_key.json")]),e._v(" because the code may complain if the file cannot be found. You can copy the key from "),a("code",[e._v("sentry-alice")]),e._v(", which does not present any risk:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBjcCBwcm9kLXNpbS9zZW50cnktYWxpY2UvY29uZmlnL3ByaXZfdmFsaWRhdG9yX2tleS5qc29uIFwKICAgIHByb2Qtc2ltL3ZhbC1hbGljZS9jb25maWcK"}}),e._v(" "),a("h3",{attrs:{id:"genesis"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#genesis"}},[e._v("#")]),e._v(" Genesis")]),e._v(" "),a("p",[e._v("With the keys in you can start fleshing out the genesis, which is already created.")]),e._v(" "),a("p",[e._v("You need to:")]),e._v(" "),a("ol",[a("li",[e._v("Set up the chain ID.")]),e._v(" "),a("li",[e._v("Add the initial balances.")]),e._v(" "),a("li",[e._v("Add the initial validator stakes.")]),e._v(" "),a("li",[e._v("Distribute the genesis file to all relevant nodes.")])]),e._v(" "),a("h3",{attrs:{id:"set-up-chain-id"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#set-up-chain-id"}},[e._v("#")]),e._v(" Set up chain ID")]),e._v(" "),a("p",[e._v("Earlier you chose "),a("code",[e._v("checkers-1")]),e._v(", so you adjust it here too:")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"JSON"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"json",base64:"JnF1b3Q7Y2hhaW5faWQmcXVvdDs6ICZxdW90O2NoZWNrZXJzLTEmcXVvdDssCg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/run-prod/prod-sim/desk-alice/config/genesis.json#L3"}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"One-liner"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWkgXAogICAgLXYgJChwd2QpL3Byb2Qtc2ltL2Rlc2stYWxpY2U6L3Jvb3QvLmNoZWNrZXJzIFwKICAgIC0tZW50cnlwb2ludCBzZWQgXAogICAgY2hlY2tlcnNkX2kgXAogICAgLUVpICdzLyZxdW90O2NoYWluX2lkJnF1b3Q7OiAmcXVvdDtjaGVja2VycyZxdW90Oy8mcXVvdDtjaGFpbl9pZCZxdW90OzogJnF1b3Q7Y2hlY2tlcnMtMSZxdW90Oy9nJyBcCiAgICAvcm9vdC8uY2hlY2tlcnMvY29uZmlnL2dlbmVzaXMuanNvbgo="}})],1)],1),e._v(" "),a("h3",{attrs:{id:"initial-balances"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#initial-balances"}},[e._v("#")]),e._v(" Initial balances")]),e._v(" "),a("p",[e._v("In this setup, Alice starts with 1,000 PAWN and Bob with 500 PAWN, of which Alice stakes 60 and Bob 40. With these amounts, the network cannot start if either of them is offline. Get their respective addresses:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBBTElDRT0kKGVjaG8gcGFzc3dvcmQgfCBkb2NrZXIgcnVuIC0tcm0gLWkgXAogICAgLXYgJChwd2QpL3Byb2Qtc2ltL2Rlc2stYWxpY2U6L3Jvb3QvLmNoZWNrZXJzIFwKICAgIGNoZWNrZXJzZF9pIFwKICAgIGtleXMgXAogICAgLS1rZXlyaW5nLWJhY2tlbmQgZmlsZSAtLWtleXJpbmctZGlyIC9yb290Ly5jaGVja2Vycy9rZXlzIFwKICAgIHNob3cgYWxpY2UgLS1hZGRyZXNzKQo="}}),e._v(" "),a("p",[e._v("Replace "),a("code",[e._v("password")]),e._v(" with the passphrase you picked when creating the keys.")]),e._v(" "),a("p",[e._v("Have Alice add her initial balance in the genesis:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IFwKICAgIC12ICQocHdkKS9wcm9kLXNpbS9kZXNrLWFsaWNlOi9yb290Ly5jaGVja2VycyBcCiAgICBjaGVja2Vyc2RfaSBcCiAgICBhZGQtZ2VuZXNpcy1hY2NvdW50ICRBTElDRSAxMDAwMDAwMDAwdXBhd24K"}}),e._v(" "),a("p",[e._v("Now move the genesis file to "),a("code",[e._v("desk-bob")]),e._v(". This mimics what would happen in a real-life setup:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBtdiBwcm9kLXNpbS9kZXNrLWFsaWNlL2NvbmZpZy9nZW5lc2lzLmpzb24gXAogICAgcHJvZC1zaW0vZGVzay1ib2IvY29uZmlnLwo="}}),e._v(" "),a("p",[e._v("Have Bob add his own initial balance:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBCT0I9JChlY2hvIHBhc3N3b3JkIHwgZG9ja2VyIHJ1biAtLXJtIC1pIFwKICAgIC12ICQocHdkKS9wcm9kLXNpbS9kZXNrLWJvYjovcm9vdC8uY2hlY2tlcnMgXAogICAgY2hlY2tlcnNkX2kgXAogICAga2V5cyBcCiAgICAtLWtleXJpbmctYmFja2VuZCBmaWxlIC0ta2V5cmluZy1kaXIgL3Jvb3QvLmNoZWNrZXJzL2tleXMgXAogICAgc2hvdyBib2IgLS1hZGRyZXNzKQokIGRvY2tlciBydW4gLS1ybSAtaXQgXAogICAgLXYgJChwd2QpL3Byb2Qtc2ltL2Rlc2stYm9iOi9yb290Ly5jaGVja2VycyBcCiAgICBjaGVja2Vyc2RfaSBcCiAgICBhZGQtZ2VuZXNpcy1hY2NvdW50ICRCT0IgNTAwMDAwMDAwdXBhd24K"}}),e._v(" "),a("h3",{attrs:{id:"initial-stakes"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#initial-stakes"}},[e._v("#")]),e._v(" Initial stakes")]),e._v(" "),a("p",[e._v("Alice and Bob both have initial stakes that they define via genesis transactions. You create them.")]),e._v(" "),a("h4",{attrs:{id:"bob-s-stake"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#bob-s-stake"}},[e._v("#")]),e._v(" Bob's stake")]),e._v(" "),a("p",[e._v("Bob is not using the Tendermint KMS but instead uses the validator key on file "),a("code",[e._v("priv_validator_key.json")]),e._v(". So, first make a copy of it on Bob's desktop.")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBjcCBwcm9kLXNpbS92YWwtYm9iL2NvbmZpZy9wcml2X3ZhbGlkYXRvcl9rZXkuanNvbiBcCiAgICBwcm9kLXNpbS9kZXNrLWJvYi9jb25maWcvcHJpdl92YWxpZGF0b3Jfa2V5Lmpzb24K"}}),e._v(" "),a("p",[e._v("Bob appears in second position in "),a("code",[e._v("app_state.accounts")]),e._v(", so his "),a("code",[e._v("account_number")]),e._v(" ought to be "),a("code",[e._v("1")]),e._v("; but it is in fact written as "),a("code",[e._v("0")]),e._v(", so you use "),a("code",[e._v("0")]),e._v(":")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBlY2hvIHBhc3N3b3JkIHwgZG9ja2VyIHJ1biAtLXJtIC1pIFwKICAgIC12ICQocHdkKS9wcm9kLXNpbS9kZXNrLWJvYjovcm9vdC8uY2hlY2tlcnMgXAogICAgY2hlY2tlcnNkX2kgXAogICAgZ2VudHggYm9iIDQwMDAwMDAwdXBhd24gXAogICAgLS1rZXlyaW5nLWJhY2tlbmQgZmlsZSAtLWtleXJpbmctZGlyIC9yb290Ly5jaGVja2Vycy9rZXlzIFwKICAgIC0tYWNjb3VudC1udW1iZXIgMCAtLXNlcXVlbmNlIDAgXAogICAgLS1jaGFpbi1pZCBjaGVja2Vycy0xIFwKICAgIC0tZ2FzIDEwMDAwMDAgXAogICAgLS1nYXMtcHJpY2VzIDAuMXVwYXduCg=="}}),e._v(" "),a("p",[e._v("Again, insert Bob's chosen passphrase instead of "),a("code",[e._v("password")]),e._v(". Return the genesis to Alice:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBtdiBwcm9kLXNpbS9kZXNrLWJvYi9jb25maWcvZ2VuZXNpcy5qc29uIFwKICAgIHByb2Qtc2ltL2Rlc2stYWxpY2UvY29uZmlnLwo="}}),e._v(" "),a("p",[e._v("It is Alice's turn to add her staking transaction.")]),e._v(" "),a("h4",{attrs:{id:"alice-s-stake"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#alice-s-stake"}},[e._v("#")]),e._v(" Alice's stake")]),e._v(" "),a("p",[e._v("Create Alice's genesis transaction using the specific validator public key that you saved on file, and not the key that would be taken from "),a("code",[e._v("priv_validator_key.json")]),e._v(" by default (and is now missing):")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBlY2hvIHBhc3N3b3JkIHwgZG9ja2VyIHJ1biAtLXJtIC1pIFwKICAgIC12ICQocHdkKS9wcm9kLXNpbS9kZXNrLWFsaWNlOi9yb290Ly5jaGVja2VycyBcCiAgICBjaGVja2Vyc2RfaSBcCiAgICBnZW50eCBhbGljZSA2MDAwMDAwMHVwYXduIFwKICAgIC0ta2V5cmluZy1iYWNrZW5kIGZpbGUgLS1rZXlyaW5nLWRpciAvcm9vdC8uY2hlY2tlcnMva2V5cyBcCiAgICAtLWFjY291bnQtbnVtYmVyIDAgLS1zZXF1ZW5jZSAwIFwKICAgIC0tcHVia2V5ICQoY2F0IHByb2Qtc2ltL2Rlc2stYWxpY2UvY29uZmlnL3B1Yl92YWxpZGF0b3Jfa2V5LXZhbC1hbGljZS5qc29uKSBcCiAgICAtLWNoYWluLWlkIGNoZWNrZXJzLTEgXAogICAgLS1nYXMgMTAwMDAwMCBcCiAgICAtLWdhcy1wcmljZXMgMC4xdXBhd24K"}}),e._v(" "),a("HighlightBox",{attrs:{type:"note"}},[a("p",[e._v("It is useful to know this "),a("code",[e._v("--pubkey")]),e._v(" method. If you were using a hardware key located on the KMS, this would be the canonical way of generating your genesis transaction.")])]),e._v(" "),a("h3",{attrs:{id:"genesis-assembly"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#genesis-assembly"}},[e._v("#")]),e._v(" Genesis assembly")]),e._v(" "),a("p",[e._v("With the two initial staking transactions created, have Alice include both of them in the genesis:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBjcCBwcm9kLXNpbS9kZXNrLWJvYi9jb25maWcvZ2VudHgvZ2VudHgtKiBcCiAgICBwcm9kLXNpbS9kZXNrLWFsaWNlL2NvbmZpZy9nZW50eAokIGRvY2tlciBydW4gLS1ybSAtaXQgXAogICAgLXYgJChwd2QpL3Byb2Qtc2ltL2Rlc2stYWxpY2U6L3Jvb3QvLmNoZWNrZXJzIFwKICAgIGNoZWNrZXJzZF9pIGNvbGxlY3QtZ2VudHhzCg=="}}),e._v(" "),a("p",[e._v("As an added precaution, confirm that it is a valid genesis:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IFwKICAgIC12ICQocHdkKS9wcm9kLXNpbS9kZXNrLWFsaWNlOi9yb290Ly5jaGVja2VycyBcCiAgICBjaGVja2Vyc2RfaSBcCiAgICB2YWxpZGF0ZS1nZW5lc2lzCg=="}}),e._v(" "),a("p",[e._v("It should return:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"txt",base64:"RmlsZSBhdCAvcm9vdC8uY2hlY2tlcnMvY29uZmlnL2dlbmVzaXMuanNvbiBpcyBhIHZhbGlkIGdlbmVzaXMgZmlsZQo="}}),e._v(" "),a("h3",{attrs:{id:"genesis-distribution"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#genesis-distribution"}},[e._v("#")]),e._v(" Genesis distribution")]),e._v(" "),a("p",[e._v("All the nodes that will run the executable need the final version of the genesis. Copy it across:")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"Separate commands"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBjcCBwcm9kLXNpbS9kZXNrLWFsaWNlL2NvbmZpZy9nZW5lc2lzLmpzb24gcHJvZC1zaW0vZGVzay1ib2IvY29uZmlnCiQgY3AgcHJvZC1zaW0vZGVzay1hbGljZS9jb25maWcvZ2VuZXNpcy5qc29uIHByb2Qtc2ltL25vZGUtY2Fyb2wvY29uZmlnCiQgY3AgcHJvZC1zaW0vZGVzay1hbGljZS9jb25maWcvZ2VuZXNpcy5qc29uIHByb2Qtc2ltL3NlbnRyeS1hbGljZS9jb25maWcKJCBjcCBwcm9kLXNpbS9kZXNrLWFsaWNlL2NvbmZpZy9nZW5lc2lzLmpzb24gcHJvZC1zaW0vc2VudHJ5LWJvYi9jb25maWcKJCBjcCBwcm9kLXNpbS9kZXNrLWFsaWNlL2NvbmZpZy9nZW5lc2lzLmpzb24gcHJvZC1zaW0vdmFsLWFsaWNlL2NvbmZpZwokIGNwIHByb2Qtc2ltL2Rlc2stYWxpY2UvY29uZmlnL2dlbmVzaXMuanNvbiBwcm9kLXNpbS92YWwtYm9iL2NvbmZpZwo="}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"One-liner"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBlY2hvIC1lIGRlc2stYm9iJ1xuJ25vZGUtY2Fyb2wnXG4nc2VudHJ5LWFsaWNlJ1xuJ3NlbnRyeS1ib2InXG4ndmFsLWFsaWNlJ1xuJ3ZhbC1ib2IgXAogICAgfCB4YXJncyAtSSB7fSBcCiAgICBjcCBwcm9kLXNpbS9kZXNrLWFsaWNlL2NvbmZpZy9nZW5lc2lzLmpzb24gcHJvZC1zaW0ve30vY29uZmlnCg=="}})],1)],1),e._v(" "),a("h2",{attrs:{id:"network-preparation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#network-preparation"}},[e._v("#")]),e._v(" Network preparation")]),e._v(" "),a("p",[e._v("Because the validators are on a private network and fronted by sentries, you need to set up the configuration of each node so they can find each other; also to make sure that the sentries keep the validators' addresses private. What are the nodes' public keys? For instance, for "),a("code",[e._v("val-alice")]),e._v(", it is:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWkgXAogICAgLXYgJChwd2QpL3Byb2Qtc2ltL3ZhbC1hbGljZTovcm9vdC8uY2hlY2tlcnMgXAogICAgY2hlY2tlcnNkX2kgXAogICAgdGVuZGVybWludCBzaG93LW5vZGUtaWQK"}}),e._v(" "),a("p",[e._v("This returns something like:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"txt",base64:"ZjI2NzMxMDM0MTczMzRhODM5ZjVjMjAwOTY5MDljMzAyM2JhNDkwMwo="}}),e._v(" "),a("h3",{attrs:{id:"set-up-alice-s-sentry"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#set-up-alice-s-sentry"}},[e._v("#")]),e._v(" Set up Alice's sentry")]),e._v(" "),a("p",[e._v("The nodes that have access to "),a("code",[e._v("val-alice")]),e._v(" should know Alice's sentry by this identifier:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"txt",base64:"ZjI2NzMxMDM0MTczMzRhODM5ZjVjMjAwOTY5MDljMzAyM2JhNDkwM0B2YWwtYWxpY2U6MjY2NTYK"}}),e._v(" "),a("p",[e._v("Where:")]),e._v(" "),a("ul",[a("li",[a("p",[a("code",[e._v("val-alice")]),e._v(" will be resolved via Docker's DNS.")])]),e._v(" "),a("li",[a("p",[a("code",[e._v("26656")]),e._v(" is the port as found in "),a("code",[e._v("val-alice")]),e._v("'s configuration:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"toml",base64:"bGFkZHIgPSAmcXVvdDt0Y3A6Ly8wLjAuMC4wOjI2NjU2JnF1b3Q7Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/run-prod/prod-sim/val-alice/config/config.toml#L202"}})],1)]),e._v(" "),a("p",[e._v("In the case of "),a("code",[e._v("val-alice")]),e._v(", only "),a("code",[e._v("sentry-alice")]),e._v(" has access to it. Moreover, this is a persistent node. So you add it in "),a("code",[e._v("sentry-alice")]),e._v("'s configuration:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"toml",base64:"cGVyc2lzdGVudF9wZWVycyA9ICZxdW90O2YyNjczMTAzNDE3MzM0YTgzOWY1YzIwMDk2OTA5YzMwMjNiYTQ5MDNAdmFsLWFsaWNlOjI2NjU2JnF1b3Q7Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/run-prod/prod-sim/sentry-alice/config/config.toml#L215"}}),e._v(" "),a("p",[a("code",[e._v("sentry-alice")]),e._v(" also has access to "),a("code",[e._v("sentry-bob")]),e._v(" and "),a("code",[e._v("node-carol")]),e._v(", although these nodes should probably not be considered persistent. You will add them under "),a("code",[e._v('"seeds"')]),e._v(". First, collect the same information from these nodes:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWkgXAogICAgLXYgJChwd2QpL3Byb2Qtc2ltL3NlbnRyeS1ib2I6L3Jvb3QvLmNoZWNrZXJzIFwKICAgIGNoZWNrZXJzZF9pIFwKICAgIHRlbmRlcm1pbnQgc2hvdy1ub2RlLWlkCiQgZG9ja2VyIHJ1biAtLXJtIC1pIFwKICAgIC12ICQocHdkKS9wcm9kLXNpbS9ub2RlLWNhcm9sOi9yb290Ly5jaGVja2VycyBcCiAgICBjaGVja2Vyc2RfaSBcCiAgICB0ZW5kZXJtaW50IHNob3ctbm9kZS1pZAo="}}),e._v(" "),a("p",[e._v("Eventually, in "),a("code",[e._v("sentry-alice")]),e._v(", you should have:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"toml",base64:"c2VlZHMgPSAmcXVvdDs3MDA5Y2M1MTE3NGRjZTg3YzMxZjUzN2ZlOGZlZDkwNjM0OWEyN2Y0QHNlbnRyeS1ib2I6MjY2NTYsOGYxYmFmYWQ2MmE0YTFmODY3ODIxNGQ5NmE4YjJhZTJlZDE0MGNmN0Bub2RlLWNhcm9sOjI2NjU2JnF1b3Q7CnBlcnNpc3RlbnRfcGVlcnMgPSAmcXVvdDtmMjY3MzEwMzQxNzMzNGE4MzlmNWMyMDA5NjkwOWMzMDIzYmE0OTAzQHZhbC1hbGljZToyNjY1NiZxdW90Owo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/run-prod/prod-sim/sentry-alice/config/config.toml#L212-L215"}}),e._v(" "),a("p",[e._v("Before moving on to other nodes, remember that "),a("code",[e._v("sentry-alice")]),e._v(" should keep "),a("code",[e._v("val-alice")]),e._v(" secret. Set:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"toml",base64:"cHJpdmF0ZV9wZWVyX2lkcyA9ICZxdW90O2YyNjczMTAzNDE3MzM0YTgzOWY1YzIwMDk2OTA5YzMwMjNiYTQ5MDMmcXVvdDsK",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/run-prod/prod-sim/sentry-alice/config/config.toml#L261"}}),e._v(" "),a("h3",{attrs:{id:"other-nodes"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#other-nodes"}},[e._v("#")]),e._v(" Other nodes")]),e._v(" "),a("p",[e._v("Repeat the procedure for the other nodes, taking into account their specific circumstances:")]),e._v(" "),a("ul",[a("li",[a("p",[a("code",[e._v("val-alice")]),e._v("'s:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"toml",base64:"cGVyc2lzdGVudF9wZWVycyA9ICZxdW90OzgzMTQ0YjU4MDMxOTUzYWQ2MGVhY2NiMGE3OTA5NTU0NTBmMWRkZWZAc2VudHJ5LWFsaWNlOjI2NjU2JnF1b3Q7Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/run-prod/prod-sim/val-alice/config/config.toml#L215"}})],1),e._v(" "),a("li",[a("p",[a("code",[e._v("val-bob")]),e._v("'s:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"toml",base64:"cGVyc2lzdGVudF9wZWVycyA9ICZxdW90OzcwMDljYzUxMTc0ZGNlODdjMzFmNTM3ZmU4ZmVkOTA2MzQ5YTI3ZjRAc2VudHJ5LWJvYjoyNjY1NiZxdW90Owo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/run-prod/prod-sim/val-bob/config/config.toml#L215"}})],1),e._v(" "),a("li",[a("p",[a("code",[e._v("sentry-bob")]),e._v("'s:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"toml",base64:"c2VlZHMgPSAmcXVvdDs4MzE0NGI1ODAzMTk1M2FkNjBlYWNjYjBhNzkwOTU1NDUwZjFkZGVmQHNlbnRyeS1hbGljZToyNjY1Niw4ZjFiYWZhZDYyYTRhMWY4Njc4MjE0ZDk2YThiMmFlMmVkMTQwY2Y3QG5vZGUtY2Fyb2w6MjY2NTYmcXVvdDsKcGVyc2lzdGVudF9wZWVycyA9ICZxdW90OzFlMGQ5OWNjZjgzYjQ5ZTdhY2E4NTJlODIwNzRjOGU3ZjBlOTlkNzNAdmFsLWJvYjoyNjY1NiZxdW90Owpwcml2YXRlX3BlZXJfaWRzID0gJnF1b3Q7MWUwZDk5Y2NmODNiNDllN2FjYTg1MmU4MjA3NGM4ZTdmMGU5OWQ3MyZxdW90Owo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/run-prod/prod-sim/sentry-bob/config/config.toml#L212-L215"}})],1),e._v(" "),a("li",[a("p",[a("code",[e._v("node-carol")]),e._v("'s:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"toml",base64:"c2VlZHMgPSAmcXVvdDs4MzE0NGI1ODAzMTk1M2FkNjBlYWNjYjBhNzkwOTU1NDUwZjFkZGVmQHNlbnRyeS1hbGljZToyNjY1Niw3MDA5Y2M1MTE3NGRjZTg3YzMxZjUzN2ZlOGZlZDkwNjM0OWEyN2Y0QHNlbnRyeS1ib2I6MjY2NTYmcXVvdDsK",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/run-prod/prod-sim/node-carol/config/config.toml#L212"}})],1)]),e._v(" "),a("HighlightBox",{attrs:{type:"note"}},[a("p",[e._v("For the avoidance of doubt, "),a("code",[e._v("sentry-alice")]),e._v(" has a different address depending on which node resolves the address:")]),e._v(" "),a("ul",[a("li",[e._v("When it is resolved from "),a("code",[e._v("val-alice")]),e._v(", the resolution takes place in "),a("code",[e._v("net-alice")]),e._v(".")]),e._v(" "),a("li",[e._v("When it is resolved from "),a("code",[e._v("sentry-bob")]),e._v(", the resolution takes place in "),a("code",[e._v("net-public")]),e._v(".")])])]),e._v(" "),a("h3",{attrs:{id:"open-carol-s-node"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#open-carol-s-node"}},[e._v("#")]),e._v(" Open Carol's node")]),e._v(" "),a("p",[e._v("Carol created her node to open it to the public. Make sure that her node's RPC listens on all IP addresses:")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"TOML"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"json",base64:"bGFkZHIgPSAmcXVvdDt0Y3A6Ly8wLjAuMC4wOjI2NjU3JnF1b3Q7Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/run-prod/prod-sim/node-carol/config/config.toml#L91"}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"One-liner"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWkgXAogICAgLXYgJChwd2QpL3Byb2Qtc2ltL25vZGUtY2Fyb2w6L3Jvb3QvLmNoZWNrZXJzIFwKICAgIC0tZW50cnlwb2ludCBzZWQgXAogICAgY2hlY2tlcnNkX2kgXAogICAgLUVpICcwLC9ebGFkZHIgPSAuKiQve3MvXmxhZGRyID0gLiokL2xhZGRyID0gJnF1b3Q7dGNwOlwvXC8wLjAuMC4wOjI2NjU3JnF1b3Q7L30nIFwKICAgIC9yb290Ly5jaGVja2Vycy9jb25maWcvY29uZmlnLnRvbWwK"}}),e._v(" "),a("p",[e._v("Note that it has to replace only the first occurrence in the whole.")])],1)],1),e._v(" "),a("h3",{attrs:{id:"cors"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cors"}},[e._v("#")]),e._v(" CORS")]),e._v(" "),a("p",[e._v("As a last step, you can disable CORS policies so that you are not surprised if you use a node from a Web browser.")]),e._v(" "),a("ol",[a("li",[e._v("In "),a("code",[e._v("config.toml")]),e._v(":")])]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"TOML"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"json",base64:"Y29yc19hbGxvd2VkX29yaWdpbnMgPSBbJnF1b3Q7KiZxdW90O10K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/run-prod/prod-sim/node-carol/config/config.toml#L96"}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"One-liner"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"ZWNobyAtZSBub2RlLWNhcm9sJ1xuJ3NlbnRyeS1hbGljZSdcbidzZW50cnktYm9iJ1xuJ3ZhbC1hbGljZSdcbid2YWwtYm9iIFwKICAgIHwgeGFyZ3MgLUkge30gXAogICAgZG9ja2VyIHJ1biAtLXJtIC1pIFwKICAgIC12ICQocHdkKS9wcm9kLXNpbS97fTovcm9vdC8uY2hlY2tlcnMgXAogICAgLS1lbnRyeXBvaW50IHNlZCBcCiAgICBjaGVja2Vyc2RfaSBcCiAgICAtRWkgJ3MvXmNvcnNfYWxsb3dlZF9vcmlnaW5zID0gXFtcXS9jb3JzX2FsbG93ZWRfb3JpZ2lucyA9IFxbJnF1b3Q7XComcXVvdDtcXS9nJyBcCiAgICAvcm9vdC8uY2hlY2tlcnMvY29uZmlnL2NvbmZpZy50b21sCg=="}})],1)],1),e._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[e._v("In "),a("code",[e._v("app.toml")]),e._v(", first location:")])]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"TOML"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"json",base64:"ZW5hYmxlZC11bnNhZmUtY29ycyA9IHRydWUK",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/run-prod/prod-sim/node-carol/config/app.toml#L129"}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"One-liner"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"ZWNobyAtZSBub2RlLWNhcm9sJ1xuJ3NlbnRyeS1hbGljZSdcbidzZW50cnktYm9iJ1xuJ3ZhbC1hbGljZSdcbid2YWwtYm9iIFwKICAgIHwgeGFyZ3MgLUkge30gXAogICAgZG9ja2VyIHJ1biAtLXJtIC1pIFwKICAgIC12ICQocHdkKS9wcm9kLXNpbS97fTovcm9vdC8uY2hlY2tlcnMgXAogICAgLS1lbnRyeXBvaW50IHNlZCBcCiAgICBjaGVja2Vyc2RfaSBcCiAgICAtRWkgJ3MvXmVuYWJsZWQtdW5zYWZlLWNvcnMgPSBmYWxzZS9lbmFibGVkLXVuc2FmZS1jb3JzID0gdHJ1ZS9nJyBcCiAgICAvcm9vdC8uY2hlY2tlcnMvY29uZmlnL2FwcC50b21sCg=="}})],1)],1),e._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[e._v("In "),a("code",[e._v("app.toml")]),e._v(", second location:")])]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"TOML"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"json",base64:"ZW5hYmxlLXVuc2FmZS1jb3JzID0gdHJ1ZQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/run-prod/prod-sim/node-carol/config/app.toml#L181"}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"One-liner"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"ZWNobyAtZSBub2RlLWNhcm9sJ1xuJ3NlbnRyeS1hbGljZSdcbidzZW50cnktYm9iJ1xuJ3ZhbC1hbGljZSdcbid2YWwtYm9iIFwKICAgIHwgeGFyZ3MgLUkge30gXAogICAgZG9ja2VyIHJ1biAtLXJtIC1pIFwKICAgIC12ICQocHdkKS9wcm9kLXNpbS97fTovcm9vdC8uY2hlY2tlcnMgXAogICAgLS1lbnRyeXBvaW50IHNlZCBcCiAgICBjaGVja2Vyc2RfaSBcCiAgICAtRWkgJ3MvXmVuYWJsZS11bnNhZmUtY29ycyA9IGZhbHNlL2VuYWJsZS11bnNhZmUtY29ycyA9IHRydWUvZycgXAogICAgL3Jvb3QvLmNoZWNrZXJzL2NvbmZpZy9hcHAudG9tbAo="}})],1)],1),e._v(" "),a("h2",{attrs:{id:"compose-elements"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#compose-elements"}},[e._v("#")]),e._v(" Compose elements")]),e._v(" "),a("p",[e._v("You have prepared:")]),e._v(" "),a("ul",[a("li",[e._v("The basic Docker elements")]),e._v(" "),a("li",[e._v("The blockchain elements")]),e._v(" "),a("li",[e._v("The network elements")])]),e._v(" "),a("p",[e._v("Time to assemble them in Compose.")]),e._v(" "),a("h3",{attrs:{id:"the-executables-that-run"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#the-executables-that-run"}},[e._v("#")]),e._v(" The executables that run")]),e._v(" "),a("p",[e._v("You define the different containers as "),a("code",[e._v("services")]),e._v(". Important elements to start with are:")]),e._v(" "),a("ul",[a("li",[e._v("In "),a("code",[e._v("container_name")]),e._v(", you use names that make them intelligible and match the names you used in the above preparations.")]),e._v(" "),a("li",[e._v("In "),a("code",[e._v("image")]),e._v(", you declare the Docker image to use.")]),e._v(" "),a("li",[e._v("In "),a("code",[e._v("command")]),e._v(", you define the command to use when launching the image.")])]),e._v(" "),a("p",[e._v("In a new "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/run-prod/prod-sim/docker-compose.yml",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("prod-sim/docker-compose.yml")]),a("OutboundLink")],1),e._v(", write:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"yaml",base64:"dmVyc2lvbjogJnF1b3Q7My43JnF1b3Q7CgpzZXJ2aWNlczoKCiAga21zLWFsaWNlOgogICAgY29tbWFuZDogc3RhcnQgLS1jb25maWcgL3Jvb3QvdG1rbXMvdG1rbXMudG9tbAogICAgY29udGFpbmVyX25hbWU6IGttcy1hbGljZQogICAgaW1hZ2U6IHRta21zX2k6djAuMTIuMgoKICB2YWwtYWxpY2U6CiAgICBjb21tYW5kOiBzdGFydAogICAgY29udGFpbmVyX25hbWU6IHZhbC1hbGljZQogICAgaW1hZ2U6IGNoZWNrZXJzZF9pCgogIHNlbnRyeS1hbGljZToKICAgIGNvbW1hbmQ6IHN0YXJ0CiAgICBjb250YWluZXJfbmFtZTogc2VudHJ5LWFsaWNlCiAgICBpbWFnZTogY2hlY2tlcnNkX2kKCiAgdmFsLWJvYjoKICAgIGNvbW1hbmQ6IHN0YXJ0CiAgICBjb250YWluZXJfbmFtZTogdmFsLWJvYgogICAgaW1hZ2U6IGNoZWNrZXJzZF9pCgogIHNlbnRyeS1ib2I6CiAgICBjb21tYW5kOiBzdGFydAogICAgY29udGFpbmVyX25hbWU6IHNlbnRyeS1ib2IKICAgIGltYWdlOiBjaGVja2Vyc2RfaQoKICBub2RlLWNhcm9sOgogICAgY29tbWFuZDogc3RhcnQKICAgIGNvbnRhaW5lcl9uYW1lOiBub2RlLWNhcm9sCiAgICBpbWFnZTogY2hlY2tlcnNkX2kK"}}),e._v(" "),a("p",[e._v("Of course, Alice's and Bob's desktop computers are not part of the server infrastructure.")]),e._v(" "),a("p",[e._v("You are going to further refine the service definitions next, starting with the disk volumes.")]),e._v(" "),a("h3",{attrs:{id:"the-data-each-container-needs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#the-data-each-container-needs"}},[e._v("#")]),e._v(" The data each container needs")]),e._v(" "),a("p",[e._v("Each container needs to access its own private folder, prepared earlier, and only that folder. Declare the volume mappings with paths relative to the "),a("code",[e._v("docker-compose.yml")]),e._v(" file:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"yaml",base64:"c2VydmljZXM6CgogIGttcy1hbGljZToKICAgIC4uLgogICAgdm9sdW1lczoKICAgICAgLSAuL2ttcy1hbGljZTovcm9vdC90bWttcwoKICB2YWwtYWxpY2U6CiAgICAuLi4KICAgIHZvbHVtZXM6CiAgICAgIC0gLi92YWwtYWxpY2U6L3Jvb3QvLmNoZWNrZXJzCgogIHNlbnRyeS1hbGljZToKICAgIC4uLgogICAgdm9sdW1lczoKICAgICAgLSAuL3NlbnRyeS1hbGljZTovcm9vdC8uY2hlY2tlcnMKCiAgdmFsLWJvYjoKICAgIC4uLgogICAgdm9sdW1lczoKICAgICAgLSAuL3ZhbC1ib2I6L3Jvb3QvLmNoZWNrZXJzCgogIHNlbnRyeS1ib2I6CiAgICAuLi4KICAgIHZvbHVtZXM6CiAgICAgIC0gLi9zZW50cnktYm9iOi9yb290Ly5jaGVja2VycwoKICBub2RlLWNhcm9sOgogICAgLi4uCiAgICB2b2x1bWVzOgogICAgICAtIC4vbm9kZS1jYXJvbDovcm9vdC8uY2hlY2tlcnMK"}}),e._v(" "),a("h3",{attrs:{id:"the-networks-they-run-in"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#the-networks-they-run-in"}},[e._v("#")]),e._v(" The networks they run in")]),e._v(" "),a("p",[e._v("The user-defined networks need to mimic the desired separation of machines/containers, it can be self-explanatorily declared as:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"yaml",base64:"bmV0d29ya3M6CiAgbmV0LWFsaWNlLWttczoKICBuZXQtYWxpY2U6CiAgbmV0LWJvYjoKICBuZXQtcHVibGljOgo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/run-prod/prod-sim/docker-compose.yml#L3-L7"}}),e._v(" "),a("p",[e._v("With the network declaration done, the associating of each computer to each network can be written as:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"yaml",base64:"c2VydmljZXM6CgogIGttcy1hbGljZToKICAgIC4uLgogICAgbmV0d29ya3M6CiAgICAgIC0gbmV0LWFsaWNlLWttcwoKICB2YWwtYWxpY2U6CiAgICAuLi4KICAgIG5ldHdvcmtzOgogICAgICAtIG5ldC1hbGljZS1rbXMKICAgICAgLSBuZXQtYWxpY2UKCiAgc2VudHJ5LWFsaWNlOgogICAgLi4uCiAgICBuZXR3b3JrczoKICAgICAgLSBuZXQtYWxpY2UKICAgICAgLSBuZXQtcHVibGljCgogIHZhbC1ib2I6CiAgICAuLi4KICAgIG5ldHdvcmtzOgogICAgICAtIG5ldC1ib2IKCiAgc2VudHJ5LWJvYjoKICAgIC4uLgogICAgbmV0d29ya3M6CiAgICAgIC0gbmV0LWJvYgogICAgICAtIG5ldC1wdWJsaWMKCiAgbm9kZS1jYXJvbDoKICAgIC4uLgogICAgbmV0d29ya3M6CiAgICAgIC0gbmV0LXB1YmxpYwo="}}),e._v(" "),a("h3",{attrs:{id:"additional-settings"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#additional-settings"}},[e._v("#")]),e._v(" Additional settings")]),e._v(" "),a("p",[e._v("The KMS connects to the node and can reconnect. So have "),a("code",[e._v("val-alice")]),e._v(" start after "),a("code",[e._v("kms-alice")]),e._v(":")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"yaml",base64:"c2VydmljZXM6CgogIHZhbC1hbGljZToKICAgIC4uLgogICAgZGVwZW5kc19vbjoKICAgICAgLSBrbXMtYWxpY2UK",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/run-prod/prod-sim/docker-compose.yml#L25-L26"}}),e._v(" "),a("p",[e._v("With all these computers on their Docker networks, you may still want to access one of them to query the blockchain, or to play games. In order to make your host computer look like an open node, expose Carol's node on all addresses of your host:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"yaml",base64:"c2VydmljZXM6CgogIG5vZGUtY2Fyb2w6CiAgICAuLi4KICAgIHBvcnRzOgogICAgICAtIDAuMC4wLjA6MjY2NTc6MjY2NTcK",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/run-prod/prod-sim/docker-compose.yml#L69-L70"}}),e._v(" "),a("h3",{attrs:{id:"launching-compose"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#launching-compose"}},[e._v("#")]),e._v(" Launching Compose")]),e._v(" "),a("HighlightBox",{attrs:{type:"tip"}},[a("p",[e._v("After this long preparation, before launch, it could be a good time to make a Git commit so that you can restore easily.")])]),e._v(" "),a("p",[e._v("You are now ready to start your setup with a name other than the folder it is running in:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgY29tcG9zZSBcCiAgICAtLWZpbGUgcHJvZC1zaW0vZG9ja2VyLWNvbXBvc2UueW1sIFwKICAgIC0tcHJvamVjdC1uYW1lIGNoZWNrZXJzLXByb2QgdXAgXAogICAgLS1kZXRhY2gK"}}),e._v(" "),a("p",[e._v("At this point, it should be apparent that you need to update "),a("code",[e._v(".gitignore")]),e._v(". Add:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"gitignore",base64:"YnVpbGQvCnByb2Qtc2ltLyovY29uZmlnL2FkZHJib29rLmpzb24KcHJvZC1zaW0vKi9kYXRhLyoKIXByb2Qtc2ltLyovZGF0YS9wcml2X3ZhbGlkYXRvcl9zdGF0ZS5qc29uCg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/run-prod/.gitignore#L4-L7"}}),e._v(" "),a("p",[e._v("Note how "),a("code",[e._v("priv_validator_state.json")]),e._v(" is necessary if you want to try again on another host, otherwise, it would be ignored by Git.")]),e._v(" "),a("h3",{attrs:{id:"interacting-with-compose"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#interacting-with-compose"}},[e._v("#")]),e._v(" Interacting with Compose")]),e._v(" "),a("p",[e._v("Your six containers are running. To monitor their status, and confirm that they are running, use the provided Docker container interface.")]),e._v(" "),a("p",[e._v("Now you can connect to "),a("code",[e._v("node-carol")]),e._v(" to start interacting with the blockchain as you would a normal node. For instance, to ask a simple "),a("code",[e._v("status")]),e._v(":")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"In net-public"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IFwKICAgIC0tbmV0d29yayBjaGVja2Vycy1wcm9kX25ldC1wdWJsaWMgXAogICAgY2hlY2tlcnNkX2kgc3RhdHVzIFwKICAgIC0tbm9kZSAmcXVvdDt0Y3A6Ly9ub2RlLWNhcm9sOjI2NjU3JnF1b3Q7Cg=="}}),e._v(" "),a("p",[e._v("Note how the "),a("code",[e._v("net-public")]),e._v(" network name is prefixed with the Compose project name. If in doubt, you can run:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgbmV0d29yayBscwo="}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"Local Mac"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCAuL2J1aWxkL2NoZWNrZXJzZC1kYXJ3aW4tYW1kNjQgc3RhdHVzIFwKICAgIC0tbm9kZSAmcXVvdDt0Y3A6Ly9sb2NhbGhvc3Q6MjY2NTcmcXVvdDsK"}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"Windows Powershell"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"Jmd0OyAuL2J1aWxkL2NoZWNrZXJzZC13aW5kb3dzLWFtZDY0IHN0YXR1cyBcCiAgICAgLS1ub2RlICZxdW90O3RjcDovL2xvY2FsaG9zdDoyNjY1NyZxdW90Owo="}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"In plain Docker"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IFwKICAgIGNoZWNrZXJzZF9pIHN0YXR1cyBcCiAgICAtLW5vZGUgJnF1b3Q7dGNwOi8vMTkyLjE2OC4wLjI6MjY2NTcmcXVvdDsK"}}),e._v(" "),a("p",[e._v("Here you would replace "),a("code",[e._v("192.168.0.2")]),e._v(" with the actual IP address of your host computer.")])],1)],1),e._v(" "),a("hr"),e._v(" "),a("p",[e._v("From this point on everything you already know how to do, such as connecting to your local node, applies.")]),e._v(" "),a("p",[e._v("Whenever you submit a transaction to "),a("code",[e._v("node-carol")]),e._v(", it will be propagated to the sentries and onward to the validators.")]),e._v(" "),a("p",[e._v("At this juncture, you may ask: Is it still possible to run a full game in almost a single block, as you did earlier in the "),a("RouterLink",{attrs:{to:"/hands-on-exercise/3-cosmjs-adv/2-cosmjs-messages.html#multiple-transactions-in-a-block"}},[e._v("CosmJS integration tests")]),e._v("? After all, when "),a("code",[e._v("node-carol")]),e._v(" passes on the transactions as they come, it is not certain that the recipients will honor the order in which they were received. Of course, they make sure to order Alice's transactions, thanks to the "),a("code",[e._v("sequence")]),e._v(", as well as Bob's. But do they keep the A-B-A-B... order in which they were sent?")],1),e._v(" "),a("p",[e._v("To find out, you need to credit the tests' Alice and Bob accounts:")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("Get your prod setup's respective addresses for Alice and Bob:")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"Alice"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBhbGljZT0kKGVjaG8gcGFzc3dvcmQgfCBkb2NrZXIgcnVuIC0tcm0gLWkgXAogICAgLXYgJChwd2QpL3Byb2Qtc2ltL2Rlc2stYWxpY2U6L3Jvb3QvLmNoZWNrZXJzIFwKICAgIGNoZWNrZXJzZF9pOnYxLWFscGluZSBcCiAgICBrZXlzIFwKICAgIC0ta2V5cmluZy1iYWNrZW5kIGZpbGUgLS1rZXlyaW5nLWRpciAvcm9vdC8uY2hlY2tlcnMva2V5cyBcCiAgICBzaG93IGFsaWNlIC0tYWRkcmVzcykK"}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"Bob"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBib2I9JChlY2hvIHBhc3N3b3JkIHwgZG9ja2VyIHJ1biAtLXJtIC1pIFwKICAgIC12ICQocHdkKS9wcm9kLXNpbS9kZXNrLWJvYjovcm9vdC8uY2hlY2tlcnMgXAogICAgY2hlY2tlcnNkX2k6djEtYWxwaW5lIFwKICAgIGtleXMgXAogICAgLS1rZXlyaW5nLWJhY2tlbmQgZmlsZSAtLWtleXJpbmctZGlyIC9yb290Ly5jaGVja2Vycy9rZXlzIFwKICAgIHNob3cgYm9iIC0tYWRkcmVzcykK"}})],1)],1)],1),e._v(" "),a("li",[a("p",[e._v("The CosmJS tests use "),a("code",[e._v("stake")]),e._v(" and "),a("code",[e._v("token")]),e._v(", whereas this production setup uses only "),a("code",[e._v("upawn")]),e._v(". Therefore, do a "),a("em",[e._v("text")]),e._v(" search and change all occurrences of "),a("code",[e._v("stake")]),e._v(" and "),a("code",[e._v("token")]),e._v(" to "),a("code",[e._v("upawn")]),e._v(" in "),a("a",{attrs:{href:"https://github.com/cosmos/academy-checkers-ui/blob/main/test/integration/stored-game-action.ts",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("client/test/integration/stored-game-action.ts")]),a("OutboundLink")],1),e._v(". Also remove the "),a("a",{attrs:{href:"https://github.com/cosmos/academy-checkers-ui/blob/main/test/integration/stored-game-action.ts#L56-L60",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("upawn: 1,")]),a("OutboundLink")],1),e._v(" lines that prevent compilation.")])]),e._v(" "),a("li",[a("p",[e._v("Credit the test accounts so that the CosmJS tests do not attempt to call a missing faucet:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBlY2hvIHBhc3N3b3JkIHwgZG9ja2VyIHJ1biAtLXJtIC1pIFwKICAgIC12ICQocHdkKS9wcm9kLXNpbS9kZXNrLWFsaWNlOi9yb290Ly5jaGVja2VycyBcCiAgICAtLW5ldHdvcmsgY2hlY2tlcnMtcHJvZF9uZXQtcHVibGljIFwKICAgIGNoZWNrZXJzZF9pOnYxLWFscGluZSB0eCBiYW5rIFwKICAgIHNlbmQgJGFsaWNlIGNvc21vczFmeDZxbHh3dGVlcXhneHdzdzgzd2tmNHM5ZmNubndrOHo4NnNxbCAzMDB1cGF3biBcCiAgICAtLWZyb20gJGFsaWNlIFwKICAgIC0ta2V5cmluZy1iYWNrZW5kIGZpbGUgLS1rZXlyaW5nLWRpciAvcm9vdC8uY2hlY2tlcnMva2V5cyBcCiAgICAtLWNoYWluLWlkIGNoZWNrZXJzLTEgXAogICAgLS1ub2RlIGh0dHA6Ly9ub2RlLWNhcm9sOjI2NjU3IFwKICAgIC0tYnJvYWRjYXN0LW1vZGUgYmxvY2sgLS15ZXMKJCBlY2hvIHBhc3N3b3JkIHwgZG9ja2VyIHJ1biAtLXJtIC1pIFwKICAgIC12ICQocHdkKS9wcm9kLXNpbS9kZXNrLWJvYjovcm9vdC8uY2hlY2tlcnMgXAogICAgLS1uZXR3b3JrIGNoZWNrZXJzLXByb2RfbmV0LXB1YmxpYyBcCiAgICBjaGVja2Vyc2RfaTp2MS1hbHBpbmUgdHggYmFuayBcCiAgICBzZW5kICRib2IgY29zbW9zMW1xbDlhYXV4MzQ1M3RkZ2hrNnJ6a21rNDNzdHh2bnZoYTRudjIyIDMwMHVwYXduIFwKICAgIC0tZnJvbSAkYm9iIFwKICAgIC0ta2V5cmluZy1iYWNrZW5kIGZpbGUgLS1rZXlyaW5nLWRpciAvcm9vdC8uY2hlY2tlcnMva2V5cyBcCiAgICAtLWNoYWluLWlkIGNoZWNrZXJzLTEgXAogICAgLS1ub2RlIGh0dHA6Ly9ub2RlLWNhcm9sOjI2NjU3IFwKICAgIC0tYnJvYWRjYXN0LW1vZGUgYmxvY2sgLS15ZXMK"}})],1)]),e._v(" "),a("p",[e._v("Now you can launch everything within "),a("code",[e._v("net-public")]),e._v(":")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IFwKICAgIC12ICQocHdkKS9jbGllbnQ6L2NsaWVudCAtdyAvY2xpZW50IFwKICAgIC0tbmV0d29yayBjaGVja2Vycy1wcm9kX25ldC1wdWJsaWMgXAogICAgLS1lbnYgUlBDX1VSTD0mcXVvdDtodHRwOi8vbm9kZS1jYXJvbDoyNjY1NyZxdW90OyBcCiAgICBub2RlOjE4Ljctc2xpbSBcCiAgICBucG0gdGVzdAo="}}),e._v(" "),a("p",[e._v("The tests should pass. "),a("em",[e._v("Should")]),e._v(" as in there is no protocol guarantee that they will, but it looks like they do.")]),e._v(" "),a("h3",{attrs:{id:"stopping-compose"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#stopping-compose"}},[e._v("#")]),e._v(" Stopping Compose")]),e._v(" "),a("p",[e._v("To stop your whole setup, run:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgY29tcG9zZSAtLXByb2plY3QtbmFtZSBjaGVja2Vycy1wcm9kIGRvd24K"}}),e._v(" "),a("ExpansionPanel",{attrs:{title:"Troubleshooting"}},[a("PanelListItem",{attrs:{number:"1"}},[a("p",[e._v("You may encounter an error such as:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"txt",base64:"RXJyb3I6IGVycm9yIGR1cmluZyBoYW5kc2hha2U6IGVycm9yIG9uIHJlcGxheTogdmFsaWRhdG9yIHNldCBpcyBuaWwgaW4gZ2VuZXNpcyBhbmQgc3RpbGwgZW1wdHkgYWZ0ZXIgSW5pdENoYWluCg=="}}),e._v(" "),a("p",[e._v("If encountering this or other errors, you may want to do a state reset on all nodes:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBlY2hvIC1lIG5vZGUtY2Fyb2wnXG4nc2VudHJ5LWFsaWNlJ1xuJ3NlbnRyeS1ib2InXG4ndmFsLWFsaWNlJ1xuJ3ZhbC1ib2IgXAogICAgfCB4YXJncyAtSSB7fSBcCiAgICBkb2NrZXIgcnVuIC0tcm0gLWkgXAogICAgLXYgJChwd2QpL3Byb2Qtc2ltL3t9Oi9yb290Ly5jaGVja2VycyBcCiAgICBjaGVja2Vyc2RfaSBcCiAgICB0ZW5kZXJtaW50IHVuc2FmZS1yZXNldC1hbGwgXAogICAgLS1ob21lIC9yb290Ly5jaGVja2Vycwo="}})],1),e._v(" "),a("PanelListItem",{attrs:{number:"2"}},[a("p",[e._v("If one of your services (for example, "),a("code",[e._v("sentry-bob")]),e._v(") fails to start because it could not resolve one of the other containers, you can restart that service independently with:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgY29tcG9zZSByZXN0YXJ0IHNlbnRyeS1ib2IK"}})],1),e._v(" "),a("PanelListItem",{attrs:{number:"3"}},[a("p",[e._v("If you want to get more detailed errors from your KMS, you can add a flag in its service definition:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"yaml",base64:"c2VydmljZXM6CgogIGttcy1hbGljZToKICAgIC4uLgogICAgZW52aXJvbm1lbnQ6CiAgICAgIC0gUlVTVF9CQUNLVFJBQ0U9MQo="}})],1),e._v(" "),a("PanelListItem",{attrs:{number:"4",last:!0}},[a("p",[e._v("If you want to erase all states after a good run, and if you have a Git commit from which to restore the state files, you can create a "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/run-prod/prod-sim/unsafe-reset-state.sh",target:"_blank",rel:"noopener noreferrer"}},[e._v("new script"),a("OutboundLink")],1),e._v(" for that.")])])],1),e._v(" "),a("h2",{attrs:{id:"self-contained-checkers-blockchain"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#self-contained-checkers-blockchain"}},[e._v("#")]),e._v(" Self-contained checkers blockchain")]),e._v(" "),a("p",[e._v("Now may be a good time to prepare a standalone setup that can be used by anyone who wants to test a checkers blockchain with minimum effort. The target setup ought to have the following characteristics:")]),e._v(" "),a("ul",[a("li",[e._v("It uses a single "),a("code",[e._v("Dockerfile")]),e._v(".")]),e._v(" "),a("li",[e._v("Such an image could be generated and uploaded into a Docker image registry to increase ease of use.")]),e._v(" "),a("li",[e._v("It can be run by someone who just wants to try checkers without going through node and genesis setups.")]),e._v(" "),a("li",[e._v("The "),a("code",[e._v("Dockerfile")]),e._v(" does not need to be in the repository to be usable. It could be copied elsewhere and still work, i.e. no "),a("code",[e._v("ADD")]),e._v("ing local files.")]),e._v(" "),a("li",[e._v("The image(s) should be as small as is reasonable.")]),e._v(" "),a("li",[e._v("It uses "),a("code",[e._v("stake")]),e._v(" instead of "),a("code",[e._v("upawn")]),e._v(", and has "),a("code",[e._v("token")]),e._v(" so as to be compatible with the current state of the checkers CosmJS exercise.")]),e._v(" "),a("li",[e._v("It also provides a faucet to further facilitate tests.")]),e._v(" "),a("li",[e._v("It sacrifices key safety to increase ease of use.")])]),e._v(" "),a("p",[e._v("The CosmJS exercise already references this standalone "),a("code",[e._v("Dockerfile")]),e._v(", so this is a circular reference. You can still work on it on your own now.")]),e._v(" "),a("p",[e._v("It is possible to build "),a("a",{attrs:{href:"https://docs.docker.com/build/building/multi-stage/#stop-at-a-specific-build-stage",target:"_blank",rel:"noopener noreferrer"}},[e._v("more than one Docker image"),a("OutboundLink")],1),e._v(" out of a single "),a("code",[e._v("Dockerfile")]),e._v(" by using the multi-stage build mechanism.")]),e._v(" "),a("h3",{attrs:{id:"cosmjs-faucet"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cosmjs-faucet"}},[e._v("#")]),e._v(" CosmJS faucet")]),e._v(" "),a("p",[e._v("When running "),a("code",[e._v("ignite chain serve")]),e._v(" you also get a faucet, which was called when running the "),a("RouterLink",{attrs:{to:"/hands-on-exercise/3-cosmjs-adv/2-cosmjs-messages.html#adding-tests"}},[e._v("CosmJS integration tests")]),e._v(". In fact, CosmJS also offers a "),a("a",{attrs:{href:"https://www.npmjs.com/package/@cosmjs/faucet",target:"_blank",rel:"noopener noreferrer"}},[e._v("faucet package"),a("OutboundLink")],1),e._v(". Its API differs from Ignite's faucet. If you went through the CosmJS exercise, you saw its API being called too.")],1),e._v(" "),a("h3",{attrs:{id:"dockerfile-construction-checkers"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile-construction-checkers"}},[e._v("#")]),e._v(" Dockerfile construction, checkers")]),e._v(" "),a("p",[e._v("You assemble this multi-stage "),a("code",[e._v("Dockerfile")]),e._v(" step by step, starting with the checkers part:")]),e._v(" "),a("PanelList",[a("PanelListItem",{attrs:{number:"1"}},[a("p",[e._v("Build the checkers executable as you have learned in this section, but this time from the public repository so as to not depend on local files:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"ockerfile",base64:"RlJPTSAtLXBsYXRmb3JtPWxpbnV4IGdvbGFuZzoxLjE4LjctYWxwaW5lIEFTIGJ1aWxkZXIKCkVOViBDSEVDS0VSU19WRVJTSU9OPW1haW4KClJVTiBhcGsgYWRkIC0tdXBkYXRlIC0tbm8tY2FjaGUgbWFrZSBnaXQKCldPUktESVIgL3Jvb3QKUlVOIGdpdCBjbG9uZSAtLWRlcHRoIDEgLS1icmFuY2ggJHtDSEVDS0VSU19WRVJTSU9OfSBodHRwczovL2dpdGh1Yi5jb20vY29zbW9zL2I5LWNoZWNrZXJzLWFjYWRlbXktZHJhZnQuZ2l0IGNoZWNrZXJzCgpXT1JLRElSIC9yb290L2NoZWNrZXJzClJVTiBnbyBidWlsZCAtbyAuL2J1aWxkL2NoZWNrZXJzZCAuL2NtZC9jaGVja2Vyc2QvbWFpbi5nbwoKRlJPTSAtLXBsYXRmb3JtPWxpbnV4IGFscGluZQoKQ09QWSAtLWZyb209YnVpbGRlciAvcm9vdC9jaGVja2Vycy9idWlsZC9jaGVja2Vyc2QgL3Vzci9sb2NhbC9iaW4vY2hlY2tlcnNkCg=="}})],1),e._v(" "),a("PanelListItem",{attrs:{number:"2"}},[a("p",[e._v("To offer maximum determinism, you are going to reuse unprotected keys. First you need to create them with "),a("code",[e._v("checkersd")]),e._v(" separately, somewhere "),a("em",[e._v("unimportant")]),e._v(" like a temporary container:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBjaGVja2Vyc2Qga2V5cyBhZGQgYWxpY2UgLS1rZXlyaW5nLWJhY2tlbmQgdGVzdAo="}}),e._v(" "),a("p",[e._v("This returns something like:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"txt",base64:"Ci0gbmFtZTogYWxpY2UKICB0eXBlOiBsb2NhbAogIGFkZHJlc3M6IGNvc21vczFhbTNmbnA1ZGQ2bm5kazVqeWpxOW1wcWgzeXZ0MmptbWR2ODN4bgogIHB1YmtleTogJ3smcXVvdDtAdHlwZSZxdW90OzomcXVvdDsvY29zbW9zLmNyeXB0by5zZWNwMjU2azEuUHViS2V5JnF1b3Q7LCZxdW90O2tleSZxdW90OzomcXVvdDtBL0U2ZEhuM1cyWHZDckxraHAvZE54QVF5VnBtZHV4RVhQQmcvblAvUHlNYSZxdW90O30nCiAgbW5lbW9uaWM6ICZxdW90OyZxdW90OwoKKipJbXBvcnRhbnQqKiB3cml0ZSB0aGlzIG1uZW1vbmljIHBocmFzZSBpbiBhIHNhZmUgcGxhY2UuCkl0IGlzIHRoZSBvbmx5IHdheSB0byByZWNvdmVyIHlvdXIgYWNjb3VudCBpZiB5b3UgZXZlciBmb3JnZXQgeW91ciBwYXNzd29yZC4KCnplYnJhIGJ1cmRlbiBhZmZvcmQgd29yayBwb3dlciBhZnJhaWQgZmllbGQgY3JlZWsgbGF1Z2ggZ292ZXJuIHVwZ3JhZGUgcHJvamVjdCBnbHVlIGNlaWxpbmcgbG91bmdlIG1vYmlsZSByb21hbmNlIHBlYXIgcmVsaWVmIGVpdGhlciBwYW5lbCBleHBlY3QgZWFnbGUgamFja2V0Cg=="}}),e._v(" "),a("p",[e._v("Make a note of the mnemonic, so as to reuse it in the faucet's definition.")]),e._v(" "),a("p",[e._v("Add this new address information:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff",base64:"ICAgIENPUFkgLS1mcm9tPWJ1aWxkZXIgL3Jvb3QvY2hlY2tlcnMvYnVpbGQvY2hlY2tlcnNkIC91c3IvbG9jYWwvYmluL2NoZWNrZXJzZAoKKyAgRU5WIEFMSUNFPWNvc21vczFhbTNmbnA1ZGQ2bm5kazVqeWpxOW1wcWgzeXZ0MmptbWR2ODN4bgo="}})],1),e._v(" "),a("PanelListItem",{attrs:{number:"3"}},[a("p",[e._v("You want to import the only validator's private key into the Docker image's own test keyring. To export it first, run:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBlY2hvIHBhc3N3b3JkIHwgY2hlY2tlcnNkIGtleXMgZXhwb3J0IGFsaWNlIC0ta2V5cmluZy1iYWNrZW5kIHRlc3QK"}}),e._v(" "),a("p",[e._v("This returns something like:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"txt",base64:"LS0tLS1CRUdJTiBURU5ERVJNSU5UIFBSSVZBVEUgS0VZLS0tLS0Ka2RmOiBiY3J5cHQKc2FsdDogQkU1OEU2NEU2MTk1NjNFMzM3QzZEODk5RjA2QkYwMjIKdHlwZTogc2VjcDI1NmsxCgpmT002Wk5ydXYxQWlyUC9LWXExWmRNTGRwOHlucGs0Y0dQQ3NOVGhtRXZSdnFraE9OcG85UzErdHc2L1dpRlJOCitaWnJTYWVxWU8vM0pLSXI0Y0tSc2FENDYwdnRvSzUzY3J2Si9iRT0KPTFFQm8KLS0tLS1FTkQgVEVOREVSTUlOVCBQUklWQVRFIEtFWS0tLS0tCg=="}}),e._v(" "),a("p",[e._v("Next, add it as a local file in "),a("code",[e._v("Dockerfile")]),e._v(":")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff",base64:"ICAgIEVOViBBTElDRT1jb3Ntb3MxYW0zZm5wNWRkNm5uZGs1anlqcTltcHFoM3l2dDJqbW1kdjgzeG4KCisgIFJVTiBta2RpciAtcCAvcm9vdC8uY2hlY2tlcnMva2V5cwoKKyAgIyBUaGlzIHByaXZhdGUga2V5IGZpbGUgY29ycmVzcG9uZHMgdG8gdGhlIG1uZW1vbmljIGFib3ZlCisgIFJVTiBlY2hvIC0tLS0tQkVHSU4gVEVOREVSTUlOVCBQUklWQVRFIEtFWS0tLS0tICZndDsgL3Jvb3QvLmNoZWNrZXJzL2tleXMvZW5jcnlwdGVkLXByaXZhdGUta2V5LWFsaWNlLnR4dAorICBSVU4gZWNobyBrZGY6IGJjcnlwdCAmZ3Q7Jmd0OyAvcm9vdC8uY2hlY2tlcnMva2V5cy9lbmNyeXB0ZWQtcHJpdmF0ZS1rZXktYWxpY2UudHh0CisgIFJVTiBlY2hvIHNhbHQ6IEE2N0Q4ODEzNkE0NjIzODNBMkREMzA3Mjc1MTBERjU5ICZndDsmZ3Q7IC9yb290Ly5jaGVja2Vycy9rZXlzL2VuY3J5cHRlZC1wcml2YXRlLWtleS1hbGljZS50eHQKKyAgUlVOIGVjaG8gdHlwZTogc2VjcDI1NmsxICZndDsmZ3Q7IC9yb290Ly5jaGVja2Vycy9rZXlzL2VuY3J5cHRlZC1wcml2YXRlLWtleS1hbGljZS50eHQKKyAgUlVOIGVjaG8gICZndDsmZ3Q7IC9yb290Ly5jaGVja2Vycy9rZXlzL2VuY3J5cHRlZC1wcml2YXRlLWtleS1hbGljZS50eHQKKyAgUlVOIGVjaG8gN2d0dFVreGtwV3hsSTl0RjAvdkVZSHZ5c21LVGMvbUcvYVo4ZE1GM3U3YTh4a1BnVkxhL1o3NWsvNDZucjB5TiAmZ3Q7Jmd0OyAvcm9vdC8uY2hlY2tlcnMva2V5cy9lbmNyeXB0ZWQtcHJpdmF0ZS1rZXktYWxpY2UudHh0CisgIFJVTiBlY2hvIEZQL2g1elRWWW9QOHRNbnZWTFYwa29WQU9WNFFRdXJENUM3bDNOOD0gJmd0OyZndDsgL3Jvb3QvLmNoZWNrZXJzL2tleXMvZW5jcnlwdGVkLXByaXZhdGUta2V5LWFsaWNlLnR4dAorICBSVU4gZWNobyA9cXlQNiAmZ3Q7Jmd0OyAvcm9vdC8uY2hlY2tlcnMva2V5cy9lbmNyeXB0ZWQtcHJpdmF0ZS1rZXktYWxpY2UudHh0CisgIFJVTiBlY2hvIC0tLS0tRU5EIFRFTkRFUk1JTlQgUFJJVkFURSBLRVktLS0tLSAmZ3Q7Jmd0OyAvcm9vdC8uY2hlY2tlcnMva2V5cy9lbmNyeXB0ZWQtcHJpdmF0ZS1rZXktYWxpY2UudHh0Cg=="}}),e._v(" "),a("p",[e._v("Now import it:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff",base64:"ICAgIFJVTiBlY2hvIC0tLS0tRU5EIFRFTkRFUk1JTlQgUFJJVkFURSBLRVktLS0tLSAmZ3Q7Jmd0OyAvcm9vdC8uY2hlY2tlcnMva2V5cy9lbmNyeXB0ZWQtcHJpdmF0ZS1rZXktYWxpY2UudHh0CgorICBSVU4gZWNobyBwYXNzd29yZCB8IGNoZWNrZXJzZCBrZXlzIGltcG9ydCBhbGljZSAvcm9vdC8uY2hlY2tlcnMva2V5cy9lbmNyeXB0ZWQtcHJpdmF0ZS1rZXktYWxpY2UudHh0IC0ta2V5cmluZy1iYWNrZW5kIHRlc3QK"}})],1),e._v(" "),a("PanelListItem",{attrs:{number:"4"}},[a("p",[e._v("You then create a genesis as you learned in this section, while making sure the other configuration files are also configured permissively:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff",base64:"ICAgIFJVTiBlY2hvIHBhc3N3b3JkIHwgY2hlY2tlcnNkIGtleXMgaW1wb3J0IGFsaWNlIC9yb290Ly5jaGVja2Vycy9rZXlzL2VuY3J5cHRlZC1wcml2YXRlLWtleS1hbGljZS50eHQgLS1rZXlyaW5nLWJhY2tlbmQgdGVzdAoKKyAgUlVOIGNoZWNrZXJzZCBpbml0IGNoZWNrZXJzCisgIFJVTiBzZWQgLUVpICdzL15lbmFibGUtdW5zYWZlLWNvcnMgPSBmYWxzZS9lbmFibGUtdW5zYWZlLWNvcnMgPSB0cnVlL2cnIC9yb290Ly5jaGVja2Vycy9jb25maWcvYXBwLnRvbWwKKyAgUlVOIHNlZCAtRWkgJ3MvXmVuYWJsZWQtdW5zYWZlLWNvcnMgPSBmYWxzZS9lbmFibGVkLXVuc2FmZS1jb3JzID0gdHJ1ZS9nJyAvcm9vdC8uY2hlY2tlcnMvY29uZmlnL2FwcC50b21sCisgIFJVTiBzZWQgLUVpICdzL15sYWRkciA9ICZxdW90O3RjcDpcL1wvMTI3LjAuMC4xOjI2NjU3JnF1b3Q7L2xhZGRyID0gJnF1b3Q7dGNwOlwvXC8wLjAuMC4wOjI2NjU3JnF1b3Q7L2cnIC9yb290Ly5jaGVja2Vycy9jb25maWcvY29uZmlnLnRvbWwKKyAgUlVOIHNlZCAtRWkgJ3MvXmNvcnNfYWxsb3dlZF9vcmlnaW5zID0gXFtcXS9jb3JzX2FsbG93ZWRfb3JpZ2lucyA9IFxbJnF1b3Q7XComcXVvdDtcXS9nJyAvcm9vdC8uY2hlY2tlcnMvY29uZmlnL2NvbmZpZy50b21sCisgIFJVTiBzZWQgLUVpICdzL15jaGFpbi1pZCA9IC4qJC9jaGFpbi1pZCA9ICZxdW90O2NoZWNrZXJzLTEmcXVvdDsvZycgL3Jvb3QvLmNoZWNrZXJzL2NvbmZpZy9jbGllbnQudG9tbAoKKyAgUlVOIHNlZCAtRWkgJ3MvJnF1b3Q7Y2hhaW5faWQmcXVvdDs6ICZxdW90O2NoZWNrZXJzJnF1b3Q7LyZxdW90O2NoYWluX2lkJnF1b3Q7OiAmcXVvdDtjaGVja2Vycy0xJnF1b3Q7L2cnIC9yb290Ly5jaGVja2Vycy9jb25maWcvZ2VuZXNpcy5qc29uCisgIFJVTiBjaGVja2Vyc2QgYWRkLWdlbmVzaXMtYWNjb3VudCAkQUxJQ0UgMTAwMDAwMDAwMDAwMDAwMHN0YWtlLDEwMDAwMDAwMDAwMDAwMDB0b2tlbgorICBSVU4gY2hlY2tlcnNkIGdlbnR4IGFsaWNlIDEwMDAwMDAwc3Rha2UgLS1rZXlyaW5nLWJhY2tlbmQgdGVzdCBcCisgICAgICAtLWFjY291bnQtbnVtYmVyIDAgLS1zZXF1ZW5jZSAwIC0tY2hhaW4taWQgY2hlY2tlcnMtMSBcCisgICAgICAtLWdhcyAxMDAwMDAwIC0tZ2FzLXByaWNlcyAwLjFzdGFrZQorICBSVU4gY2hlY2tlcnNkIGNvbGxlY3QtZ2VudHhzCg=="}}),e._v(" "),a("p",[e._v("Note that:")]),e._v(" "),a("ul",[a("li",[e._v("You add both "),a("code",[e._v("stake")]),e._v(" and "),a("code",[e._v("token")]),e._v(" to Alice, so as to increase compatibility with the CosmJS exercise.")]),e._v(" "),a("li",[e._v("The genesis transaction is only with "),a("code",[e._v("stake")]),e._v(".")])])],1),e._v(" "),a("PanelListItem",{attrs:{number:"5",last:!0}},[a("p",[e._v("Finally, advertise the gRPC port so that any user knows they ought to forward to the host, and have "),a("code",[e._v("checkersd")]),e._v(" start by default:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff",base64:"ICAgIFJVTiBjaGVja2Vyc2QgY29sbGVjdC1nZW50eHMKCisgIEVYUE9TRSAyNjY1NwoKKyAgRU5UUllQT0lOVCBbICZxdW90O2NoZWNrZXJzZCZxdW90OyBdCg=="}})],1)],1),e._v(" "),a("p",[e._v("Your standalone checkers blockchain with a single validator is ready.")]),e._v(" "),a("h3",{attrs:{id:"dockerfile-construction-faucet"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile-construction-faucet"}},[e._v("#")]),e._v(" Dockerfile construction, faucet")]),e._v(" "),a("p",[e._v("Moving on to the faucet, you continue adding to the same "),a("code",[e._v("Dockerfile")]),e._v(".")]),e._v(" "),a("PanelList",[a("PanelListItem",{attrs:{number:"1"}},[a("p",[e._v("You start its definition as a separate independent stage:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"ockerfile",base64:"RlJPTSAtLXBsYXRmb3JtPWxpbnV4IG5vZGU6MTguNy1hbHBpbmUgQVMgY29zbW9zLWZhdWNldAo="}}),e._v(" "),a("p",[e._v("Install the CosmJS faucet package:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff",base64:"ICAgIEZST00gLS1wbGF0Zm9ybT1saW51eCBub2RlOjE4LjctYWxwaW5lIEFTIGNvc21vcy1mYXVjZXQKCisgIEVOViBDT1NNSlNfVkVSU0lPTj0wLjI4LjExCgorICBSVU4gbnBtIGluc3RhbGwgQGNvc21qcy9mYXVjZXRAJHtDT1NNSlNfVkVSU0lPTn0gLS1nbG9iYWwgLS1wcm9kdWN0aW9uCg=="}})],1),e._v(" "),a("PanelListItem",{attrs:{number:"2"}},[a("p",[e._v("Configure the faucet:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff",base64:"ICAgIFJVTiBucG0gaW5zdGFsbCBAY29zbWpzL2ZhdWNldEAke0NPU01KU19WRVJTSU9OfSAtLWdsb2JhbCAtLXByb2R1Y3Rpb24KCisgIEVOViBGQVVDRVRfQ09OQ1VSUkVOQ1k9MgorICBFTlYgRkFVQ0VUX1BPUlQ9NDUwMAorICBFTlYgRkFVQ0VUX0dBU19QUklDRT0wLjAwMXN0YWtlCisgIEVOViBGQVVDRVRfTU5FTU9OSUM9JnF1b3Q7emVicmEgYnVyZGVuIGFmZm9yZCB3b3JrIHBvd2VyIGFmcmFpZCBmaWVsZCBjcmVlayBsYXVnaCBnb3Zlcm4gdXBncmFkZSBwcm9qZWN0IGdsdWUgY2VpbGluZyBsb3VuZ2UgbW9iaWxlIHJvbWFuY2UgcGVhciByZWxpZWYgZWl0aGVyIHBhbmVsIGV4cGVjdCBlYWdsZSBqYWNrZXQmcXVvdDsKKyAgRU5WIEZBVUNFVF9BRERSRVNTX1BSRUZJWD1jb3Ntb3MKKyAgRU5WIEZBVUNFVF9UT0tFTlM9JnF1b3Q7c3Rha2UsIHRva2VuJnF1b3Q7CisgIEVOViBGQVVDRVRfQ1JFRElUX0FNT1VOVF9TVEFLRT0xMDAKKyAgRU5WIEZBVUNFVF9DUkVESVRfQU1PVU5UX1RPS0VOPTEwMAorICBFTlYgRkFVQ0VUX0NPT0xET1dOX1RJTUU9MAo="}}),e._v(" "),a("HighlightBox",{attrs:{type:"note"}},[a("p",[e._v("Be aware:")]),e._v(" "),a("ul",[a("li",[e._v("A concurrency of at least "),a("code",[e._v("2")]),e._v(" is necessary for the CosmJS exercise, because when crediting in "),a("code",[e._v("before")]),e._v(" it launches two simultaneous requests. The faucet does "),a("strong",[e._v("not")]),e._v(" internally keep track of the accounts' sequences and instead uses its "),a("em",[e._v("distributor")]),e._v(" accounts in a round-robin fashion.")]),e._v(" "),a("li",[e._v("You used port 4500 to mimic that of Ignite's faucet, so as to be conveniently compatible with the CosmJS exercise.")]),e._v(" "),a("li",[e._v("You pasted the mnemonic that you obtained in the previous key-creation steps.")]),e._v(" "),a("li",[e._v("You reused the token denominations as found in the CosmJS exercise.")])])])],1),e._v(" "),a("PanelListItem",{attrs:{number:"3",last:!0}},[a("p",[e._v("Finish the faucet declaration with the port to share and the default command to launch:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"diff",base64:"ICAgIEVOViBGQVVDRVRfQ09PTERPV05fVElNRT0wCgorICBFWFBPU0UgNDUwMAoKKyAgRU5UUllQT0lOVCBbICZxdW90O2Nvc21vcy1mYXVjZXQmcXVvdDsgXQo="}})],1)],1),e._v(" "),a("p",[e._v("You now have a complete setup definition. Time to build the images.")]),e._v(" "),a("ExpansionPanel",{attrs:{title:"Complete Dockerfile"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"ockerfile",base64:"IyBGYXVjZXQ6IGRvY2tlciBidWlsZCAtLXRhcmdldCBmYXVjZXQKRlJPTSAtLXBsYXRmb3JtPWxpbnV4IG5vZGU6MTguNy1hbHBpbmUgQVMgY29zbW9zLWZhdWNldAoKRU5WIENPU01KU19WRVJTSU9OPTAuMjguMTEKClJVTiBucG0gaW5zdGFsbCBAY29zbWpzL2ZhdWNldEAke0NPU01KU19WRVJTSU9OfSAtLWdsb2JhbCAtLXByb2R1Y3Rpb24KCkVOViBGQVVDRVRfQ09OQ1VSUkVOQ1k9MgpFTlYgRkFVQ0VUX1BPUlQ9NDUwMApFTlYgRkFVQ0VUX0dBU19QUklDRT0wLjAwMXN0YWtlCiMgUHJlcGFyZWQga2V5cyBmb3IgZGV0ZXJtaW5pc20KRU5WIEZBVUNFVF9NTkVNT05JQz0mcXVvdDt6ZWJyYSBidXJkZW4gYWZmb3JkIHdvcmsgcG93ZXIgYWZyYWlkIGZpZWxkIGNyZWVrIGxhdWdoIGdvdmVybiB1cGdyYWRlIHByb2plY3QgZ2x1ZSBjZWlsaW5nIGxvdW5nZSBtb2JpbGUgcm9tYW5jZSBwZWFyIHJlbGllZiBlaXRoZXIgcGFuZWwgZXhwZWN0IGVhZ2xlIGphY2tldCZxdW90OwpFTlYgRkFVQ0VUX0FERFJFU1NfUFJFRklYPWNvc21vcwpFTlYgRkFVQ0VUX1RPS0VOUz0mcXVvdDtzdGFrZSwgdG9rZW4mcXVvdDsKRU5WIEZBVUNFVF9DUkVESVRfQU1PVU5UX1NUQUtFPTEwMApFTlYgRkFVQ0VUX0NSRURJVF9BTU9VTlRfVE9LRU49MTAwCkVOViBGQVVDRVRfQ09PTERPV05fVElNRT0wCgpFWFBPU0UgNDUwMAoKRU5UUllQT0lOVCBbICZxdW90O2Nvc21vcy1mYXVjZXQmcXVvdDsgXQoKIyBDaGVja2Vyc2QgYnVpbGRlcgpGUk9NIC0tcGxhdGZvcm09bGludXggZ29sYW5nOjEuMTguNy1hbHBpbmUgQVMgYnVpbGRlcgoKRU5WIENIRUNLRVJTX1ZFUlNJT049bWFpbgoKUlVOIGFwayBhZGQgLS11cGRhdGUgLS1uby1jYWNoZSBtYWtlIGdpdAoKV09SS0RJUiAvcm9vdApSVU4gZ2l0IGNsb25lIC0tZGVwdGggMSAtLWJyYW5jaCAke0NIRUNLRVJTX1ZFUlNJT059IGh0dHBzOi8vZ2l0aHViLmNvbS9jb3Ntb3MvYjktY2hlY2tlcnMtYWNhZGVteS1kcmFmdC5naXQgY2hlY2tlcnMKCldPUktESVIgL3Jvb3QvY2hlY2tlcnMKUlVOIGdvIGJ1aWxkIC1vIC4vYnVpbGQvY2hlY2tlcnNkIC4vY21kL2NoZWNrZXJzZC9tYWluLmdvCgojIENoZWNrZXJzZCBpbiBwcm9kdWN0aW9uCkZST00gLS1wbGF0Zm9ybT1saW51eCBhbHBpbmUKCkNPUFkgLS1mcm9tPWJ1aWxkZXIgL3Jvb3QvY2hlY2tlcnMvYnVpbGQvY2hlY2tlcnNkIC91c3IvbG9jYWwvYmluL2NoZWNrZXJzZAoKIyBUaGlzIGFkZHJlc3MgY29ycmVzcG9uZHMgdG8gdGhlIG1uZW1vbmljIGFib3ZlCkVOViBBTElDRT1jb3Ntb3MxYW0zZm5wNWRkNm5uZGs1anlqcTltcHFoM3l2dDJqbW1kdjgzeG4KClJVTiBta2RpciAtcCAvcm9vdC8uY2hlY2tlcnMva2V5cwoKIyBUaGlzIHByaXZhdGUga2V5IGZpbGUgY29ycmVzcG9uZHMgdG8gdGhlIG1uZW1vbmljIGFib3ZlClJVTiBlY2hvIC0tLS0tQkVHSU4gVEVOREVSTUlOVCBQUklWQVRFIEtFWS0tLS0tICZndDsgL3Jvb3QvLmNoZWNrZXJzL2tleXMvZW5jcnlwdGVkLXByaXZhdGUta2V5LWFsaWNlLnR4dApSVU4gZWNobyBrZGY6IGJjcnlwdCAmZ3Q7Jmd0OyAvcm9vdC8uY2hlY2tlcnMva2V5cy9lbmNyeXB0ZWQtcHJpdmF0ZS1rZXktYWxpY2UudHh0ClJVTiBlY2hvIHNhbHQ6IEE2N0Q4ODEzNkE0NjIzODNBMkREMzA3Mjc1MTBERjU5ICZndDsmZ3Q7IC9yb290Ly5jaGVja2Vycy9rZXlzL2VuY3J5cHRlZC1wcml2YXRlLWtleS1hbGljZS50eHQKUlVOIGVjaG8gdHlwZTogc2VjcDI1NmsxICZndDsmZ3Q7IC9yb290Ly5jaGVja2Vycy9rZXlzL2VuY3J5cHRlZC1wcml2YXRlLWtleS1hbGljZS50eHQKUlVOIGVjaG8gICZndDsmZ3Q7IC9yb290Ly5jaGVja2Vycy9rZXlzL2VuY3J5cHRlZC1wcml2YXRlLWtleS1hbGljZS50eHQKUlVOIGVjaG8gN2d0dFVreGtwV3hsSTl0RjAvdkVZSHZ5c21LVGMvbUcvYVo4ZE1GM3U3YTh4a1BnVkxhL1o3NWsvNDZucjB5TiAmZ3Q7Jmd0OyAvcm9vdC8uY2hlY2tlcnMva2V5cy9lbmNyeXB0ZWQtcHJpdmF0ZS1rZXktYWxpY2UudHh0ClJVTiBlY2hvIEZQL2g1elRWWW9QOHRNbnZWTFYwa29WQU9WNFFRdXJENUM3bDNOOD0gJmd0OyZndDsgL3Jvb3QvLmNoZWNrZXJzL2tleXMvZW5jcnlwdGVkLXByaXZhdGUta2V5LWFsaWNlLnR4dApSVU4gZWNobyA9cXlQNiAmZ3Q7Jmd0OyAvcm9vdC8uY2hlY2tlcnMva2V5cy9lbmNyeXB0ZWQtcHJpdmF0ZS1rZXktYWxpY2UudHh0ClJVTiBlY2hvIC0tLS0tRU5EIFRFTkRFUk1JTlQgUFJJVkFURSBLRVktLS0tLSAmZ3Q7Jmd0OyAvcm9vdC8uY2hlY2tlcnMva2V5cy9lbmNyeXB0ZWQtcHJpdmF0ZS1rZXktYWxpY2UudHh0CgpSVU4gZWNobyBwYXNzd29yZCB8IGNoZWNrZXJzZCBrZXlzIGltcG9ydCBhbGljZSAvcm9vdC8uY2hlY2tlcnMva2V5cy9lbmNyeXB0ZWQtcHJpdmF0ZS1rZXktYWxpY2UudHh0IC0ta2V5cmluZy1iYWNrZW5kIHRlc3QKClJVTiBjaGVja2Vyc2QgaW5pdCBjaGVja2VycwpSVU4gc2VkIC1FaSAncy9eZW5hYmxlLXVuc2FmZS1jb3JzID0gZmFsc2UvZW5hYmxlLXVuc2FmZS1jb3JzID0gdHJ1ZS9nJyAvcm9vdC8uY2hlY2tlcnMvY29uZmlnL2FwcC50b21sClJVTiBzZWQgLUVpICdzL15lbmFibGVkLXVuc2FmZS1jb3JzID0gZmFsc2UvZW5hYmxlZC11bnNhZmUtY29ycyA9IHRydWUvZycgL3Jvb3QvLmNoZWNrZXJzL2NvbmZpZy9hcHAudG9tbApSVU4gc2VkIC1FaSAncy9ebGFkZHIgPSAmcXVvdDt0Y3A6XC9cLzEyNy4wLjAuMToyNjY1NyZxdW90Oy9sYWRkciA9ICZxdW90O3RjcDpcL1wvMC4wLjAuMDoyNjY1NyZxdW90Oy9nJyAvcm9vdC8uY2hlY2tlcnMvY29uZmlnL2NvbmZpZy50b21sClJVTiBzZWQgLUVpICdzL15jb3JzX2FsbG93ZWRfb3JpZ2lucyA9IFxbXF0vY29yc19hbGxvd2VkX29yaWdpbnMgPSBcWyZxdW90O1wqJnF1b3Q7XF0vZycgL3Jvb3QvLmNoZWNrZXJzL2NvbmZpZy9jb25maWcudG9tbApSVU4gc2VkIC1FaSAncy9eY2hhaW4taWQgPSAuKiQvY2hhaW4taWQgPSAmcXVvdDtjaGVja2Vycy0xJnF1b3Q7L2cnIC9yb290Ly5jaGVja2Vycy9jb25maWcvY2xpZW50LnRvbWwKClJVTiBzZWQgLUVpICdzLyZxdW90O2NoYWluX2lkJnF1b3Q7OiAmcXVvdDtjaGVja2VycyZxdW90Oy8mcXVvdDtjaGFpbl9pZCZxdW90OzogJnF1b3Q7Y2hlY2tlcnMtMSZxdW90Oy9nJyAvcm9vdC8uY2hlY2tlcnMvY29uZmlnL2dlbmVzaXMuanNvbgpSVU4gY2hlY2tlcnNkIGFkZC1nZW5lc2lzLWFjY291bnQgJEFMSUNFIDEwMDAwMDAwMDAwMDAwMDBzdGFrZSwxMDAwMDAwMDAwMDAwMDAwdG9rZW4KUlVOIGNoZWNrZXJzZCBnZW50eCBhbGljZSAxMDAwMDAwMHN0YWtlIC0ta2V5cmluZy1iYWNrZW5kIHRlc3QgXAogICAgLS1hY2NvdW50LW51bWJlciAwIC0tc2VxdWVuY2UgMCAtLWNoYWluLWlkIGNoZWNrZXJzLTEgXAogICAgLS1nYXMgMTAwMDAwMCAtLWdhcy1wcmljZXMgMC4xc3Rha2UKUlVOIGNoZWNrZXJzZCBjb2xsZWN0LWdlbnR4cwoKRVhQT1NFIDI2NjU3CgpFTlRSWVBPSU5UIFsgJnF1b3Q7Y2hlY2tlcnNkJnF1b3Q7IF0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/run-prod/Dockerfile-standalone"}})],1),e._v(" "),a("h3",{attrs:{id:"build-your-standalone-images"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#build-your-standalone-images"}},[e._v("#")]),e._v(" Build your standalone images")]),e._v(" "),a("p",[e._v("Your two Docker images will run in the same Docker network. To build them, run:")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"Checkers"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgYnVpbGQgLiBcCiAgICAtZiBEb2NrZXJmaWxlLXN0YW5kYWxvbmUgXAogICAgLXQgY2hlY2tlcnNkX2k6c3RhbmRhbG9uZQo="}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"Faucet"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgYnVpbGQgLiBcCiAgICAtZiBEb2NrZXJmaWxlLXN0YW5kYWxvbmUgXAogICAgLS10YXJnZXQgY29zbW9zLWZhdWNldCBcCiAgICAtdCBjb3Ntb3MtZmF1Y2V0X2k6MC4yOC4xMQo="}})],1)],1),e._v(" "),a("h3",{attrs:{id:"run-your-standalone-checkers"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#run-your-standalone-checkers"}},[e._v("#")]),e._v(" Run your standalone checkers")]),e._v(" "),a("p",[e._v("With your images built, you can launch both "),a("code",[e._v("checkersd")]),e._v(" and the faucet process right away. Allow for a few seconds between them:")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"Checkers"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgbmV0d29yayBjcmVhdGUgY2hlY2tlcnMtbmV0CiQgZG9ja2VyIHJ1biAtLXJtIC1pdCBcCiAgICAtcCAyNjY1NzoyNjY1NyBcCiAgICAtLW5hbWUgY2hlY2tlcnMgXAogICAgLS1uZXR3b3JrIGNoZWNrZXJzLW5ldCBcCiAgICAtLWRldGFjaCBcCiAgICBjaGVja2Vyc2RfaTpzdGFuZGFsb25lIHN0YXJ0Cg=="}}),e._v(" "),a("p",[e._v("Checkers needs about "),a("strong",[e._v("10 seconds")]),e._v(" to become operational. Wait that long before launching the faucet.")]),e._v(" "),a("p",[e._v("If your "),a("code",[e._v("checkers-net")]),e._v(" network already exists, the first command fails with:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"txt",base64:"RXJyb3IgcmVzcG9uc2UgZnJvbSBkYWVtb246IG5ldHdvcmsgd2l0aCBuYW1lIGNoZWNrZXJzLW5ldCBhbHJlYWR5IGV4aXN0cwo="}}),e._v(" "),a("p",[e._v("But that is okay.")])],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"Faucet"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IFwKICAgIC1wIDQ1MDA6NDUwMCBcCiAgICAtLW5hbWUgY29zbW9zLWZhdWNldCBcCiAgICAtLW5ldHdvcmsgY2hlY2tlcnMtbmV0IFwKICAgIC0tZGV0YWNoIFwKICAgIGNvc21vcy1mYXVjZXRfaTowLjI4LjExIHN0YXJ0IGh0dHA6Ly9jaGVja2VyczoyNjY1Nwo="}}),e._v(" "),a("p",[e._v("The faucet needs about "),a("strong",[e._v("20 seconds")]),e._v(" to become operational, as it sends four transactions to its distributor accounts. Wait that long before launching any CosmJS tests.")])],1)],1),e._v(" "),a("hr"),e._v(" "),a("HighlightBox",{attrs:{type:"note"}},[a("p",[e._v("Be aware:")]),e._v(" "),a("ul",[a("li",[e._v("Both processes are started as "),a("code",[e._v("--detach")]),e._v("ed, which is how they are typically started by users who do not care about the details. If you get errors then stop, remove this flag, and restart to see the logs.")]),e._v(" "),a("li",[e._v("Checkers is started with "),a("code",[e._v("--name checkers")]),e._v(", whose name is then reused in the node address "),a("code",[e._v("http://checkers:26657")]),e._v(" when launching the faucet.")])])]),e._v(" "),a("p",[e._v("On a side-note, if you want to access Alice's address in order to access her balance, you can run:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgZXhlYyAtaXQgY2hlY2tlcnMgXAogICAgc2ggLWMgJnF1b3Q7Y2hlY2tlcnNkIHF1ZXJ5IGJhbmsgYmFsYW5jZXMgXCRBTElDRSZxdW90Owo="}}),e._v(" "),a("p",[e._v("And to check the faucet status, you can use:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBjdXJsIGh0dHA6Ly9sb2NhbGhvc3Q6NDUwMC9zdGF0dXMK"}}),e._v(" "),a("p",[e._v("You now have a container running both the checkers and a faucet. You are ready to run your CosmJS tests in "),a("code",[e._v("client")]),e._v(".")]),e._v(" "),a("h3",{attrs:{id:"test-your-standalone-checkers"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#test-your-standalone-checkers"}},[e._v("#")]),e._v(" Test your standalone checkers")]),e._v(" "),a("p",[e._v("Which "),a("code",[e._v("RPC_URL")]),e._v(" and which "),a("code",[e._v("FAUCET_URL")]),e._v(" will the tests require?")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("If locally, the defaults will do:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"ini",base64:"UlBDX1VSTD0mcXVvdDtodHRwOi8vbG9jYWxob3N0OjI2NjU3JnF1b3Q7CkZBVUNFVF9VUkw9JnF1b3Q7aHR0cDovL2xvY2FsaG9zdDo0NTAwJnF1b3Q7Cg=="}})],1),e._v(" "),a("li",[a("p",[e._v("If running from Docker, you have to pass values to the tests that resolve via Docker's automatic name resolution within "),a("code",[e._v("checkers-net")]),e._v(":")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"ini",base64:"UlBDX1VSTD0mcXVvdDtodHRwOi8vY2hlY2tlcnM6MjY2NTcmcXVvdDsKRkFVQ0VUX1VSTD0mcXVvdDtodHRwOi8vY29zbW9zLWZhdWNldDo0NTAwJnF1b3Q7Cg=="}})],1)]),e._v(" "),a("p",[e._v("Now you can launch the tests:")]),e._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"Local"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBucG0gdGVzdCAtLXByZWZpeCBjbGllbnQK"}})],1),e._v(" "),a("CodeGroupItem",{attrs:{title:"Docker"}},[a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgcnVuIC0tcm0gLWl0IFwKICAgIC12ICQocHdkKS9jbGllbnQ6L2NsaWVudCAtdyAvY2xpZW50IFwKICAgIC0tbmV0d29yayBjaGVja2Vycy1uZXQgXAogICAgLS1lbnYgUlBDX1VSTD0mcXVvdDtodHRwOi8vY2hlY2tlcnM6MjY2NTcmcXVvdDsgXAogICAgLS1lbnYgRkFVQ0VUX1VSTD0mcXVvdDtodHRwOi8vY29zbW9zLWZhdWNldDo0NTAwJnF1b3Q7IFwKICAgIG5vZGU6MTguNy1zbGltIFwKICAgIG5wbSB0ZXN0Cg=="}})],1)],1),e._v(" "),a("p",[e._v("To stop (and "),a("code",[e._v("--rm")]),e._v(") both containers, run:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBkb2NrZXIgc3RvcCBjb3Ntb3MtZmF1Y2V0IGNoZWNrZXJzCiQgZG9ja2VyIG5ldHdvcmsgcm0gY2hlY2tlcnMtbmV0Cg=="}}),e._v(" "),a("HighlightBox",{attrs:{type:"synopsis"}},[a("p",[e._v("To summarize, this section has explored:")]),e._v(" "),a("ul",[a("li",[e._v("How to prepare Docker images.")]),e._v(" "),a("li",[e._v("How to prepare nodes for a simulated production setup.")]),e._v(" "),a("li",[e._v("How to prepare a Tendermint Key Management System for a simulated production setup.")]),e._v(" "),a("li",[e._v("How to prepare a blockchain genesis with multiple parties.")]),e._v(" "),a("li",[e._v("How to launch all that with the help of Docker Compose.")]),e._v(" "),a("li",[e._v("How to create a standalone blockchain server in a container.")]),e._v(" "),a("li",[e._v("How to create a small faucet to assist with running your CosmJS integration tests.")])])])],1)}),[],!1,null,null,null);t.default=c.exports}}]);