(window.webpackJsonp=window.webpackJsonp||[]).push([[115],{715:function(e,a,t){"use strict";t.r(a);var o=t(0),c=Object(o.a)({},(function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"message-and-handler-make-sure-a-player-can-reject-a-game"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#message-and-handler-make-sure-a-player-can-reject-a-game"}},[e._v("#")]),e._v(" Message and Handler - Make Sure a Player Can Reject a Game")]),e._v(" "),t("HighlightBox",{attrs:{type:"synopsis"}},[t("p",[e._v("Before proceeding, make sure you have all you need:")]),e._v(" "),t("ul",[t("li",[e._v("You understand the concepts of "),t("RouterLink",{attrs:{to:"/academy/2-main-concepts/transactions.html"}},[e._v("transactions")]),e._v(", "),t("RouterLink",{attrs:{to:"/academy/2-main-concepts/messages.html"}},[e._v("messages")]),e._v("), and "),t("RouterLink",{attrs:{to:"/academy/2-main-concepts/protobuf.html"}},[e._v("Protobuf")]),e._v(".")],1),e._v(" "),t("li",[e._v("You know how to "),t("RouterLink",{attrs:{to:"/academy/4-my-own-chain/create-message.html"}},[e._v("create a message")]),e._v(" with Starport, and code "),t("RouterLink",{attrs:{to:"/academy/4-my-own-chain/create-handling.html"}},[e._v("its handling")]),e._v(". This section does not aim to repeat what can be learned in earlier sections.")],1),e._v(" "),t("li",[e._v("Have Go installed.")]),e._v(" "),t("li",[e._v("The checkers blockchain codebase with the previous messages and their events. You can get there by following the "),t("RouterLink",{attrs:{to:"/academy/4-my-own-chain/events.html"}},[e._v("previous steps")]),e._v(" or checking out the "),t("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/tree/two-events",target:"_blank",rel:"noopener noreferrer"}},[e._v("relevant version"),t("OutboundLink")],1),e._v(".")],1)])]),e._v(" "),t("p",[e._v("If anyone can create a game for any two other players, it is important to allow a player to reject a game. But a player should not be allowed to reject a game once they have made their first move.")]),e._v(" "),t("p",[e._v("To reject a game, a player needs to provide the ID of the game that the player wants to reject. Call the field "),t("code",[e._v("idValue")]),e._v(". This should be sufficient as the signer of the message is implicitly the player.")]),e._v(" "),t("h2",{attrs:{id:"working-with-starport"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#working-with-starport"}},[e._v("#")]),e._v(" Working with Starport")]),e._v(" "),t("p",[e._v("Name the message object "),t("code",[e._v("RejectGame")]),e._v(". Invoke Starport with:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBzdGFycG9ydCBzY2FmZm9sZCBtZXNzYWdlIHJlamVjdEdhbWUgaWRWYWx1ZSAtLW1vZHVsZSBjaGVja2Vycwo="}}),e._v(" "),t("p",[e._v("It creates all the boilerplate for you and leaves a single place for the code you want to include:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAoayBtc2dTZXJ2ZXIpIFJlamVjdEdhbWUoZ29DdHggY29udGV4dC5Db250ZXh0LCBtc2cgKnR5cGVzLk1zZ1JlamVjdEdhbWUpICgqdHlwZXMuTXNnUmVqZWN0R2FtZVJlc3BvbnNlLCBlcnJvcikgewogICAgY3R4IDo9IHNkay5VbndyYXBTREtDb250ZXh0KGdvQ3R4KQoKICAgIC8vIFRPRE86IEhhbmRsaW5nIHRoZSBtZXNzYWdlCiAgICBfID0gY3R4CgogICAgcmV0dXJuICZhbXA7dHlwZXMuTXNnUmVqZWN0R2FtZVJlc3BvbnNle30sIG5pbAp9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/93d048c2b7fbdc26825b41bd043d6203ec9c861c/x/checkers/keeper/msg_server_reject_game.go#L10-L17"}}),e._v(" "),t("h2",{attrs:{id:"additional-information"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#additional-information"}},[e._v("#")]),e._v(" Additional information")]),e._v(" "),t("p",[e._v("A new rule of the game should be that a player cannot reject a game once they begin to play. When loading a "),t("code",[e._v("StoredGame")]),e._v(" from storage you have no way of knowing whether a player already played or not. To access this information add a new field to the "),t("code",[e._v("StoredGame")]),e._v(" called "),t("code",[e._v("MoveCount")]),e._v(". In "),t("code",[e._v("proto/checkers/stored_game.proto")]),e._v(":")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"protobuf",base64:"c3RvcmVkR2FtZSA6PSB0eXBlcy5TdG9yZWRHYW1lewogICAgLi4uCiAgICB1aW50NjQgbW92ZUNvdW50ID0gNzsKfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/329c6d0ae8c1dffa85cd437d0cebb246a827dfb2/proto/checkers/stored_game.proto#L15"}}),e._v(" "),t("p",[e._v("Run Protobuf to recompile the relevant Go files:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBzdGFycG9ydCBnZW5lcmF0ZSBwcm90by1nbwo="}}),e._v(" "),t("p",[t("code",[e._v("MoveCount")]),e._v(" should start at "),t("code",[e._v("0")]),e._v(" and increment by "),t("code",[e._v("1")]),e._v(" on each move. So adjust it first in the handler when creating the game:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"c3RvcmVkR2FtZSA6PSB0eXBlcy5TdG9yZWRHYW1lewogICAgLi4uCiAgICBNb3ZlQ291bnQ6IDAsCn0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/329c6d0ae8c1dffa85cd437d0cebb246a827dfb2/x/checkers/keeper/msg_server_create_game.go#L26"}}),e._v(" "),t("p",[e._v("Just before saving to the storage, in the handler when playing a move:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Li4uCnN0b3JlZEdhbWUuTW92ZUNvdW50KysKc3RvcmVkR2FtZS5HYW1lID0gZ2FtZS5TdHJpbmcoKQouLi4K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/329c6d0ae8c1dffa85cd437d0cebb246a827dfb2/x/checkers/keeper/msg_server_play_move.go#L55"}}),e._v(" "),t("p",[e._v("With "),t("code",[e._v("MoveCount")]),e._v(" counting properly, you are now ready to handle a rejection request.")]),e._v(" "),t("h2",{attrs:{id:"the-reject-handling"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#the-reject-handling"}},[e._v("#")]),e._v(" The reject handling")]),e._v(" "),t("p",[e._v("To follow the Cosmos SDK conventions declare the following new errors:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"RXJyUmVkQWxyZWFkeVBsYXllZCAgID0gc2RrZXJyb3JzLlJlZ2lzdGVyKE1vZHVsZU5hbWUsIDExMDgsICZxdW90O3JlZCBwbGF5ZXIgaGFzIGFscmVhZHkgcGxheWVkJnF1b3Q7KQpFcnJCbGFja0FscmVhZHlQbGF5ZWQgPSBzZGtlcnJvcnMuUmVnaXN0ZXIoTW9kdWxlTmFtZSwgMTEwOSwgJnF1b3Q7YmxhY2sgcGxheWVyIGhhcyBhbHJlYWR5IHBsYXllZCZxdW90OykK",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/329c6d0ae8c1dffa85cd437d0cebb246a827dfb2/x/checkers/types/errors.go#L19-L20"}}),e._v(" "),t("p",[e._v("You will add an event for rejection. Begin by preparing the new keys:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Y29uc3QgKAogICAgUmVqZWN0R2FtZUV2ZW50S2V5ICAgICA9ICZxdW90O0dhbWVSZWplY3RlZCZxdW90OwogICAgUmVqZWN0R2FtZUV2ZW50Q3JlYXRvciA9ICZxdW90O0NyZWF0b3ImcXVvdDsKICAgIFJlamVjdEdhbWVFdmVudElkVmFsdWUgPSAmcXVvdDtJZFZhbHVlJnF1b3Q7CikK",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/329c6d0ae8c1dffa85cd437d0cebb246a827dfb2/x/checkers/types/keys.go#L41-L45"}}),e._v(" "),t("p",[e._v("In the message handler the reject steps are:")]),e._v(" "),t("ol",[t("li",[t("p",[e._v("Fetch the relevant information:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"c3RvcmVkR2FtZSwgZm91bmQgOj0gay5LZWVwZXIuR2V0U3RvcmVkR2FtZShjdHgsIG1zZy5JZFZhbHVlKQppZiAhZm91bmQgewogICAgcmV0dXJuIG5pbCwgc2RrZXJyb3JzLldyYXBmKHR5cGVzLkVyckdhbWVOb3RGb3VuZCwgJnF1b3Q7Z2FtZSBub3QgZm91bmQgJXMmcXVvdDssIG1zZy5JZFZhbHVlKQp9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/329c6d0ae8c1dffa85cd437d0cebb246a827dfb2/x/checkers/keeper/msg_server_reject_game.go#L15-L18"}})],1),e._v(" "),t("li",[t("p",[e._v("Is the player expected? Did the player already play? Check with:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"aWYgc3RyaW5ncy5Db21wYXJlKHN0b3JlZEdhbWUuUmVkLCBtc2cuQ3JlYXRvcikgPT0gMCB7CiAgICBpZiAxICZsdDsgc3RvcmVkR2FtZS5Nb3ZlQ291bnQgeyAvLyBOb3RpY2UgdGhlIHVzZSBvZiB0aGUgbmV3IGZpZWxkCiAgICAgICAgcmV0dXJuIG5pbCwgdHlwZXMuRXJyUmVkQWxyZWFkeVBsYXllZAogICAgfQp9IGVsc2UgaWYgc3RyaW5ncy5Db21wYXJlKHN0b3JlZEdhbWUuQmxhY2ssIG1zZy5DcmVhdG9yKSA9PSAwIHsKICAgIGlmIDAgJmx0OyBzdG9yZWRHYW1lLk1vdmVDb3VudCB7IC8vIE5vdGljZSB0aGUgdXNlIG9mIHRoZSBuZXcgZmllbGQKICAgICAgICByZXR1cm4gbmlsLCB0eXBlcy5FcnJCbGFja0FscmVhZHlQbGF5ZWQKICAgIH0KfSBlbHNlIHsKICAgIHJldHVybiBuaWwsIHR5cGVzLkVyckNyZWF0b3JOb3RQbGF5ZXIKfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/329c6d0ae8c1dffa85cd437d0cebb246a827dfb2/x/checkers/keeper/msg_server_reject_game.go#L21-L31"}}),e._v(" "),t("p",[e._v("Remember that the player with the color black plays first.")])],1),e._v(" "),t("li",[t("p",[e._v("Remove the game:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ay5LZWVwZXIuUmVtb3ZlU3RvcmVkR2FtZShjdHgsIG1zZy5JZFZhbHVlKQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/329c6d0ae8c1dffa85cd437d0cebb246a827dfb2/x/checkers/keeper/msg_server_reject_game.go#L34"}}),e._v(" "),t("p",[e._v("Finally using the "),t("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/create-game-msg/x/checkers/keeper/stored_game.go#L30",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("Keeper.RemoveStoredGame")]),t("OutboundLink")],1),e._v(" function created long ago by the "),t("code",[e._v("starport scaffold map storedGame...")]),e._v(" command.")])],1),e._v(" "),t("li",[t("p",[e._v("Emit the relevant event:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Y3R4LkV2ZW50TWFuYWdlcigpLkVtaXRFdmVudCgKICAgIHNkay5OZXdFdmVudChzZGsuRXZlbnRUeXBlTWVzc2FnZSwKICAgICAgICBzZGsuTmV3QXR0cmlidXRlKHNkay5BdHRyaWJ1dGVLZXlNb2R1bGUsICZxdW90O2NoZWNrZXJzJnF1b3Q7KSwKICAgICAgICBzZGsuTmV3QXR0cmlidXRlKHNkay5BdHRyaWJ1dGVLZXlBY3Rpb24sIHR5cGVzLlJlamVjdEdhbWVFdmVudEtleSksCiAgICAgICAgc2RrLk5ld0F0dHJpYnV0ZSh0eXBlcy5SZWplY3RHYW1lRXZlbnRDcmVhdG9yLCBtc2cuQ3JlYXRvciksCiAgICAgICAgc2RrLk5ld0F0dHJpYnV0ZSh0eXBlcy5SZWplY3RHYW1lRXZlbnRJZFZhbHVlLCBtc2cuSWRWYWx1ZSksCiAgICApLAopCg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/329c6d0ae8c1dffa85cd437d0cebb246a827dfb2/x/checkers/keeper/msg_server_reject_game.go#L37-L44"}})],1),e._v(" "),t("li",[t("p",[e._v("Leave the returned object as it is as you have nothing new to tell the caller.")])])]),e._v(" "),t("p",[e._v("You can confirm that your project at least compiles "),t("a",{attrs:{href:"https://docs.starport.network/cli/#starport-chain-build",target:"_blank",rel:"noopener noreferrer"}},[e._v("with"),t("OutboundLink")],1),e._v(":")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBzdGFycG9ydCBjaGFpbiBidWlsZAo="}}),e._v(" "),t("h2",{attrs:{id:"next-up"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#next-up"}},[e._v("#")]),e._v(" Next up")]),e._v(" "),t("p",[e._v("The next four sections cover forfeits and how games end. In the next section you create a "),t("RouterLink",{attrs:{to:"/academy/4-my-own-chain/game-fifo.html"}},[e._v("doubly-linked FIFO")]),e._v(".")],1),e._v(" "),t("p",[e._v("Later you add a "),t("RouterLink",{attrs:{to:"/academy/4-my-own-chain/game-deadline.html"}},[e._v("deadline")]),e._v(" and a "),t("RouterLink",{attrs:{to:"/academy/4-my-own-chain/game-winner.html"}},[e._v("game winner")]),e._v(" fields, before being able to finally "),t("RouterLink",{attrs:{to:"/academy/4-my-own-chain/game-forfeit.html"}},[e._v("enforce the forfeit")]),e._v(".")],1),e._v(" "),t("p",[e._v("If you want to enable token wagers in your games instead, skip ahead to "),t("RouterLink",{attrs:{to:"/academy/4-my-own-chain/game-wager.html"}},[e._v("wagers")]),e._v(".")],1)],1)}),[],!1,null,null,null);a.default=c.exports}}]);